/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Iv=Object.create;var Ma=Object.defineProperty;var kv=Object.getOwnPropertyDescriptor;var Cv=Object.getOwnPropertyNames;var Av=Object.getPrototypeOf,Tv=Object.prototype.hasOwnProperty;var Dv=(o,e,t)=>e in o?Ma(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Ws=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),gf=(o,e)=>{for(var t in e)Ma(o,t,{get:e[t],enumerable:!0})},Bp=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Cv(e))!Tv.call(o,n)&&n!==t&&Ma(o,n,{get:()=>e[n],enumerable:!(r=kv(e,n))||r.enumerable});return o};var Fa=(o,e,t)=>(t=o!=null?Iv(Av(o)):{},Bp(e||!o||!o.__esModule?Ma(t,"default",{value:o,enumerable:!0}):t,o)),Ev=o=>Bp(Ma({},"__esModule",{value:!0}),o);var pt=(o,e,t)=>(Dv(o,typeof e!="symbol"?e+"":e,t),t);var qs=Ws((UA,Hp)=>{"use strict";function Er(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function Np(o,e){for(var t="",r=0,n=-1,a=0,s,i=0;i<=o.length;++i){if(i<o.length)s=o.charCodeAt(i);else{if(s===47)break;s=47}if(s===47){if(!(n===i-1||a===1))if(n!==i-1&&a===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var f=t.lastIndexOf("/");if(f!==t.length-1){f===-1?(t="",r=0):(t=t.slice(0,f),r=t.length-1-t.lastIndexOf("/")),n=i,a=0;continue}}else if(t.length===2||t.length===1){t="",r=0,n=i,a=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+o.slice(n+1,i):t=o.slice(n+1,i),r=i-n-1;n=i,a=0}else s===46&&a!==-1?++a:a=-1}return t}function Pv(o,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+o+r:r}var In={resolve:function(){for(var e="",t=!1,r,n=arguments.length-1;n>=-1&&!t;n--){var a;n>=0?a=arguments[n]:(r===void 0&&(r=process.cwd()),a=r),Er(a),a.length!==0&&(e=a+"/"+e,t=a.charCodeAt(0)===47)}return e=Np(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(Er(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=Np(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return Er(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];Er(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":In.normalize(e)},relative:function(e,t){if(Er(e),Er(t),e===t||(e=In.resolve(e),t=In.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var n=e.length,a=n-r,s=1;s<t.length&&t.charCodeAt(s)===47;++s);for(var i=t.length,f=i-s,c=a<f?a:f,d=-1,p=0;p<=c;++p){if(p===c){if(f>c){if(t.charCodeAt(s+p)===47)return t.slice(s+p+1);if(p===0)return t.slice(s+p)}else a>c&&(e.charCodeAt(r+p)===47?d=p:p===0&&(d=0));break}var h=e.charCodeAt(r+p),y=t.charCodeAt(s+p);if(h!==y)break;h===47&&(d=p)}var g="";for(p=r+d+1;p<=n;++p)(p===n||e.charCodeAt(p)===47)&&(g.length===0?g+="..":g+="/..");return g.length>0?g+t.slice(s+d):(s+=d,t.charCodeAt(s)===47&&++s,t.slice(s))},_makeLong:function(e){return e},dirname:function(e){if(Er(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,n=-1,a=!0,s=e.length-1;s>=1;--s)if(t=e.charCodeAt(s),t===47){if(!a){n=s;break}}else a=!1;return n===-1?r?"/":".":r&&n===1?"//":e.slice(0,n)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');Er(e);var r=0,n=-1,a=!0,s;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var i=t.length-1,f=-1;for(s=e.length-1;s>=0;--s){var c=e.charCodeAt(s);if(c===47){if(!a){r=s+1;break}}else f===-1&&(a=!1,f=s+1),i>=0&&(c===t.charCodeAt(i)?--i===-1&&(n=s):(i=-1,n=f))}return r===n?n=f:n===-1&&(n=e.length),e.slice(r,n)}else{for(s=e.length-1;s>=0;--s)if(e.charCodeAt(s)===47){if(!a){r=s+1;break}}else n===-1&&(a=!1,n=s+1);return n===-1?"":e.slice(r,n)}},extname:function(e){Er(e);for(var t=-1,r=0,n=-1,a=!0,s=0,i=e.length-1;i>=0;--i){var f=e.charCodeAt(i);if(f===47){if(!a){r=i+1;break}continue}n===-1&&(a=!1,n=i+1),f===46?t===-1?t=i:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||n===-1||s===0||s===1&&t===n-1&&t===r+1?"":e.slice(t,n)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return Pv("/",e)},parse:function(e){Er(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),n=r===47,a;n?(t.root="/",a=1):a=0;for(var s=-1,i=0,f=-1,c=!0,d=e.length-1,p=0;d>=a;--d){if(r=e.charCodeAt(d),r===47){if(!c){i=d+1;break}continue}f===-1&&(c=!1,f=d+1),r===46?s===-1?s=d:p!==1&&(p=1):s!==-1&&(p=-1)}return s===-1||f===-1||p===0||p===1&&s===f-1&&s===i+1?f!==-1&&(i===0&&n?t.base=t.name=e.slice(1,f):t.base=t.name=e.slice(i,f)):(i===0&&n?(t.name=e.slice(1,s),t.base=e.slice(1,f)):(t.name=e.slice(i,s),t.base=e.slice(i,f)),t.ext=e.slice(s,f)),i>0?t.dir=e.slice(0,i-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};In.posix=In;Hp.exports=In});var Og=Ws((_F,ha)=>{var z=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},$e=-1,Ne=1,we=0;z.Diff=function(o,e){return[o,e]};z.prototype.diff_main=function(o,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var n=r;if(o==null||e==null)throw new Error("Null input. (diff_main)");if(o==e)return o?[new z.Diff(we,o)]:[];typeof t=="undefined"&&(t=!0);var a=t,s=this.diff_commonPrefix(o,e),i=o.substring(0,s);o=o.substring(s),e=e.substring(s),s=this.diff_commonSuffix(o,e);var f=o.substring(o.length-s);o=o.substring(0,o.length-s),e=e.substring(0,e.length-s);var c=this.diff_compute_(o,e,a,n);return i&&c.unshift(new z.Diff(we,i)),f&&c.push(new z.Diff(we,f)),this.diff_cleanupMerge(c),c};z.prototype.diff_compute_=function(o,e,t,r){var n;if(!o)return[new z.Diff(Ne,e)];if(!e)return[new z.Diff($e,o)];var a=o.length>e.length?o:e,s=o.length>e.length?e:o,i=a.indexOf(s);if(i!=-1)return n=[new z.Diff(Ne,a.substring(0,i)),new z.Diff(we,s),new z.Diff(Ne,a.substring(i+s.length))],o.length>e.length&&(n[0][0]=n[2][0]=$e),n;if(s.length==1)return[new z.Diff($e,o),new z.Diff(Ne,e)];var f=this.diff_halfMatch_(o,e);if(f){var c=f[0],d=f[1],p=f[2],h=f[3],y=f[4],g=this.diff_main(c,p,t,r),v=this.diff_main(d,h,t,r);return g.concat([new z.Diff(we,y)],v)}return t&&o.length>100&&e.length>100?this.diff_lineMode_(o,e,r):this.diff_bisect_(o,e,r)};z.prototype.diff_lineMode_=function(o,e,t){var r=this.diff_linesToChars_(o,e);o=r.chars1,e=r.chars2;var n=r.lineArray,a=this.diff_main(o,e,!1,t);this.diff_charsToLines_(a,n),this.diff_cleanupSemantic(a),a.push(new z.Diff(we,""));for(var s=0,i=0,f=0,c="",d="";s<a.length;){switch(a[s][0]){case Ne:f++,d+=a[s][1];break;case $e:i++,c+=a[s][1];break;case we:if(i>=1&&f>=1){a.splice(s-i-f,i+f),s=s-i-f;for(var p=this.diff_main(c,d,!1,t),h=p.length-1;h>=0;h--)a.splice(s,0,p[h]);s=s+p.length}f=0,i=0,c="",d="";break}s++}return a.pop(),a};z.prototype.diff_bisect_=function(o,e,t){for(var r=o.length,n=e.length,a=Math.ceil((r+n)/2),s=a,i=2*a,f=new Array(i),c=new Array(i),d=0;d<i;d++)f[d]=-1,c[d]=-1;f[s+1]=0,c[s+1]=0;for(var p=r-n,h=p%2!=0,y=0,g=0,v=0,b=0,_=0;_<a&&!(new Date().getTime()>t);_++){for(var D=-_+y;D<=_-g;D+=2){var F=s+D,S;D==-_||D!=_&&f[F-1]<f[F+1]?S=f[F+1]:S=f[F-1]+1;for(var P=S-D;S<r&&P<n&&o.charAt(S)==e.charAt(P);)S++,P++;if(f[F]=S,S>r)g+=2;else if(P>n)y+=2;else if(h){var H=s+p-D;if(H>=0&&H<i&&c[H]!=-1){var R=r-c[H];if(S>=R)return this.diff_bisectSplit_(o,e,S,P,t)}}}for(var V=-_+v;V<=_-b;V+=2){var H=s+V,R;V==-_||V!=_&&c[H-1]<c[H+1]?R=c[H+1]:R=c[H-1]+1;for(var O=R-V;R<r&&O<n&&o.charAt(r-R-1)==e.charAt(n-O-1);)R++,O++;if(c[H]=R,R>r)b+=2;else if(O>n)v+=2;else if(!h){var F=s+p-V;if(F>=0&&F<i&&f[F]!=-1){var S=f[F],P=s+S-F;if(R=r-R,S>=R)return this.diff_bisectSplit_(o,e,S,P,t)}}}}return[new z.Diff($e,o),new z.Diff(Ne,e)]};z.prototype.diff_bisectSplit_=function(o,e,t,r,n){var a=o.substring(0,t),s=e.substring(0,r),i=o.substring(t),f=e.substring(r),c=this.diff_main(a,s,!1,n),d=this.diff_main(i,f,!1,n);return c.concat(d)};z.prototype.diff_linesToChars_=function(o,e){var t=[],r={};t[0]="";function n(f){for(var c="",d=0,p=-1,h=t.length;p<f.length-1;){p=f.indexOf(`
`,d),p==-1&&(p=f.length-1);var y=f.substring(d,p+1);(r.hasOwnProperty?r.hasOwnProperty(y):r[y]!==void 0)?c+=String.fromCharCode(r[y]):(h==a&&(y=f.substring(d),p=f.length),c+=String.fromCharCode(h),r[y]=h,t[h++]=y),d=p+1}return c}var a=4e4,s=n(o);a=65535;var i=n(e);return{chars1:s,chars2:i,lineArray:t}};z.prototype.diff_charsToLines_=function(o,e){for(var t=0;t<o.length;t++){for(var r=o[t][1],n=[],a=0;a<r.length;a++)n[a]=e[r.charCodeAt(a)];o[t][1]=n.join("")}};z.prototype.diff_commonPrefix=function(o,e){if(!o||!e||o.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,a=0;t<n;)o.substring(a,n)==e.substring(a,n)?(t=n,a=t):r=n,n=Math.floor((r-t)/2+t);return n};z.prototype.diff_commonSuffix=function(o,e){if(!o||!e||o.charAt(o.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,a=0;t<n;)o.substring(o.length-n,o.length-a)==e.substring(e.length-n,e.length-a)?(t=n,a=t):r=n,n=Math.floor((r-t)/2+t);return n};z.prototype.diff_commonOverlap_=function(o,e){var t=o.length,r=e.length;if(t==0||r==0)return 0;t>r?o=o.substring(t-r):t<r&&(e=e.substring(0,t));var n=Math.min(t,r);if(o==e)return n;for(var a=0,s=1;;){var i=o.substring(n-s),f=e.indexOf(i);if(f==-1)return a;s+=f,(f==0||o.substring(n-s)==e.substring(0,s))&&(a=s,s++)}};z.prototype.diff_halfMatch_=function(o,e){if(this.Diff_Timeout<=0)return null;var t=o.length>e.length?o:e,r=o.length>e.length?e:o;if(t.length<4||r.length*2<t.length)return null;var n=this;function a(g,v,b){for(var _=g.substring(b,b+Math.floor(g.length/4)),D=-1,F="",S,P,H,R;(D=v.indexOf(_,D+1))!=-1;){var V=n.diff_commonPrefix(g.substring(b),v.substring(D)),O=n.diff_commonSuffix(g.substring(0,b),v.substring(0,D));F.length<O+V&&(F=v.substring(D-O,D)+v.substring(D,D+V),S=g.substring(0,b-O),P=g.substring(b+V),H=v.substring(0,D-O),R=v.substring(D+V))}return F.length*2>=g.length?[S,P,H,R,F]:null}var s=a(t,r,Math.ceil(t.length/4)),i=a(t,r,Math.ceil(t.length/2)),f;if(!s&&!i)return null;i?s?f=s[4].length>i[4].length?s:i:f=i:f=s;var c,d,p,h;o.length>e.length?(c=f[0],d=f[1],p=f[2],h=f[3]):(p=f[0],h=f[1],c=f[2],d=f[3]);var y=f[4];return[c,d,p,h,y]};z.prototype.diff_cleanupSemantic=function(o){for(var e=!1,t=[],r=0,n=null,a=0,s=0,i=0,f=0,c=0;a<o.length;)o[a][0]==we?(t[r++]=a,s=f,i=c,f=0,c=0,n=o[a][1]):(o[a][0]==Ne?f+=o[a][1].length:c+=o[a][1].length,n&&n.length<=Math.max(s,i)&&n.length<=Math.max(f,c)&&(o.splice(t[r-1],0,new z.Diff($e,n)),o[t[r-1]+1][0]=Ne,r--,r--,a=r>0?t[r-1]:-1,s=0,i=0,f=0,c=0,n=null,e=!0)),a++;for(e&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),a=1;a<o.length;){if(o[a-1][0]==$e&&o[a][0]==Ne){var d=o[a-1][1],p=o[a][1],h=this.diff_commonOverlap_(d,p),y=this.diff_commonOverlap_(p,d);h>=y?(h>=d.length/2||h>=p.length/2)&&(o.splice(a,0,new z.Diff(we,p.substring(0,h))),o[a-1][1]=d.substring(0,d.length-h),o[a+1][1]=p.substring(h),a++):(y>=d.length/2||y>=p.length/2)&&(o.splice(a,0,new z.Diff(we,d.substring(0,y))),o[a-1][0]=Ne,o[a-1][1]=p.substring(0,p.length-y),o[a+1][0]=$e,o[a+1][1]=d.substring(y),a++),a++}a++}};z.prototype.diff_cleanupSemanticLossless=function(o){function e(y,g){if(!y||!g)return 6;var v=y.charAt(y.length-1),b=g.charAt(0),_=v.match(z.nonAlphaNumericRegex_),D=b.match(z.nonAlphaNumericRegex_),F=_&&v.match(z.whitespaceRegex_),S=D&&b.match(z.whitespaceRegex_),P=F&&v.match(z.linebreakRegex_),H=S&&b.match(z.linebreakRegex_),R=P&&y.match(z.blanklineEndRegex_),V=H&&g.match(z.blanklineStartRegex_);return R||V?5:P||H?4:_&&!F&&S?3:F||S?2:_||D?1:0}for(var t=1;t<o.length-1;){if(o[t-1][0]==we&&o[t+1][0]==we){var r=o[t-1][1],n=o[t][1],a=o[t+1][1],s=this.diff_commonSuffix(r,n);if(s){var i=n.substring(n.length-s);r=r.substring(0,r.length-s),n=i+n.substring(0,n.length-s),a=i+a}for(var f=r,c=n,d=a,p=e(r,n)+e(n,a);n.charAt(0)===a.charAt(0);){r+=n.charAt(0),n=n.substring(1)+a.charAt(0),a=a.substring(1);var h=e(r,n)+e(n,a);h>=p&&(p=h,f=r,c=n,d=a)}o[t-1][1]!=f&&(f?o[t-1][1]=f:(o.splice(t-1,1),t--),o[t][1]=c,d?o[t+1][1]=d:(o.splice(t+1,1),t--))}t++}};z.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;z.whitespaceRegex_=/\s/;z.linebreakRegex_=/[\r\n]/;z.blanklineEndRegex_=/\n\r?\n$/;z.blanklineStartRegex_=/^\r?\n\r?\n/;z.prototype.diff_cleanupEfficiency=function(o){for(var e=!1,t=[],r=0,n=null,a=0,s=!1,i=!1,f=!1,c=!1;a<o.length;)o[a][0]==we?(o[a][1].length<this.Diff_EditCost&&(f||c)?(t[r++]=a,s=f,i=c,n=o[a][1]):(r=0,n=null),f=c=!1):(o[a][0]==$e?c=!0:f=!0,n&&(s&&i&&f&&c||n.length<this.Diff_EditCost/2&&s+i+f+c==3)&&(o.splice(t[r-1],0,new z.Diff($e,n)),o[t[r-1]+1][0]=Ne,r--,n=null,s&&i?(f=c=!0,r=0):(r--,a=r>0?t[r-1]:-1,f=c=!1),e=!0)),a++;e&&this.diff_cleanupMerge(o)};z.prototype.diff_cleanupMerge=function(o){o.push(new z.Diff(we,""));for(var e=0,t=0,r=0,n="",a="",s;e<o.length;)switch(o[e][0]){case Ne:r++,a+=o[e][1],e++;break;case $e:t++,n+=o[e][1],e++;break;case we:t+r>1?(t!==0&&r!==0&&(s=this.diff_commonPrefix(a,n),s!==0&&(e-t-r>0&&o[e-t-r-1][0]==we?o[e-t-r-1][1]+=a.substring(0,s):(o.splice(0,0,new z.Diff(we,a.substring(0,s))),e++),a=a.substring(s),n=n.substring(s)),s=this.diff_commonSuffix(a,n),s!==0&&(o[e][1]=a.substring(a.length-s)+o[e][1],a=a.substring(0,a.length-s),n=n.substring(0,n.length-s))),e-=t+r,o.splice(e,t+r),n.length&&(o.splice(e,0,new z.Diff($e,n)),e++),a.length&&(o.splice(e,0,new z.Diff(Ne,a)),e++),e++):e!==0&&o[e-1][0]==we?(o[e-1][1]+=o[e][1],o.splice(e,1)):e++,r=0,t=0,n="",a="";break}o[o.length-1][1]===""&&o.pop();var i=!1;for(e=1;e<o.length-1;)o[e-1][0]==we&&o[e+1][0]==we&&(o[e][1].substring(o[e][1].length-o[e-1][1].length)==o[e-1][1]?(o[e][1]=o[e-1][1]+o[e][1].substring(0,o[e][1].length-o[e-1][1].length),o[e+1][1]=o[e-1][1]+o[e+1][1],o.splice(e-1,1),i=!0):o[e][1].substring(0,o[e+1][1].length)==o[e+1][1]&&(o[e-1][1]+=o[e+1][1],o[e][1]=o[e][1].substring(o[e+1][1].length)+o[e+1][1],o.splice(e+1,1),i=!0)),e++;i&&this.diff_cleanupMerge(o)};z.prototype.diff_xIndex=function(o,e){var t=0,r=0,n=0,a=0,s;for(s=0;s<o.length&&(o[s][0]!==Ne&&(t+=o[s][1].length),o[s][0]!==$e&&(r+=o[s][1].length),!(t>e));s++)n=t,a=r;return o.length!=s&&o[s][0]===$e?a:a+(e-n)};z.prototype.diff_prettyHtml=function(o){for(var e=[],t=/&/g,r=/</g,n=/>/g,a=/\n/g,s=0;s<o.length;s++){var i=o[s][0],f=o[s][1],c=f.replace(t,"&amp;").replace(r,"&lt;").replace(n,"&gt;").replace(a,"&para;<br>");switch(i){case Ne:e[s]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case $e:e[s]='<del style="background:#ffe6e6;">'+c+"</del>";break;case we:e[s]="<span>"+c+"</span>";break}}return e.join("")};z.prototype.diff_text1=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==Ne&&(e[t]=o[t][1]);return e.join("")};z.prototype.diff_text2=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==$e&&(e[t]=o[t][1]);return e.join("")};z.prototype.diff_levenshtein=function(o){for(var e=0,t=0,r=0,n=0;n<o.length;n++){var a=o[n][0],s=o[n][1];switch(a){case Ne:t+=s.length;break;case $e:r+=s.length;break;case we:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};z.prototype.diff_toDelta=function(o){for(var e=[],t=0;t<o.length;t++)switch(o[t][0]){case Ne:e[t]="+"+encodeURI(o[t][1]);break;case $e:e[t]="-"+o[t][1].length;break;case we:e[t]="="+o[t][1].length;break}return e.join("	").replace(/%20/g," ")};z.prototype.diff_fromDelta=function(o,e){for(var t=[],r=0,n=0,a=e.split(/\t/g),s=0;s<a.length;s++){var i=a[s].substring(1);switch(a[s].charAt(0)){case"+":try{t[r++]=new z.Diff(Ne,decodeURI(i))}catch(d){throw new Error("Illegal escape in diff_fromDelta: "+i)}break;case"-":case"=":var f=parseInt(i,10);if(isNaN(f)||f<0)throw new Error("Invalid number in diff_fromDelta: "+i);var c=o.substring(n,n+=f);a[s].charAt(0)=="="?t[r++]=new z.Diff(we,c):t[r++]=new z.Diff($e,c);break;default:if(a[s])throw new Error("Invalid diff operation in diff_fromDelta: "+a[s])}}if(n!=o.length)throw new Error("Delta length ("+n+") does not equal source text length ("+o.length+").");return t};z.prototype.match_main=function(o,e,t){if(o==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,o.length)),o==e?0:o.length?o.substring(t,t+e.length)==e?t:this.match_bitap_(o,e,t):-1};z.prototype.match_bitap_=function(o,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),n=this;function a(S,P){var H=S/e.length,R=Math.abs(t-P);return n.Match_Distance?H+R/n.Match_Distance:R?1:H}var s=this.Match_Threshold,i=o.indexOf(e,t);i!=-1&&(s=Math.min(a(0,i),s),i=o.lastIndexOf(e,t+e.length),i!=-1&&(s=Math.min(a(0,i),s)));var f=1<<e.length-1;i=-1;for(var c,d,p=e.length+o.length,h,y=0;y<e.length;y++){for(c=0,d=p;c<d;)a(y,t+d)<=s?c=d:p=d,d=Math.floor((p-c)/2+c);p=d;var g=Math.max(1,t-d+1),v=Math.min(t+d,o.length)+e.length,b=Array(v+2);b[v+1]=(1<<y)-1;for(var _=v;_>=g;_--){var D=r[o.charAt(_-1)];if(y===0?b[_]=(b[_+1]<<1|1)&D:b[_]=(b[_+1]<<1|1)&D|((h[_+1]|h[_])<<1|1)|h[_+1],b[_]&f){var F=a(y,_-1);if(F<=s)if(s=F,i=_-1,i>t)g=Math.max(1,2*t-i);else break}}if(a(y+1,t)>s)break;h=b}return i};z.prototype.match_alphabet_=function(o){for(var e={},t=0;t<o.length;t++)e[o.charAt(t)]=0;for(var t=0;t<o.length;t++)e[o.charAt(t)]|=1<<o.length-t-1;return e};z.prototype.patch_addContext_=function(o,e){if(e.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var t=e.substring(o.start2,o.start2+o.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(o.start2-r,o.start2+o.length1+r);r+=this.Patch_Margin;var n=e.substring(o.start2-r,o.start2);n&&o.diffs.unshift(new z.Diff(we,n));var a=e.substring(o.start2+o.length1,o.start2+o.length1+r);a&&o.diffs.push(new z.Diff(we,a)),o.start1-=n.length,o.start2-=n.length,o.length1+=n.length+a.length,o.length2+=n.length+a.length}};z.prototype.patch_make=function(o,e,t){var r,n;if(typeof o=="string"&&typeof e=="string"&&typeof t=="undefined")r=o,n=this.diff_main(r,e,!0),n.length>2&&(this.diff_cleanupSemantic(n),this.diff_cleanupEfficiency(n));else if(o&&typeof o=="object"&&typeof e=="undefined"&&typeof t=="undefined")n=o,r=this.diff_text1(n);else if(typeof o=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=o,n=e;else if(typeof o=="string"&&typeof e=="string"&&t&&typeof t=="object")r=o,n=t;else throw new Error("Unknown call format to patch_make.");if(n.length===0)return[];for(var a=[],s=new z.patch_obj,i=0,f=0,c=0,d=r,p=r,h=0;h<n.length;h++){var y=n[h][0],g=n[h][1];switch(!i&&y!==we&&(s.start1=f,s.start2=c),y){case Ne:s.diffs[i++]=n[h],s.length2+=g.length,p=p.substring(0,c)+g+p.substring(c);break;case $e:s.length1+=g.length,s.diffs[i++]=n[h],p=p.substring(0,c)+p.substring(c+g.length);break;case we:g.length<=2*this.Patch_Margin&&i&&n.length!=h+1?(s.diffs[i++]=n[h],s.length1+=g.length,s.length2+=g.length):g.length>=2*this.Patch_Margin&&i&&(this.patch_addContext_(s,d),a.push(s),s=new z.patch_obj,i=0,d=p,f=c);break}y!==Ne&&(f+=g.length),y!==$e&&(c+=g.length)}return i&&(this.patch_addContext_(s,d),a.push(s)),a};z.prototype.patch_deepCopy=function(o){for(var e=[],t=0;t<o.length;t++){var r=o[t],n=new z.patch_obj;n.diffs=[];for(var a=0;a<r.diffs.length;a++)n.diffs[a]=new z.Diff(r.diffs[a][0],r.diffs[a][1]);n.start1=r.start1,n.start2=r.start2,n.length1=r.length1,n.length2=r.length2,e[t]=n}return e};z.prototype.patch_apply=function(o,e){if(o.length==0)return[e,[]];o=this.patch_deepCopy(o);var t=this.patch_addPadding(o);e=t+e+t,this.patch_splitMax(o);for(var r=0,n=[],a=0;a<o.length;a++){var s=o[a].start2+r,i=this.diff_text1(o[a].diffs),f,c=-1;if(i.length>this.Match_MaxBits?(f=this.match_main(e,i.substring(0,this.Match_MaxBits),s),f!=-1&&(c=this.match_main(e,i.substring(i.length-this.Match_MaxBits),s+i.length-this.Match_MaxBits),(c==-1||f>=c)&&(f=-1))):f=this.match_main(e,i,s),f==-1)n[a]=!1,r-=o[a].length2-o[a].length1;else{n[a]=!0,r=f-s;var d;if(c==-1?d=e.substring(f,f+i.length):d=e.substring(f,c+this.Match_MaxBits),i==d)e=e.substring(0,f)+this.diff_text2(o[a].diffs)+e.substring(f+i.length);else{var p=this.diff_main(i,d,!1);if(i.length>this.Match_MaxBits&&this.diff_levenshtein(p)/i.length>this.Patch_DeleteThreshold)n[a]=!1;else{this.diff_cleanupSemanticLossless(p);for(var h=0,y,g=0;g<o[a].diffs.length;g++){var v=o[a].diffs[g];v[0]!==we&&(y=this.diff_xIndex(p,h)),v[0]===Ne?e=e.substring(0,f+y)+v[1]+e.substring(f+y):v[0]===$e&&(e=e.substring(0,f+y)+e.substring(f+this.diff_xIndex(p,h+v[1].length))),v[0]!==$e&&(h+=v[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,n]};z.prototype.patch_addPadding=function(o){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<o.length;r++)o[r].start1+=e,o[r].start2+=e;var n=o[0],a=n.diffs;if(a.length==0||a[0][0]!=we)a.unshift(new z.Diff(we,t)),n.start1-=e,n.start2-=e,n.length1+=e,n.length2+=e;else if(e>a[0][1].length){var s=e-a[0][1].length;a[0][1]=t.substring(a[0][1].length)+a[0][1],n.start1-=s,n.start2-=s,n.length1+=s,n.length2+=s}if(n=o[o.length-1],a=n.diffs,a.length==0||a[a.length-1][0]!=we)a.push(new z.Diff(we,t)),n.length1+=e,n.length2+=e;else if(e>a[a.length-1][1].length){var s=e-a[a.length-1][1].length;a[a.length-1][1]+=t.substring(0,s),n.length1+=s,n.length2+=s}return t};z.prototype.patch_splitMax=function(o){for(var e=this.Match_MaxBits,t=0;t<o.length;t++)if(!(o[t].length1<=e)){var r=o[t];o.splice(t--,1);for(var n=r.start1,a=r.start2,s="";r.diffs.length!==0;){var i=new z.patch_obj,f=!0;for(i.start1=n-s.length,i.start2=a-s.length,s!==""&&(i.length1=i.length2=s.length,i.diffs.push(new z.Diff(we,s)));r.diffs.length!==0&&i.length1<e-this.Patch_Margin;){var c=r.diffs[0][0],d=r.diffs[0][1];c===Ne?(i.length2+=d.length,a+=d.length,i.diffs.push(r.diffs.shift()),f=!1):c===$e&&i.diffs.length==1&&i.diffs[0][0]==we&&d.length>2*e?(i.length1+=d.length,n+=d.length,f=!1,i.diffs.push(new z.Diff(c,d)),r.diffs.shift()):(d=d.substring(0,e-i.length1-this.Patch_Margin),i.length1+=d.length,n+=d.length,c===we?(i.length2+=d.length,a+=d.length):f=!1,i.diffs.push(new z.Diff(c,d)),d==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(d.length))}s=this.diff_text2(i.diffs),s=s.substring(s.length-this.Patch_Margin);var p=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);p!==""&&(i.length1+=p.length,i.length2+=p.length,i.diffs.length!==0&&i.diffs[i.diffs.length-1][0]===we?i.diffs[i.diffs.length-1][1]+=p:i.diffs.push(new z.Diff(we,p))),f||o.splice(++t,0,i)}}};z.prototype.patch_toText=function(o){for(var e=[],t=0;t<o.length;t++)e[t]=o[t];return e.join("")};z.prototype.patch_fromText=function(o){var e=[];if(!o)return e;for(var t=o.split(`
`),r=0,n=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var a=t[r].match(n);if(!a)throw new Error("Invalid patch string: "+t[r]);var s=new z.patch_obj;for(e.push(s),s.start1=parseInt(a[1],10),a[2]===""?(s.start1--,s.length1=1):a[2]=="0"?s.length1=0:(s.start1--,s.length1=parseInt(a[2],10)),s.start2=parseInt(a[3],10),a[4]===""?(s.start2--,s.length2=1):a[4]=="0"?s.length2=0:(s.start2--,s.length2=parseInt(a[4],10)),r++;r<t.length;){var i=t[r].charAt(0);try{var f=decodeURI(t[r].substring(1))}catch(c){throw new Error("Illegal escape in patch_fromText: "+f)}if(i=="-")s.diffs.push(new z.Diff($e,f));else if(i=="+")s.diffs.push(new z.Diff(Ne,f));else if(i==" ")s.diffs.push(new z.Diff(we,f));else{if(i=="@")break;if(i!=="")throw new Error('Invalid patch mode "'+i+'" in: '+f)}r++}}return e};z.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};z.patch_obj.prototype.toString=function(){var o,e;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+o+" +"+e+` @@
`],r,n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case Ne:r="+";break;case $e:r="-";break;case we:r=" ";break}t[n+1]=r+encodeURI(this.diffs[n][1])+`
`}return t.join("").replace(/%20/g," ")};ha.exports=z;ha.exports.diff_match_patch=z;ha.exports.DIFF_DELETE=$e;ha.exports.DIFF_INSERT=Ne;ha.exports.DIFF_EQUAL=we});var fx=Ws((xO,lx)=>{var nx=require("url").parse,pk=require("events"),mk=require("https"),hk=require("http"),gk=require("util"),xk=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],ix=[239,187,191],yk=58,wk=32,ax=10,bk=13,sx=1024*256,_k=/^(cookie|authorization)$/i;function vk(o){return ix.every(function(e,t){return o[t]===e})}function Ze(o,e){var t=Ze.CONNECTING,r=e&&e.headers,n=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return o}});var a=this;a.reconnectInterval=1e3,a.connectionInProgress=!1;function s(b){t!==Ze.CLOSED&&(t=Ze.CONNECTING,g("error",new ps("error",{message:b})),h&&(o=h,h=null,n=!1),setTimeout(function(){t!==Ze.CONNECTING||a.connectionInProgress||(a.connectionInProgress=!0,y())},a.reconnectInterval))}var i,f="";r&&r["Last-Event-ID"]&&(f=r["Last-Event-ID"],delete r["Last-Event-ID"]);var c=!1,d="",p="",h=null;function y(){var b=nx(o),_=b.protocol==="https:";if(b.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},f&&(b.headers["Last-Event-ID"]=f),r){var D=n?Lk(r):r;for(var F in D){var S=D[F];S&&(b.headers[F]=S)}}b.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(b.createConnection=e.createConnection);var P=e&&e.proxy;if(P){var H=nx(e.proxy);_=H.protocol==="https:",b.protocol=_?"https:":"http:",b.path=o,b.headers.Host=b.host,b.hostname=H.hostname,b.host=H.host,b.port=H.port}if(e&&e.https){for(var R in e.https)if(xk.indexOf(R)!==-1){var V=e.https[R];V!==void 0&&(b[R]=V)}}e&&e.withCredentials!==void 0&&(b.withCredentials=e.withCredentials),i=(_?mk:hk).request(b,function(O){if(a.connectionInProgress=!1,O.statusCode===500||O.statusCode===502||O.statusCode===503||O.statusCode===504){g("error",new ps("error",{status:O.statusCode,message:O.statusMessage})),s();return}if(O.statusCode===301||O.statusCode===302||O.statusCode===307){var te=O.headers.location;if(!te){g("error",new ps("error",{status:O.statusCode,message:O.statusMessage}));return}var ve=new URL(o).origin,ne=new URL(te).origin;n=ve!==ne,O.statusCode===307&&(h=o),o=te,process.nextTick(y);return}if(O.statusCode!==200)return g("error",new ps("error",{status:O.statusCode,message:O.statusMessage})),a.close();t=Ze.OPEN,O.on("close",function(){O.removeAllListeners("close"),O.removeAllListeners("end"),s()}),O.on("end",function(){O.removeAllListeners("close"),O.removeAllListeners("end"),s()}),g("open",new ps("open"));var fe,q,Z=0,Je=-1,Vt=0,Ue=0;O.on("data",function(Xe){fe?(Xe.length>fe.length-Ue&&(Vt=fe.length*2+Xe.length,Vt>sx&&(Vt=fe.length+Xe.length+sx),q=Buffer.alloc(Vt),fe.copy(q,0,0,Ue),fe=q),Xe.copy(fe,Ue),Ue+=Xe.length):(fe=Xe,vk(fe)&&(fe=fe.slice(ix.length)),Ue=fe.length);for(var qe=0,ue=Ue;qe<ue;){c&&(fe[qe]===ax&&++qe,c=!1);for(var je=-1,oe=Je,Ar,Xt=Z;je<0&&Xt<ue;++Xt)Ar=fe[Xt],Ar===yk?oe<0&&(oe=Xt-qe):Ar===bk?(c=!0,je=Xt-qe):Ar===ax&&(je=Xt-qe);if(je<0){Z=ue-qe,Je=oe;break}else Z=0,Je=-1;v(fe,qe,oe,je),qe+=je+1}qe===ue?(fe=void 0,Ue=0):qe>0&&(fe=fe.slice(qe,Ue),Ue=fe.length)})}),i.on("error",function(O){a.connectionInProgress=!1,s(O.message)}),i.setNoDelay&&i.setNoDelay(!0),i.end()}y();function g(){a.listeners(arguments[0]).length>0&&a.emit.apply(a,arguments)}this._close=function(){t!==Ze.CLOSED&&(t=Ze.CLOSED,i.abort&&i.abort(),i.xhr&&i.xhr.abort&&i.xhr.abort())};function v(b,_,D,F){if(F===0){if(d.length>0){var S=p||"message";g(S,new Sk(S,{data:d.slice(0,-1),lastEventId:f,origin:new URL(o).origin})),d=""}p=void 0}else if(D>0){var P=D<0,H=0,R=b.slice(_,_+(P?F:D)).toString();P?H=F:b[_+D+1]!==wk?H=D+1:H=D+2,_+=H;var V=F-H,O=b.slice(_,_+V).toString();if(R==="data")d+=O+`
`;else if(R==="event")p=O;else if(R==="id")f=O;else if(R==="retry"){var te=parseInt(O,10);Number.isNaN(te)||(a.reconnectInterval=te)}}}}lx.exports=Ze;gk.inherits(Ze,pk.EventEmitter);Ze.prototype.constructor=Ze;["open","error","message"].forEach(function(o){Object.defineProperty(Ze.prototype,"on"+o,{get:function(){var t=this.listeners(o)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(o),this.addEventListener(o,t)}})});Object.defineProperty(Ze,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(Ze,"OPEN",{enumerable:!0,value:1});Object.defineProperty(Ze,"CLOSED",{enumerable:!0,value:2});Ze.prototype.CONNECTING=0;Ze.prototype.OPEN=1;Ze.prototype.CLOSED=2;Ze.prototype.close=function(){this._close()};Ze.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};Ze.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};Ze.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function ps(o,e){if(Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function Sk(o,e){Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function Lk(o){var e={};for(var t in o)_k.test(t)||(e[t]=o[t]);return e}});var $x=Ws((cd,_a)=>{(function(o,e){typeof cd=="object"&&typeof _a!="undefined"?_a.exports=e():typeof define=="function"&&define.amd?define(e):o.moment=e()})(cd,function(){"use strict";var o;function e(){return o.apply(null,arguments)}function t(l){o=l}function r(l){return l instanceof Array||Object.prototype.toString.call(l)==="[object Array]"}function n(l){return l!=null&&Object.prototype.toString.call(l)==="[object Object]"}function a(l,u){return Object.prototype.hasOwnProperty.call(l,u)}function s(l){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(l).length===0;var u;for(u in l)if(a(l,u))return!1;return!0}function i(l){return l===void 0}function f(l){return typeof l=="number"||Object.prototype.toString.call(l)==="[object Number]"}function c(l){return l instanceof Date||Object.prototype.toString.call(l)==="[object Date]"}function d(l,u){var m=[],x,w=l.length;for(x=0;x<w;++x)m.push(u(l[x],x));return m}function p(l,u){for(var m in u)a(u,m)&&(l[m]=u[m]);return a(u,"toString")&&(l.toString=u.toString),a(u,"valueOf")&&(l.valueOf=u.valueOf),l}function h(l,u,m,x){return xp(l,u,m,x,!0).utc()}function y(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function g(l){return l._pf==null&&(l._pf=y()),l._pf}var v;Array.prototype.some?v=Array.prototype.some:v=function(l){var u=Object(this),m=u.length>>>0,x;for(x=0;x<m;x++)if(x in u&&l.call(this,u[x],x,u))return!0;return!1};function b(l){if(l._isValid==null){var u=g(l),m=v.call(u.parsedDateParts,function(w){return w!=null}),x=!isNaN(l._d.getTime())&&u.overflow<0&&!u.empty&&!u.invalidEra&&!u.invalidMonth&&!u.invalidWeekday&&!u.weekdayMismatch&&!u.nullInput&&!u.invalidFormat&&!u.userInvalidated&&(!u.meridiem||u.meridiem&&m);if(l._strict&&(x=x&&u.charsLeftOver===0&&u.unusedTokens.length===0&&u.bigHour===void 0),Object.isFrozen==null||!Object.isFrozen(l))l._isValid=x;else return x}return l._isValid}function _(l){var u=h(NaN);return l!=null?p(g(u),l):g(u).userInvalidated=!0,u}var D=e.momentProperties=[],F=!1;function S(l,u){var m,x,w,A=D.length;if(i(u._isAMomentObject)||(l._isAMomentObject=u._isAMomentObject),i(u._i)||(l._i=u._i),i(u._f)||(l._f=u._f),i(u._l)||(l._l=u._l),i(u._strict)||(l._strict=u._strict),i(u._tzm)||(l._tzm=u._tzm),i(u._isUTC)||(l._isUTC=u._isUTC),i(u._offset)||(l._offset=u._offset),i(u._pf)||(l._pf=g(u)),i(u._locale)||(l._locale=u._locale),A>0)for(m=0;m<A;m++)x=D[m],w=u[x],i(w)||(l[x]=w);return l}function P(l){S(this,l),this._d=new Date(l._d!=null?l._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),F===!1&&(F=!0,e.updateOffset(this),F=!1)}function H(l){return l instanceof P||l!=null&&l._isAMomentObject!=null}function R(l){e.suppressDeprecationWarnings===!1&&typeof console!="undefined"&&console.warn&&console.warn("Deprecation warning: "+l)}function V(l,u){var m=!0;return p(function(){if(e.deprecationHandler!=null&&e.deprecationHandler(null,l),m){var x=[],w,A,B,se=arguments.length;for(A=0;A<se;A++){if(w="",typeof arguments[A]=="object"){w+=`
[`+A+"] ";for(B in arguments[0])a(arguments[0],B)&&(w+=B+": "+arguments[0][B]+", ");w=w.slice(0,-2)}else w=arguments[A];x.push(w)}R(l+`
Arguments: `+Array.prototype.slice.call(x).join("")+`
`+new Error().stack),m=!1}return u.apply(this,arguments)},u)}var O={};function te(l,u){e.deprecationHandler!=null&&e.deprecationHandler(l,u),O[l]||(R(u),O[l]=!0)}e.suppressDeprecationWarnings=!1,e.deprecationHandler=null;function ve(l){return typeof Function!="undefined"&&l instanceof Function||Object.prototype.toString.call(l)==="[object Function]"}function ne(l){var u,m;for(m in l)a(l,m)&&(u=l[m],ve(u)?this[m]=u:this["_"+m]=u);this._config=l,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function fe(l,u){var m=p({},l),x;for(x in u)a(u,x)&&(n(l[x])&&n(u[x])?(m[x]={},p(m[x],l[x]),p(m[x],u[x])):u[x]!=null?m[x]=u[x]:delete m[x]);for(x in l)a(l,x)&&!a(u,x)&&n(l[x])&&(m[x]=p({},m[x]));return m}function q(l){l!=null&&this.set(l)}var Z;Object.keys?Z=Object.keys:Z=function(l){var u,m=[];for(u in l)a(l,u)&&m.push(u);return m};var Je={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function Vt(l,u,m){var x=this._calendar[l]||this._calendar.sameElse;return ve(x)?x.call(u,m):x}function Ue(l,u,m){var x=""+Math.abs(l),w=u-x.length,A=l>=0;return(A?m?"+":"":"-")+Math.pow(10,Math.max(0,w)).toString().substr(1)+x}var Xe=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,qe=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,ue={},je={};function oe(l,u,m,x){var w=x;typeof x=="string"&&(w=function(){return this[x]()}),l&&(je[l]=w),u&&(je[u[0]]=function(){return Ue(w.apply(this,arguments),u[1],u[2])}),m&&(je[m]=function(){return this.localeData().ordinal(w.apply(this,arguments),l)})}function Ar(l){return l.match(/\[[\s\S]/)?l.replace(/^\[|\]$/g,""):l.replace(/\\/g,"")}function Xt(l){var u=l.match(Xe),m,x;for(m=0,x=u.length;m<x;m++)je[u[m]]?u[m]=je[u[m]]:u[m]=Ar(u[m]);return function(w){var A="",B;for(B=0;B<x;B++)A+=ve(u[B])?u[B].call(w,l):u[B];return A}}function ke(l,u){return l.isValid()?(u=Rt(u,l.localeData()),ue[u]=ue[u]||Xt(u),ue[u](l)):l.localeData().invalidDate()}function Rt(l,u){var m=5;function x(w){return u.longDateFormat(w)||w}for(qe.lastIndex=0;m>=0&&qe.test(l);)l=l.replace(qe,x),qe.lastIndex=0,m-=1;return l}var Tr={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function yn(l){var u=this._longDateFormat[l],m=this._longDateFormat[l.toUpperCase()];return u||!m?u:(this._longDateFormat[l]=m.match(Xe).map(function(x){return x==="MMMM"||x==="MM"||x==="DD"||x==="dddd"?x.slice(1):x}).join(""),this._longDateFormat[l])}var Hl="Invalid date";function Vl(){return this._invalidDate}var Wl="%d",ql=/\d{1,2}/;function Kl(l){return this._ordinal.replace("%d",l)}var zl={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function Gl(l,u,m,x){var w=this._relativeTime[m];return ve(w)?w(l,u,m,x):w.replace(/%d/i,l)}function Yl(l,u){var m=this._relativeTime[l>0?"future":"past"];return ve(m)?m(u):m.replace(/%s/i,u)}var Wo={};function dt(l,u){var m=l.toLowerCase();Wo[m]=Wo[m+"s"]=Wo[u]=l}function Ot(l){return typeof l=="string"?Wo[l]||Wo[l.toLowerCase()]:void 0}function La(l){var u={},m,x;for(x in l)a(l,x)&&(m=Ot(x),m&&(u[m]=l[x]));return u}var Ls={};function K(l,u){Ls[l]=u}function Te(l){var u=[],m;for(m in l)a(l,m)&&u.push({unit:m,priority:Ls[m]});return u.sort(function(x,w){return x.priority-w.priority}),u}function Qe(l){return l%4===0&&l%100!==0||l%400===0}function Ke(l){return l<0?Math.ceil(l)||0:Math.floor(l)}function de(l){var u=+l,m=0;return u!==0&&isFinite(u)&&(m=Ke(u)),m}function ho(l,u){return function(m){return m!=null?(Xd(this,l,m),e.updateOffset(this,u),this):go(this,l)}}function go(l,u){return l.isValid()?l._d["get"+(l._isUTC?"UTC":"")+u]():NaN}function Xd(l,u,m){l.isValid()&&!isNaN(m)&&(u==="FullYear"&&Qe(l.year())&&l.month()===1&&l.date()===29?(m=de(m),l._d["set"+(l._isUTC?"UTC":"")+u](m,l.month(),Es(m,l.month()))):l._d["set"+(l._isUTC?"UTC":"")+u](m))}function Wy(l){return l=Ot(l),ve(this[l])?this[l]():this}function qy(l,u){if(typeof l=="object"){l=La(l);var m=Te(l),x,w=m.length;for(x=0;x<w;x++)this[m[x].unit](l[m[x].unit])}else if(l=Ot(l),ve(this[l]))return this[l](u);return this}var Zd=/\d/,Wt=/\d\d/,Qd=/\d{3}/,Jl=/\d{4}/,Is=/[+-]?\d{6}/,Ve=/\d\d?/,ep=/\d\d\d\d?/,tp=/\d\d\d\d\d\d?/,ks=/\d{1,3}/,jl=/\d{1,4}/,Cs=/[+-]?\d{1,6}/,wn=/\d+/,As=/[+-]?\d+/,Ky=/Z|[+-]\d\d:?\d\d/gi,Ts=/Z|[+-]\d\d(?::?\d\d)?/gi,zy=/[+-]?\d+(\.\d{1,3})?/,Ia=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Ds;Ds={};function re(l,u,m){Ds[l]=ve(u)?u:function(x,w){return x&&m?m:u}}function Gy(l,u){return a(Ds,l)?Ds[l](u._strict,u._locale):new RegExp(Yy(l))}function Yy(l){return qt(l.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(u,m,x,w,A){return m||x||w||A}))}function qt(l){return l.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var Xl={};function Me(l,u){var m,x=u,w;for(typeof l=="string"&&(l=[l]),f(u)&&(x=function(A,B){B[u]=de(A)}),w=l.length,m=0;m<w;m++)Xl[l[m]]=x}function ka(l,u){Me(l,function(m,x,w,A){w._w=w._w||{},u(m,w._w,w,A)})}function Jy(l,u,m){u!=null&&a(Xl,l)&&Xl[l](u,m._a,m,l)}var kt=0,Wr=1,Dr=2,ut=3,dr=4,qr=5,qo=6,jy=7,Xy=8;function Zy(l,u){return(l%u+u)%u}var et;Array.prototype.indexOf?et=Array.prototype.indexOf:et=function(l){var u;for(u=0;u<this.length;++u)if(this[u]===l)return u;return-1};function Es(l,u){if(isNaN(l)||isNaN(u))return NaN;var m=Zy(u,12);return l+=(u-m)/12,m===1?Qe(l)?29:28:31-m%7%2}oe("M",["MM",2],"Mo",function(){return this.month()+1}),oe("MMM",0,0,function(l){return this.localeData().monthsShort(this,l)}),oe("MMMM",0,0,function(l){return this.localeData().months(this,l)}),dt("month","M"),K("month",8),re("M",Ve),re("MM",Ve,Wt),re("MMM",function(l,u){return u.monthsShortRegex(l)}),re("MMMM",function(l,u){return u.monthsRegex(l)}),Me(["M","MM"],function(l,u){u[Wr]=de(l)-1}),Me(["MMM","MMMM"],function(l,u,m,x){var w=m._locale.monthsParse(l,x,m._strict);w!=null?u[Wr]=w:g(m).invalidMonth=l});var Qy="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),rp="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),op=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,ew=Ia,tw=Ia;function rw(l,u){return l?r(this._months)?this._months[l.month()]:this._months[(this._months.isFormat||op).test(u)?"format":"standalone"][l.month()]:r(this._months)?this._months:this._months.standalone}function ow(l,u){return l?r(this._monthsShort)?this._monthsShort[l.month()]:this._monthsShort[op.test(u)?"format":"standalone"][l.month()]:r(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function nw(l,u,m){var x,w,A,B=l.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],x=0;x<12;++x)A=h([2e3,x]),this._shortMonthsParse[x]=this.monthsShort(A,"").toLocaleLowerCase(),this._longMonthsParse[x]=this.months(A,"").toLocaleLowerCase();return m?u==="MMM"?(w=et.call(this._shortMonthsParse,B),w!==-1?w:null):(w=et.call(this._longMonthsParse,B),w!==-1?w:null):u==="MMM"?(w=et.call(this._shortMonthsParse,B),w!==-1?w:(w=et.call(this._longMonthsParse,B),w!==-1?w:null)):(w=et.call(this._longMonthsParse,B),w!==-1?w:(w=et.call(this._shortMonthsParse,B),w!==-1?w:null))}function aw(l,u,m){var x,w,A;if(this._monthsParseExact)return nw.call(this,l,u,m);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),x=0;x<12;x++){if(w=h([2e3,x]),m&&!this._longMonthsParse[x]&&(this._longMonthsParse[x]=new RegExp("^"+this.months(w,"").replace(".","")+"$","i"),this._shortMonthsParse[x]=new RegExp("^"+this.monthsShort(w,"").replace(".","")+"$","i")),!m&&!this._monthsParse[x]&&(A="^"+this.months(w,"")+"|^"+this.monthsShort(w,""),this._monthsParse[x]=new RegExp(A.replace(".",""),"i")),m&&u==="MMMM"&&this._longMonthsParse[x].test(l))return x;if(m&&u==="MMM"&&this._shortMonthsParse[x].test(l))return x;if(!m&&this._monthsParse[x].test(l))return x}}function np(l,u){var m;if(!l.isValid())return l;if(typeof u=="string"){if(/^\d+$/.test(u))u=de(u);else if(u=l.localeData().monthsParse(u),!f(u))return l}return m=Math.min(l.date(),Es(l.year(),u)),l._d["set"+(l._isUTC?"UTC":"")+"Month"](u,m),l}function ap(l){return l!=null?(np(this,l),e.updateOffset(this,!0),this):go(this,"Month")}function sw(){return Es(this.year(),this.month())}function iw(l){return this._monthsParseExact?(a(this,"_monthsRegex")||sp.call(this),l?this._monthsShortStrictRegex:this._monthsShortRegex):(a(this,"_monthsShortRegex")||(this._monthsShortRegex=ew),this._monthsShortStrictRegex&&l?this._monthsShortStrictRegex:this._monthsShortRegex)}function lw(l){return this._monthsParseExact?(a(this,"_monthsRegex")||sp.call(this),l?this._monthsStrictRegex:this._monthsRegex):(a(this,"_monthsRegex")||(this._monthsRegex=tw),this._monthsStrictRegex&&l?this._monthsStrictRegex:this._monthsRegex)}function sp(){function l(B,se){return se.length-B.length}var u=[],m=[],x=[],w,A;for(w=0;w<12;w++)A=h([2e3,w]),u.push(this.monthsShort(A,"")),m.push(this.months(A,"")),x.push(this.months(A,"")),x.push(this.monthsShort(A,""));for(u.sort(l),m.sort(l),x.sort(l),w=0;w<12;w++)u[w]=qt(u[w]),m[w]=qt(m[w]);for(w=0;w<24;w++)x[w]=qt(x[w]);this._monthsRegex=new RegExp("^("+x.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+m.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+u.join("|")+")","i")}oe("Y",0,0,function(){var l=this.year();return l<=9999?Ue(l,4):"+"+l}),oe(0,["YY",2],0,function(){return this.year()%100}),oe(0,["YYYY",4],0,"year"),oe(0,["YYYYY",5],0,"year"),oe(0,["YYYYYY",6,!0],0,"year"),dt("year","y"),K("year",1),re("Y",As),re("YY",Ve,Wt),re("YYYY",jl,Jl),re("YYYYY",Cs,Is),re("YYYYYY",Cs,Is),Me(["YYYYY","YYYYYY"],kt),Me("YYYY",function(l,u){u[kt]=l.length===2?e.parseTwoDigitYear(l):de(l)}),Me("YY",function(l,u){u[kt]=e.parseTwoDigitYear(l)}),Me("Y",function(l,u){u[kt]=parseInt(l,10)});function Ca(l){return Qe(l)?366:365}e.parseTwoDigitYear=function(l){return de(l)+(de(l)>68?1900:2e3)};var ip=ho("FullYear",!0);function fw(){return Qe(this.year())}function uw(l,u,m,x,w,A,B){var se;return l<100&&l>=0?(se=new Date(l+400,u,m,x,w,A,B),isFinite(se.getFullYear())&&se.setFullYear(l)):se=new Date(l,u,m,x,w,A,B),se}function Aa(l){var u,m;return l<100&&l>=0?(m=Array.prototype.slice.call(arguments),m[0]=l+400,u=new Date(Date.UTC.apply(null,m)),isFinite(u.getUTCFullYear())&&u.setUTCFullYear(l)):u=new Date(Date.UTC.apply(null,arguments)),u}function Ps(l,u,m){var x=7+u-m,w=(7+Aa(l,0,x).getUTCDay()-u)%7;return-w+x-1}function lp(l,u,m,x,w){var A=(7+m-x)%7,B=Ps(l,x,w),se=1+7*(u-1)+A+B,be,Fe;return se<=0?(be=l-1,Fe=Ca(be)+se):se>Ca(l)?(be=l+1,Fe=se-Ca(l)):(be=l,Fe=se),{year:be,dayOfYear:Fe}}function Ta(l,u,m){var x=Ps(l.year(),u,m),w=Math.floor((l.dayOfYear()-x-1)/7)+1,A,B;return w<1?(B=l.year()-1,A=w+Kr(B,u,m)):w>Kr(l.year(),u,m)?(A=w-Kr(l.year(),u,m),B=l.year()+1):(B=l.year(),A=w),{week:A,year:B}}function Kr(l,u,m){var x=Ps(l,u,m),w=Ps(l+1,u,m);return(Ca(l)-x+w)/7}oe("w",["ww",2],"wo","week"),oe("W",["WW",2],"Wo","isoWeek"),dt("week","w"),dt("isoWeek","W"),K("week",5),K("isoWeek",5),re("w",Ve),re("ww",Ve,Wt),re("W",Ve),re("WW",Ve,Wt),ka(["w","ww","W","WW"],function(l,u,m,x){u[x.substr(0,1)]=de(l)});function cw(l){return Ta(l,this._week.dow,this._week.doy).week}var dw={dow:0,doy:6};function pw(){return this._week.dow}function mw(){return this._week.doy}function hw(l){var u=this.localeData().week(this);return l==null?u:this.add((l-u)*7,"d")}function gw(l){var u=Ta(this,1,4).week;return l==null?u:this.add((l-u)*7,"d")}oe("d",0,"do","day"),oe("dd",0,0,function(l){return this.localeData().weekdaysMin(this,l)}),oe("ddd",0,0,function(l){return this.localeData().weekdaysShort(this,l)}),oe("dddd",0,0,function(l){return this.localeData().weekdays(this,l)}),oe("e",0,0,"weekday"),oe("E",0,0,"isoWeekday"),dt("day","d"),dt("weekday","e"),dt("isoWeekday","E"),K("day",11),K("weekday",11),K("isoWeekday",11),re("d",Ve),re("e",Ve),re("E",Ve),re("dd",function(l,u){return u.weekdaysMinRegex(l)}),re("ddd",function(l,u){return u.weekdaysShortRegex(l)}),re("dddd",function(l,u){return u.weekdaysRegex(l)}),ka(["dd","ddd","dddd"],function(l,u,m,x){var w=m._locale.weekdaysParse(l,x,m._strict);w!=null?u.d=w:g(m).invalidWeekday=l}),ka(["d","e","E"],function(l,u,m,x){u[x]=de(l)});function xw(l,u){return typeof l!="string"?l:isNaN(l)?(l=u.weekdaysParse(l),typeof l=="number"?l:null):parseInt(l,10)}function yw(l,u){return typeof l=="string"?u.weekdaysParse(l)%7||7:isNaN(l)?null:l}function Zl(l,u){return l.slice(u,7).concat(l.slice(0,u))}var ww="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),fp="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),bw="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),_w=Ia,vw=Ia,Sw=Ia;function Lw(l,u){var m=r(this._weekdays)?this._weekdays:this._weekdays[l&&l!==!0&&this._weekdays.isFormat.test(u)?"format":"standalone"];return l===!0?Zl(m,this._week.dow):l?m[l.day()]:m}function Iw(l){return l===!0?Zl(this._weekdaysShort,this._week.dow):l?this._weekdaysShort[l.day()]:this._weekdaysShort}function kw(l){return l===!0?Zl(this._weekdaysMin,this._week.dow):l?this._weekdaysMin[l.day()]:this._weekdaysMin}function Cw(l,u,m){var x,w,A,B=l.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],x=0;x<7;++x)A=h([2e3,1]).day(x),this._minWeekdaysParse[x]=this.weekdaysMin(A,"").toLocaleLowerCase(),this._shortWeekdaysParse[x]=this.weekdaysShort(A,"").toLocaleLowerCase(),this._weekdaysParse[x]=this.weekdays(A,"").toLocaleLowerCase();return m?u==="dddd"?(w=et.call(this._weekdaysParse,B),w!==-1?w:null):u==="ddd"?(w=et.call(this._shortWeekdaysParse,B),w!==-1?w:null):(w=et.call(this._minWeekdaysParse,B),w!==-1?w:null):u==="dddd"?(w=et.call(this._weekdaysParse,B),w!==-1||(w=et.call(this._shortWeekdaysParse,B),w!==-1)?w:(w=et.call(this._minWeekdaysParse,B),w!==-1?w:null)):u==="ddd"?(w=et.call(this._shortWeekdaysParse,B),w!==-1||(w=et.call(this._weekdaysParse,B),w!==-1)?w:(w=et.call(this._minWeekdaysParse,B),w!==-1?w:null)):(w=et.call(this._minWeekdaysParse,B),w!==-1||(w=et.call(this._weekdaysParse,B),w!==-1)?w:(w=et.call(this._shortWeekdaysParse,B),w!==-1?w:null))}function Aw(l,u,m){var x,w,A;if(this._weekdaysParseExact)return Cw.call(this,l,u,m);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),x=0;x<7;x++){if(w=h([2e3,1]).day(x),m&&!this._fullWeekdaysParse[x]&&(this._fullWeekdaysParse[x]=new RegExp("^"+this.weekdays(w,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[x]=new RegExp("^"+this.weekdaysShort(w,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[x]=new RegExp("^"+this.weekdaysMin(w,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[x]||(A="^"+this.weekdays(w,"")+"|^"+this.weekdaysShort(w,"")+"|^"+this.weekdaysMin(w,""),this._weekdaysParse[x]=new RegExp(A.replace(".",""),"i")),m&&u==="dddd"&&this._fullWeekdaysParse[x].test(l))return x;if(m&&u==="ddd"&&this._shortWeekdaysParse[x].test(l))return x;if(m&&u==="dd"&&this._minWeekdaysParse[x].test(l))return x;if(!m&&this._weekdaysParse[x].test(l))return x}}function Tw(l){if(!this.isValid())return l!=null?this:NaN;var u=this._isUTC?this._d.getUTCDay():this._d.getDay();return l!=null?(l=xw(l,this.localeData()),this.add(l-u,"d")):u}function Dw(l){if(!this.isValid())return l!=null?this:NaN;var u=(this.day()+7-this.localeData()._week.dow)%7;return l==null?u:this.add(l-u,"d")}function Ew(l){if(!this.isValid())return l!=null?this:NaN;if(l!=null){var u=yw(l,this.localeData());return this.day(this.day()%7?u:u-7)}else return this.day()||7}function Pw(l){return this._weekdaysParseExact?(a(this,"_weekdaysRegex")||Ql.call(this),l?this._weekdaysStrictRegex:this._weekdaysRegex):(a(this,"_weekdaysRegex")||(this._weekdaysRegex=_w),this._weekdaysStrictRegex&&l?this._weekdaysStrictRegex:this._weekdaysRegex)}function Mw(l){return this._weekdaysParseExact?(a(this,"_weekdaysRegex")||Ql.call(this),l?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(a(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=vw),this._weekdaysShortStrictRegex&&l?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function Fw(l){return this._weekdaysParseExact?(a(this,"_weekdaysRegex")||Ql.call(this),l?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(a(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Sw),this._weekdaysMinStrictRegex&&l?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function Ql(){function l(At,jr){return jr.length-At.length}var u=[],m=[],x=[],w=[],A,B,se,be,Fe;for(A=0;A<7;A++)B=h([2e3,1]).day(A),se=qt(this.weekdaysMin(B,"")),be=qt(this.weekdaysShort(B,"")),Fe=qt(this.weekdays(B,"")),u.push(se),m.push(be),x.push(Fe),w.push(se),w.push(be),w.push(Fe);u.sort(l),m.sort(l),x.sort(l),w.sort(l),this._weekdaysRegex=new RegExp("^("+w.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+x.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+m.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+u.join("|")+")","i")}function ef(){return this.hours()%12||12}function Rw(){return this.hours()||24}oe("H",["HH",2],0,"hour"),oe("h",["hh",2],0,ef),oe("k",["kk",2],0,Rw),oe("hmm",0,0,function(){return""+ef.apply(this)+Ue(this.minutes(),2)}),oe("hmmss",0,0,function(){return""+ef.apply(this)+Ue(this.minutes(),2)+Ue(this.seconds(),2)}),oe("Hmm",0,0,function(){return""+this.hours()+Ue(this.minutes(),2)}),oe("Hmmss",0,0,function(){return""+this.hours()+Ue(this.minutes(),2)+Ue(this.seconds(),2)});function up(l,u){oe(l,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),u)})}up("a",!0),up("A",!1),dt("hour","h"),K("hour",13);function cp(l,u){return u._meridiemParse}re("a",cp),re("A",cp),re("H",Ve),re("h",Ve),re("k",Ve),re("HH",Ve,Wt),re("hh",Ve,Wt),re("kk",Ve,Wt),re("hmm",ep),re("hmmss",tp),re("Hmm",ep),re("Hmmss",tp),Me(["H","HH"],ut),Me(["k","kk"],function(l,u,m){var x=de(l);u[ut]=x===24?0:x}),Me(["a","A"],function(l,u,m){m._isPm=m._locale.isPM(l),m._meridiem=l}),Me(["h","hh"],function(l,u,m){u[ut]=de(l),g(m).bigHour=!0}),Me("hmm",function(l,u,m){var x=l.length-2;u[ut]=de(l.substr(0,x)),u[dr]=de(l.substr(x)),g(m).bigHour=!0}),Me("hmmss",function(l,u,m){var x=l.length-4,w=l.length-2;u[ut]=de(l.substr(0,x)),u[dr]=de(l.substr(x,2)),u[qr]=de(l.substr(w)),g(m).bigHour=!0}),Me("Hmm",function(l,u,m){var x=l.length-2;u[ut]=de(l.substr(0,x)),u[dr]=de(l.substr(x))}),Me("Hmmss",function(l,u,m){var x=l.length-4,w=l.length-2;u[ut]=de(l.substr(0,x)),u[dr]=de(l.substr(x,2)),u[qr]=de(l.substr(w))});function Ow(l){return(l+"").toLowerCase().charAt(0)==="p"}var Uw=/[ap]\.?m?\.?/i,$w=ho("Hours",!0);function Bw(l,u,m){return l>11?m?"pm":"PM":m?"am":"AM"}var dp={calendar:Je,longDateFormat:Tr,invalidDate:Hl,ordinal:Wl,dayOfMonthOrdinalParse:ql,relativeTime:zl,months:Qy,monthsShort:rp,week:dw,weekdays:ww,weekdaysMin:bw,weekdaysShort:fp,meridiemParse:Uw},ze={},Da={},Ea;function Nw(l,u){var m,x=Math.min(l.length,u.length);for(m=0;m<x;m+=1)if(l[m]!==u[m])return m;return x}function pp(l){return l&&l.toLowerCase().replace("_","-")}function Hw(l){for(var u=0,m,x,w,A;u<l.length;){for(A=pp(l[u]).split("-"),m=A.length,x=pp(l[u+1]),x=x?x.split("-"):null;m>0;){if(w=Ms(A.slice(0,m).join("-")),w)return w;if(x&&x.length>=m&&Nw(A,x)>=m-1)break;m--}u++}return Ea}function Vw(l){return l.match("^[^/\\\\]*$")!=null}function Ms(l){var u=null,m;if(ze[l]===void 0&&typeof _a!="undefined"&&_a&&_a.exports&&Vw(l))try{u=Ea._abbr,m=require,m("./locale/"+l),xo(u)}catch(x){ze[l]=null}return ze[l]}function xo(l,u){var m;return l&&(i(u)?m=zr(l):m=tf(l,u),m?Ea=m:typeof console!="undefined"&&console.warn&&console.warn("Locale "+l+" not found. Did you forget to load it?")),Ea._abbr}function tf(l,u){if(u!==null){var m,x=dp;if(u.abbr=l,ze[l]!=null)te("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),x=ze[l]._config;else if(u.parentLocale!=null)if(ze[u.parentLocale]!=null)x=ze[u.parentLocale]._config;else if(m=Ms(u.parentLocale),m!=null)x=m._config;else return Da[u.parentLocale]||(Da[u.parentLocale]=[]),Da[u.parentLocale].push({name:l,config:u}),null;return ze[l]=new q(fe(x,u)),Da[l]&&Da[l].forEach(function(w){tf(w.name,w.config)}),xo(l),ze[l]}else return delete ze[l],null}function Ww(l,u){if(u!=null){var m,x,w=dp;ze[l]!=null&&ze[l].parentLocale!=null?ze[l].set(fe(ze[l]._config,u)):(x=Ms(l),x!=null&&(w=x._config),u=fe(w,u),x==null&&(u.abbr=l),m=new q(u),m.parentLocale=ze[l],ze[l]=m),xo(l)}else ze[l]!=null&&(ze[l].parentLocale!=null?(ze[l]=ze[l].parentLocale,l===xo()&&xo(l)):ze[l]!=null&&delete ze[l]);return ze[l]}function zr(l){var u;if(l&&l._locale&&l._locale._abbr&&(l=l._locale._abbr),!l)return Ea;if(!r(l)){if(u=Ms(l),u)return u;l=[l]}return Hw(l)}function qw(){return Z(ze)}function rf(l){var u,m=l._a;return m&&g(l).overflow===-2&&(u=m[Wr]<0||m[Wr]>11?Wr:m[Dr]<1||m[Dr]>Es(m[kt],m[Wr])?Dr:m[ut]<0||m[ut]>24||m[ut]===24&&(m[dr]!==0||m[qr]!==0||m[qo]!==0)?ut:m[dr]<0||m[dr]>59?dr:m[qr]<0||m[qr]>59?qr:m[qo]<0||m[qo]>999?qo:-1,g(l)._overflowDayOfYear&&(u<kt||u>Dr)&&(u=Dr),g(l)._overflowWeeks&&u===-1&&(u=jy),g(l)._overflowWeekday&&u===-1&&(u=Xy),g(l).overflow=u),l}var Kw=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,zw=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Gw=/Z|[+-]\d\d(?::?\d\d)?/,Fs=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],of=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Yw=/^\/?Date\((-?\d+)/i,Jw=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,jw={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function mp(l){var u,m,x=l._i,w=Kw.exec(x)||zw.exec(x),A,B,se,be,Fe=Fs.length,At=of.length;if(w){for(g(l).iso=!0,u=0,m=Fe;u<m;u++)if(Fs[u][1].exec(w[1])){B=Fs[u][0],A=Fs[u][2]!==!1;break}if(B==null){l._isValid=!1;return}if(w[3]){for(u=0,m=At;u<m;u++)if(of[u][1].exec(w[3])){se=(w[2]||" ")+of[u][0];break}if(se==null){l._isValid=!1;return}}if(!A&&se!=null){l._isValid=!1;return}if(w[4])if(Gw.exec(w[4]))be="Z";else{l._isValid=!1;return}l._f=B+(se||"")+(be||""),af(l)}else l._isValid=!1}function Xw(l,u,m,x,w,A){var B=[Zw(l),rp.indexOf(u),parseInt(m,10),parseInt(x,10),parseInt(w,10)];return A&&B.push(parseInt(A,10)),B}function Zw(l){var u=parseInt(l,10);return u<=49?2e3+u:u<=999?1900+u:u}function Qw(l){return l.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function eb(l,u,m){if(l){var x=fp.indexOf(l),w=new Date(u[0],u[1],u[2]).getDay();if(x!==w)return g(m).weekdayMismatch=!0,m._isValid=!1,!1}return!0}function tb(l,u,m){if(l)return jw[l];if(u)return 0;var x=parseInt(m,10),w=x%100,A=(x-w)/100;return A*60+w}function hp(l){var u=Jw.exec(Qw(l._i)),m;if(u){if(m=Xw(u[4],u[3],u[2],u[5],u[6],u[7]),!eb(u[1],m,l))return;l._a=m,l._tzm=tb(u[8],u[9],u[10]),l._d=Aa.apply(null,l._a),l._d.setUTCMinutes(l._d.getUTCMinutes()-l._tzm),g(l).rfc2822=!0}else l._isValid=!1}function rb(l){var u=Yw.exec(l._i);if(u!==null){l._d=new Date(+u[1]);return}if(mp(l),l._isValid===!1)delete l._isValid;else return;if(hp(l),l._isValid===!1)delete l._isValid;else return;l._strict?l._isValid=!1:e.createFromInputFallback(l)}e.createFromInputFallback=V("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(l){l._d=new Date(l._i+(l._useUTC?" UTC":""))});function bn(l,u,m){return l!=null?l:u!=null?u:m}function ob(l){var u=new Date(e.now());return l._useUTC?[u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()]:[u.getFullYear(),u.getMonth(),u.getDate()]}function nf(l){var u,m,x=[],w,A,B;if(!l._d){for(w=ob(l),l._w&&l._a[Dr]==null&&l._a[Wr]==null&&nb(l),l._dayOfYear!=null&&(B=bn(l._a[kt],w[kt]),(l._dayOfYear>Ca(B)||l._dayOfYear===0)&&(g(l)._overflowDayOfYear=!0),m=Aa(B,0,l._dayOfYear),l._a[Wr]=m.getUTCMonth(),l._a[Dr]=m.getUTCDate()),u=0;u<3&&l._a[u]==null;++u)l._a[u]=x[u]=w[u];for(;u<7;u++)l._a[u]=x[u]=l._a[u]==null?u===2?1:0:l._a[u];l._a[ut]===24&&l._a[dr]===0&&l._a[qr]===0&&l._a[qo]===0&&(l._nextDay=!0,l._a[ut]=0),l._d=(l._useUTC?Aa:uw).apply(null,x),A=l._useUTC?l._d.getUTCDay():l._d.getDay(),l._tzm!=null&&l._d.setUTCMinutes(l._d.getUTCMinutes()-l._tzm),l._nextDay&&(l._a[ut]=24),l._w&&typeof l._w.d!="undefined"&&l._w.d!==A&&(g(l).weekdayMismatch=!0)}}function nb(l){var u,m,x,w,A,B,se,be,Fe;u=l._w,u.GG!=null||u.W!=null||u.E!=null?(A=1,B=4,m=bn(u.GG,l._a[kt],Ta(We(),1,4).year),x=bn(u.W,1),w=bn(u.E,1),(w<1||w>7)&&(be=!0)):(A=l._locale._week.dow,B=l._locale._week.doy,Fe=Ta(We(),A,B),m=bn(u.gg,l._a[kt],Fe.year),x=bn(u.w,Fe.week),u.d!=null?(w=u.d,(w<0||w>6)&&(be=!0)):u.e!=null?(w=u.e+A,(u.e<0||u.e>6)&&(be=!0)):w=A),x<1||x>Kr(m,A,B)?g(l)._overflowWeeks=!0:be!=null?g(l)._overflowWeekday=!0:(se=lp(m,x,w,A,B),l._a[kt]=se.year,l._dayOfYear=se.dayOfYear)}e.ISO_8601=function(){},e.RFC_2822=function(){};function af(l){if(l._f===e.ISO_8601){mp(l);return}if(l._f===e.RFC_2822){hp(l);return}l._a=[],g(l).empty=!0;var u=""+l._i,m,x,w,A,B,se=u.length,be=0,Fe,At;for(w=Rt(l._f,l._locale).match(Xe)||[],At=w.length,m=0;m<At;m++)A=w[m],x=(u.match(Gy(A,l))||[])[0],x&&(B=u.substr(0,u.indexOf(x)),B.length>0&&g(l).unusedInput.push(B),u=u.slice(u.indexOf(x)+x.length),be+=x.length),je[A]?(x?g(l).empty=!1:g(l).unusedTokens.push(A),Jy(A,x,l)):l._strict&&!x&&g(l).unusedTokens.push(A);g(l).charsLeftOver=se-be,u.length>0&&g(l).unusedInput.push(u),l._a[ut]<=12&&g(l).bigHour===!0&&l._a[ut]>0&&(g(l).bigHour=void 0),g(l).parsedDateParts=l._a.slice(0),g(l).meridiem=l._meridiem,l._a[ut]=ab(l._locale,l._a[ut],l._meridiem),Fe=g(l).era,Fe!==null&&(l._a[kt]=l._locale.erasConvertYear(Fe,l._a[kt])),nf(l),rf(l)}function ab(l,u,m){var x;return m==null?u:l.meridiemHour!=null?l.meridiemHour(u,m):(l.isPM!=null&&(x=l.isPM(m),x&&u<12&&(u+=12),!x&&u===12&&(u=0)),u)}function sb(l){var u,m,x,w,A,B,se=!1,be=l._f.length;if(be===0){g(l).invalidFormat=!0,l._d=new Date(NaN);return}for(w=0;w<be;w++)A=0,B=!1,u=S({},l),l._useUTC!=null&&(u._useUTC=l._useUTC),u._f=l._f[w],af(u),b(u)&&(B=!0),A+=g(u).charsLeftOver,A+=g(u).unusedTokens.length*10,g(u).score=A,se?A<x&&(x=A,m=u):(x==null||A<x||B)&&(x=A,m=u,B&&(se=!0));p(l,m||u)}function ib(l){if(!l._d){var u=La(l._i),m=u.day===void 0?u.date:u.day;l._a=d([u.year,u.month,m,u.hour,u.minute,u.second,u.millisecond],function(x){return x&&parseInt(x,10)}),nf(l)}}function lb(l){var u=new P(rf(gp(l)));return u._nextDay&&(u.add(1,"d"),u._nextDay=void 0),u}function gp(l){var u=l._i,m=l._f;return l._locale=l._locale||zr(l._l),u===null||m===void 0&&u===""?_({nullInput:!0}):(typeof u=="string"&&(l._i=u=l._locale.preparse(u)),H(u)?new P(rf(u)):(c(u)?l._d=u:r(m)?sb(l):m?af(l):fb(l),b(l)||(l._d=null),l))}function fb(l){var u=l._i;i(u)?l._d=new Date(e.now()):c(u)?l._d=new Date(u.valueOf()):typeof u=="string"?rb(l):r(u)?(l._a=d(u.slice(0),function(m){return parseInt(m,10)}),nf(l)):n(u)?ib(l):f(u)?l._d=new Date(u):e.createFromInputFallback(l)}function xp(l,u,m,x,w){var A={};return(u===!0||u===!1)&&(x=u,u=void 0),(m===!0||m===!1)&&(x=m,m=void 0),(n(l)&&s(l)||r(l)&&l.length===0)&&(l=void 0),A._isAMomentObject=!0,A._useUTC=A._isUTC=w,A._l=m,A._i=l,A._f=u,A._strict=x,lb(A)}function We(l,u,m,x){return xp(l,u,m,x,!1)}var ub=V("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var l=We.apply(null,arguments);return this.isValid()&&l.isValid()?l<this?this:l:_()}),cb=V("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var l=We.apply(null,arguments);return this.isValid()&&l.isValid()?l>this?this:l:_()});function yp(l,u){var m,x;if(u.length===1&&r(u[0])&&(u=u[0]),!u.length)return We();for(m=u[0],x=1;x<u.length;++x)(!u[x].isValid()||u[x][l](m))&&(m=u[x]);return m}function db(){var l=[].slice.call(arguments,0);return yp("isBefore",l)}function pb(){var l=[].slice.call(arguments,0);return yp("isAfter",l)}var mb=function(){return Date.now?Date.now():+new Date},Pa=["year","quarter","month","week","day","hour","minute","second","millisecond"];function hb(l){var u,m=!1,x,w=Pa.length;for(u in l)if(a(l,u)&&!(et.call(Pa,u)!==-1&&(l[u]==null||!isNaN(l[u]))))return!1;for(x=0;x<w;++x)if(l[Pa[x]]){if(m)return!1;parseFloat(l[Pa[x]])!==de(l[Pa[x]])&&(m=!0)}return!0}function gb(){return this._isValid}function xb(){return pr(NaN)}function Rs(l){var u=La(l),m=u.year||0,x=u.quarter||0,w=u.month||0,A=u.week||u.isoWeek||0,B=u.day||0,se=u.hour||0,be=u.minute||0,Fe=u.second||0,At=u.millisecond||0;this._isValid=hb(u),this._milliseconds=+At+Fe*1e3+be*6e4+se*1e3*60*60,this._days=+B+A*7,this._months=+w+x*3+m*12,this._data={},this._locale=zr(),this._bubble()}function Os(l){return l instanceof Rs}function sf(l){return l<0?Math.round(-1*l)*-1:Math.round(l)}function yb(l,u,m){var x=Math.min(l.length,u.length),w=Math.abs(l.length-u.length),A=0,B;for(B=0;B<x;B++)(m&&l[B]!==u[B]||!m&&de(l[B])!==de(u[B]))&&A++;return A+w}function wp(l,u){oe(l,0,0,function(){var m=this.utcOffset(),x="+";return m<0&&(m=-m,x="-"),x+Ue(~~(m/60),2)+u+Ue(~~m%60,2)})}wp("Z",":"),wp("ZZ",""),re("Z",Ts),re("ZZ",Ts),Me(["Z","ZZ"],function(l,u,m){m._useUTC=!0,m._tzm=lf(Ts,l)});var wb=/([\+\-]|\d\d)/gi;function lf(l,u){var m=(u||"").match(l),x,w,A;return m===null?null:(x=m[m.length-1]||[],w=(x+"").match(wb)||["-",0,0],A=+(w[1]*60)+de(w[2]),A===0?0:w[0]==="+"?A:-A)}function ff(l,u){var m,x;return u._isUTC?(m=u.clone(),x=(H(l)||c(l)?l.valueOf():We(l).valueOf())-m.valueOf(),m._d.setTime(m._d.valueOf()+x),e.updateOffset(m,!1),m):We(l).local()}function uf(l){return-Math.round(l._d.getTimezoneOffset())}e.updateOffset=function(){};function bb(l,u,m){var x=this._offset||0,w;if(!this.isValid())return l!=null?this:NaN;if(l!=null){if(typeof l=="string"){if(l=lf(Ts,l),l===null)return this}else Math.abs(l)<16&&!m&&(l=l*60);return!this._isUTC&&u&&(w=uf(this)),this._offset=l,this._isUTC=!0,w!=null&&this.add(w,"m"),x!==l&&(!u||this._changeInProgress?Sp(this,pr(l-x,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?x:uf(this)}function _b(l,u){return l!=null?(typeof l!="string"&&(l=-l),this.utcOffset(l,u),this):-this.utcOffset()}function vb(l){return this.utcOffset(0,l)}function Sb(l){return this._isUTC&&(this.utcOffset(0,l),this._isUTC=!1,l&&this.subtract(uf(this),"m")),this}function Lb(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var l=lf(Ky,this._i);l!=null?this.utcOffset(l):this.utcOffset(0,!0)}return this}function Ib(l){return this.isValid()?(l=l?We(l).utcOffset():0,(this.utcOffset()-l)%60===0):!1}function kb(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Cb(){if(!i(this._isDSTShifted))return this._isDSTShifted;var l={},u;return S(l,this),l=gp(l),l._a?(u=l._isUTC?h(l._a):We(l._a),this._isDSTShifted=this.isValid()&&yb(l._a,u.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function Ab(){return this.isValid()?!this._isUTC:!1}function Tb(){return this.isValid()?this._isUTC:!1}function bp(){return this.isValid()?this._isUTC&&this._offset===0:!1}var Db=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,Eb=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function pr(l,u){var m=l,x=null,w,A,B;return Os(l)?m={ms:l._milliseconds,d:l._days,M:l._months}:f(l)||!isNaN(+l)?(m={},u?m[u]=+l:m.milliseconds=+l):(x=Db.exec(l))?(w=x[1]==="-"?-1:1,m={y:0,d:de(x[Dr])*w,h:de(x[ut])*w,m:de(x[dr])*w,s:de(x[qr])*w,ms:de(sf(x[qo]*1e3))*w}):(x=Eb.exec(l))?(w=x[1]==="-"?-1:1,m={y:Ko(x[2],w),M:Ko(x[3],w),w:Ko(x[4],w),d:Ko(x[5],w),h:Ko(x[6],w),m:Ko(x[7],w),s:Ko(x[8],w)}):m==null?m={}:typeof m=="object"&&("from"in m||"to"in m)&&(B=Pb(We(m.from),We(m.to)),m={},m.ms=B.milliseconds,m.M=B.months),A=new Rs(m),Os(l)&&a(l,"_locale")&&(A._locale=l._locale),Os(l)&&a(l,"_isValid")&&(A._isValid=l._isValid),A}pr.fn=Rs.prototype,pr.invalid=xb;function Ko(l,u){var m=l&&parseFloat(l.replace(",","."));return(isNaN(m)?0:m)*u}function _p(l,u){var m={};return m.months=u.month()-l.month()+(u.year()-l.year())*12,l.clone().add(m.months,"M").isAfter(u)&&--m.months,m.milliseconds=+u-+l.clone().add(m.months,"M"),m}function Pb(l,u){var m;return l.isValid()&&u.isValid()?(u=ff(u,l),l.isBefore(u)?m=_p(l,u):(m=_p(u,l),m.milliseconds=-m.milliseconds,m.months=-m.months),m):{milliseconds:0,months:0}}function vp(l,u){return function(m,x){var w,A;return x!==null&&!isNaN(+x)&&(te(u,"moment()."+u+"(period, number) is deprecated. Please use moment()."+u+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),A=m,m=x,x=A),w=pr(m,x),Sp(this,w,l),this}}function Sp(l,u,m,x){var w=u._milliseconds,A=sf(u._days),B=sf(u._months);l.isValid()&&(x=x==null?!0:x,B&&np(l,go(l,"Month")+B*m),A&&Xd(l,"Date",go(l,"Date")+A*m),w&&l._d.setTime(l._d.valueOf()+w*m),x&&e.updateOffset(l,A||B))}var Mb=vp(1,"add"),Fb=vp(-1,"subtract");function Lp(l){return typeof l=="string"||l instanceof String}function Rb(l){return H(l)||c(l)||Lp(l)||f(l)||Ub(l)||Ob(l)||l===null||l===void 0}function Ob(l){var u=n(l)&&!s(l),m=!1,x=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],w,A,B=x.length;for(w=0;w<B;w+=1)A=x[w],m=m||a(l,A);return u&&m}function Ub(l){var u=r(l),m=!1;return u&&(m=l.filter(function(x){return!f(x)&&Lp(l)}).length===0),u&&m}function $b(l){var u=n(l)&&!s(l),m=!1,x=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],w,A;for(w=0;w<x.length;w+=1)A=x[w],m=m||a(l,A);return u&&m}function Bb(l,u){var m=l.diff(u,"days",!0);return m<-6?"sameElse":m<-1?"lastWeek":m<0?"lastDay":m<1?"sameDay":m<2?"nextDay":m<7?"nextWeek":"sameElse"}function Nb(l,u){arguments.length===1&&(arguments[0]?Rb(arguments[0])?(l=arguments[0],u=void 0):$b(arguments[0])&&(u=arguments[0],l=void 0):(l=void 0,u=void 0));var m=l||We(),x=ff(m,this).startOf("day"),w=e.calendarFormat(this,x)||"sameElse",A=u&&(ve(u[w])?u[w].call(this,m):u[w]);return this.format(A||this.localeData().calendar(w,this,We(m)))}function Hb(){return new P(this)}function Vb(l,u){var m=H(l)?l:We(l);return this.isValid()&&m.isValid()?(u=Ot(u)||"millisecond",u==="millisecond"?this.valueOf()>m.valueOf():m.valueOf()<this.clone().startOf(u).valueOf()):!1}function Wb(l,u){var m=H(l)?l:We(l);return this.isValid()&&m.isValid()?(u=Ot(u)||"millisecond",u==="millisecond"?this.valueOf()<m.valueOf():this.clone().endOf(u).valueOf()<m.valueOf()):!1}function qb(l,u,m,x){var w=H(l)?l:We(l),A=H(u)?u:We(u);return this.isValid()&&w.isValid()&&A.isValid()?(x=x||"()",(x[0]==="("?this.isAfter(w,m):!this.isBefore(w,m))&&(x[1]===")"?this.isBefore(A,m):!this.isAfter(A,m))):!1}function Kb(l,u){var m=H(l)?l:We(l),x;return this.isValid()&&m.isValid()?(u=Ot(u)||"millisecond",u==="millisecond"?this.valueOf()===m.valueOf():(x=m.valueOf(),this.clone().startOf(u).valueOf()<=x&&x<=this.clone().endOf(u).valueOf())):!1}function zb(l,u){return this.isSame(l,u)||this.isAfter(l,u)}function Gb(l,u){return this.isSame(l,u)||this.isBefore(l,u)}function Yb(l,u,m){var x,w,A;if(!this.isValid())return NaN;if(x=ff(l,this),!x.isValid())return NaN;switch(w=(x.utcOffset()-this.utcOffset())*6e4,u=Ot(u),u){case"year":A=Us(this,x)/12;break;case"month":A=Us(this,x);break;case"quarter":A=Us(this,x)/3;break;case"second":A=(this-x)/1e3;break;case"minute":A=(this-x)/6e4;break;case"hour":A=(this-x)/36e5;break;case"day":A=(this-x-w)/864e5;break;case"week":A=(this-x-w)/6048e5;break;default:A=this-x}return m?A:Ke(A)}function Us(l,u){if(l.date()<u.date())return-Us(u,l);var m=(u.year()-l.year())*12+(u.month()-l.month()),x=l.clone().add(m,"months"),w,A;return u-x<0?(w=l.clone().add(m-1,"months"),A=(u-x)/(x-w)):(w=l.clone().add(m+1,"months"),A=(u-x)/(w-x)),-(m+A)||0}e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",e.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function Jb(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function jb(l){if(!this.isValid())return null;var u=l!==!0,m=u?this.clone().utc():this;return m.year()<0||m.year()>9999?ke(m,u?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):ve(Date.prototype.toISOString)?u?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",ke(m,"Z")):ke(m,u?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function Xb(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var l="moment",u="",m,x,w,A;return this.isLocal()||(l=this.utcOffset()===0?"moment.utc":"moment.parseZone",u="Z"),m="["+l+'("]',x=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",w="-MM-DD[T]HH:mm:ss.SSS",A=u+'[")]',this.format(m+x+w+A)}function Zb(l){l||(l=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var u=ke(this,l);return this.localeData().postformat(u)}function Qb(l,u){return this.isValid()&&(H(l)&&l.isValid()||We(l).isValid())?pr({to:this,from:l}).locale(this.locale()).humanize(!u):this.localeData().invalidDate()}function e_(l){return this.from(We(),l)}function t_(l,u){return this.isValid()&&(H(l)&&l.isValid()||We(l).isValid())?pr({from:this,to:l}).locale(this.locale()).humanize(!u):this.localeData().invalidDate()}function r_(l){return this.to(We(),l)}function Ip(l){var u;return l===void 0?this._locale._abbr:(u=zr(l),u!=null&&(this._locale=u),this)}var kp=V("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(l){return l===void 0?this.localeData():this.locale(l)});function Cp(){return this._locale}var $s=1e3,_n=60*$s,Bs=60*_n,Ap=(365*400+97)*24*Bs;function vn(l,u){return(l%u+u)%u}function Tp(l,u,m){return l<100&&l>=0?new Date(l+400,u,m)-Ap:new Date(l,u,m).valueOf()}function Dp(l,u,m){return l<100&&l>=0?Date.UTC(l+400,u,m)-Ap:Date.UTC(l,u,m)}function o_(l){var u,m;if(l=Ot(l),l===void 0||l==="millisecond"||!this.isValid())return this;switch(m=this._isUTC?Dp:Tp,l){case"year":u=m(this.year(),0,1);break;case"quarter":u=m(this.year(),this.month()-this.month()%3,1);break;case"month":u=m(this.year(),this.month(),1);break;case"week":u=m(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":u=m(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":u=m(this.year(),this.month(),this.date());break;case"hour":u=this._d.valueOf(),u-=vn(u+(this._isUTC?0:this.utcOffset()*_n),Bs);break;case"minute":u=this._d.valueOf(),u-=vn(u,_n);break;case"second":u=this._d.valueOf(),u-=vn(u,$s);break}return this._d.setTime(u),e.updateOffset(this,!0),this}function n_(l){var u,m;if(l=Ot(l),l===void 0||l==="millisecond"||!this.isValid())return this;switch(m=this._isUTC?Dp:Tp,l){case"year":u=m(this.year()+1,0,1)-1;break;case"quarter":u=m(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":u=m(this.year(),this.month()+1,1)-1;break;case"week":u=m(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":u=m(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":u=m(this.year(),this.month(),this.date()+1)-1;break;case"hour":u=this._d.valueOf(),u+=Bs-vn(u+(this._isUTC?0:this.utcOffset()*_n),Bs)-1;break;case"minute":u=this._d.valueOf(),u+=_n-vn(u,_n)-1;break;case"second":u=this._d.valueOf(),u+=$s-vn(u,$s)-1;break}return this._d.setTime(u),e.updateOffset(this,!0),this}function a_(){return this._d.valueOf()-(this._offset||0)*6e4}function s_(){return Math.floor(this.valueOf()/1e3)}function i_(){return new Date(this.valueOf())}function l_(){var l=this;return[l.year(),l.month(),l.date(),l.hour(),l.minute(),l.second(),l.millisecond()]}function f_(){var l=this;return{years:l.year(),months:l.month(),date:l.date(),hours:l.hours(),minutes:l.minutes(),seconds:l.seconds(),milliseconds:l.milliseconds()}}function u_(){return this.isValid()?this.toISOString():null}function c_(){return b(this)}function d_(){return p({},g(this))}function p_(){return g(this).overflow}function m_(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}oe("N",0,0,"eraAbbr"),oe("NN",0,0,"eraAbbr"),oe("NNN",0,0,"eraAbbr"),oe("NNNN",0,0,"eraName"),oe("NNNNN",0,0,"eraNarrow"),oe("y",["y",1],"yo","eraYear"),oe("y",["yy",2],0,"eraYear"),oe("y",["yyy",3],0,"eraYear"),oe("y",["yyyy",4],0,"eraYear"),re("N",cf),re("NN",cf),re("NNN",cf),re("NNNN",I_),re("NNNNN",k_),Me(["N","NN","NNN","NNNN","NNNNN"],function(l,u,m,x){var w=m._locale.erasParse(l,x,m._strict);w?g(m).era=w:g(m).invalidEra=l}),re("y",wn),re("yy",wn),re("yyy",wn),re("yyyy",wn),re("yo",C_),Me(["y","yy","yyy","yyyy"],kt),Me(["yo"],function(l,u,m,x){var w;m._locale._eraYearOrdinalRegex&&(w=l.match(m._locale._eraYearOrdinalRegex)),m._locale.eraYearOrdinalParse?u[kt]=m._locale.eraYearOrdinalParse(l,w):u[kt]=parseInt(l,10)});function h_(l,u){var m,x,w,A=this._eras||zr("en")._eras;for(m=0,x=A.length;m<x;++m){switch(typeof A[m].since){case"string":w=e(A[m].since).startOf("day"),A[m].since=w.valueOf();break}switch(typeof A[m].until){case"undefined":A[m].until=1/0;break;case"string":w=e(A[m].until).startOf("day").valueOf(),A[m].until=w.valueOf();break}}return A}function g_(l,u,m){var x,w,A=this.eras(),B,se,be;for(l=l.toUpperCase(),x=0,w=A.length;x<w;++x)if(B=A[x].name.toUpperCase(),se=A[x].abbr.toUpperCase(),be=A[x].narrow.toUpperCase(),m)switch(u){case"N":case"NN":case"NNN":if(se===l)return A[x];break;case"NNNN":if(B===l)return A[x];break;case"NNNNN":if(be===l)return A[x];break}else if([B,se,be].indexOf(l)>=0)return A[x]}function x_(l,u){var m=l.since<=l.until?1:-1;return u===void 0?e(l.since).year():e(l.since).year()+(u-l.offset)*m}function y_(){var l,u,m,x=this.localeData().eras();for(l=0,u=x.length;l<u;++l)if(m=this.clone().startOf("day").valueOf(),x[l].since<=m&&m<=x[l].until||x[l].until<=m&&m<=x[l].since)return x[l].name;return""}function w_(){var l,u,m,x=this.localeData().eras();for(l=0,u=x.length;l<u;++l)if(m=this.clone().startOf("day").valueOf(),x[l].since<=m&&m<=x[l].until||x[l].until<=m&&m<=x[l].since)return x[l].narrow;return""}function b_(){var l,u,m,x=this.localeData().eras();for(l=0,u=x.length;l<u;++l)if(m=this.clone().startOf("day").valueOf(),x[l].since<=m&&m<=x[l].until||x[l].until<=m&&m<=x[l].since)return x[l].abbr;return""}function __(){var l,u,m,x,w=this.localeData().eras();for(l=0,u=w.length;l<u;++l)if(m=w[l].since<=w[l].until?1:-1,x=this.clone().startOf("day").valueOf(),w[l].since<=x&&x<=w[l].until||w[l].until<=x&&x<=w[l].since)return(this.year()-e(w[l].since).year())*m+w[l].offset;return this.year()}function v_(l){return a(this,"_erasNameRegex")||df.call(this),l?this._erasNameRegex:this._erasRegex}function S_(l){return a(this,"_erasAbbrRegex")||df.call(this),l?this._erasAbbrRegex:this._erasRegex}function L_(l){return a(this,"_erasNarrowRegex")||df.call(this),l?this._erasNarrowRegex:this._erasRegex}function cf(l,u){return u.erasAbbrRegex(l)}function I_(l,u){return u.erasNameRegex(l)}function k_(l,u){return u.erasNarrowRegex(l)}function C_(l,u){return u._eraYearOrdinalRegex||wn}function df(){var l=[],u=[],m=[],x=[],w,A,B=this.eras();for(w=0,A=B.length;w<A;++w)u.push(qt(B[w].name)),l.push(qt(B[w].abbr)),m.push(qt(B[w].narrow)),x.push(qt(B[w].name)),x.push(qt(B[w].abbr)),x.push(qt(B[w].narrow));this._erasRegex=new RegExp("^("+x.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+u.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+l.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+m.join("|")+")","i")}oe(0,["gg",2],0,function(){return this.weekYear()%100}),oe(0,["GG",2],0,function(){return this.isoWeekYear()%100});function Ns(l,u){oe(0,[l,l.length],0,u)}Ns("gggg","weekYear"),Ns("ggggg","weekYear"),Ns("GGGG","isoWeekYear"),Ns("GGGGG","isoWeekYear"),dt("weekYear","gg"),dt("isoWeekYear","GG"),K("weekYear",1),K("isoWeekYear",1),re("G",As),re("g",As),re("GG",Ve,Wt),re("gg",Ve,Wt),re("GGGG",jl,Jl),re("gggg",jl,Jl),re("GGGGG",Cs,Is),re("ggggg",Cs,Is),ka(["gggg","ggggg","GGGG","GGGGG"],function(l,u,m,x){u[x.substr(0,2)]=de(l)}),ka(["gg","GG"],function(l,u,m,x){u[x]=e.parseTwoDigitYear(l)});function A_(l){return Ep.call(this,l,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function T_(l){return Ep.call(this,l,this.isoWeek(),this.isoWeekday(),1,4)}function D_(){return Kr(this.year(),1,4)}function E_(){return Kr(this.isoWeekYear(),1,4)}function P_(){var l=this.localeData()._week;return Kr(this.year(),l.dow,l.doy)}function M_(){var l=this.localeData()._week;return Kr(this.weekYear(),l.dow,l.doy)}function Ep(l,u,m,x,w){var A;return l==null?Ta(this,x,w).year:(A=Kr(l,x,w),u>A&&(u=A),F_.call(this,l,u,m,x,w))}function F_(l,u,m,x,w){var A=lp(l,u,m,x,w),B=Aa(A.year,0,A.dayOfYear);return this.year(B.getUTCFullYear()),this.month(B.getUTCMonth()),this.date(B.getUTCDate()),this}oe("Q",0,"Qo","quarter"),dt("quarter","Q"),K("quarter",7),re("Q",Zd),Me("Q",function(l,u){u[Wr]=(de(l)-1)*3});function R_(l){return l==null?Math.ceil((this.month()+1)/3):this.month((l-1)*3+this.month()%3)}oe("D",["DD",2],"Do","date"),dt("date","D"),K("date",9),re("D",Ve),re("DD",Ve,Wt),re("Do",function(l,u){return l?u._dayOfMonthOrdinalParse||u._ordinalParse:u._dayOfMonthOrdinalParseLenient}),Me(["D","DD"],Dr),Me("Do",function(l,u){u[Dr]=de(l.match(Ve)[0])});var Pp=ho("Date",!0);oe("DDD",["DDDD",3],"DDDo","dayOfYear"),dt("dayOfYear","DDD"),K("dayOfYear",4),re("DDD",ks),re("DDDD",Qd),Me(["DDD","DDDD"],function(l,u,m){m._dayOfYear=de(l)});function O_(l){var u=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return l==null?u:this.add(l-u,"d")}oe("m",["mm",2],0,"minute"),dt("minute","m"),K("minute",14),re("m",Ve),re("mm",Ve,Wt),Me(["m","mm"],dr);var U_=ho("Minutes",!1);oe("s",["ss",2],0,"second"),dt("second","s"),K("second",15),re("s",Ve),re("ss",Ve,Wt),Me(["s","ss"],qr);var $_=ho("Seconds",!1);oe("S",0,0,function(){return~~(this.millisecond()/100)}),oe(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),oe(0,["SSS",3],0,"millisecond"),oe(0,["SSSS",4],0,function(){return this.millisecond()*10}),oe(0,["SSSSS",5],0,function(){return this.millisecond()*100}),oe(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3}),oe(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4}),oe(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5}),oe(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6}),dt("millisecond","ms"),K("millisecond",16),re("S",ks,Zd),re("SS",ks,Wt),re("SSS",ks,Qd);var yo,Mp;for(yo="SSSS";yo.length<=9;yo+="S")re(yo,wn);function B_(l,u){u[qo]=de(("0."+l)*1e3)}for(yo="S";yo.length<=9;yo+="S")Me(yo,B_);Mp=ho("Milliseconds",!1),oe("z",0,0,"zoneAbbr"),oe("zz",0,0,"zoneName");function N_(){return this._isUTC?"UTC":""}function H_(){return this._isUTC?"Coordinated Universal Time":""}var G=P.prototype;G.add=Mb,G.calendar=Nb,G.clone=Hb,G.diff=Yb,G.endOf=n_,G.format=Zb,G.from=Qb,G.fromNow=e_,G.to=t_,G.toNow=r_,G.get=Wy,G.invalidAt=p_,G.isAfter=Vb,G.isBefore=Wb,G.isBetween=qb,G.isSame=Kb,G.isSameOrAfter=zb,G.isSameOrBefore=Gb,G.isValid=c_,G.lang=kp,G.locale=Ip,G.localeData=Cp,G.max=cb,G.min=ub,G.parsingFlags=d_,G.set=qy,G.startOf=o_,G.subtract=Fb,G.toArray=l_,G.toObject=f_,G.toDate=i_,G.toISOString=jb,G.inspect=Xb,typeof Symbol!="undefined"&&Symbol.for!=null&&(G[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),G.toJSON=u_,G.toString=Jb,G.unix=s_,G.valueOf=a_,G.creationData=m_,G.eraName=y_,G.eraNarrow=w_,G.eraAbbr=b_,G.eraYear=__,G.year=ip,G.isLeapYear=fw,G.weekYear=A_,G.isoWeekYear=T_,G.quarter=G.quarters=R_,G.month=ap,G.daysInMonth=sw,G.week=G.weeks=hw,G.isoWeek=G.isoWeeks=gw,G.weeksInYear=P_,G.weeksInWeekYear=M_,G.isoWeeksInYear=D_,G.isoWeeksInISOWeekYear=E_,G.date=Pp,G.day=G.days=Tw,G.weekday=Dw,G.isoWeekday=Ew,G.dayOfYear=O_,G.hour=G.hours=$w,G.minute=G.minutes=U_,G.second=G.seconds=$_,G.millisecond=G.milliseconds=Mp,G.utcOffset=bb,G.utc=vb,G.local=Sb,G.parseZone=Lb,G.hasAlignedHourOffset=Ib,G.isDST=kb,G.isLocal=Ab,G.isUtcOffset=Tb,G.isUtc=bp,G.isUTC=bp,G.zoneAbbr=N_,G.zoneName=H_,G.dates=V("dates accessor is deprecated. Use date instead.",Pp),G.months=V("months accessor is deprecated. Use month instead",ap),G.years=V("years accessor is deprecated. Use year instead",ip),G.zone=V("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",_b),G.isDSTShifted=V("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",Cb);function V_(l){return We(l*1e3)}function W_(){return We.apply(null,arguments).parseZone()}function Fp(l){return l}var De=q.prototype;De.calendar=Vt,De.longDateFormat=yn,De.invalidDate=Vl,De.ordinal=Kl,De.preparse=Fp,De.postformat=Fp,De.relativeTime=Gl,De.pastFuture=Yl,De.set=ne,De.eras=h_,De.erasParse=g_,De.erasConvertYear=x_,De.erasAbbrRegex=S_,De.erasNameRegex=v_,De.erasNarrowRegex=L_,De.months=rw,De.monthsShort=ow,De.monthsParse=aw,De.monthsRegex=lw,De.monthsShortRegex=iw,De.week=cw,De.firstDayOfYear=mw,De.firstDayOfWeek=pw,De.weekdays=Lw,De.weekdaysMin=kw,De.weekdaysShort=Iw,De.weekdaysParse=Aw,De.weekdaysRegex=Pw,De.weekdaysShortRegex=Mw,De.weekdaysMinRegex=Fw,De.isPM=Ow,De.meridiem=Bw;function Hs(l,u,m,x){var w=zr(),A=h().set(x,u);return w[m](A,l)}function Rp(l,u,m){if(f(l)&&(u=l,l=void 0),l=l||"",u!=null)return Hs(l,u,m,"month");var x,w=[];for(x=0;x<12;x++)w[x]=Hs(l,x,m,"month");return w}function pf(l,u,m,x){typeof l=="boolean"?(f(u)&&(m=u,u=void 0),u=u||""):(u=l,m=u,l=!1,f(u)&&(m=u,u=void 0),u=u||"");var w=zr(),A=l?w._week.dow:0,B,se=[];if(m!=null)return Hs(u,(m+A)%7,x,"day");for(B=0;B<7;B++)se[B]=Hs(u,(B+A)%7,x,"day");return se}function q_(l,u){return Rp(l,u,"months")}function K_(l,u){return Rp(l,u,"monthsShort")}function z_(l,u,m){return pf(l,u,m,"weekdays")}function G_(l,u,m){return pf(l,u,m,"weekdaysShort")}function Y_(l,u,m){return pf(l,u,m,"weekdaysMin")}xo("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(l){var u=l%10,m=de(l%100/10)===1?"th":u===1?"st":u===2?"nd":u===3?"rd":"th";return l+m}}),e.lang=V("moment.lang is deprecated. Use moment.locale instead.",xo),e.langData=V("moment.langData is deprecated. Use moment.localeData instead.",zr);var Gr=Math.abs;function J_(){var l=this._data;return this._milliseconds=Gr(this._milliseconds),this._days=Gr(this._days),this._months=Gr(this._months),l.milliseconds=Gr(l.milliseconds),l.seconds=Gr(l.seconds),l.minutes=Gr(l.minutes),l.hours=Gr(l.hours),l.months=Gr(l.months),l.years=Gr(l.years),this}function Op(l,u,m,x){var w=pr(u,m);return l._milliseconds+=x*w._milliseconds,l._days+=x*w._days,l._months+=x*w._months,l._bubble()}function j_(l,u){return Op(this,l,u,1)}function X_(l,u){return Op(this,l,u,-1)}function Up(l){return l<0?Math.floor(l):Math.ceil(l)}function Z_(){var l=this._milliseconds,u=this._days,m=this._months,x=this._data,w,A,B,se,be;return l>=0&&u>=0&&m>=0||l<=0&&u<=0&&m<=0||(l+=Up(mf(m)+u)*864e5,u=0,m=0),x.milliseconds=l%1e3,w=Ke(l/1e3),x.seconds=w%60,A=Ke(w/60),x.minutes=A%60,B=Ke(A/60),x.hours=B%24,u+=Ke(B/24),be=Ke($p(u)),m+=be,u-=Up(mf(be)),se=Ke(m/12),m%=12,x.days=u,x.months=m,x.years=se,this}function $p(l){return l*4800/146097}function mf(l){return l*146097/4800}function Q_(l){if(!this.isValid())return NaN;var u,m,x=this._milliseconds;if(l=Ot(l),l==="month"||l==="quarter"||l==="year")switch(u=this._days+x/864e5,m=this._months+$p(u),l){case"month":return m;case"quarter":return m/3;case"year":return m/12}else switch(u=this._days+Math.round(mf(this._months)),l){case"week":return u/7+x/6048e5;case"day":return u+x/864e5;case"hour":return u*24+x/36e5;case"minute":return u*1440+x/6e4;case"second":return u*86400+x/1e3;case"millisecond":return Math.floor(u*864e5)+x;default:throw new Error("Unknown unit "+l)}}function ev(){return this.isValid()?this._milliseconds+this._days*864e5+this._months%12*2592e6+de(this._months/12)*31536e6:NaN}function Yr(l){return function(){return this.as(l)}}var tv=Yr("ms"),rv=Yr("s"),ov=Yr("m"),nv=Yr("h"),av=Yr("d"),sv=Yr("w"),iv=Yr("M"),lv=Yr("Q"),fv=Yr("y");function uv(){return pr(this)}function cv(l){return l=Ot(l),this.isValid()?this[l+"s"]():NaN}function zo(l){return function(){return this.isValid()?this._data[l]:NaN}}var dv=zo("milliseconds"),pv=zo("seconds"),mv=zo("minutes"),hv=zo("hours"),gv=zo("days"),xv=zo("months"),yv=zo("years");function wv(){return Ke(this.days()/7)}var Jr=Math.round,Sn={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function bv(l,u,m,x,w){return w.relativeTime(u||1,!!m,l,x)}function _v(l,u,m,x){var w=pr(l).abs(),A=Jr(w.as("s")),B=Jr(w.as("m")),se=Jr(w.as("h")),be=Jr(w.as("d")),Fe=Jr(w.as("M")),At=Jr(w.as("w")),jr=Jr(w.as("y")),wo=A<=m.ss&&["s",A]||A<m.s&&["ss",A]||B<=1&&["m"]||B<m.m&&["mm",B]||se<=1&&["h"]||se<m.h&&["hh",se]||be<=1&&["d"]||be<m.d&&["dd",be];return m.w!=null&&(wo=wo||At<=1&&["w"]||At<m.w&&["ww",At]),wo=wo||Fe<=1&&["M"]||Fe<m.M&&["MM",Fe]||jr<=1&&["y"]||["yy",jr],wo[2]=u,wo[3]=+l>0,wo[4]=x,bv.apply(null,wo)}function vv(l){return l===void 0?Jr:typeof l=="function"?(Jr=l,!0):!1}function Sv(l,u){return Sn[l]===void 0?!1:u===void 0?Sn[l]:(Sn[l]=u,l==="s"&&(Sn.ss=u-1),!0)}function Lv(l,u){if(!this.isValid())return this.localeData().invalidDate();var m=!1,x=Sn,w,A;return typeof l=="object"&&(u=l,l=!1),typeof l=="boolean"&&(m=l),typeof u=="object"&&(x=Object.assign({},Sn,u),u.s!=null&&u.ss==null&&(x.ss=u.s-1)),w=this.localeData(),A=_v(this,!m,x,w),m&&(A=w.pastFuture(+this,A)),w.postformat(A)}var hf=Math.abs;function Ln(l){return(l>0)-(l<0)||+l}function Vs(){if(!this.isValid())return this.localeData().invalidDate();var l=hf(this._milliseconds)/1e3,u=hf(this._days),m=hf(this._months),x,w,A,B,se=this.asSeconds(),be,Fe,At,jr;return se?(x=Ke(l/60),w=Ke(x/60),l%=60,x%=60,A=Ke(m/12),m%=12,B=l?l.toFixed(3).replace(/\.?0+$/,""):"",be=se<0?"-":"",Fe=Ln(this._months)!==Ln(se)?"-":"",At=Ln(this._days)!==Ln(se)?"-":"",jr=Ln(this._milliseconds)!==Ln(se)?"-":"",be+"P"+(A?Fe+A+"Y":"")+(m?Fe+m+"M":"")+(u?At+u+"D":"")+(w||x||l?"T":"")+(w?jr+w+"H":"")+(x?jr+x+"M":"")+(l?jr+B+"S":"")):"P0D"}var Ae=Rs.prototype;Ae.isValid=gb,Ae.abs=J_,Ae.add=j_,Ae.subtract=X_,Ae.as=Q_,Ae.asMilliseconds=tv,Ae.asSeconds=rv,Ae.asMinutes=ov,Ae.asHours=nv,Ae.asDays=av,Ae.asWeeks=sv,Ae.asMonths=iv,Ae.asQuarters=lv,Ae.asYears=fv,Ae.valueOf=ev,Ae._bubble=Z_,Ae.clone=uv,Ae.get=cv,Ae.milliseconds=dv,Ae.seconds=pv,Ae.minutes=mv,Ae.hours=hv,Ae.days=gv,Ae.weeks=wv,Ae.months=xv,Ae.years=yv,Ae.humanize=Lv,Ae.toISOString=Vs,Ae.toString=Vs,Ae.toJSON=Vs,Ae.locale=Ip,Ae.localeData=Cp,Ae.toIsoString=V("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Vs),Ae.lang=kp,oe("X",0,0,"unix"),oe("x",0,0,"valueOf"),re("x",As),re("X",zy),Me("X",function(l,u,m){m._d=new Date(parseFloat(l)*1e3)}),Me("x",function(l,u,m){m._d=new Date(de(l))});return e.version="2.29.4",t(We),e.fn=G,e.min=db,e.max=pb,e.now=mb,e.utc=h,e.unix=V_,e.months=q_,e.isDate=c,e.locale=xo,e.invalid=_,e.duration=pr,e.isMoment=H,e.weekdays=z_,e.parseZone=W_,e.localeData=zr,e.isDuration=Os,e.monthsShort=K_,e.weekdaysMin=Y_,e.defineLocale=tf,e.updateLocale=Ww,e.locales=qw,e.weekdaysShort=G_,e.normalizeUnits=Ot,e.relativeTimeRounding=vv,e.relativeTimeThreshold=Sv,e.calendarFormat=Bb,e.prototype=G,e.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},e})});var RA={};gf(RA,{default:()=>Nl});module.exports=Ev(RA);var jt=require("obsidian"),Ny=require("obsidian"),Hy=Fa(qs());var mt=()=>new Map,Ks=o=>{let e=mt();return o.forEach((t,r)=>{e.set(r,t)}),e},mr=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},Vp=(o,e)=>{let t=[];for(let[r,n]of o)t.push(e(n,r));return t},Wp=(o,e)=>{for(let[t,r]of o)if(e(r,t))return!0;return!1};var Pr=()=>new Set;var zs=o=>o[o.length-1];var qp=(o,e)=>{for(let t=0;t<e.length;t++)o.push(e[t])},hr=Array.from;var yf=Array.isArray;var Gs=class{constructor(){this._observers=mt()}on(e,t){return mr(this._observers,e,Pr).add(t),t}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return hr((this._observers.get(e)||mt()).values()).forEach(r=>r(...t))}destroy(){this._observers=mt()}},kn=class{constructor(){this._observers=mt()}on(e,t){mr(this._observers,e,Pr).add(t)}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return hr((this._observers.get(e)||mt()).values()).forEach(r=>r(...t))}destroy(){this._observers=mt()}};var Ut=Math.floor;var Cn=Math.abs;var An=(o,e)=>o<e?o:e,gr=(o,e)=>o>e?o:e,BA=Number.isNaN;var Ys=o=>o!==0?o<0:1/o<0;var bf=Number.MAX_SAFE_INTEGER,NA=Number.MIN_SAFE_INTEGER,HA=1<<31;var Kp=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&Ut(o)===o),VA=Number.isNaN,WA=Number.parseInt;var Mv=String.fromCharCode,qA=String.fromCodePoint,KA=Mv(65535),Fv=o=>o.toLowerCase(),Rv=/^\s*/g,Ov=o=>o.replace(Rv,""),Uv=/([A-Z])/g,_f=(o,e)=>Ov(o.replace(Uv,t=>`${e}${Fv(t)}`));var $v=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},En=typeof TextEncoder!="undefined"?new TextEncoder:null,Bv=o=>En.encode(o),Gp=En?Bv:$v;var Dn=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Dn&&Dn.decode(new Uint8Array).length===1&&(Dn=null);var Go=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Jo=()=>new Go;var Nv=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e};var Kt=o=>{let e=new Uint8Array(Nv(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(new Uint8Array(o.cbuf.buffer,0,o.cpos),t),e},Hv=(o,e)=>{let t=o.cbuf.length;t-o.cpos<e&&(o.bufs.push(new Uint8Array(o.cbuf.buffer,0,o.cpos)),o.cbuf=new Uint8Array(gr(t,e)*2),o.cpos=0)},ht=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e};var js=ht;var pe=(o,e)=>{for(;e>127;)ht(o,128|127&e),e=Ut(e/128);ht(o,127&e)},Xs=(o,e)=>{let t=Ys(e);for(t&&(e=-e),ht(o,(e>63?128:0)|(t?64:0)|63&e),e=Ut(e/64);e>0;)ht(o,(e>127?128:0)|127&e),e=Ut(e/128)},Sf=new Uint8Array(3e4),Vv=Sf.length/3,Wv=(o,e)=>{if(e.length<Vv){let t=En.encodeInto(e,Sf).written||0;pe(o,t);for(let r=0;r<t;r++)ht(o,Sf[r])}else gt(o,Gp(e))},qv=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;pe(o,r);for(let n=0;n<r;n++)ht(o,t.codePointAt(n))},Xr=En&&En.encodeInto?Wv:qv;var Ua=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=An(t-r,e.length),a=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,a>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(gr(t*2,a)),o.cbuf.set(e.subarray(n)),o.cpos=a)},gt=(o,e)=>{pe(o,e.byteLength),Ua(o,e)},Lf=(o,e)=>{Hv(o,e);let t=new DataView(o.cbuf.buffer,o.cpos,e);return o.cpos+=e,t},Kv=(o,e)=>Lf(o,4).setFloat32(0,e,!1),zv=(o,e)=>Lf(o,8).setFloat64(0,e,!1),Gv=(o,e)=>Lf(o,8).setBigInt64(0,e,!1);var Jp=new DataView(new ArrayBuffer(4)),Yv=o=>(Jp.setFloat32(0,o),Jp.getFloat32(0)===o),Mn=(o,e)=>{switch(typeof e){case"string":ht(o,119),Xr(o,e);break;case"number":Kp(e)&&Cn(e)<=2147483647?(ht(o,125),Xs(o,e)):Yv(e)?(ht(o,124),Kv(o,e)):(ht(o,123),zv(o,e));break;case"bigint":ht(o,122),Gv(o,e);break;case"object":if(e===null)ht(o,126);else if(yf(e)){ht(o,117),pe(o,e.length);for(let t=0;t<e.length;t++)Mn(o,e[t])}else if(e instanceof Uint8Array)ht(o,116),gt(o,e);else{ht(o,118);let t=Object.keys(e);pe(o,t.length);for(let r=0;r<t.length;r++){let n=t[r];Xr(o,n),Mn(o,e[n])}}break;case"boolean":ht(o,e?120:121);break;default:ht(o,127)}},Oa=class extends Go{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&pe(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var jp=o=>{o.count>0&&(Xs(o.encoder,o.count===1?o.s:-o.s),o.count>1&&pe(o.encoder,o.count-2))},Yo=class{constructor(){this.encoder=new Go,this.s=0,this.count=0}write(e){this.s===e?this.count++:(jp(this),this.count=1,this.s=e)}toUint8Array(){return jp(this),Kt(this.encoder)}};var Xp=o=>{if(o.count>0){let e=o.diff*2+(o.count===1?0:1);Xs(o.encoder,e),o.count>1&&pe(o.encoder,o.count-2)}},Fn=class{constructor(){this.encoder=new Go,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Xp(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Xp(this),Kt(this.encoder)}},Js=class{constructor(){this.sarr=[],this.s="",this.lensE=new Yo}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new Go;return this.sarr.push(this.s),this.s="",Xr(e,this.sarr.join("")),Ua(e,this.lensE.toUint8Array()),Kt(e)}};var Qt=o=>new Error(o),xr=()=>{throw Qt("Method unimplemented")},er=()=>{throw Qt("Unexpected case")};var Zp=Qt("Unexpected end of array"),Qp=Qt("Integer out of Range"),Rn=class{constructor(e){this.arr=e,this.pos=0}},wr=o=>new Rn(o),em=o=>o.pos!==o.arr.length;var Jv=(o,e)=>{let t=new Uint8Array(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},_t=o=>Jv(o,ce(o));var jo=o=>o.arr[o.pos++];var ce=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&127)*t,t*=128,n<128)return e;if(e>bf)throw Qp}throw Zp},Qs=o=>{let e=o.arr[o.pos++],t=e&63,r=64,n=(e&64)>0?-1:1;if(!(e&128))return n*t;let a=o.arr.length;for(;o.pos<a;){if(e=o.arr[o.pos++],t=t+(e&127)*r,r*=128,e<128)return n*t;if(t>bf)throw Qp}throw Zp};var jv=o=>{let e=ce(o);if(e===0)return"";{let t=String.fromCodePoint(jo(o));if(--e<100)for(;e--;)t+=String.fromCodePoint(jo(o));else for(;e>0;){let r=e<1e4?e:1e4,n=o.arr.subarray(o.pos,o.pos+r);o.pos+=r,t+=String.fromCodePoint.apply(null,n),e-=r}return decodeURIComponent(escape(t))}},Xv=o=>Dn.decode(_t(o)),yr=Dn?Xv:jv;var Cf=(o,e)=>{let t=new DataView(o.arr.buffer,o.arr.byteOffset+o.pos,e);return o.pos+=e,t},Zv=o=>Cf(o,4).getFloat32(0,!1),Qv=o=>Cf(o,8).getFloat64(0,!1),eS=o=>Cf(o,8).getBigInt64(0,!1);var tS=[o=>{},o=>null,Qs,Zv,Qv,eS,o=>!1,o=>!0,yr,o=>{let e=ce(o),t={};for(let r=0;r<e;r++){let n=yr(o);t[n]=On(o)}return t},o=>{let e=ce(o),t=[];for(let r=0;r<e;r++)t.push(On(o));return t},_t],On=o=>tS[127-jo(o)](o),$a=class extends Rn{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),em(this)?this.count=ce(this)+1:this.count=-1),this.count--,this.s}};var Xo=class extends Rn{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Qs(this);let e=Ys(this.s);this.count=1,e&&(this.s=-this.s,this.count=ce(this)+2)}return this.count--,this.s}};var Un=class extends Rn{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=Qs(this),t=e&1;this.diff=Ut(e/2),this.count=1,t&&(this.count=ce(this)+2)}return this.s+=this.diff,this.count--,this.s}},Zs=class{constructor(e){this.decoder=new Xo(e),this.str=yr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var YA=crypto.subtle,tm=crypto.getRandomValues.bind(crypto);var Ba=()=>tm(new Uint32Array(1))[0];var rS=[1e7]+-1e3+-4e3+-8e3+-1e11,ti=()=>rS.replace(/[018]/g,o=>(o^Ba()&15>>o/4).toString(16));var Zo=Date.now;var Zr=o=>new Promise(o);var oS=Promise.all.bind(Promise);var Tf=o=>o===void 0?null:o;var Df=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},nm=new Df,aS=!0;try{typeof localStorage!="undefined"&&localStorage&&(nm=localStorage,aS=!1)}catch(o){}var am=nm;var sm=Object.assign,iS=Object.keys,im=(o,e)=>{for(let t in o)e(o[t],t)};var Na=o=>iS(o).length;var lm=o=>{for(let e in o)return!1;return!0},lS=(o,e)=>{for(let t in o)if(!e(o[t],t))return!1;return!0},Ef=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),Pf=(o,e)=>o===e||Na(o)===Na(e)&&lS(o,(t,r)=>(t!==void 0||Ef(e,r))&&e[r]===t);var Ha=(o,e,t=0)=>{try{for(;t<o.length;t++)o[t](...e)}finally{t<o.length&&Ha(o,e,t+1)}};var um=o=>o,fS=(o,e)=>o===e;var $n=(o,e)=>{if(o==null||e==null)return fS(o,e);if(o.constructor!==e.constructor)return!1;if(o===e)return!0;switch(o.constructor){case ArrayBuffer:o=new Uint8Array(o),e=new Uint8Array(e);case Uint8Array:{if(o.byteLength!==e.byteLength)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;break}case Set:{if(o.size!==e.size)return!1;for(let t of o)if(!e.has(t))return!1;break}case Map:{if(o.size!==e.size)return!1;for(let t of o.keys())if(!e.has(t)||!$n(o.get(t),e.get(t)))return!1;break}case Object:if(Na(o)!==Na(e))return!1;for(let t in o)if(!Ef(o,t)||!$n(o[t],e[t]))return!1;break;case Array:if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!$n(o[t],e[t]))return!1;break;default:return!1}return!0},cm=(o,e)=>e.includes(o);var Va=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var XA=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,Mr,uS=[],cS=()=>{if(Mr===void 0)if(Va){Mr=mt();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&Mr.set(e,""),e=r):e!==null?(Mr.set(e,r),e=null):uS.push(r)}e!==null&&Mr.set(e,"")}else typeof location=="object"?(Mr=mt(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");Mr.set(`--${_f(e,"-")}`,t),Mr.set(`-${_f(e,"-")}`,t)}})):Mr=mt();return Mr},Ff=o=>cS().has(o);var Rf=o=>Va?Tf(process.env[o.toUpperCase().replaceAll("-","_")]):Tf(am.getItem(o));var dS=o=>Ff("--"+o)||Rf(o)!==null,ZA=dS("production"),dm=Va&&cm(process.env.FORCE_COLOR,["true","1","2"]),pm=!Ff("no-colors")&&(!Va||process.stdout.isTTY||dm)&&(!Va||Ff("color")||dm||Rf("COLORTERM")!==null||(Rf("TERM")||"").includes("color"));var mS=o=>new Uint8Array(o);var mm=o=>{let e=mS(o.byteLength);return e.set(o),e};var Of=class{constructor(e,t){this.left=e,this.right=t}},Tt=(o,e)=>new Of(o,e);var hm=(o,e)=>o.forEach(t=>e(t.left,t.right));var Fr=typeof document!="undefined"?document:{},gS=o=>Fr.createElement(o),xS=()=>Fr.createDocumentFragment(),yS=o=>Fr.createTextNode(o),QA=typeof DOMParser!="undefined"?new DOMParser:null;var wS=(o,e)=>(hm(e,(t,r)=>{r===!1?o.removeAttribute(t):r===!0?o.setAttribute(t,""):o.setAttribute(t,r)}),o);var bS=o=>{let e=xS();for(let t=0;t<o.length;t++)ym(e,o[t]);return e},gm=(o,e)=>(ym(o,bS(e)),o);var Wa=(o,e=[],t=[])=>gm(wS(gS(o),e),t);var Bn=yS;var xm=o=>Vp(o,(e,t)=>`${t}:${e};`).join("");var ym=(o,e)=>o.appendChild(e),eT=Fr.ELEMENT_NODE,tT=Fr.TEXT_NODE,rT=Fr.CDATA_SECTION_NODE,oT=Fr.COMMENT_NODE,nT=Fr.DOCUMENT_NODE,aT=Fr.DOCUMENT_TYPE_NODE,sT=Fr.DOCUMENT_FRAGMENT_NODE;var Rr=Symbol;var qa=Rr(),Ka=Rr(),$f=Rr(),Bf=Rr(),Nf=Rr(),za=Rr(),Hf=Rr(),Ga=Rr(),Vf=Rr(),bm=o=>{var n;o.length===1&&((n=o[0])==null?void 0:n.constructor)===Function&&(o=o[0]());let e=[],t=[],r=0;for(;r<o.length;r++){let a=o[r];a===void 0?e.push("undefined"):a.constructor===String||a.constructor===Number?e.push(a):a.constructor===Object&&t.push(JSON.stringify(a))}return t};var iT=Zo();var SS={[qa]:Tt("font-weight","bold"),[Ka]:Tt("font-weight","normal"),[$f]:Tt("color","blue"),[Nf]:Tt("color","green"),[Bf]:Tt("color","grey"),[za]:Tt("color","red"),[Hf]:Tt("color","purple"),[Ga]:Tt("color","orange"),[Vf]:Tt("color","black")},LS=o=>{var s;o.length===1&&((s=o[0])==null?void 0:s.constructor)===Function&&(o=o[0]());let e=[],t=[],r=mt(),n=[],a=0;for(;a<o.length;a++){let i=o[a],f=SS[i];if(f!==void 0)r.set(f.left,f.right);else{if(i===void 0)break;if(i.constructor===String||i.constructor===Number){let c=xm(r);a>0||c.length>0?(e.push("%c"+i),t.push(c)):e.push(i)}else break}}for(a>0&&(n=t,n.unshift(e.join("")));a<o.length;a++){let i=o[a];i instanceof Symbol||n.push(i)}return n},IS=pm?LS:bm,_m=(...o)=>{console.log(...IS(o)),kS.forEach(e=>e.print(o))};var kS=Pr();var vm=o=>({[Symbol.iterator](){return this},next:o}),Sm=(o,e)=>vm(()=>{let t;do t=o.next();while(!t.done&&!e(t.value));return t}),ri=(o,e)=>vm(()=>{let{done:t,value:r}=o.next();return{done:t,value:t?void 0:e(r)}});var Ja=class{constructor(e,t){this.clock=e,this.len=t}},Qo=class{constructor(){this.clients=new Map}},$m=(o,e,t)=>e.clients.forEach((r,n)=>{let a=o.doc.store.clients.get(n);for(let s=0;s<r.length;s++){let i=r[s];Gm(o,a,i.clock,i.len,t)}}),ES=(o,e)=>{let t=0,r=o.length-1;for(;t<=r;){let n=Ut((t+r)/2),a=o[n],s=a.clock;if(s<=e){if(e<s+a.len)return n;t=n+1}else r=n-1}return null},nu=(o,e)=>{let t=o.clients.get(e.client);return t!==void 0&&ES(t,e.clock)!==null},au=o=>{o.clients.forEach(e=>{e.sort((n,a)=>n.clock-a.clock);let t,r;for(t=1,r=1;t<e.length;t++){let n=e[r-1],a=e[t];n.clock+n.len>=a.clock?n.len=gr(n.len,a.clock+a.len-n.clock):(r<t&&(e[r]=a),r++)}e.length=r})},qf=o=>{let e=new Qo;for(let t=0;t<o.length;t++)o[t].clients.forEach((r,n)=>{if(!e.clients.has(n)){let a=r.slice();for(let s=t+1;s<o.length;s++)qp(a,o[s].clients.get(n)||[]);e.clients.set(n,a)}});return au(e),e},fi=(o,e,t,r)=>{mr(o.clients,e,()=>[]).push(new Ja(t,r))},su=()=>new Qo,PS=o=>{let e=su();return o.clients.forEach((t,r)=>{let n=[];for(let a=0;a<t.length;a++){let s=t[a];if(s.deleted){let i=s.id.clock,f=s.length;if(a+1<t.length)for(let c=t[a+1];a+1<t.length&&c.deleted;c=t[++a+1])f+=c.length;n.push(new Ja(i,f))}}n.length>0&&e.clients.set(r,n)}),e},Lo=(o,e)=>{pe(o.restEncoder,e.clients.size),hr(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{o.resetDsCurVal(),pe(o.restEncoder,t);let n=r.length;pe(o.restEncoder,n);for(let a=0;a<n;a++){let s=r[a];o.writeDsClock(s.clock),o.writeDsLen(s.len)}})},ja=o=>{let e=new Qo,t=ce(o.restDecoder);for(let r=0;r<t;r++){o.resetDsCurVal();let n=ce(o.restDecoder),a=ce(o.restDecoder);if(a>0){let s=mr(e.clients,n,()=>[]);for(let i=0;i<a;i++)s.push(new Ja(o.readDsClock(),o.readDsLen()))}}return e},km=(o,e,t)=>{let r=new Qo,n=ce(o.restDecoder);for(let a=0;a<n;a++){o.resetDsCurVal();let s=ce(o.restDecoder),i=ce(o.restDecoder),f=t.clients.get(s)||[],c=st(t,s);for(let d=0;d<i;d++){let p=o.readDsClock(),h=p+o.readDsLen();if(p<c){c<h&&fi(r,s,c,h-c);let y=Ur(f,p),g=f[y];for(!g.deleted&&g.id.clock<p&&(f.splice(y+1,0,yi(e,g,p-g.id.clock)),y++);y<f.length&&(g=f[y++],g.id.clock<h);)g.deleted||(h<g.id.clock+g.length&&f.splice(y,0,yi(e,g,h-g.id.clock)),g.delete(e))}else fi(r,s,p,h-p)}}if(r.clients.size>0){let a=new Qr;return pe(a.restEncoder,0),Lo(a,r),a.toUint8Array()}return null};var Bm=Ba,tr=class extends Gs{constructor({guid:e=ti(),collectionid:t=null,gc:r=!0,gcFilter:n=()=>!0,meta:a=null,autoLoad:s=!1,shouldLoad:i=!0}={}){super(),this.gc=r,this.gcFilter=n,this.clientID=Bm(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new mi,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=i,this.autoLoad=s,this.meta=a,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Zr(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});let f=()=>Zr(c=>{let d=p=>{(p===void 0||p===!0)&&(this.off("sync",d),c())};this.on("sync",d)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=f()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=f()}load(){let e=this._item;e!==null&&!this.shouldLoad&&Re(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(hr(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Re(this,e,t)}get(e,t=ct){let r=mr(this.share,e,()=>{let a=new t;return a._integrate(this,null),a}),n=r.constructor;if(t!==ct&&n!==t)if(n===ct){let a=new t;a._map=r._map,r._map.forEach(s=>{for(;s!==null;s=s.left)s.parent=a}),a._start=r._start;for(let s=a._start;s!==null;s=s.right)s.parent=a;return a._length=r._length,this.share.set(e,a),a._integrate(this,null),a}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Or)}getText(e=""){return this.get(e,Co)}getMap(e=""){return this.get(e,eo)}getXmlElement(e=""){return this.get(e,Ao)}getXmlFragment(e=""){return this.get(e,to)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){hr(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new tr({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Re(e.parent.doc,r=>{let n=t.doc;e.deleted||r.subdocsAdded.add(n),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},Vn=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return ce(this.restDecoder)}readDsLen(){return ce(this.restDecoder)}},ui=class extends Vn{readLeftID(){return _e(ce(this.restDecoder),ce(this.restDecoder))}readRightID(){return _e(ce(this.restDecoder),ce(this.restDecoder))}readClient(){return ce(this.restDecoder)}readInfo(){return jo(this.restDecoder)}readString(){return yr(this.restDecoder)}readParentInfo(){return ce(this.restDecoder)===1}readTypeRef(){return ce(this.restDecoder)}readLen(){return ce(this.restDecoder)}readAny(){return On(this.restDecoder)}readBuf(){return mm(_t(this.restDecoder))}readJSON(){return JSON.parse(yr(this.restDecoder))}readKey(){return yr(this.restDecoder)}},Kf=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=ce(this.restDecoder),this.dsCurrVal}readDsLen(){let e=ce(this.restDecoder)+1;return this.dsCurrVal+=e,e}},Io=class extends Kf{constructor(e){super(e),this.keys=[],ce(e),this.keyClockDecoder=new Un(_t(e)),this.clientDecoder=new Xo(_t(e)),this.leftClockDecoder=new Un(_t(e)),this.rightClockDecoder=new Un(_t(e)),this.infoDecoder=new $a(_t(e),jo),this.stringDecoder=new Zs(_t(e)),this.parentInfoDecoder=new $a(_t(e),jo),this.typeRefDecoder=new Xo(_t(e)),this.lenDecoder=new Xo(_t(e))}readLeftID(){return new So(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new So(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return On(this.restDecoder)}readBuf(){return _t(this.restDecoder)}readJSON(){return On(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},Wn=class{constructor(){this.restEncoder=Jo()}toUint8Array(){return Kt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){pe(this.restEncoder,e)}writeDsLen(e){pe(this.restEncoder,e)}},en=class extends Wn{writeLeftID(e){pe(this.restEncoder,e.client),pe(this.restEncoder,e.clock)}writeRightID(e){pe(this.restEncoder,e.client),pe(this.restEncoder,e.clock)}writeClient(e){pe(this.restEncoder,e)}writeInfo(e){js(this.restEncoder,e)}writeString(e){Xr(this.restEncoder,e)}writeParentInfo(e){pe(this.restEncoder,e?1:0)}writeTypeRef(e){pe(this.restEncoder,e)}writeLen(e){pe(this.restEncoder,e)}writeAny(e){Mn(this.restEncoder,e)}writeBuf(e){gt(this.restEncoder,e)}writeJSON(e){Xr(this.restEncoder,JSON.stringify(e))}writeKey(e){Xr(this.restEncoder,e)}},ci=class{constructor(){this.restEncoder=Jo(),this.dsCurrVal=0}toUint8Array(){return Kt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,pe(this.restEncoder,t)}writeDsLen(e){e===0&&er(),pe(this.restEncoder,e-1),this.dsCurrVal+=e}},Qr=class extends ci{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Fn,this.clientEncoder=new Yo,this.leftClockEncoder=new Fn,this.rightClockEncoder=new Fn,this.infoEncoder=new Oa(js),this.stringEncoder=new Js,this.parentInfoEncoder=new Oa(js),this.typeRefEncoder=new Yo,this.lenEncoder=new Yo}toUint8Array(){let e=Jo();return pe(e,0),gt(e,this.keyClockEncoder.toUint8Array()),gt(e,this.clientEncoder.toUint8Array()),gt(e,this.leftClockEncoder.toUint8Array()),gt(e,this.rightClockEncoder.toUint8Array()),gt(e,Kt(this.infoEncoder)),gt(e,this.stringEncoder.toUint8Array()),gt(e,Kt(this.parentInfoEncoder)),gt(e,this.typeRefEncoder.toUint8Array()),gt(e,this.lenEncoder.toUint8Array()),Ua(e,Kt(this.restEncoder)),Kt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Mn(this.restEncoder,e)}writeBuf(e){gt(this.restEncoder,e)}writeJSON(e){Mn(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},MS=(o,e,t,r)=>{r=gr(r,e[0].id.clock);let n=Ur(e,r);pe(o.restEncoder,e.length-n),o.writeClient(t),pe(o.restEncoder,r);let a=e[n];a.write(o,r-a.id.clock);for(let s=n+1;s<e.length;s++)e[s].write(o,0)},iu=(o,e,t)=>{let r=new Map;t.forEach((n,a)=>{st(e,a)>n&&r.set(a,n)}),wi(e).forEach((n,a)=>{t.has(a)||r.set(a,0)}),pe(o.restEncoder,r.size),hr(r.entries()).sort((n,a)=>a[0]-n[0]).forEach(([n,a])=>{MS(o,e.clients.get(n),n,a)})},FS=(o,e)=>{let t=mt(),r=ce(o.restDecoder);for(let n=0;n<r;n++){let a=ce(o.restDecoder),s=new Array(a),i=o.readClient(),f=ce(o.restDecoder);t.set(i,{i:0,refs:s});for(let c=0;c<a;c++){let d=o.readInfo();switch(31&d){case 0:{let p=o.readLen();s[c]=new $t(_e(i,f),p),f+=p;break}case 10:{let p=ce(o.restDecoder);s[c]=new Bt(_e(i,f),p),f+=p;break}default:{let p=(d&192)===0,h=new Ge(_e(i,f),null,(d&128)===128?o.readLeftID():null,null,(d&64)===64?o.readRightID():null,p?o.readParentInfo()?e.get(o.readString()):o.readLeftID():null,p&&(d&32)===32?o.readString():null,dh(o,d));s[c]=h,f+=h.length}}}}return t},RS=(o,e,t)=>{let r=[],n=hr(t.keys()).sort((y,g)=>y-g);if(n.length===0)return null;let a=()=>{if(n.length===0)return null;let y=t.get(n[n.length-1]);for(;y.refs.length===y.i;)if(n.pop(),n.length>0)y=t.get(n[n.length-1]);else return null;return y},s=a();if(s===null)return null;let i=new mi,f=new Map,c=(y,g)=>{let v=f.get(y);(v==null||v>g)&&f.set(y,g)},d=s.refs[s.i++],p=new Map,h=()=>{for(let y of r){let g=y.id.client,v=t.get(g);v?(v.i--,i.clients.set(g,v.refs.slice(v.i)),t.delete(g),v.i=0,v.refs=[]):i.clients.set(g,[y]),n=n.filter(b=>b!==g)}r.length=0};for(;;){if(d.constructor!==Bt){let g=mr(p,d.id.client,()=>st(e,d.id.client))-d.id.clock;if(g<0)r.push(d),c(d.id.client,d.id.clock-1),h();else{let v=d.getMissing(o,e);if(v!==null){r.push(d);let b=t.get(v)||{refs:[],i:0};if(b.refs.length===b.i)c(v,st(e,v)),h();else{d=b.refs[b.i++];continue}}else(g===0||g<d.length)&&(d.integrate(o,g),p.set(d.id.client,d.id.clock+d.length))}}if(r.length>0)d=r.pop();else if(s!==null&&s.i<s.refs.length)d=s.refs[s.i++];else{if(s=a(),s===null)break;d=s.refs[s.i++]}}if(i.clients.size>0){let y=new Qr;return iu(y,i,new Map),pe(y.restEncoder,0),{missing:f,update:y.toUint8Array()}}return null},OS=(o,e)=>iu(o,e.doc.store,e.beforeState),US=(o,e,t,r=new Io(o))=>Re(e,n=>{n.local=!1;let a=!1,s=n.doc,i=s.store,f=FS(r,s),c=RS(n,i,f),d=i.pendingStructs;if(d){for(let[h,y]of d.missing)if(y<st(i,h)){a=!0;break}if(c){for(let[h,y]of c.missing){let g=d.missing.get(h);(g==null||g>y)&&d.missing.set(h,y)}d.update=hi([d.update,c.update])}}else i.pendingStructs=c;let p=km(r,n,i);if(i.pendingDs){let h=new Io(wr(i.pendingDs));ce(h.restDecoder);let y=km(h,n,i);p&&y?i.pendingDs=hi([p,y]):i.pendingDs=p||y}else i.pendingDs=p;if(a){let h=i.pendingStructs.update;i.pendingStructs=null,Nm(n.doc,h)}},t,!1);var Nm=(o,e,t,r=Io)=>{let n=wr(e);US(n,o,t,new r(n))},To=(o,e,t)=>Nm(o,e,t,ui),$S=(o,e,t=new Map)=>{iu(o,e.store,t),Lo(o,PS(e.store))},BS=(o,e=new Uint8Array([0]),t=new Qr)=>{let r=Hm(e);$S(t,o,r);let n=[t.toUint8Array()];if(o.store.pendingDs&&n.push(o.store.pendingDs),o.store.pendingStructs&&n.push(ZS(o.store.pendingStructs.update,e)),n.length>1){if(t.constructor===en)return jS(n.map((a,s)=>s===0?a:e0(a)));if(t.constructor===Qr)return hi(n)}return n[0]},nn=(o,e)=>BS(o,e,new en),NS=o=>{let e=new Map,t=ce(o.restDecoder);for(let r=0;r<t;r++){let n=ce(o.restDecoder),a=ce(o.restDecoder);e.set(n,a)}return e},Hm=o=>NS(new Vn(wr(o))),Vm=(o,e)=>(pe(o.restEncoder,e.size),hr(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{pe(o.restEncoder,t),pe(o.restEncoder,r)}),o),HS=(o,e)=>Vm(o,wi(e.store)),VS=(o,e=new ci)=>(o instanceof Map?Vm(e,o):HS(e,o),e.toUint8Array()),Wm=o=>VS(o,new Wn),zf=class{constructor(){this.l=[]}},Cm=()=>new zf,Am=(o,e)=>o.l.push(e),Tm=(o,e)=>{let t=o.l,r=t.length;o.l=t.filter(n=>e!==n),r===o.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},qm=(o,e,t)=>Ha(o.l,[e,t]),So=class{constructor(e,t){this.client=e,this.clock=t}},Hn=(o,e)=>o===e||o!==null&&e!==null&&o.client===e.client&&o.clock===e.clock,_e=(o,e)=>new So(o,e);var Km=o=>{for(let[e,t]of o.doc.share.entries())if(t===o)return e;throw er()};var di=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let n=(a,s)=>{let i=a.get("ds"),f=a.get("ids"),c=d=>this.clients.set(d,s);i.observe(d=>{d.changes.added.forEach(p=>{p.content.getContent().forEach(h=>{h instanceof Uint8Array&&this.dss.set(s,qf([this.dss.get(s)||su(),ja(new Vn(wr(h)))]))})})}),this.dss.set(s,qf(i.map(d=>ja(new Vn(wr(d)))))),f.observe(d=>d.changes.added.forEach(p=>p.content.getContent().forEach(c))),f.forEach(c)};t.observe(a=>{a.keysChanged.forEach(s=>n(t.get(s),s))}),t.forEach(n)}setUserMapping(e,t,r,{filter:n=()=>!0}={}){let a=this.yusers,s=a.get(r);s||(s=new eo,s.set("ids",new Or),s.set("ds",new Or),a.set(r,s)),s.get("ids").push([t]),a.observe(i=>{setTimeout(()=>{let f=a.get(r);if(f!==s){s=f,this.clients.forEach((p,h)=>{r===p&&s.get("ids").push([h])});let c=new Wn,d=this.dss.get(r);d&&(Lo(c,d),s.get("ds").push([c.toUint8Array()]))}},0)}),e.on("afterTransaction",i=>{setTimeout(()=>{let f=s.get("ds"),c=i.deleteSet;if(i.local&&c.clients.size>0&&n(i,c)){let d=new Wn;Lo(d,c),f.push([d.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(nu(r,e))return t;return null}},pi=class{constructor(e,t,r,n=0){this.type=e,this.tname=t,this.item=r,this.assoc=n}};var lu=o=>new pi(o.type==null?null:_e(o.type.client,o.type.clock),o.tname||null,o.item==null?null:_e(o.item.client,o.item.clock),o.assoc==null?0:o.assoc),Gf=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},WS=(o,e,t=0)=>new Gf(o,e,t),oi=(o,e,t)=>{let r=null,n=null;return o._item===null?n=Km(o):r=_e(o._item.id.client,o._item.id.clock),new pi(r,n,e,t)},fu=(o,e,t=0)=>{let r=o._start;if(t<0){if(e===0)return oi(o,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return oi(o,_e(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return oi(o,r.lastId,t);r=r.right}return oi(o,null,t)};var uu=(o,e)=>{let t=e.store,r=o.item,n=o.type,a=o.tname,s=o.assoc,i=null,f=0;if(r!==null){if(st(t,r.client)<=r.clock)return null;let c=Um(t,r),d=c.item;if(!(d instanceof Ge))return null;if(i=d.parent,i._item===null||!i._item.deleted){f=d.deleted||!d.countable?0:c.diff+(s>=0?0:1);let p=d.left;for(;p!==null;)!p.deleted&&p.countable&&(f+=p.length),p=p.left}}else{if(a!==null)i=e.get(a);else if(n!==null){if(st(t,n.client)<=n.clock)return null;let{item:c}=Um(t,n);if(c instanceof Ge&&c.content instanceof or)i=c.content.type;else return null}else throw er();s>=0?f=i._length:f=0}return WS(i,f,o.assoc)},cu=(o,e)=>o===e||o!==null&&e!==null&&o.tname===e.tname&&Hn(o.item,e.item)&&Hn(o.type,e.type)&&o.assoc===e.assoc,Yf=class{constructor(e,t){this.ds=e,this.sv=t}};var qS=(o,e)=>new Yf(o,e),xT=qS(su(),new Map);var Nn=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&(e.sv.get(o.id.client)||0)>o.id.clock&&!nu(e.ds,o.id),Jf=(o,e)=>{let t=mr(o.meta,Jf,Pr),r=o.doc.store;t.has(e)||(e.sv.forEach((n,a)=>{n<st(r,a)&&ko(o,_e(a,n))}),$m(o,e.ds,n=>{}),t.add(e))};var mi=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},wi=o=>{let e=new Map;return o.clients.forEach((t,r)=>{let n=t[t.length-1];e.set(r,n.id.clock+n.length)}),e},st=(o,e)=>{let t=o.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},zm=(o,e)=>{let t=o.clients.get(e.id.client);if(t===void 0)t=[],o.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw er()}t.push(e)},Ur=(o,e)=>{let t=0,r=o.length-1,n=o[r],a=n.id.clock;if(a===e)return r;let s=Ut(e/(a+n.length-1)*r);for(;t<=r;){if(n=o[s],a=n.id.clock,a<=e){if(e<a+n.length)return s;t=s+1}else r=s-1;s=Ut((t+r)/2)}throw er()},KS=(o,e)=>{let t=o.clients.get(e.client);return t[Ur(t,e.clock)]},si=KS,jf=(o,e,t)=>{let r=Ur(e,t),n=e[r];return n.id.clock<t&&n instanceof Ge?(e.splice(r+1,0,yi(o,n,t-n.id.clock)),r+1):r},ko=(o,e)=>{let t=o.doc.store.clients.get(e.client);return t[jf(o,t,e.clock)]},Dm=(o,e,t)=>{let r=e.clients.get(t.client),n=Ur(r,t.clock),a=r[n];return t.clock!==a.id.clock+a.length-1&&a.constructor!==$t&&r.splice(n+1,0,yi(o,a,t.clock-a.id.clock+1)),a},zS=(o,e,t)=>{let r=o.clients.get(e.id.client);r[Ur(r,e.id.clock)]=t},Gm=(o,e,t,r,n)=>{if(r===0)return;let a=t+r,s=jf(o,e,t),i;do i=e[s++],a<i.id.clock+i.length&&jf(o,e,a),n(i);while(s<e.length&&e[s].id.clock<a)},Xf=class{constructor(e,t,r){this.doc=e,this.deleteSet=new Qo,this.beforeState=wi(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},Em=(o,e)=>e.deleteSet.clients.size===0&&!Wp(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(au(e.deleteSet),OS(o,e),Lo(o,e.deleteSet),!0),Pm=(o,e,t)=>{let r=e._item;(r===null||r.id.clock<(o.beforeState.get(r.id.client)||0)&&!r.deleted)&&mr(o.changed,e,Pr).add(t)},ii=(o,e)=>{let t=o[e],r=o[e-1],n=e;for(;n>0;t=r,r=o[--n-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof Ge&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let a=e-n;return a&&o.splice(e+1-a,a),a},GS=(o,e,t)=>{for(let[r,n]of o.clients.entries()){let a=e.clients.get(r);for(let s=n.length-1;s>=0;s--){let i=n[s],f=i.clock+i.len;for(let c=Ur(a,i.clock),d=a[c];c<a.length&&d.id.clock<f;d=a[++c]){let p=a[c];if(i.clock+i.len<=p.id.clock)break;p instanceof Ge&&p.deleted&&!p.keep&&t(p)&&p.gc(e,!1)}}}},YS=(o,e)=>{o.clients.forEach((t,r)=>{let n=e.clients.get(r);for(let a=t.length-1;a>=0;a--){let s=t[a],i=An(n.length-1,1+Ur(n,s.clock+s.len-1));for(let f=i,c=n[f];f>0&&c.id.clock>=s.clock;c=n[f])f-=1+ii(n,f)}})};var Ym=(o,e)=>{if(e<o.length){let t=o[e],r=t.doc,n=r.store,a=t.deleteSet,s=t._mergeStructs;try{au(a),t.afterState=wi(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let i=[];t.changed.forEach((f,c)=>i.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,f)})),i.push(()=>{t.changedParentTypes.forEach((f,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(f=f.filter(d=>d.target._item===null||!d.target._item.deleted),f.forEach(d=>{d.currentTarget=c,d._path=null}),f.sort((d,p)=>d.path.length-p.path.length),qm(c._dEH,f,t))})}),i.push(()=>r.emit("afterTransaction",[t,r])),Ha(i,[]),t._needFormattingCleanup&&c0(t)}finally{r.gc&&GS(a,n,r.gcFilter),YS(a,n),t.afterState.forEach((d,p)=>{let h=t.beforeState.get(p)||0;if(h!==d){let y=n.clients.get(p),g=gr(Ur(y,h),1);for(let v=y.length-1;v>=g;)v-=1+ii(y,v)}});for(let d=s.length-1;d>=0;d--){let{client:p,clock:h}=s[d].id,y=n.clients.get(p),g=Ur(y,h);g+1<y.length&&ii(y,g+1)>1||g>0&&ii(y,g)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(_m(Ga,qa,"[yjs] ",Ka,za,"Changed the client-id because another client seems to be using it."),r.clientID=Bm()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let d=new en;Em(d,t)&&r.emit("update",[d.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let d=new Qr;Em(d,t)&&r.emit("updateV2",[d.toUint8Array(),t.origin,r,t])}let{subdocsAdded:i,subdocsLoaded:f,subdocsRemoved:c}=t;(i.size>0||c.size>0||f.size>0)&&(i.forEach(d=>{d.clientID=r.clientID,d.collectionid==null&&(d.collectionid=r.collectionid),r.subdocs.add(d)}),c.forEach(d=>r.subdocs.delete(d)),r.emit("subdocs",[{loaded:f,added:i,removed:c},r,t]),c.forEach(d=>d.destroy())),o.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,o])):Ym(o,e+1)}}},Re=(o,e,t=null,r=!0)=>{let n=o._transactionCleanups,a=!1,s=null;o._transaction===null&&(a=!0,o._transaction=new Xf(o,t,r),n.push(o._transaction),n.length===1&&o.emit("beforeAllTransactions",[o]),o.emit("beforeTransaction",[o._transaction,o]));try{s=e(o._transaction)}finally{if(a){let i=o._transaction===n[0];o._transaction=null,i&&Ym(n,0)}}return s};function*JS(o){let e=ce(o.restDecoder);for(let t=0;t<e;t++){let r=ce(o.restDecoder),n=o.readClient(),a=ce(o.restDecoder);for(let s=0;s<r;s++){let i=o.readInfo();if(i===10){let f=ce(o.restDecoder);yield new Bt(_e(n,a),f),a+=f}else if(31&i){let f=(i&192)===0,c=new Ge(_e(n,a),null,(i&128)===128?o.readLeftID():null,null,(i&64)===64?o.readRightID():null,f?o.readParentInfo()?o.readString():o.readLeftID():null,f&&(i&32)===32?o.readString():null,dh(o,i));yield c,a+=c.length}else{let f=o.readLen();yield new $t(_e(n,a),f),a+=f}}}}var Xa=class{constructor(e,t){this.gen=JS(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Bt);return this.curr}};var Za=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},jS=o=>hi(o,ui,en);var XS=(o,e)=>{if(o.constructor===$t){let{client:t,clock:r}=o.id;return new $t(_e(t,r+e),o.length-e)}else if(o.constructor===Bt){let{client:t,clock:r}=o.id;return new Bt(_e(t,r+e),o.length-e)}else{let t=o,{client:r,clock:n}=t.id;return new Ge(_e(r,n+e),null,_e(r,n+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},hi=(o,e=Io,t=Qr)=>{if(o.length===1)return o[0];let r=o.map(d=>new e(wr(d))),n=r.map(d=>new Xa(d,!0)),a=null,s=new t,i=new Za(s);for(;n=n.filter(h=>h.curr!==null),n.sort((h,y)=>{if(h.curr.id.client===y.curr.id.client){let g=h.curr.id.clock-y.curr.id.clock;return g===0?h.curr.constructor===y.curr.constructor?0:h.curr.constructor===Bt?1:-1:g}else return y.curr.id.client-h.curr.id.client}),n.length!==0;){let d=n[0],p=d.curr.id.client;if(a!==null){let h=d.curr,y=!1;for(;h!==null&&h.id.clock+h.length<=a.struct.id.clock+a.struct.length&&h.id.client>=a.struct.id.client;)h=d.next(),y=!0;if(h===null||h.id.client!==p||y&&h.id.clock>a.struct.id.clock+a.struct.length)continue;if(p!==a.struct.id.client)_o(i,a.struct,a.offset),a={struct:h,offset:0},d.next();else if(a.struct.id.clock+a.struct.length<h.id.clock)if(a.struct.constructor===Bt)a.struct.length=h.id.clock+h.length-a.struct.id.clock;else{_o(i,a.struct,a.offset);let g=h.id.clock-a.struct.id.clock-a.struct.length;a={struct:new Bt(_e(p,a.struct.id.clock+a.struct.length),g),offset:0}}else{let g=a.struct.id.clock+a.struct.length-h.id.clock;g>0&&(a.struct.constructor===Bt?a.struct.length-=g:h=XS(h,g)),a.struct.mergeWith(h)||(_o(i,a.struct,a.offset),a={struct:h,offset:0},d.next())}}else a={struct:d.curr,offset:0},d.next();for(let h=d.curr;h!==null&&h.id.client===p&&h.id.clock===a.struct.id.clock+a.struct.length&&h.constructor!==Bt;h=d.next())_o(i,a.struct,a.offset),a={struct:h,offset:0}}a!==null&&(_o(i,a.struct,a.offset),a=null),du(i);let f=r.map(d=>ja(d)),c=qf(f);return Lo(s,c),s.toUint8Array()},ZS=(o,e,t=Io,r=Qr)=>{let n=Hm(e),a=new r,s=new Za(a),i=new t(wr(o)),f=new Xa(i,!1);for(;f.curr;){let d=f.curr,p=d.id.client,h=n.get(p)||0;if(f.curr.constructor===Bt){f.next();continue}if(d.id.clock+d.length>h)for(_o(s,d,gr(h-d.id.clock,0)),f.next();f.curr&&f.curr.id.client===p;)_o(s,f.curr,0),f.next();else for(;f.curr&&f.curr.id.client===p&&f.curr.id.clock+f.curr.length<=h;)f.next()}du(s);let c=ja(i);return Lo(a,c),a.toUint8Array()};var Jm=o=>{o.written>0&&(o.clientStructs.push({written:o.written,restEncoder:Kt(o.encoder.restEncoder)}),o.encoder.restEncoder=Jo(),o.written=0)},_o=(o,e,t)=>{o.written>0&&o.currClient!==e.id.client&&Jm(o),o.written===0&&(o.currClient=e.id.client,o.encoder.writeClient(e.id.client),pe(o.encoder.restEncoder,e.id.clock+t)),e.write(o.encoder,t),o.written++},du=o=>{Jm(o);let e=o.encoder.restEncoder;pe(e,o.clientStructs.length);for(let t=0;t<o.clientStructs.length;t++){let r=o.clientStructs[t];pe(e,r.written),Ua(e,r.restEncoder)}},QS=(o,e,t,r)=>{let n=new t(wr(o)),a=new Xa(n,!1),s=new r,i=new Za(s);for(let c=a.curr;c!==null;c=a.next())_o(i,e(c),0);du(i);let f=ja(n);return Lo(s,f),s.toUint8Array()};var e0=o=>QS(o,um,Io,en),Mm="You must not compute changes after the event-handler fired.",qn=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=t0(this.currentTarget,this.target))}deletes(e){return nu(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Qt(Mm);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(n=>{if(n!==null){let a=t._map.get(n),s,i;if(this.adds(a)){let f=a.left;for(;f!==null&&this.adds(f);)f=f.left;if(this.deletes(a))if(f!==null&&this.deletes(f))s="delete",i=zs(f.content.getContent());else return;else f!==null&&this.deletes(f)?(s="update",i=zs(f.content.getContent())):(s="add",i=void 0)}else if(this.deletes(a))s="delete",i=zs(a.content.getContent());else return;e.set(n,{action:s,oldValue:i})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Qt(Mm);let t=this.target,r=Pr(),n=Pr(),a=[];if(e={added:r,deleted:n,delta:a,keys:this.keys},this.transaction.changed.get(t).has(null)){let i=null,f=()=>{i&&a.push(i)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((i===null||i.delete===void 0)&&(f(),i={delete:0}),i.delete+=c.length,n.add(c)):this.adds(c)?((i===null||i.insert===void 0)&&(f(),i={insert:[]}),i.insert=i.insert.concat(c.content.getContent()),r.add(c)):((i===null||i.retain===void 0)&&(f(),i={retain:0}),i.retain+=c.length);i!==null&&i.retain===void 0&&f()}this._changes=e}return e}},t0=(o,e)=>{let t=[];for(;e._item!==null&&e!==o;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,n=e._item.parent._start;for(;n!==e._item&&n!==null;)n.deleted||r++,n=n.right;t.unshift(r)}e=e._item.parent}return t},jm=80,pu=0,Zf=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=pu++}},r0=o=>{o.timestamp=pu++},Xm=(o,e,t)=>{o.p.marker=!1,o.p=e,e.marker=!0,o.index=t,o.timestamp=pu++},o0=(o,e,t)=>{if(o.length>=jm){let r=o.reduce((n,a)=>n.timestamp<a.timestamp?n:a);return Xm(r,e,t),r}else{let r=new Zf(e,t);return o.push(r),r}},bi=(o,e)=>{if(o._start===null||e===0||o._searchMarker===null)return null;let t=o._searchMarker.length===0?null:o._searchMarker.reduce((a,s)=>Cn(e-a.index)<Cn(e-s.index)?a:s),r=o._start,n=0;for(t!==null&&(r=t.p,n=t.index,r0(t));r.right!==null&&n<e;){if(!r.deleted&&r.countable){if(e<n+r.length)break;n+=r.length}r=r.right}for(;r.left!==null&&n>e;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);return t!==null&&Cn(t.index-n)<r.parent.length/jm?(Xm(t,r,n),t):o0(o._searchMarker,r,n)},Qa=(o,e,t)=>{for(let r=o.length-1;r>=0;r--){let n=o[r];if(t>0){let a=n.p;for(a.marker=!1;a&&(a.deleted||!a.countable);)a=a.left,a&&!a.deleted&&a.countable&&(n.index-=a.length);if(a===null||a.marker===!0){o.splice(r,1);continue}n.p=a,a.marker=!0}(e<n.index||t>0&&e===n.index)&&(n.index=gr(e,n.index+t))}};var _i=(o,e,t)=>{let r=o,n=e.changedParentTypes;for(;mr(n,o,()=>[]).push(t),o._item!==null;)o=o._item.parent;qm(r._eH,t,e)},ct=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Cm(),this._dEH=Cm(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw xr()}clone(){throw xr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Am(this._eH,e)}observeDeep(e){Am(this._dEH,e)}unobserve(e){Tm(this._eH,e)}unobserveDeep(e){Tm(this._dEH,e)}toJSON(){}},Zm=(o,e,t)=>{e<0&&(e=o._length+e),t<0&&(t=o._length+t);let r=t-e,n=[],a=o._start;for(;a!==null&&r>0;){if(a.countable&&!a.deleted){let s=a.content.getContent();if(s.length<=e)e-=s.length;else{for(let i=e;i<s.length&&r>0;i++)n.push(s[i]),r--;e=0}}a=a.right}return n},Qm=o=>{let e=[],t=o._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let n=0;n<r.length;n++)e.push(r[n])}t=t.right}return e};var es=(o,e)=>{let t=0,r=o._start;for(;r!==null;){if(r.countable&&!r.deleted){let n=r.content.getContent();for(let a=0;a<n.length;a++)e(n[a],t++,o)}r=r.right}},eh=(o,e)=>{let t=[];return es(o,(r,n)=>{t.push(e(r,n,o))}),t},n0=o=>{let e=o._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let n=t[r++];return t.length<=r&&(t=null),{done:!1,value:n}}}},th=(o,e)=>{let t=bi(o,e),r=o._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},gi=(o,e,t,r)=>{let n=t,a=o.doc,s=a.clientID,i=a.store,f=t===null?e._start:t.right,c=[],d=()=>{c.length>0&&(n=new Ge(_e(s,st(i,s)),n,n&&n.lastId,f,f&&f.id,e,null,new br(c)),n.integrate(o,0),c=[])};r.forEach(p=>{if(p===null)c.push(p);else switch(p.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(p);break;default:switch(d(),p.constructor){case Uint8Array:case ArrayBuffer:n=new Ge(_e(s,st(i,s)),n,n&&n.lastId,f,f&&f.id,e,null,new tn(new Uint8Array(p))),n.integrate(o,0);break;case tr:n=new Ge(_e(s,st(i,s)),n,n&&n.lastId,f,f&&f.id,e,null,new on(p)),n.integrate(o,0);break;default:if(p instanceof ct)n=new Ge(_e(s,st(i,s)),n,n&&n.lastId,f,f&&f.id,e,null,new or(p)),n.integrate(o,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},rh=()=>Qt("Length exceeded!"),oh=(o,e,t,r)=>{if(t>e._length)throw rh();if(t===0)return e._searchMarker&&Qa(e._searchMarker,t,r.length),gi(o,e,null,r);let n=t,a=bi(e,t),s=e._start;for(a!==null&&(s=a.p,t-=a.index,t===0&&(s=s.prev,t+=s&&s.countable&&!s.deleted?s.length:0));s!==null;s=s.right)if(!s.deleted&&s.countable){if(t<=s.length){t<s.length&&ko(o,_e(s.id.client,s.id.clock+t));break}t-=s.length}return e._searchMarker&&Qa(e._searchMarker,n,r.length),gi(o,e,s,r)},a0=(o,e,t)=>{let n=(e._searchMarker||[]).reduce((a,s)=>s.index>a.index?s:a,{index:0,p:e._start}).p;if(n)for(;n.right;)n=n.right;return gi(o,e,n,t)},nh=(o,e,t,r)=>{if(r===0)return;let n=t,a=r,s=bi(e,t),i=e._start;for(s!==null&&(i=s.p,t-=s.index);i!==null&&t>0;i=i.right)!i.deleted&&i.countable&&(t<i.length&&ko(o,_e(i.id.client,i.id.clock+t)),t-=i.length);for(;r>0&&i!==null;)i.deleted||(r<i.length&&ko(o,_e(i.id.client,i.id.clock+r)),i.delete(o),r-=i.length),i=i.right;if(r>0)throw rh();e._searchMarker&&Qa(e._searchMarker,n,-a+r)},xi=(o,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(o)},mu=(o,e,t,r)=>{let n=e._map.get(t)||null,a=o.doc,s=a.clientID,i;if(r==null)i=new br([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:i=new br([r]);break;case Uint8Array:i=new tn(r);break;case tr:i=new on(r);break;default:if(r instanceof ct)i=new or(r);else throw new Error("Unexpected content type")}new Ge(_e(s,st(a.store,s)),n,n&&n.lastId,null,null,e,t,i).integrate(o,0)},hu=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},ah=o=>{let e={};return o._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},sh=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted};var s0=(o,e)=>{let t={};return o._map.forEach((r,n)=>{let a=r;for(;a!==null&&(!e.sv.has(a.id.client)||a.id.clock>=(e.sv.get(a.id.client)||0));)a=a.left;a!==null&&Nn(a,e)&&(t[n]=a.content.getContent()[a.length-1])}),t},ni=o=>Sm(o.entries(),e=>!e[1].deleted),Qf=class extends qn{constructor(e,t){super(e,t),this._transaction=t}},Or=class extends ct{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new Or;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Or}clone(){let e=new Or;return e.insert(0,this.toArray().map(t=>t instanceof ct?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),_i(this,e,new Qf(this,e))}insert(e,t){this.doc!==null?Re(this.doc,r=>{oh(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Re(this.doc,t=>{a0(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Re(this.doc,r=>{nh(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return th(this,e)}toArray(){return Qm(this)}slice(e=0,t=this.length){return Zm(this,e,t)}toJSON(){return this.map(e=>e instanceof ct?e.toJSON():e)}map(e){return eh(this,e)}forEach(e){es(this,e)}[Symbol.iterator](){return n0(this)}_write(e){e.writeTypeRef(C0)}},i0=o=>new Or,eu=class extends qn{constructor(e,t,r){super(e,t),this.keysChanged=r}},eo=class extends ct{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,n)=>{this.set(n,r)}),this._prelimContent=null}_copy(){return new eo}clone(){let e=new eo;return this.forEach((t,r)=>{e.set(r,t instanceof ct?t.clone():t)}),e}_callObserver(e,t){_i(this,e,new eu(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let n=t.content.getContent()[t.length-1];e[r]=n instanceof ct?n.toJSON():n}}),e}get size(){return[...ni(this._map)].length}keys(){return ri(ni(this._map),e=>e[0])}values(){return ri(ni(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return ri(ni(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Re(this.doc,t=>{xi(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Re(this.doc,r=>{mu(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return hu(this,e)}has(e){return sh(this,e)}clear(){this.doc!==null?Re(this.doc,e=>{this.forEach(function(t,r,n){xi(e,n,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(A0)}},l0=o=>new eo,vo=(o,e)=>o===e||typeof o=="object"&&typeof e=="object"&&o&&e&&Pf(o,e),ts=class{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){switch(this.right===null&&er(),this.right.content.constructor){case tt:this.right.deleted||Yn(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},Fm=(o,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case tt:e.right.deleted||Yn(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&ko(o,_e(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},ai=(o,e,t,r)=>{let n=new Map,a=r?bi(e,t):null;if(a){let s=new ts(a.p.left,a.p,a.index,n);return Fm(o,s,t-a.index)}else{let s=new ts(null,e._start,0,n);return Fm(o,s,t)}},ih=(o,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===tt&&vo(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let n=o.doc,a=n.clientID;r.forEach((s,i)=>{let f=t.left,c=t.right,d=new Ge(_e(a,st(n.store,a)),f,f&&f.lastId,c,c&&c.id,e,null,new tt(i,s));d.integrate(o,0),t.right=d,t.forward()})},Yn=(o,e)=>{let{key:t,value:r}=e;r===null?o.delete(t):o.set(t,r)},lh=(o,e)=>{var t;for(;o.right!==null;){if(!(o.right.deleted||o.right.content.constructor===tt&&vo((t=e[o.right.content.key])!=null?t:null,o.right.content.value)))break;o.forward()}},fh=(o,e,t,r)=>{var i;let n=o.doc,a=n.clientID,s=new Map;for(let f in r){let c=r[f],d=(i=t.currentAttributes.get(f))!=null?i:null;if(!vo(d,c)){s.set(f,d);let{left:p,right:h}=t;t.right=new Ge(_e(a,st(n.store,a)),p,p&&p.lastId,h,h&&h.id,e,null,new tt(f,c)),t.right.integrate(o,0),t.forward()}}return s},Wf=(o,e,t,r,n)=>{t.currentAttributes.forEach((h,y)=>{n[y]===void 0&&(n[y]=null)});let a=o.doc,s=a.clientID;lh(t,n);let i=fh(o,e,t,n),f=r.constructor===String?new rr(r):r instanceof ct?new or(r):new ro(r),{left:c,right:d,index:p}=t;e._searchMarker&&Qa(e._searchMarker,t.index,f.getLength()),d=new Ge(_e(s,st(a.store,s)),c,c&&c.lastId,d,d&&d.id,e,null,f),d.integrate(o,0),t.right=d,t.index=p,t.forward(),ih(o,e,t,i)},Rm=(o,e,t,r,n)=>{let a=o.doc,s=a.clientID;lh(t,n);let i=fh(o,e,t,n);e:for(;t.right!==null&&(r>0||i.size>0&&(t.right.deleted||t.right.content.constructor===tt));){if(!t.right.deleted)switch(t.right.content.constructor){case tt:{let{key:f,value:c}=t.right.content,d=n[f];if(d!==void 0){if(vo(d,c))i.delete(f);else{if(r===0)break e;i.set(f,c)}t.right.delete(o)}else t.currentAttributes.set(f,c);break}default:r<t.right.length&&ko(o,_e(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let f="";for(;r>0;r--)f+=`
`;t.right=new Ge(_e(s,st(a.store,s)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new rr(f)),t.right.integrate(o,0),t.forward()}ih(o,e,t,i)},uh=(o,e,t,r,n)=>{var c,d;let a=e,s=mt();for(;a&&(!a.countable||a.deleted);){if(!a.deleted&&a.content.constructor===tt){let p=a.content;s.set(p.key,p)}a=a.right}let i=0,f=!1;for(;e!==a;){if(t===e&&(f=!0),!e.deleted){let p=e.content;switch(p.constructor){case tt:{let{key:h,value:y}=p,g=(c=r.get(h))!=null?c:null;(s.get(h)!==p||g===y)&&(e.delete(o),i++,!f&&((d=n.get(h))!=null?d:null)===y&&g!==y&&(g===null?n.delete(h):n.set(h,g))),!f&&!e.deleted&&Yn(n,p);break}}}e=e.right}return i},f0=(o,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===tt){let r=e.content.key;t.has(r)?e.delete(o):t.add(r)}e=e.left}},u0=o=>{let e=0;return Re(o.doc,t=>{let r=o._start,n=o._start,a=mt(),s=Ks(a);for(;n;){if(n.deleted===!1)switch(n.content.constructor){case tt:Yn(s,n.content);break;default:e+=uh(t,r,n,a,s),a=Ks(s),r=n;break}n=n.right}}),e},c0=o=>{let e=new Set,t=o.doc;for(let[r,n]of o.afterState.entries()){let a=o.beforeState.get(r)||0;n!==a&&Gm(o,t.store.clients.get(r),a,n,s=>{!s.deleted&&s.content.constructor===tt&&s.constructor!==$t&&e.add(s.parent)})}Re(t,r=>{$m(o,o.deleteSet,n=>{if(n instanceof $t||!n.parent._hasFormatting||e.has(n.parent))return;let a=n.parent;n.content.constructor===tt?e.add(a):f0(r,n)});for(let n of e)u0(n)})},Om=(o,e,t)=>{let r=t,n=Ks(e.currentAttributes),a=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case or:case ro:case rr:t<e.right.length&&ko(o,_e(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(o);break}e.forward()}a&&uh(o,a,e.right,n,e.currentAttributes);let s=(e.left||e.right).parent;return s._searchMarker&&Qa(s._searchMarker,e.index,-r+t),e},tu=class extends qn{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(n=>{n===null?this.childListChanged=!0:this.keysChanged.add(n)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];Re(e,r=>{var y,g,v;let n=new Map,a=new Map,s=this.target._start,i=null,f={},c="",d=0,p=0,h=()=>{if(i!==null){let b=null;switch(i){case"delete":p>0&&(b={delete:p}),p=0;break;case"insert":(typeof c=="object"||c.length>0)&&(b={insert:c},n.size>0&&(b.attributes={},n.forEach((_,D)=>{_!==null&&(b.attributes[D]=_)}))),c="";break;case"retain":d>0&&(b={retain:d},lm(f)||(b.attributes=sm({},f))),d=0;break}b&&t.push(b),i=null}};for(;s!==null;){switch(s.content.constructor){case or:case ro:this.adds(s)?this.deletes(s)||(h(),i="insert",c=s.content.getContent()[0],h()):this.deletes(s)?(i!=="delete"&&(h(),i="delete"),p+=1):s.deleted||(i!=="retain"&&(h(),i="retain"),d+=1);break;case rr:this.adds(s)?this.deletes(s)||(i!=="insert"&&(h(),i="insert"),c+=s.content.str):this.deletes(s)?(i!=="delete"&&(h(),i="delete"),p+=s.length):s.deleted||(i!=="retain"&&(h(),i="retain"),d+=s.length);break;case tt:{let{key:b,value:_}=s.content;if(this.adds(s)){if(!this.deletes(s)){let D=(y=n.get(b))!=null?y:null;vo(D,_)?_!==null&&s.delete(r):(i==="retain"&&h(),vo(_,(g=a.get(b))!=null?g:null)?delete f[b]:f[b]=_)}}else if(this.deletes(s)){a.set(b,_);let D=(v=n.get(b))!=null?v:null;vo(D,_)||(i==="retain"&&h(),f[b]=D)}else if(!s.deleted){a.set(b,_);let D=f[b];D!==void 0&&(vo(D,_)?D!==null&&s.delete(r):(i==="retain"&&h(),_===null?delete f[b]:f[b]=_))}s.deleted||(i==="insert"&&h(),Yn(n,s.content));break}}s=s.right}for(h();t.length>0;){let b=t[t.length-1];if(b.retain!==void 0&&b.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},Co=class extends ct{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Co}clone(){let e=new Co;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new tu(this,e,t);_i(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===rr&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Re(this.doc,r=>{let n=new ts(null,this._start,0,new Map);for(let a=0;a<e.length;a++){let s=e[a];if(s.insert!==void 0){let i=!t&&typeof s.insert=="string"&&a===e.length-1&&n.right===null&&s.insert.slice(-1)===`
`?s.insert.slice(0,-1):s.insert;(typeof i!="string"||i.length>0)&&Wf(r,this,n,i,s.attributes||{})}else s.retain!==void 0?Rm(r,this,n,s.retain,s.attributes||{}):s.delete!==void 0&&Om(r,n,s.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let n=[],a=new Map,s=this.doc,i="",f=this._start;function c(){if(i.length>0){let p={},h=!1;a.forEach((g,v)=>{h=!0,p[v]=g});let y={insert:i};h&&(y.attributes=p),n.push(y),i=""}}let d=()=>{for(;f!==null;){if(Nn(f,e)||t!==void 0&&Nn(f,t))switch(f.content.constructor){case rr:{let p=a.get("ychange");e!==void 0&&!Nn(f,e)?(p===void 0||p.user!==f.id.client||p.type!=="removed")&&(c(),a.set("ychange",r?r("removed",f.id):{type:"removed"})):t!==void 0&&!Nn(f,t)?(p===void 0||p.user!==f.id.client||p.type!=="added")&&(c(),a.set("ychange",r?r("added",f.id):{type:"added"})):p!==void 0&&(c(),a.delete("ychange")),i+=f.content.str;break}case or:case ro:{c();let p={insert:f.content.getContent()[0]};if(a.size>0){let h={};p.attributes=h,a.forEach((y,g)=>{h[g]=y})}n.push(p);break}case tt:Nn(f,e)&&(c(),Yn(a,f.content));break}f=f.right}c()};return e||t?Re(s,p=>{e&&Jf(p,e),t&&Jf(p,t),d()},"cleanup"):d(),n}insert(e,t,r){if(t.length<=0)return;let n=this.doc;n!==null?Re(n,a=>{let s=ai(a,this,e,!r);r||(r={},s.currentAttributes.forEach((i,f)=>{r[f]=i})),Wf(a,this,s,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let n=this.doc;n!==null?Re(n,a=>{let s=ai(a,this,e,!r);Wf(a,this,s,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?Re(r,n=>{Om(n,ai(n,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let n=this.doc;n!==null?Re(n,a=>{let s=ai(a,this,e,!1);s.right!==null&&Rm(a,this,s,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Re(this.doc,t=>{xi(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Re(this.doc,r=>{mu(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return hu(this,e)}getAttributes(){return ah(this)}_write(e){e.writeTypeRef(T0)}},d0=o=>new Co,Ya=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===Ao||t.constructor===to)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},to=class extends ct{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new to}clone(){let e=new to;return e.insert(0,this.toArray().map(t=>t instanceof ct?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Ya(this,e)}querySelector(e){e=e.toUpperCase();let r=new Ya(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),hr(new Ya(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){_i(this,e,new ru(this,t,e))}toString(){return eh(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let n=e.createDocumentFragment();return r!==void 0&&r._createAssociation(n,this),es(this,a=>{n.insertBefore(a.toDOM(e,t,r),null)}),n}insert(e,t){this.doc!==null?Re(this.doc,r=>{oh(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Re(this.doc,r=>{let n=e&&e instanceof ct?e._item:e;gi(r,this,n,t)});else{let r=this._prelimContent,n=e===null?0:r.findIndex(a=>a===e)+1;if(n===0&&e!==null)throw Qt("Reference item not found");r.splice(n,0,...t)}}delete(e,t=1){this.doc!==null?Re(this.doc,r=>{nh(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return Qm(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return th(this,e)}slice(e=0,t=this.length){return Zm(this,e,t)}forEach(e){es(this,e)}_write(e){e.writeTypeRef(E0)}},p0=o=>new to,Ao=class extends to{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,n)=>{this.setAttribute(n,r)}),this._prelimAttrs=null}_copy(){return new Ao(this.nodeName)}clone(){let e=new Ao(this.nodeName),t=this.getAttributes();return im(t,(r,n)=>{typeof r=="string"&&e.setAttribute(n,r)}),e.insert(0,this.toArray().map(r=>r instanceof ct?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let i in e)r.push(i);r.sort();let n=r.length;for(let i=0;i<n;i++){let f=r[i];t.push(f+'="'+e[f]+'"')}let a=this.nodeName.toLocaleLowerCase(),s=t.length>0?" "+t.join(" "):"";return`<${a}${s}>${super.toString()}</${a}>`}removeAttribute(e){this.doc!==null?Re(this.doc,t=>{xi(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Re(this.doc,r=>{mu(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return hu(this,e)}hasAttribute(e){return sh(this,e)}getAttributes(e){return e?s0(this,e):ah(this)}toDOM(e=document,t={},r){let n=e.createElement(this.nodeName),a=this.getAttributes();for(let s in a){let i=a[s];typeof i=="string"&&n.setAttribute(s,i)}return es(this,s=>{n.appendChild(s.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(D0),e.writeKey(this.nodeName)}},m0=o=>new Ao(o.readKey()),ru=class extends qn{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(n=>{n===null?this.childListChanged=!0:this.attributesChanged.add(n)})}},Kn=class extends eo{constructor(e){super(),this.hookName=e}_copy(){return new Kn(this.hookName)}clone(){let e=new Kn(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let n=t[this.hookName],a;return n!==void 0?a=n.createDom(this):a=document.createElement(this.hookName),a.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(a,this),a}_write(e){e.writeTypeRef(P0),e.writeKey(this.hookName)}},h0=o=>new Kn(o.readKey()),zn=class extends Co{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new zn}clone(){let e=new zn;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let n=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{let t=[];for(let n in e.attributes){let a=[];for(let s in e.attributes[n])a.push({key:s,value:e.attributes[n][s]});a.sort((s,i)=>s.key<i.key?-1:1),t.push({nodeName:n,attrs:a})}t.sort((n,a)=>n.nodeName<a.nodeName?-1:1);let r="";for(let n=0;n<t.length;n++){let a=t[n];r+=`<${a.nodeName}`;for(let s=0;s<a.attrs.length;s++){let i=a.attrs[s];r+=` ${i.key}="${i.value}"`}r+=">"}r+=e.insert;for(let n=t.length-1;n>=0;n--)r+=`</${t[n].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(M0)}},g0=o=>new zn,rs=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw xr()}mergeWith(e){return!1}write(e,t,r){throw xr()}integrate(e,t){throw xr()}},x0=0,$t=class extends rs{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),zm(e.doc.store,this)}write(e,t){e.writeInfo(x0),e.writeLen(this.length-t)}getMissing(e,t){return null}},tn=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new tn(this.content)}splice(e){throw xr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},y0=o=>new tn(o.readBuf()),rn=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new rn(this.len)}splice(e){let t=new rn(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){fi(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},w0=o=>new rn(o.readLen()),ch=(o,e)=>new tr({guid:o,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),on=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new on(ch(this.doc.guid,this.opts))}splice(e){throw xr()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},b0=o=>new on(ch(o.readString(),o.readAny())),ro=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ro(this.embed)}splice(e){throw xr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},_0=o=>new ro(o.readJSON()),tt=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new tt(this.key,this.value)}splice(e){throw xr()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},v0=o=>new tt(o.readKey(),o.readJSON()),Gn=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Gn(this.arr)}splice(e){let t=new Gn(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let a=this.arr[n];e.writeString(a===void 0?"undefined":JSON.stringify(a))}}getRef(){return 2}},S0=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++){let n=o.readString();n==="undefined"?t.push(void 0):t.push(JSON.parse(n))}return new Gn(t)},br=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new br(this.arr)}splice(e){let t=new br(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let a=this.arr[n];e.writeAny(a)}}getRef(){return 8}},L0=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++)t.push(o.readAny());return new br(t)},rr=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new rr(this.str)}splice(e){let t=new rr(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},I0=o=>new rr(o.readString()),k0=[i0,l0,d0,m0,p0,h0,g0],C0=0,A0=1,T0=2,D0=3,E0=4,P0=5,M0=6,or=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new or(this.type._copy())}splice(e){throw xr()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},F0=o=>new or(k0[o.readTypeRef()](o)),Um=(o,e)=>{let t=e,r=0,n;do r>0&&(t=_e(t.client,t.clock+r)),n=si(o,t),r=t.clock-n.id.clock,t=n.redone;while(t!==null&&n instanceof Ge);return{item:n,diff:r}};var yi=(o,e,t)=>{let{client:r,clock:n}=e.id,a=new Ge(_e(r,n+t),e,_e(r,n+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&a.markDeleted(),e.keep&&(a.keep=!0),e.redone!==null&&(a.redone=_e(e.redone.client,e.redone.clock+t)),e.right=a,a.right!==null&&(a.right.left=a),o._mergeStructs.push(a),a.parentSub!==null&&a.right===null&&a.parent._map.set(a.parentSub,a),e.length=t,a};var Ge=class extends rs{constructor(e,t,r,n,a,s,i,f){super(e,f.getLength()),this.origin=r,this.left=t,this.right=n,this.rightOrigin=a,this.parent=s,this.parentSub=i,this.redone=null,this.content=f,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=st(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=st(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===So&&this.id.client!==this.parent.client&&this.parent.clock>=st(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Dm(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=ko(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===$t||this.right&&this.right.constructor===$t)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ge&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Ge&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===So){let r=si(t,this.parent);r.constructor===$t?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=Dm(e,e.doc.store,_e(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,n;if(r!==null)n=r.right;else if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start;let a=new Set,s=new Set;for(;n!==null&&n!==this.right;){if(s.add(n),a.add(n),Hn(this.origin,n.origin)){if(n.id.client<this.id.client)r=n,a.clear();else if(Hn(this.rightOrigin,n.rightOrigin))break}else if(n.origin!==null&&s.has(si(e.doc.store,n.origin)))a.has(si(e.doc.store,n.origin))||(r=n,a.clear());else break;n=n.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),zm(e.doc.store,this),this.content.integrate(e,this),Pm(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new $t(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:_e(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Hn(e.origin,this.lastId)&&this.right===e&&Hn(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),fi(e.deleteSet,this.id.client,this.id.clock,this.length),Pm(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw er();this.content.gc(e),t?zS(e,this,new $t(this.id,this.length)):this.content=new rn(this.length)}write(e,t){let r=t>0?_e(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,a=this.parentSub,s=this.content.getRef()&31|(r===null?0:128)|(n===null?0:64)|(a===null?0:32);if(e.writeInfo(s),r!==null&&e.writeLeftID(r),n!==null&&e.writeRightID(n),r===null&&n===null){let i=this.parent;if(i._item!==void 0){let f=i._item;if(f===null){let c=Km(i);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(f.id)}else i.constructor===String?(e.writeParentInfo(!0),e.writeString(i)):i.constructor===So?(e.writeParentInfo(!1),e.writeLeftID(i)):er();a!==null&&e.writeString(a)}this.content.write(e,t)}},dh=(o,e)=>R0[e&31](o),R0=[()=>{er()},w0,S0,y0,I0,_0,v0,F0,L0,b0,()=>{er()}],O0=10,Bt=class extends rs{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){er()}write(e,t){e.writeInfo(O0),pe(e.restEncoder,this.length-t)}getMissing(e,t){return null}},ph=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},mh="__ $YJS$ __";ph[mh]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");ph[mh]=!0;var xt=require("obsidian");var an=o=>Zr((e,t)=>{o.onerror=r=>t(new Error(r.target.error)),o.onsuccess=r=>e(r.target.result)}),hh=(o,e)=>Zr((t,r)=>{let n=indexedDB.open(o);n.onupgradeneeded=a=>e(a.target.result),n.onerror=a=>r(Qt(a.target.error)),n.onsuccess=a=>{let s=a.target.result;s.onversionchange=()=>{s.close()},t(s)}}),gh=o=>an(indexedDB.deleteDatabase(o)),xh=(o,e)=>e.forEach(t=>o.createObjectStore.apply(o,t)),jn=(o,e,t="readwrite")=>{let r=o.transaction(e,t);return e.map(n=>N0(r,n))},gu=(o,e)=>an(o.count(e)),yh=(o,e)=>an(o.get(e)),xu=(o,e)=>an(o.delete(e)),wh=(o,e,t)=>an(o.put(e,t));var vi=(o,e)=>an(o.add(e)),bh=(o,e,t)=>an(o.getAll(e,t));var U0=(o,e,t)=>{let r=null;return B0(o,e,n=>(r=n,!1),t).then(()=>r)},_h=(o,e=null)=>U0(o,e,"prev");var $0=(o,e)=>Zr((t,r)=>{o.onerror=r,o.onsuccess=async n=>{let a=n.target.result;if(a===null||await e(a)===!1)return t();a.continue()}});var B0=(o,e,t,r="next")=>$0(o.openKeyCursor(e,r),n=>t(n.key)),N0=(o,e)=>o.objectStore(e);var vh=(o,e)=>IDBKeyRange.upperBound(o,e),Sh=(o,e)=>IDBKeyRange.lowerBound(o,e);var yu="custom",Lh="updates",Ih=500,Zn=(o,e=()=>{},t=()=>{})=>{let[r]=jn(o.db,[Lh]);return bh(r,Sh(o._dbref,!1)).then(n=>{o._destroyed||(e(r),Re(o.doc,()=>{n.forEach(a=>To(o.doc,a))},o,!1),t(r))}).then(()=>_h(r).then(n=>{o._dbref=n+1})).then(()=>gu(r).then(n=>{o._dbsize=n})).then(()=>r)},V0=(o,e=!0)=>Zn(o).then(t=>{(e||o._dbsize>=Ih)&&vi(t,nn(o.doc)).then(()=>xu(t,vh(o._dbref,!0))).then(()=>gu(t).then(r=>{o._dbsize=r}))});var Xn=class extends kn{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=hh(e,r=>xh(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Zr(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,Zn(this,s=>vi(s,nn(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,n)=>{if(this.db&&n!==this){let[a]=jn(this.db,[Lh]);vi(a,r),++this._dbsize>=Ih&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{V0(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{gh(this.name)})}get(e){return this._db.then(t=>{let[r]=jn(t,[yu],"readonly");return yh(r,e)})}set(e,t){return this._db.then(r=>{let[n]=jn(r,[yu]);return wh(n,t,e)})}del(e){return this._db.then(t=>{let[r]=jn(t,[yu]);return xu(r,e)})}};var Si,W0=new Uint8Array(16);function wu(){if(!Si&&(Si=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Si))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Si(W0)}var vt=[];for(let o=0;o<256;++o)vt.push((o+256).toString(16).slice(1));function kh(o,e=0){return vt[o[e+0]]+vt[o[e+1]]+vt[o[e+2]]+vt[o[e+3]]+"-"+vt[o[e+4]]+vt[o[e+5]]+"-"+vt[o[e+6]]+vt[o[e+7]]+"-"+vt[o[e+8]]+vt[o[e+9]]+"-"+vt[o[e+10]]+vt[o[e+11]]+vt[o[e+12]]+vt[o[e+13]]+vt[o[e+14]]+vt[o[e+15]]}var q0=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),bu={randomUUID:q0};function K0(o,e,t){if(bu.randomUUID&&!e&&!o)return bu.randomUUID();o=o||{};let r=o.random||(o.rng||wu)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=r[n];return e}return kh(r)}var Qn=K0;var lr=Fa(qs());var Ch=0,Li=1,Ah=2,Ii=(o,e)=>{pe(o,Ch);let t=Wm(e);gt(o,t)},_u=(o,e,t)=>{pe(o,Li),gt(o,nn(e,t))},z0=(o,e,t)=>_u(e,t,_t(o)),Th=(o,e,t)=>{try{To(e,_t(o),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Dh=(o,e)=>{pe(o,Ah),gt(o,e)},G0=Th,Eh=(o,e,t,r)=>{let n=ce(o);switch(n){case Ch:z0(o,e,t);break;case Li:Th(o,t,r);break;case Ah:G0(o,t,r);break;default:throw new Error("Unknown message type")}return n};var J0=0;var Ph=(o,e,t)=>{switch(ce(o)){case J0:t(e,yr(o))}};var vu=3e4,ki=class extends kn{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=Zo();this.getLocalState()!==null&&vu/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((n,a)=>{a!==this.clientID&&vu<=t-n.lastUpdated&&this.states.has(a)&&r.push(a)}),r.length>0&&Ci(this,r,"timeout")},Ut(vu/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),n=r===void 0?0:r.clock+1,a=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:Zo()});let s=[],i=[],f=[],c=[];e===null?c.push(t):a==null?e!=null&&s.push(t):(i.push(t),$n(a,e)||f.push(t)),(s.length>0||f.length>0||c.length>0)&&this.emit("change",[{added:s,updated:f,removed:c},"local"]),this.emit("update",[{added:s,updated:i,removed:c},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},Ci=(o,e,t)=>{let r=[];for(let n=0;n<e.length;n++){let a=e[n];if(o.states.has(a)){if(o.states.delete(a),a===o.clientID){let s=o.meta.get(a);o.meta.set(a,{clock:s.clock+1,lastUpdated:Zo()})}r.push(a)}}r.length>0&&(o.emit("change",[{added:[],updated:[],removed:r},t]),o.emit("update",[{added:[],updated:[],removed:r},t]))},ea=(o,e,t=o.states)=>{let r=e.length,n=Jo();pe(n,r);for(let a=0;a<r;a++){let s=e[a],i=t.get(s)||null,f=o.meta.get(s).clock;pe(n,s),pe(n,f),Xr(n,JSON.stringify(i))}return Kt(n)};var Mh=(o,e,t)=>{let r=wr(e),n=Zo(),a=[],s=[],i=[],f=[],c=ce(r);for(let d=0;d<c;d++){let p=ce(r),h=ce(r),y=JSON.parse(yr(r)),g=o.meta.get(p),v=o.states.get(p),b=g===void 0?0:g.clock;(b<h||b===h&&y===null&&o.states.has(p))&&(y===null?p===o.clientID&&o.getLocalState()!=null?h++:o.states.delete(p):o.states.set(p,y),o.meta.set(p,{clock:h,lastUpdated:n}),g===void 0&&y!==null?a.push(p):g!==void 0&&y===null?f.push(p):y!==null&&($n(y,v)||i.push(p),s.push(p)))}(a.length>0||i.length>0||f.length>0)&&o.emit("change",[{added:a,updated:i,removed:f},t]),(a.length>0||s.length>0||f.length>0)&&o.emit("update",[{added:a,updated:s,removed:f},t])};var ra=()=>new Map,$h=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},Bh=()=>new Set,Z0=Array.from,DT=Array.isArray,Nh=String.fromCharCode,ET=String.fromCodePoint,PT=Nh(65535),Q0=o=>o.toLowerCase(),e1=/^\s*/g,t1=o=>o.replace(e1,""),r1=/([A-Z])/g,Fh=(o,e)=>t1(o.replace(r1,t=>`${e}${Q0(t)}`)),o1=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},os=typeof TextEncoder!="undefined"?new TextEncoder:null,n1=o=>os.encode(o),a1=os?n1:o1,Su=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Su&&Su.decode(new Uint8Array).length===1&&(Su=null);var Rh=o=>o===void 0?null:o,s1=class{constructor(){this.map=new Map}setItem(o,e){this.map.set(o,e)}getItem(o){return this.map.get(o)}},Hh=new s1,Tu=!0;try{typeof localStorage!="undefined"&&(Hh=localStorage,Tu=!1)}catch(o){}var Vh=Hh,i1=o=>Tu||addEventListener("storage",o),l1=o=>Tu||removeEventListener("storage",o),f1=(o,e)=>{let t=[];for(let r in o)t.push(e(o[r],r));return t},u1=(o,e)=>e.includes(o),aa=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),Wh=typeof window!="undefined"&&typeof document!="undefined"&&!aa,MT=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,$r,c1=[],d1=()=>{if($r===void 0)if(aa){$r=ra();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&$r.set(e,""),e=r):e!==null?($r.set(e,r),e=null):c1.push(r)}e!==null&&$r.set(e,"")}else typeof location=="object"?($r=ra(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");$r.set(`--${Fh(e,"-")}`,t),$r.set(`-${Fh(e,"-")}`,t)}})):$r=ra();return $r},Iu=o=>d1().has(o),ku=o=>Rh(aa?process.env[o.toUpperCase()]:Vh.getItem(o)),p1=o=>Iu("--"+o)||ku(o)!==null,FT=p1("production"),Oh=aa&&u1(process.env.FORCE_COLOR,["true","1","2"]),RT=!Iu("no-colors")&&(!aa||process.stdout.isTTY||Oh)&&(!aa||Iu("color")||Oh||ku("COLORTERM")!==null||(ku("TERM")||"").includes("color")),qh=Math.floor,Kh=(o,e)=>o<e?o:e,m1=(o,e)=>o>e?o:e,OT=Number.isNaN,h1=Math.pow,zh=128,g1=1<<17,x1=1<<18,y1=1<<19,w1=1<<20,b1=1<<21,_1=1<<22,v1=1<<23,S1=1<<24,L1=1<<25,I1=1<<26,k1=1<<27,C1=1<<28,A1=1<<29,T1=1<<30,UT=1<<31,Ai=127,$T=g1-1,BT=x1-1,NT=y1-1,HT=w1-1,VT=b1-1,WT=_1-1,qT=v1-1,KT=S1-1,zT=L1-1,GT=I1-1,YT=k1-1,JT=C1-1,jT=A1-1,XT=T1-1,D1=Number.MAX_SAFE_INTEGER,ZT=Number.MIN_SAFE_INTEGER,QT=1<<31,eD=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&qh(o)===o),tD=Number.isNaN,rD=Number.parseInt,E1=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},_r=()=>new E1,Du=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e},nr=o=>{let e=new Uint8Array(Du(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(Jh(o.cbuf.buffer,0,o.cpos),t),e},Ti=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e},Dt=(o,e)=>{for(;e>Ai;)Ti(o,zh|Ai&e),e=qh(e/128);Ti(o,Ai&e)},Cu=new Uint8Array(3e4),P1=Cu.length/3,M1=(o,e)=>{if(e.length<P1){let t=os.encodeInto(e,Cu).written||0;Dt(o,t);for(let r=0;r<t;r++)Ti(o,Cu[r])}else oa(o,a1(e))},F1=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Dt(o,r);for(let n=0;n<r;n++)Ti(o,t.codePointAt(n))},oD=os&&os.encodeInto?M1:F1,R1=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=Kh(t-r,e.length),a=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,a>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(m1(t*2,a)),o.cbuf.set(e.subarray(n)),o.cpos=a)},oa=(o,e)=>{Dt(o,e.byteLength),R1(o,e)},nD=new DataView(new ArrayBuffer(4)),Gh=o=>new Error(o),O1=Gh("Unexpected end of array"),U1=Gh("Integer out of Range"),$1=class{constructor(o){this.arr=o,this.pos=0}},B1=o=>new $1(o),N1=(o,e)=>{let t=Jh(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},H1=o=>N1(o,Yh(o)),Yh=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&Ai)*t,t*=128,n<zh)return e;if(e>D1)throw U1}throw O1},V1=o=>new Uint8Array(o),Jh=(o,e,t)=>new Uint8Array(o,e,t),W1=o=>new Uint8Array(o),q1=o=>{let e="";for(let t=0;t<o.byteLength;t++)e+=Nh(o[t]);return btoa(e)},K1=o=>Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("base64"),z1=o=>{let e=atob(o),t=V1(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},G1=o=>{let e=Buffer.from(o,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},Y1=Wh?q1:K1,J1=Wh?z1:G1,jh=new Map,j1=class{constructor(o){this.room=o,this.onmessage=null,this._onChange=e=>e.key===o&&this.onmessage!==null&&this.onmessage({data:J1(e.newValue||"")}),i1(this._onChange)}postMessage(o){Vh.setItem(this.room,Y1(W1(o)))}close(){l1(this._onChange)}},X1=typeof BroadcastChannel=="undefined"?j1:BroadcastChannel,Eu=o=>$h(jh,o,()=>{let e=Bh(),t=new X1(o);return t.onmessage=r=>e.forEach(n=>n(r.data,"broadcastchannel")),{bc:t,subs:e}}),Z1=(o,e)=>(Eu(o).subs.add(e),e),Q1=(o,e)=>{let t=Eu(o),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),jh.delete(o)),r},ta=(o,e,t=null)=>{let r=Eu(o);r.bc.postMessage(e),r.subs.forEach(n=>n(e,t))},Au=Date.now,eL=class{constructor(){this._observers=ra()}on(o,e){$h(this._observers,o,Bh).add(e)}once(o,e){let t=(...r)=>{this.off(o,t),e(...r)};this.on(o,t)}off(o,e){let t=this._observers.get(o);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(o))}emit(o,e){return Z0((this._observers.get(o)||ra()).values()).forEach(t=>t(...e))}destroy(){this._observers=ra()}},tL=o=>f1(o,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),sn=0,Xh=3,na=1,rL=2,ns=[];ns[sn]=(o,e,t,r,n)=>{Dt(o,sn);let a=Eh(e,o,t.doc,t);r&&a===Li&&!t.synced&&(t.synced=!0)};ns[Xh]=(o,e,t,r,n)=>{Dt(o,na),oa(o,ea(t.awareness,Array.from(t.awareness.getStates().keys())))};ns[na]=(o,e,t,r,n)=>{Mh(t.awareness,H1(e),t)};ns[rL]=(o,e,t,r,n)=>{Ph(e,t.doc,(a,s)=>oL(t,s))};var Uh=3e4,oL=(o,e)=>console.warn(`Permission denied to access ${o.url}.
${e}`),Zh=(o,e,t)=>{let r=B1(e),n=_r(),a=Yh(r),s=o.messageHandlers[a];return s?s(n,r,o,t,a):console.error("Unable to compute message"),n},Qh=o=>{if(o.shouldConnect&&o.ws===null){let e=new o._WS(o.url);e.binaryType="arraybuffer",o.ws=e,o.wsconnecting=!0,o.wsconnected=!1,o.synced=!1,e.onmessage=t=>{o.wsLastMessageReceived=Au();let r=Zh(o,new Uint8Array(t.data),!0);Du(r)>1&&e.send(nr(r))},e.onerror=t=>{o.emit("connection-error",[t,o])},e.onclose=t=>{o.emit("connection-close",[t,o]),o.ws=null,o.wsconnecting=!1,o.wsconnected?(o.wsconnected=!1,o.synced=!1,Ci(o.awareness,Array.from(o.awareness.getStates().keys()).filter(r=>r!==o.doc.clientID),o),o.emit("status",[{status:"disconnected"}])):o.wsUnsuccessfulReconnects++,setTimeout(Qh,Kh(h1(2,o.wsUnsuccessfulReconnects)*100,o.maxBackoffTime),o)},e.onopen=()=>{o.wsLastMessageReceived=Au(),o.wsconnecting=!1,o.wsconnected=!0,o.wsUnsuccessfulReconnects=0,o.emit("status",[{status:"connected"}]);let t=_r();if(Dt(t,sn),Ii(t,o.doc),e.send(nr(t)),o.awareness.getLocalState()!==null){let r=_r();Dt(r,na),oa(r,ea(o.awareness,[o.doc.clientID])),e.send(nr(r))}},o.emit("status",[{status:"connecting"}])}},Lu=(o,e)=>{let t=o.ws;o.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),o.bcconnected&&ta(o.bcChannel,e,o)},eg=class extends eL{constructor(o,e,t,{connect:r=!0,awareness:n=new ki(t),params:a={},WebSocketPolyfill:s=WebSocket,resyncInterval:i=-1,maxBackoffTime:f=2500,disableBc:c=!1}={}){for(super();o[o.length-1]==="/";)o=o.slice(0,o.length-1);let d=tL(a);this.maxBackoffTime=f,this.bcChannel=o+"/"+e,this.url=o+"/"+e+(d.length===0?"":"?"+d),this.roomname=e,this.doc=t,this._WS=s,this.awareness=n,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=c,this.wsUnsuccessfulReconnects=0,this.messageHandlers=ns.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,i>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let p=_r();Dt(p,sn),Ii(p,t),this.ws.send(nr(p))}},i)),this._bcSubscriber=(p,h)=>{if(h!==this){let y=Zh(this,new Uint8Array(p),!1);Du(y)>1&&ta(this.bcChannel,nr(y),this)}},this._updateHandler=(p,h)=>{if(h!==this){let y=_r();Dt(y,sn),Dh(y,p),Lu(this,nr(y))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:p,updated:h,removed:y},g)=>{let v=p.concat(h).concat(y),b=_r();Dt(b,na),oa(b,ea(n,v)),Lu(this,nr(b))},this._unloadHandler=()=>{Ci(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),n.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var p;this.wsconnected&&Uh<Au()-this.wsLastMessageReceived&&((p=this.ws)==null||p.close())},Uh/10),r&&this.connect()}get synced(){return this._synced}set synced(o){this._synced!==o&&(this._synced=o,this.emit("synced",[o]),this.emit("sync",[o]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(Z1(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let o=_r();Dt(o,sn),Ii(o,this.doc),ta(this.bcChannel,nr(o),this);let e=_r();Dt(e,sn),_u(e,this.doc),ta(this.bcChannel,nr(e),this);let t=_r();Dt(t,Xh),ta(this.bcChannel,nr(t),this);let r=_r();Dt(r,na),oa(r,ea(this.awareness,[this.doc.clientID])),ta(this.bcChannel,nr(r),this)}disconnectBc(){let o=_r();Dt(o,na),oa(o,ea(this.awareness,[this.doc.clientID],new Map)),Lu(this,nr(o)),this.bcconnected&&(Q1(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(Qh(this),this.connectBc())}};var Pu=require("obsidian"),Nt=new WeakMap,tg=!1;function Pi(o){tg=o}var ao={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3},oo,no,Di=[];function rg(o,e,t,r){no=o,oo=t,r&&(ao={...ao,...r}),e.setInterval(Mu,ao.batchInterval)}async function Mu(){if(Di.length===0)return;let o=[...Di];Di.length=0;for(let e=0;e<ao.maxRetries;e++)try{await nL();let t=o.map(og).join(`
`)+`
`;await no.adapter.append(oo,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===ao.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function nL(){let o=await no.adapter.stat(oo);if(o&&o.size>ao.maxFileSize){for(let e=ao.maxBackups;e>0;e--){let t=`${oo}.${e}`,r=`${oo}.${e+1}`;await no.adapter.exists(t)&&(e===ao.maxBackups?await no.adapter.remove(t):await no.adapter.rename(t,r))}await no.adapter.exists(oo)&&await no.adapter.rename(oo,`${oo}.1`),await no.adapter.write(oo,"")}}function og(o){return`[${o.timestamp}] [${o.level.toUpperCase()}] ${o.message}
    at ${o.callerInfo}`}function aL(o){return new Pu.Notice(o.name+`
`+o.message),o}function sL(o){return new Pu.Notice(o.name+`:
An error has occurred, please reload Obsidian.`),o}function iL(o){if(typeof o=="object"&&o!==null){let e=new WeakSet;try{return JSON.stringify(o,(t,r)=>{var n;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&(t.toLowerCase().includes("authorization")||t.toLowerCase().includes("token"))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(n=r.stack)==null?void 0:n.split(`
`).map(a=>a.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(o)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(o)}function ae(o,e="log"){return(...t)=>{if(tg){let r=new Date().toISOString(),n=new Error().stack,a=n?n.split(`
`)[2].trim():"",s=t.map(iL).join(" "),i={timestamp:r,level:e,message:`${o}: ${s}`,callerInfo:a};ao.disableConsole||console[e](og(i)),Di.push(i)}}}var Ei=class{constructor(e){let t=e||this.constructor.name;this.debug=ae(`[${t}]`,"debug"),this.log=ae(`[${t}]`,"log"),this.warn=ae(`[${t}]`,"warn"),this.error=ae(`[${t}]`,"error")}},lL=!1,Fu=lL?aL:sL;var ln=class extends Error{constructor(e){super(e),this.name="TimeoutError",Object.setPrototypeOf(this,ln.prototype)}};function Fi(o,e,t){let r,n=performance.now(),a=new Promise((s,i)=>{r=window.setTimeout(()=>{ae("[Promise]","error")(`[${o}] Timeout on promise`,e);let f=performance.now();i(new ln(`[${o}]: Timeout after ${f-n} ms`))},t)});return Promise.race([e,a]).finally(()=>{clearTimeout(r)})}var Mi=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction();return e?Promise.resolve(t):(this.currentPromise||(this.currentPromise=this.promiseFunction().then(r=>(this.currentPromise=null,r),r=>{throw this.currentPromise=null,r})),this.currentPromise)}};var Ru=class{constructor(){this.platform="s3rn";this.product="relay"}},Ou=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},ar=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},vr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},Do=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},fn=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},Br=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,n,a,s,i,f,c]=t;if(!this.validateUUID(a))throw new Error("Invalid UUID");if(i&&!this.validateUUID(i))throw new Error("Invalid UUID");if(c&&!this.validateUUID(c))throw new Error("Invalid UUID");if(r==="relay"&&n==="relay"&&s==="folder"&&f==="doc")return new vr(a,i,c);if(r==="relay"&&n==="relay"&&s=="folder")return new ar(a,i);if(r==="relay"&&n==="folder"&&s==="document")return new fn(a,i);if(r==="relay"&&n==="folder")return new Do(a);if(r==="relay"&&n==="relay")return new Ou(a);if(n===void 0)return new Ru;throw new Error("Invalid s3rn format for the given product type")}};var sg=require("obsidian");function fL(o){if(typeof window!="undefined"&&window.btoa)return window.btoa(o);if(typeof Buffer!="undefined")return Buffer.from(o).toString("base64");throw new Error("Unable to encode to Base64")}function ng(o){let e=JSON.stringify(o),t=fL(e);return t=t.replace("+","-").replace("/","_").replace(/=+$/,""),t}var uL={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function ag(o,e,t){let r={token:o.token},n=new eg(o.url,o.docId,e,{connect:!1,params:r,disableBc:!0});return t&&n.awareness.setLocalStateField("user",{name:t.name,color:t.color.color,colorLight:t.color.light}),n}var sa=class extends Ei{constructor(t,r,n){var f;super();this.PROVIDER_MAX_ERRORS=3;this._s3rn=t,this.listeners=new Map,this.loginManager=n;let a=(f=this.loginManager)==null?void 0:f.user;this.ydoc=new tr,this.ydoc.gc=!1,a&&new di(this.ydoc).setUserMapping(this.ydoc,this.ydoc.clientID,a.id),this.tokenStore=r,this.clientToken=this.tokenStore.getTokenSync(Br.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0},this._provider=ag(this.clientToken,this.ydoc,a);let s=this.providerConnectionErrorSubscription(c=>{this.log(`[${this.path}] disconnection event`,c);let d=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),d&&this.connect()});s.on(),this._offConnectionError=s.off;let i=this.providerStateSubscription(c=>{this.notifyListeners()});i.on(),this._offState=i.off}get s3rn(){return this._s3rn}set s3rn(t){this._s3rn=t,this.refreshProvider(this.clientToken)}get debuggerUrl(){return`https://debugger.y-sweet.dev/?payload=${ng(this.clientToken)}`}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(t=>{t(this.state)})}subscribe(t,r){return this.listeners.set(t,r),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t)}async getProviderToken(){this.log("get provider token");let t=this.tokenStore.getToken(Br.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this));return sg.Platform.isIosApp?t:Fi("getProviderToken",t,1e4)}providerActive(){var t;if(this.clientToken){let r=this._provider.url==this.clientToken.url,n=Date.now()>(((t=this.clientToken)==null?void 0:t.expiryTime)||0);return r&&!n}return!1}refreshProvider(t){var s;this.clientToken=t;let r=new tr,n=ag(t,r),a=n.url;if(this._provider)this._provider.url!==a&&(this._provider.url=a,this._provider.wsUnsuccessfulReconnects=0,this.log(`Token Refreshed: setting new provider url, ${this._provider.url}`),(s=this._provider.ws)==null||s.close());else throw new Error("missing provider!");n.awareness.destroy(),n.destroy(),r.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(t=>(this.refreshProvider(t),this._provider.connect(),this.notifyListeners(),!0)).catch(t=>!1)}get state(){var t;return{status:uL[((t=this._provider.ws)==null?void 0:t.readyState)||3],intent:this.intent}}get intent(){return this._provider.shouldConnect?"connected":"disconnected"}get synced(){return this._provider.synced}disconnect(){var t;this._provider.shouldConnect=!1,(t=this._provider.ws)==null||t.close(),this._provider.ws=null,this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(t=>{t(this)}):this.getProviderToken().then(t=>this)}onceConnected(){return new Promise(t=>{let r=n=>{n.status==="connected"&&t()};this._provider.on("status",r)})}onceProviderSynced(){var t;return(t=this._provider)!=null&&t.synced?new Promise(r=>{r()}):new Promise(r=>{this._provider.once("synced",r)})}_injectIntent(t){return n=>{t({status:n.status,intent:this.intent})}}providerConnectionErrorSubscription(t){return{on:()=>{this._provider.on("connection-error",t)},off:()=>{this._provider.off("connection-error",t)}}}providerStateSubscription(t){return{on:()=>{this._provider.on("status",this._injectIntent(t))},off:()=>{this._provider.off("status",this._injectIntent(t))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var Eo=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},Ri=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=n=>{n.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((n,a)=>{try{let f=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});f.onerror=()=>a(f.error),f.onsuccess=()=>n()}catch(s){a(s)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let i=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);i.onerror=()=>n(i.error),i.onsuccess=()=>r(i.result?i.result.contents:null)}catch(a){n(a)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let i=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);i.onerror=()=>n(i.error),i.onsuccess=()=>r()}catch(a){n(a)}})}};var Po=class extends sa{constructor(t,r,n,a){let s=a.relayId?new vr(a.relayId,a.guid,r):new fn(a.guid,r);super(s,a.tokenStore,n);this.guid=r,this._parent=a,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this.offFolderStatusListener=this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()}),this.setLoggers(`[SharedDoc](${this.path})`);try{this._persistence=new Xn(this.guid,this.ydoc)}catch(i){throw this.warn("Unable to open persistence.",this.guid),console.error(i),i}this.ydoc.on("update",(i,f,c)=>{this.updateStats()}),this._tfile=null}setLoggers(t){this.debug=ae(t,"debug"),this.log=ae(t,"log"),this.warn=ae(t,"warn"),this.error=ae(t,"error")}move(t){this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r;try{let n=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(a=>null);return n!==null&&n!==""?r=n:r=await this._parent.read(this),this.setDiskBuffer(r)}catch(n){throw console.error(n),n}}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new Eo(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenReady();let t=await this.hasKnownPeers(),r=await this.diskBuffer(!0);if(!t&&this.text.trim()==="")return!1;let n=r.contents,a=this.text.trim()!==n.trim();return a||this.clearDiskBuffer(),a}async connect(){return this.sharedFolder.s3rn instanceof Do?!1:(this.s3rn instanceof fn&&(this.sharedFolder.relayId?this.s3rn=new vr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new fn(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}async whenReady(){let t=[];return this._persistence.synced||t.push(this.whenSynced()),this._provider||t.push(this.withActiveProvider()),Promise.all(t).then(r=>this)}whenSynced(){return this._persistence.synced?Promise.resolve():new Promise(t=>{this._persistence.once("synced",t)})}get persistenceSynced(){return this._persistence.synced}hasLocalDB(){return this._persistence._dbsize>3}hasKnownPeers(){return this._hasKnownPeers!==void 0?Promise.resolve(this._hasKnownPeers):this.whenSynced().then(async()=>(await Zn(this._persistence),this._hasKnownPeers=this._persistence._dbsize>3,this.debug("update count",this.path,this._persistence._dbsize),this._hasKnownPeers))}get dbsize(){return this._persistence._dbsize}destroy(){this.offFolderStatusListener(),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0)}async read(){return this.text}async rename(t){this.move(t)}async delete(){this.destroy()}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var ia=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(()=>{this.timeouts.remove(r),e()},t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}};var St=class{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return St.instance||(St.instance=new St(new ia),Nt.set(this.instance,"postie")),St.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let n={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(n),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=ae("[postie]","debug");for(let[t,r]of this.mailboxes){for(let n of r)t(n),e("send",n.constructor.name,t),this.deliveredMailLog.push({sender:n,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){ae("[postie]","warn")("All Mail Log:"),this.prettyPrintMailLog(this.allMailLog)}prettyPrintDeliveredMailLog(){ae("[postie]","warn")("Delivered Mail Log:"),this.prettyPrintMailLog(this.deliveredMailLog)}prettyPrintMailLog(e){let t=ae("[postie]","warn");e.forEach((r,n)=>{t(`Mail #${n+1}:`),t(`  Timestamp: ${new Date(r.timestamp).toISOString()}`),t(`  Transaction ID: ${r.transactionId}`),t(`  Sender: ${r.sender.observableName||r.sender.constructor.name}`),t(`  Recipient: ${r.recipient.name||"Anonymous function"}`),t(`  Recipient Origin: ${r.recipientOrigin||"Unknown"}`),t("---")})}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let n=200,a=t.replace(/\s+/g," ").slice(0,n);return a.length===n&&(a+="..."),`AnonymousFunction(${a})`}static destroy(){St.instance&&(St.instance.mailboxes=null,St.instance.allMailLog=[],St.instance.deliveredMailLog=[],St.instance.timeProvider.destroy(),St.instance.timeProvider=null,St.instance.isDelivering=!1,St.instance.isInTransaction=!1,St.instance.currentTransactionId=0,St._destroyed=!0,St.instance=void 0)}},sr=St;sr._destroyed=!1;var Uu=new Map;function ig(){for(let[,o]of Uu)o();Uu.clear()}var zt=class{constructor(e){this.observableName=e;let t=ae("[Observable]","warn");Uu.set(this,()=>{this._listeners&&this._listeners.size>0&&t(`Missing tear down of ${this._listeners.size} listeners`,this,this._listeners)}),this._listeners=new Set}notifyListeners(){for(let e of this._listeners)sr.getInstance().send(this,e)}on(e){return this._listeners.add(e),()=>{this.off(e)}}subscribe(e){return this._listeners.add(e),sr.getInstance().send(this,e,!0),()=>{this.unsubscribe(e)}}off(e){this._listeners.delete(e)}unsubscribe(e){this._listeners.delete(e)}destroy(){this._listeners.clear(),this._listeners=null}};var as=class extends zt{constructor(){super();this._set=new Set}add(t){return this._set.add(t),this.notifyListeners(),this}delete(t){let r=this._set.delete(t);return r&&this.notifyListeners(),r}clear(){this._set.clear(),this.notifyListeners()}has(t){return this._set.has(t)}items(){return[...this._set]}get size(){return this._set.size}map(t){return this.items().map(t)}forEach(t){this.items().forEach(t)}find(t){return this.items().find(t)}some(t){for(let r of this._set)if(t(r))return!0;return!1}filter(t){let r=[];for(let n of this._set)t(n)&&r.push(n);return r}};var $u=require("obsidian");var Oi={enableUpdateYDocFromDiskBuffer:!1,enableDownloadOnAddToVault:!1,enableUploadOnShare:!1,enableDocumentStatus:!1,enableDebugFileTag:!1,enableNewLinkFormat:!1};function cL(){return new Proxy({},{get:(o,e)=>e})}var ir=cL();function Nr(o,e,t=()=>{}){Ct.getInstance().flags[o]?e():t()}function lg(o,e,t=()=>{}){o.forEach(r=>{if(Ct.getInstance().flags[r]){e();return}}),t()}var Ct=class extends zt{constructor(){super();this.flags=Oi}static getInstance(){return Ct.instance||(Ct.instance=new Ct),Ct.instance}async setFlags(t,r=!1){let n=Object.keys(this.flags).reduce((a,s)=>(s in t&&(a[s]=t[s]),a),{});this.flags!==n&&(this.flags={...this.flags,...n},r&&this.notifyListeners())}getFlag(t){return this.flags[t]}setFlag(t,r,n=!1){this.flags[t]=r,n&&this.notifyListeners()}static destroy(){Ct.instance=null}};var Bu=class extends as{constructor(){super(...arguments);this.notifyListeners=(0,xt.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){return this._set.add(t),r&&this.notifyListeners(),this}},Ui=class extends sa{constructor(t,r,n,a,s,i,f,c,d,p=!0){let h=d?new ar(d,t):new Do(t);super(h,i,n);this.backgroundSync=c;this.readyPromise=null;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getFiles(),r=[],n=[];t.forEach(s=>{this.checkPath(s.path)&&(this.ids.has(s.path)||n.push(this.getVirtualPath(s.path)))});let a=this.placeHold(n);t.forEach(s=>{if(!this.checkPath(s.path)||!this.checkExtension(s.path)||s instanceof xt.TFolder)return;let i=this.ids.get(this.getVirtualPath(s.path)),f=i&&a.contains(i)||!1,c=p=>{Nr(ir.enableUploadOnShare,()=>{this.backgroundSync.putDocument(p)})},d=this.createFile(s.path,f,!1,c);r.push(d)}),r.length>0&&this.docset.update()};this.shouldConnect=!0,this.guid=t,this.fileManager=s,this.vault=a,this.path=r,this.ids=this.ydoc.getMap("docs"),this.docs=new Map,this.docset=new Bu,this.relayManager=f,this._awaitingUpdates=p,this.relayId=d,this.diskBufferStore=new Ri,this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(y=>{this.remote=y.find(g=>g.guid==this.guid)}));try{this._persistence=new Xn(this.guid,this.ydoc),this._persistence.once("synced",()=>{this.log("",this.ids)})}catch(y){throw this.warn("Unable to open persistence.",this.guid),console.error(y),y}n.loggedIn&&this.connect(),this.whenReady().then(()=>{this.addLocalDocs()}),this.ydoc.on("update",async(y,g,v)=>{g!=this&&(this.log("file tree",this._debugFileTree()),await this.syncFileTree(v))})}getFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof xt.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return xt.Vault.recurseChildren(t,n=>{n instanceof xt.TFile&&r.push(n)}),r}connect(){return this.s3rn instanceof ar&&(this.connected||this.shouldConnect)?super.connect():Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get settings(){return{guid:this.guid,path:this.path,relay:this.relayId}}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new ar(this.relayId,this.guid):new Do(this.guid),this.notifyListeners())}get ready(){let t=this._persistence.synced,r=this.synced&&this.connected;return t&&(!this._awaitingUpdates||r)}async awaitingUpdates(){return await this.whenSynced(),this._awaitingUpdates&&(await Zn(this._persistence),this.log("update count",this.path,this._persistence._dbsize),this._awaitingUpdates=this._persistence._dbsize<3),this._awaitingUpdates}async whenReady(){let t=async()=>await this.awaitingUpdates()?(await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new Mi(t,()=>[this.ready,this]),this.readyPromise.getPromise()}_debugFileTree(){let t=new Map;return this.ydoc.getMap("docs")._map.forEach((r,n)=>{r.content instanceof br?t.set(n,r.content.arr[0]):t.set(n,r.content)}),t}whenSynced(){return this._persistence.synced?new Promise(t=>{t()}):new Promise(t=>{this._persistence.once("synced",t)})}toggleConnection(){this.shouldConnect?(this.shouldConnect=!1,this.disconnect()):(this.shouldConnect=!0,this.connect())}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,n,a){a==null||a.push(`${n.path} was renamed to ${r}`);let s=(0,lr.dirname)(r);this.existsSync(s)||(await this.mkdir(s),a==null||a.push(`creating directory ${s}`)),this.fileManager.renameFile(n,(0,xt.normalizePath)(this.getPath(r))).then(()=>{t.move(r)})}async _handleServerCreate(t,r){let n=this.createDoc(t,!1,!1),a=Promise.resolve(),s=(0,lr.dirname)(t);this.existsSync(s)||(a=this.mkdir(s),r==null||r.push(`creating directory ${s}`));let i=$u.moment.now();await n.whenReady();let f=$u.moment.now();return this.debug(`receive delay: received content for ${n.path} after ${f-i}ms`,n.text.toString()),await a,this.flush(n,n.text.toString()),r==null||r.push(`created local file for remotely added doc ${t}`),n}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.ids.delete(t);return}}applyRemoteState(t,r,n,a){let s=this.docs.get(t);if(this.existsSync(r))return{op:"noop",path:r,promise:Promise.resolve()};if(n.has(t)&&s){let f=this.getPath(s.path),c=this.vault.getAbstractFileByPath(f);if(c){let d=this._handleServerRename(s,r,c,a);return{op:"rename",path:r,from:f,to:r,promise:d}}}let i=this._handleServerCreate(r,a);return{op:"create",path:r,promise:i}}cleanupExtraLocalFiles(t,r){let n=this.getFiles(),a=[];return n.forEach(s=>{var d,p;let i=this.checkPath(s.path),f=t.contains(s.path.slice(this.path.length)),c=((d=this._provider)==null?void 0:d.synced)&&((p=this._persistence)==null?void 0:p.synced);if(i&&!f&&c){r.push(`deleted local file ${s.path} for remotely deleted doc`);let h=this.vault.adapter.trashLocal(s.path);a.push({op:"delete",path:s.path,promise:h})}}),a}async syncFileTree(t){let r=[],n=t.getMap("docs"),a=[];this.ydoc.transact(()=>{n.forEach((p,h)=>{this._assertNamespacing(h)});let d=new Set(this.ids.values());n.forEach((p,h)=>{this._assertNamespacing(h),r.push(this.applyRemoteState(p,h,d,a))})});let s=r.filter(d=>d.op==="create"),i=r.filter(d=>d.op==="rename"),f=r.map(d=>d.path);await Promise.all([...s,...i].map(d=>d.promise));let c=this.cleanupExtraLocalFiles(f,a);(i.length>0||s.length>0||c.length>0)&&this.docset.update(),this.log(`syncFileTree diff:
`+a.join(`
`))}read(t){let r=(0,lr.join)(this.path,t.path);return this.vault.adapter.read((0,xt.normalizePath)(r))}existsSync(t){let r=(0,xt.normalizePath)((0,lr.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,lr.join)(this.path,t.path);return this.vault.adapter.exists((0,xt.normalizePath)(r))}flush(t,r){let n=(0,lr.join)(this.path,t.path);return this.vault.adapter.write((0,xt.normalizePath)(n),r)}getPath(t){return(0,lr.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,lr.join)(this.path,t);return this.vault.adapter.mkdir((0,xt.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+lr.sep)}checkExtension(t,r=".md"){return t.endsWith(r)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getFile(t,r=!0,n=!1,a=!0){let s=this.getVirtualPath(t);return this.getDoc(s,r,n,a)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof xt.TFile?r:null}getDoc(t,r=!0,n=!1,a=!0){let s=this.ids.get(t);if(s!==void 0){let i=this.docs.get(s);return i!==void 0?(i.move(t),i):(this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,!1,a))}else{if(r)return this.log("[getDoc]: creating new shared ID for existing file"),this.createDoc(t,n,a);throw new Error("No shared doc for vpath: "+t)}}createFile(t,r=!1,n=!0,a=s=>{}){let s=this.getVirtualPath(t);return this.createDoc(s,r,n,a)}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(n=>{if(!this.ids.has(n)){this.debug("creating entirely new doc for",n);let a=Qn();r.push(a),this.ids.set(n,a)}})},this),r}createDoc(t,r=!1,n=!0,a=s=>{}){!this.synced&&!this.ids.get(t)&&this.warn(`potential for document split at ${t}`);let s=this.ids.get(t),i;if(s===void 0){if(!r)throw new Error("attempting to create a new doc without a local file");i=Qn(),this.ydoc.transact(()=>{this.ids.set(t,i)},this)}else i=s;let f=this.docs.get(i)||new Po(t,i,this.loginManager,this),c=f.hasKnownPeers(),d=this.awaitingUpdates();return r&&(async()=>{if(!await this.exists(f))return;let[h,y,g]=await Promise.all([this.read(f),c,d]),v=f.ydoc.getText("contents");!g&&!y&&h&&v.toString()!=h&&(this.log(`[${f.path}] No Known Peers: Syncing file into ytext.`),v.insert(0,h),a(f))})(),this.docs.set(i,f),this.docset.add(f,n),f}deleteFile(t){let r=this.getVirtualPath(t);return this.deleteDoc(r)}deleteDoc(t){let r=this.ids.get(t);r&&(this.ydoc.transact(()=>{var a;this.ids.delete(t);let n=(a=this.docs.get(r))==null?void 0:a.destroy();n&&this.docset.delete(n),this.docs.delete(r)},this),this.diskBufferStore.removeDiskBuffer(r))}renameFile(t,r){let n="",a="";try{n=this.getVirtualPath(t)}catch(s){this.log("Moving out of shared folder")}try{a=this.getVirtualPath(r)}catch(s){this.log("Moving in from outside of shared folder")}if(!(!n&&!a))if(!a)this.assertPath(t),this.createDoc(n,!0,!0);else{let s=this.ids.get(a);if(!s)return;let i=this.docs.get(s);if(!n)this.ydoc.transact(()=>{this.ids.delete(a)},this),i&&(i.destroy(),this.docset.delete(i)),this.docs.delete(s);else{let f=this.ids.get(a);if(!f)return;this.ydoc.transact(()=>{this.ids.set(n,f),this.ids.delete(a),i&&i.move(n)},this)}}}destroy(){this.docs.forEach(t=>{t.destroy(),this.docs.delete(t.guid)}),super.destroy(),this.ydoc.destroy(),this.docset.clear(),this.unsubscribes.forEach(t=>{t()}),this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.vault=null}},$i=class extends as{constructor(t,r){super();this.relayManager=t;this.update=(0,xt.debounce)(this.notifyListeners,100);this.folderBuilder=r,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(n=>{let a=!1;this.items().forEach(s=>{let i=n.find(f=>f.guid==s.guid);s.remote!=i&&(a=!0),s.remote=i}),a&&this.update()}))}toSettings(){return this.items().map(t=>t.settings)}delete(t){return t==null||t.destroy(),super.delete(t)}lookup(t){let r=this.find(n=>n.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.relayManager=null,this.folderBuilder=null}async _new(t,r,n,a){let s=this.find(d=>d.path==t&&d.guid==r);if(s)return s;let i=this.find(d=>d.guid==r);if(i)throw new Error(`This folder is already mounted at ${i.path}.`);if(this.find(d=>d.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let c=await this.folderBuilder(t,r,n,a);return this._set.add(c),c}async new(t,r,n,a){let s=await this._new(t,r,n,a);return this.notifyListeners(),s}};var rl=require("@codemirror/state"),Uo=require("obsidian");function Y(){}function ye(o,e){for(let t in e)o[t]=e[t];return o}function Nu(o){return o()}function Ni(){return Object.create(null)}function Ce(o){o.forEach(Nu)}function rt(o){return typeof o=="function"}function J(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}var Bi;function Hu(o,e){return o===e?!0:(Bi||(Bi=document.createElement("a")),Bi.href=e,o===Bi.href)}function fg(o){return Object.keys(o).length===0}function Et(o,...e){if(o==null){for(let r of e)r(void 0);return Y}let t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Oe(o,e,t){o.$$.on_destroy.push(Et(e,t))}function me(o,e,t,r){if(o){let n=ug(o,e,t,r);return o[0](n)}}function ug(o,e,t,r){return o[1]&&r?ye(t.ctx.slice(),o[1](r(e))):t.ctx}function he(o,e,t,r){if(o[2]&&r){let n=o[2](r(t));if(e.dirty===void 0)return n;if(typeof n=="object"){let a=[],s=Math.max(e.dirty.length,n.length);for(let i=0;i<s;i+=1)a[i]=e.dirty[i]|n[i];return a}return e.dirty|n}return e.dirty}function ge(o,e,t,r,n,a){if(n){let s=ug(e,t,r,a);o.p(s,n)}}function xe(o){if(o.ctx.length>32){let e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function Ee(o){let e={};for(let t in o)t[0]!=="$"&&(e[t]=o[t]);return e}function Vu(o,e){let t={};e=new Set(e);for(let r in o)!e.has(r)&&r[0]!=="$"&&(t[r]=o[r]);return t}function la(o){return o==null?"":o}function cg(o){return o&&rt(o.destroy)?o.destroy:Y}var Wu=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var fa=class{constructor(e){pt(this,"_listeners","WeakMap"in Wu?new WeakMap:void 0);pt(this,"_observer");pt(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let n of t)fa.entries.set(n.target,n),(r=this._listeners.get(n.target))==null||r(n)})}};fa.entries="WeakMap"in Wu?new WeakMap:void 0;var dg=!1;function pg(){dg=!0}function mg(){dg=!1}function M(o,e){o.appendChild(e)}function Ie(o,e,t){let r=hg(o);if(!r.getElementById(e)){let n=E("style");n.id=e,n.textContent=t,mL(r,n)}}function hg(o){if(!o)return document;let e=o.getRootNode?o.getRootNode():o.ownerDocument;return e&&e.host?e:o.ownerDocument}function mL(o,e){return M(o.head||o,e),e.sheet}function C(o,e,t){o.insertBefore(e,t||null)}function k(o){o.parentNode&&o.parentNode.removeChild(o)}function fr(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function E(o){return document.createElement(o)}function Hr(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function ee(o){return document.createTextNode(o)}function W(){return ee(" ")}function Pe(){return ee("")}function Q(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function gg(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function L(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function ss(o,e){for(let t in e)L(o,t,e[t])}function xg(o){return Array.from(o.childNodes)}function ie(o,e){e=""+e,o.data!==e&&(o.data=e)}function ur(o,e){o.value=e==null?"":e}function le(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function it(o,e,t){o.classList.toggle(e,!!t)}function Hi(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}function yg(o){let e={};return o.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}function qu(o,e){return new o(e)}var Mo;function so(o){Mo=o}function Vi(){if(!Mo)throw new Error("Function called outside component initialization");return Mo}function Sr(o){Vi().$$.on_mount.push(o)}function Ku(o){Vi().$$.on_destroy.push(o)}function Lt(){let o=Vi();return(e,t,{cancelable:r=!1}={})=>{let n=o.$$.callbacks[e];if(n){let a=Hi(e,t,{cancelable:r});return n.slice().forEach(s=>{s.call(o,a)}),!a.defaultPrevented}return!0}}function Lr(o,e){let t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}var un=[];var cr=[],ca=[],wg=[],bL=Promise.resolve(),Gu=!1;function bg(){Gu||(Gu=!0,bL.then(Wi))}function is(o){ca.push(o)}var zu=new Set,ua=0;function Wi(){if(ua!==0)return;let o=Mo;do{try{for(;ua<un.length;){let e=un[ua];ua++,so(e),_L(e.$$)}}catch(e){throw un.length=0,ua=0,e}for(so(null),un.length=0,ua=0;cr.length;)cr.pop()();for(let e=0;e<ca.length;e+=1){let t=ca[e];zu.has(t)||(zu.add(t),t())}ca.length=0}while(un.length);for(;wg.length;)wg.pop()();Gu=!1,zu.clear(),so(o)}function _L(o){if(o.fragment!==null){o.update(),Ce(o.before_update);let e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(is)}}function _g(o){let e=[],t=[];ca.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),ca=e}var qi=new Set,cn;function Se(){cn={r:0,c:[],p:cn}}function Le(){cn.r||Ce(cn.c),cn=cn.p}function I(o,e){o&&o.i&&(qi.delete(o),o.i(e))}function T(o,e,t,r){if(o&&o.o){if(qi.has(o))return;qi.add(o),cn.c.push(()=>{qi.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}function ot(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function nt(o,e){let t={},r={},n={$$scope:1},a=o.length;for(;a--;){let s=o[a],i=e[a];if(i){for(let f in s)f in i||(r[f]=1);for(let f in i)n[f]||(t[f]=i[f],n[f]=1);o[a]=i}else for(let f in s)n[f]=1}for(let s in r)s in t||(t[s]=void 0);return t}function yt(o){return typeof o=="object"&&o!==null?o:{}}var vL=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],SL=new Set([...vL]);function N(o){o&&o.c()}function U(o,e,t){let{fragment:r,after_update:n}=o.$$;r&&r.m(e,t),is(()=>{let a=o.$$.on_mount.map(Nu).filter(rt);o.$$.on_destroy?o.$$.on_destroy.push(...a):Ce(a),o.$$.on_mount=[]}),n.forEach(is)}function $(o,e){let t=o.$$;t.fragment!==null&&(_g(t.after_update),Ce(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function IL(o,e){o.$$.dirty[0]===-1&&(un.push(o),bg(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function X(o,e,t,r,n,a,s=null,i=[-1]){let f=Mo;so(o);let c=o.$$={fragment:null,ctx:[],props:a,update:Y,not_equal:n,bound:Ni(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(f?f.$$.context:[])),callbacks:Ni(),dirty:i,skip_bound:!1,root:e.target||f.$$.root};s&&s(c.root);let d=!1;if(c.ctx=t?t(o,e.props||{},(p,h,...y)=>{let g=y.length?y[0]:h;return c.ctx&&n(c.ctx[p],c.ctx[p]=g)&&(!c.skip_bound&&c.bound[p]&&c.bound[p](g),d&&IL(o,p)),h}):[],c.update(),d=!0,Ce(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){pg();let p=xg(e.target);c.fragment&&c.fragment.l(p),p.forEach(k)}else c.fragment&&c.fragment.c();e.intro&&I(o.$$.fragment),U(o,e.target,e.anchor),mg(),Wi()}so(f)}var kL;typeof HTMLElement=="function"&&(kL=class extends HTMLElement{constructor(e,t,r){super();pt(this,"$$ctor");pt(this,"$$s");pt(this,"$$c");pt(this,"$$cn",!1);pt(this,"$$d",{});pt(this,"$$r",!1);pt(this,"$$p_d",{});pt(this,"$$l",{});pt(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let n=this.$$c.$on(e,t);this.$$l_u.set(t,n)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let n=this.$$l_u.get(t);n&&(n(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(a){return()=>{let s;return{c:function(){s=E("slot"),a!=="default"&&L(s,"name",a)},m:function(c,d){C(c,s,d)},d:function(c){c&&k(s)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=yg(this);for(let a of this.$$s)a in r&&(t[a]=[e(a)]);for(let a of this.attributes){let s=this.$$g_p(a.name);s in this.$$d||(this.$$d[s]=Yu(s,a.value,this.$$p_d,"toProp"))}for(let a in this.$$p_d)!(a in this.$$d)&&this[a]!==void 0&&(this.$$d[a]=this[a],delete this[a]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let n=()=>{this.$$r=!0;for(let a in this.$$p_d)if(this.$$d[a]=this.$$c.$$.ctx[this.$$c.$$.props[a]],this.$$p_d[a].reflect){let s=Yu(a,this.$$d[a],this.$$p_d,"toAttribute");s==null?this.removeAttribute(this.$$p_d[a].attribute||a):this.setAttribute(this.$$p_d[a].attribute||a,s)}this.$$r=!1};this.$$c.$$.after_update.push(n),n();for(let a in this.$$l)for(let s of this.$$l[a]){let i=this.$$c.$on(a,s);this.$$l_u.set(s,i)}this.$$l={}}}attributeChangedCallback(e,t,r){var n;this.$$r||(e=this.$$g_p(e),this.$$d[e]=Yu(e,r,this.$$p_d,"toProp"),(n=this.$$c)==null||n.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function Yu(o,e,t,r){var a;let n=(a=t[o])==null?void 0:a.type;if(e=n==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[o])return e;if(r==="toAttribute")switch(n){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(n){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var j=class{constructor(){pt(this,"$$");pt(this,"$$set")}$destroy(){$(this,1),this.$destroy=Y}$on(e,t){if(!rt(t))return Y;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let n=r.indexOf(t);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!fg(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var vg="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(vg);var CL={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Ju=CL;function Sg(o,e,t){let r=o.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function ju(o){let e,t=[o[12]],r={};for(let n=0;n<t.length;n+=1)r=ye(r,t[n]);return{c(){e=Hr(o[11]),ss(e,r)},m(n,a){C(n,e,a)},p(n,a){ss(e,r=nt(t,[a&32&&n[12]]))},d(n){n&&k(e)}}}function Lg(o){let e=o[11],t,r=o[11]&&ju(o);return{c(){r&&r.c(),t=Pe()},m(n,a){r&&r.m(n,a),C(n,t,a)},p(n,a){n[11]?e?J(e,n[11])?(r.d(1),r=ju(n),e=n[11],r.c(),r.m(t.parentNode,t)):r.p(n,a):(r=ju(n),e=n[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=n[11])},d(n){n&&k(t),r&&r.d(n)}}}function AL(o){let e,t,r,n,a,s=ot(o[5]),i=[];for(let h=0;h<s.length;h+=1)i[h]=Lg(Sg(o,s,h));let f=o[10].default,c=me(f,o,o[9],null),d=[Ju,o[7],{width:o[2]},{height:o[2]},{stroke:o[1]},{"stroke-width":r=o[4]?Number(o[3])*24/Number(o[2]):o[3]},{class:n=o[6]("lucide-icon","lucide",o[0]?`lucide-${o[0]}`:"",o[8].class)}],p={};for(let h=0;h<d.length;h+=1)p=ye(p,d[h]);return{c(){e=Hr("svg");for(let h=0;h<i.length;h+=1)i[h].c();t=Pe(),c&&c.c(),ss(e,p)},m(h,y){C(h,e,y);for(let g=0;g<i.length;g+=1)i[g]&&i[g].m(e,null);M(e,t),c&&c.m(e,null),a=!0},p(h,[y]){if(y&32){s=ot(h[5]);let g;for(g=0;g<s.length;g+=1){let v=Sg(h,s,g);i[g]?i[g].p(v,y):(i[g]=Lg(v),i[g].c(),i[g].m(e,t))}for(;g<i.length;g+=1)i[g].d(1);i.length=s.length}c&&c.p&&(!a||y&512)&&ge(c,f,h,h[9],a?he(f,h[9],y,null):xe(h[9]),null),ss(e,p=nt(d,[Ju,y&128&&h[7],(!a||y&4)&&{width:h[2]},(!a||y&4)&&{height:h[2]},(!a||y&2)&&{stroke:h[1]},(!a||y&28&&r!==(r=h[4]?Number(h[3])*24/Number(h[2]):h[3]))&&{"stroke-width":r},(!a||y&257&&n!==(n=h[6]("lucide-icon","lucide",h[0]?`lucide-${h[0]}`:"",h[8].class)))&&{class:n}]))},i(h){a||(I(c,h),a=!0)},o(h){T(c,h),a=!1},d(h){h&&k(e),fr(i,h),c&&c.d(h)}}}function TL(o,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],n=Vu(e,r),{$$slots:a={},$$scope:s}=e,{name:i=void 0}=e,{color:f="currentColor"}=e,{size:c=24}=e,{strokeWidth:d=2}=e,{absoluteStrokeWidth:p=!1}=e,{iconNode:h}=e,y=(...g)=>g.filter((v,b,_)=>Boolean(v)&&_.indexOf(v)===b).join(" ");return o.$$set=g=>{t(8,e=ye(ye({},e),Ee(g))),t(7,n=Vu(e,r)),"name"in g&&t(0,i=g.name),"color"in g&&t(1,f=g.color),"size"in g&&t(2,c=g.size),"strokeWidth"in g&&t(3,d=g.strokeWidth),"absoluteStrokeWidth"in g&&t(4,p=g.absoluteStrokeWidth),"iconNode"in g&&t(5,h=g.iconNode),"$$scope"in g&&t(9,s=g.$$scope)},e=Ee(e),[i,f,c,d,p,h,y,n,e,s,a]}var Xu=class extends j{constructor(e){super(),X(this,e,TL,AL,J,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},wt=Xu;function DL(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,a){r&&r.m(n,a),e=!0},p(n,a){r&&r.p&&(!e||a&8)&&ge(r,t,n,n[3],e?he(t,n[3],a,null):xe(n[3]),null)},i(n){e||(I(r,n),e=!0)},o(n){T(r,n),e=!1},d(n){r&&r.d(n)}}}function EL(o){let e,t,r=[{name:"arrow-right-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[DL]},$$scope:{ctx:o}};for(let a=0;a<r.length;a+=1)n=ye(n,r[a]);return e=new wt({props:n}),{c(){N(e.$$.fragment)},m(a,s){U(e,a,s),t=!0},p(a,[s]){let i=s&3?nt(r,[r[0],s&2&&yt(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(i.$$scope={dirty:s,ctx:a}),e.$set(i)},i(a){t||(I(e.$$.fragment,a),t=!0)},o(a){T(e.$$.fragment,a),t=!1},d(a){$(e,a)}}}function PL(o,e,t){let{$$slots:r={},$$scope:n}=e,a=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return o.$$set=s=>{t(1,e=ye(ye({},e),Ee(s))),"$$scope"in s&&t(3,n=s.$$scope)},e=Ee(e),[a,e,r,n]}var Zu=class extends j{constructor(e){super(),X(this,e,PL,EL,J,{})}},Qu=Zu;function ML(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,a){r&&r.m(n,a),e=!0},p(n,a){r&&r.p&&(!e||a&8)&&ge(r,t,n,n[3],e?he(t,n[3],a,null):xe(n[3]),null)},i(n){e||(I(r,n),e=!0)},o(n){T(r,n),e=!1},d(n){r&&r.d(n)}}}function FL(o){let e,t,r=[{name:"chevron-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[ML]},$$scope:{ctx:o}};for(let a=0;a<r.length;a+=1)n=ye(n,r[a]);return e=new wt({props:n}),{c(){N(e.$$.fragment)},m(a,s){U(e,a,s),t=!0},p(a,[s]){let i=s&3?nt(r,[r[0],s&2&&yt(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(i.$$scope={dirty:s,ctx:a}),e.$set(i)},i(a){t||(I(e.$$.fragment,a),t=!0)},o(a){T(e.$$.fragment,a),t=!1},d(a){$(e,a)}}}function RL(o,e,t){let{$$slots:r={},$$scope:n}=e,a=[["path",{d:"m15 18-6-6 6-6"}]];return o.$$set=s=>{t(1,e=ye(ye({},e),Ee(s))),"$$scope"in s&&t(3,n=s.$$scope)},e=Ee(e),[a,e,r,n]}var ec=class extends j{constructor(e){super(),X(this,e,RL,FL,J,{})}},tc=ec;function OL(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,a){r&&r.m(n,a),e=!0},p(n,a){r&&r.p&&(!e||a&8)&&ge(r,t,n,n[3],e?he(t,n[3],a,null):xe(n[3]),null)},i(n){e||(I(r,n),e=!0)},o(n){T(r,n),e=!1},d(n){r&&r.d(n)}}}function UL(o){let e,t,r=[{name:"chevron-right"},o[1],{iconNode:o[0]}],n={$$slots:{default:[OL]},$$scope:{ctx:o}};for(let a=0;a<r.length;a+=1)n=ye(n,r[a]);return e=new wt({props:n}),{c(){N(e.$$.fragment)},m(a,s){U(e,a,s),t=!0},p(a,[s]){let i=s&3?nt(r,[r[0],s&2&&yt(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(i.$$scope={dirty:s,ctx:a}),e.$set(i)},i(a){t||(I(e.$$.fragment,a),t=!0)},o(a){T(e.$$.fragment,a),t=!1},d(a){$(e,a)}}}function $L(o,e,t){let{$$slots:r={},$$scope:n}=e,a=[["path",{d:"m9 18 6-6-6-6"}]];return o.$$set=s=>{t(1,e=ye(ye({},e),Ee(s))),"$$scope"in s&&t(3,n=s.$$scope)},e=Ee(e),[a,e,r,n]}var rc=class extends j{constructor(e){super(),X(this,e,$L,UL,J,{})}},oc=rc;function BL(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,a){r&&r.m(n,a),e=!0},p(n,a){r&&r.p&&(!e||a&8)&&ge(r,t,n,n[3],e?he(t,n[3],a,null):xe(n[3]),null)},i(n){e||(I(r,n),e=!0)},o(n){T(r,n),e=!1},d(n){r&&r.d(n)}}}function NL(o){let e,t,r=[{name:"circle-help"},o[1],{iconNode:o[0]}],n={$$slots:{default:[BL]},$$scope:{ctx:o}};for(let a=0;a<r.length;a+=1)n=ye(n,r[a]);return e=new wt({props:n}),{c(){N(e.$$.fragment)},m(a,s){U(e,a,s),t=!0},p(a,[s]){let i=s&3?nt(r,[r[0],s&2&&yt(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(i.$$scope={dirty:s,ctx:a}),e.$set(i)},i(a){t||(I(e.$$.fragment,a),t=!0)},o(a){T(e.$$.fragment,a),t=!1},d(a){$(e,a)}}}function HL(o,e,t){let{$$slots:r={},$$scope:n}=e,a=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return o.$$set=s=>{t(1,e=ye(ye({},e),Ee(s))),"$$scope"in s&&t(3,n=s.$$scope)},e=Ee(e),[a,e,r,n]}var nc=class extends j{constructor(e){super(),X(this,e,HL,NL,J,{})}},ls=nc;function VL(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,a){r&&r.m(n,a),e=!0},p(n,a){r&&r.p&&(!e||a&8)&&ge(r,t,n,n[3],e?he(t,n[3],a,null):xe(n[3]),null)},i(n){e||(I(r,n),e=!0)},o(n){T(r,n),e=!1},d(n){r&&r.d(n)}}}function WL(o){let e,t,r=[{name:"folder"},o[1],{iconNode:o[0]}],n={$$slots:{default:[VL]},$$scope:{ctx:o}};for(let a=0;a<r.length;a+=1)n=ye(n,r[a]);return e=new wt({props:n}),{c(){N(e.$$.fragment)},m(a,s){U(e,a,s),t=!0},p(a,[s]){let i=s&3?nt(r,[r[0],s&2&&yt(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(i.$$scope={dirty:s,ctx:a}),e.$set(i)},i(a){t||(I(e.$$.fragment,a),t=!0)},o(a){T(e.$$.fragment,a),t=!1},d(a){$(e,a)}}}function qL(o,e,t){let{$$slots:r={},$$scope:n}=e,a=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return o.$$set=s=>{t(1,e=ye(ye({},e),Ee(s))),"$$scope"in s&&t(3,n=s.$$scope)},e=Ee(e),[a,e,r,n]}var ac=class extends j{constructor(e){super(),X(this,e,qL,WL,J,{})}},sc=ac;function KL(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,a){r&&r.m(n,a),e=!0},p(n,a){r&&r.p&&(!e||a&8)&&ge(r,t,n,n[3],e?he(t,n[3],a,null):xe(n[3]),null)},i(n){e||(I(r,n),e=!0)},o(n){T(r,n),e=!1},d(n){r&&r.d(n)}}}function zL(o){let e,t,r=[{name:"layers"},o[1],{iconNode:o[0]}],n={$$slots:{default:[KL]},$$scope:{ctx:o}};for(let a=0;a<r.length;a+=1)n=ye(n,r[a]);return e=new wt({props:n}),{c(){N(e.$$.fragment)},m(a,s){U(e,a,s),t=!0},p(a,[s]){let i=s&3?nt(r,[r[0],s&2&&yt(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(i.$$scope={dirty:s,ctx:a}),e.$set(i)},i(a){t||(I(e.$$.fragment,a),t=!0)},o(a){T(e.$$.fragment,a),t=!1},d(a){$(e,a)}}}function GL(o,e,t){let{$$slots:r={},$$scope:n}=e,a=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return o.$$set=s=>{t(1,e=ye(ye({},e),Ee(s))),"$$scope"in s&&t(3,n=s.$$scope)},e=Ee(e),[a,e,r,n]}var ic=class extends j{constructor(e){super(),X(this,e,GL,zL,J,{})}},io=ic;function YL(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,a){r&&r.m(n,a),e=!0},p(n,a){r&&r.p&&(!e||a&8)&&ge(r,t,n,n[3],e?he(t,n[3],a,null):xe(n[3]),null)},i(n){e||(I(r,n),e=!0)},o(n){T(r,n),e=!1},d(n){r&&r.d(n)}}}function JL(o){let e,t,r=[{name:"message-square-heart"},o[1],{iconNode:o[0]}],n={$$slots:{default:[YL]},$$scope:{ctx:o}};for(let a=0;a<r.length;a+=1)n=ye(n,r[a]);return e=new wt({props:n}),{c(){N(e.$$.fragment)},m(a,s){U(e,a,s),t=!0},p(a,[s]){let i=s&3?nt(r,[r[0],s&2&&yt(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(i.$$scope={dirty:s,ctx:a}),e.$set(i)},i(a){t||(I(e.$$.fragment,a),t=!0)},o(a){T(e.$$.fragment,a),t=!1},d(a){$(e,a)}}}function jL(o,e,t){let{$$slots:r={},$$scope:n}=e,a=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"}]];return o.$$set=s=>{t(1,e=ye(ye({},e),Ee(s))),"$$scope"in s&&t(3,n=s.$$scope)},e=Ee(e),[a,e,r,n]}var lc=class extends j{constructor(e){super(),X(this,e,jL,JL,J,{})}},fc=lc;function XL(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,a){r&&r.m(n,a),e=!0},p(n,a){r&&r.p&&(!e||a&8)&&ge(r,t,n,n[3],e?he(t,n[3],a,null):xe(n[3]),null)},i(n){e||(I(r,n),e=!0)},o(n){T(r,n),e=!1},d(n){r&&r.d(n)}}}function ZL(o){let e,t,r=[{name:"satellite"},o[1],{iconNode:o[0]}],n={$$slots:{default:[XL]},$$scope:{ctx:o}};for(let a=0;a<r.length;a+=1)n=ye(n,r[a]);return e=new wt({props:n}),{c(){N(e.$$.fragment)},m(a,s){U(e,a,s),t=!0},p(a,[s]){let i=s&3?nt(r,[r[0],s&2&&yt(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(i.$$scope={dirty:s,ctx:a}),e.$set(i)},i(a){t||(I(e.$$.fragment,a),t=!0)},o(a){T(e.$$.fragment,a),t=!1},d(a){$(e,a)}}}function QL(o,e,t){let{$$slots:r={},$$scope:n}=e,a=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return o.$$set=s=>{t(1,e=ye(ye({},e),Ee(s))),"$$scope"in s&&t(3,n=s.$$scope)},e=Ee(e),[a,e,r,n]}var uc=class extends j{constructor(e){super(),X(this,e,QL,ZL,J,{})}},dn=uc;function eI(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,a){r&&r.m(n,a),e=!0},p(n,a){r&&r.p&&(!e||a&8)&&ge(r,t,n,n[3],e?he(t,n[3],a,null):xe(n[3]),null)},i(n){e||(I(r,n),e=!0)},o(n){T(r,n),e=!1},d(n){r&&r.d(n)}}}function tI(o){let e,t,r=[{name:"settings"},o[1],{iconNode:o[0]}],n={$$slots:{default:[eI]},$$scope:{ctx:o}};for(let a=0;a<r.length;a+=1)n=ye(n,r[a]);return e=new wt({props:n}),{c(){N(e.$$.fragment)},m(a,s){U(e,a,s),t=!0},p(a,[s]){let i=s&3?nt(r,[r[0],s&2&&yt(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(i.$$scope={dirty:s,ctx:a}),e.$set(i)},i(a){t||(I(e.$$.fragment,a),t=!0)},o(a){T(e.$$.fragment,a),t=!1},d(a){$(e,a)}}}function rI(o,e,t){let{$$slots:r={},$$scope:n}=e,a=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return o.$$set=s=>{t(1,e=ye(ye({},e),Ee(s))),"$$scope"in s&&t(3,n=s.$$scope)},e=Ee(e),[a,e,r,n]}var cc=class extends j{constructor(e){super(),X(this,e,rI,tI,J,{})}},dc=cc;function oI(o){Ie(o,"svelte-1gxdage","button.notebook.svelte-1gxdage{color:var(--color-base-30);background-color:transparent}button.notebook-synced.svelte-1gxdage{color:var(--color-accent)}button.system3-connected.svelte-1gxdage{color:var(--color-accent)}button.system3-disconnected.svelte-1gxdage{color:var(--color-base-40)}")}function nI(o){let e,t,r,n,a,s;return t=new io({props:{class:"svg-icon inline-icon"}}),{c(){var i;e=E("button"),N(t.$$.fragment),L(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),L(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),L(e,"tabindex","0"),L(e,"data-filename",a=(i=o[0].view.file)==null?void 0:i.name)},m(i,f){C(i,e,f),U(t,e,null),s=!0},p(i,f){var c;(!s||f&1&&r!==(r="clickable-icon view-action system3-view-action "+(i[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&L(e,"class",r),(!s||f&1&&n!==(n=i[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&L(e,"aria-label",n),(!s||f&1&&a!==(a=(c=i[0].view.file)==null?void 0:c.name))&&L(e,"data-filename",a)},i(i){s||(I(t.$$.fragment,i),s=!0)},o(i){T(t.$$.fragment,i),s=!1},d(i){i&&k(e),$(t)}}}function aI(o){let e,t,r,n,a,s,i,f,c,d,p,h,y;return t=new io({props:{class:"svg-icon inline-icon"}}),f=new dn({props:{class:"svg-icon inline-icon"}}),{c(){var g;e=E("button"),N(t.$$.fragment),s=W(),i=E("button"),N(f.$$.fragment),L(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),L(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),L(e,"tabindex","0"),L(e,"data-filename",a=(g=o[0].view.file)==null?void 0:g.name),L(i,"class",c="system3-"+o[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"),L(i,"aria-label",d=`${o[2].relay.name} (${o[1].status})`),L(i,"tabindex","0")},m(g,v){C(g,e,v),U(t,e,null),C(g,s,v),C(g,i,v),U(f,i,null),p=!0,h||(y=[Q(i,"click",o[3]),Q(i,"keypress",o[4])],h=!0)},p(g,v){var b;(!p||v&1&&r!==(r="clickable-icon view-action system3-view-action "+(g[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&L(e,"class",r),(!p||v&1&&n!==(n=g[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&L(e,"aria-label",n),(!p||v&1&&a!==(a=(b=g[0].view.file)==null?void 0:b.name))&&L(e,"data-filename",a),(!p||v&2&&c!==(c="system3-"+g[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"))&&L(i,"class",c),(!p||v&6&&d!==(d=`${g[2].relay.name} (${g[1].status})`))&&L(i,"aria-label",d)},i(g){p||(I(t.$$.fragment,g),I(f.$$.fragment,g),p=!0)},o(g){T(t.$$.fragment,g),T(f.$$.fragment,g),p=!1},d(g){g&&(k(e),k(s),k(i)),$(t),$(f),h=!1,Ce(y)}}}function sI(o){let e,t,r,n,a=[aI,nI],s=[];function i(f,c){return f[2]?0:1}return e=i(o,-1),t=s[e]=a[e](o),{c(){t.c(),r=Pe()},m(f,c){s[e].m(f,c),C(f,r,c),n=!0},p(f,[c]){let d=e;e=i(f,c),e===d?s[e].p(f,c):(Se(),T(s[d],1,1,()=>{s[d]=null}),Le(),t=s[e],t?t.p(f,c):(t=s[e]=a[e](f),t.c()),I(t,1),t.m(r.parentNode,r))},i(f){n||(I(t),n=!0)},o(f){T(t),n=!1},d(f){f&&k(r),s[e].d(f)}}}function iI(o,e,t){let{view:r}=e,{state:n}=e,{remote:a}=e,s={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},i=()=>{r.toggleConnection()},f=c=>{c.key==="Enter"&&i()};return o.$$set=c=>{"view"in c&&t(0,r=c.view),"state"in c&&t(1,n=c.state),"remote"in c&&t(2,a=c.remote)},[r,n,a,i,f]}var pc=class extends j{constructor(e){super(),X(this,e,iI,sI,J,{view:0,state:1,remote:2},oI)}},Ig=pc;var da=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let n=e.querySelector(".system3-banner");if(!n){n=document.createElement("div"),n.classList.add("system3-banner");let a=n.createSpan();a.setText(this.text),n.appendChild(a),r.appendChild(n);let s=async()=>{await this.onClick()&&this.destroy()};n.addEventListener("click",s)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),!0}};var Ki=require("@codemirror/state"),kg=require("@codemirror/view");var ZM=Ki.Facet.define({combine(o){return o[o.length-1]}}),mc=Ki.Annotation.define(),hc=class{constructor(e){this.initialSet=!1;this.log=e=>{};var t,r;this.editor=e,this.connectionManager=this.editor.state.field(Fo),this.view=(t=this.connectionManager)==null?void 0:t.findView(e),this.view&&(this.log=ae(`[LiveCMPluginValue][${(r=this.view.view.file)==null?void 0:r.path}]`),this.log("created"),this.view.document&&(this.view.document.whenSynced().then(async()=>{pa(this.view)&&!this.view.tracking&&this.editor.dispatch({changes:await this.getKeyFrame(),annotations:[mc.of(this)]})}),this._observer=async(n,a)=>{if(!pa(this.view)){this.log("Recived yjs event against a non-live view");return}if(a.origin!==this){let s=n.delta,i=[],f=0;for(let c=0;c<s.length;c++){let d=s[c];d.insert!=null?i.push({from:f,to:f,insert:d.insert}):d.delete!=null?(i.push({from:f,to:f+d.delete,insert:""}),f+=d.delete):d.retain!=null&&(f+=d.retain)}this.view.tracking?this.log("dispatch (incremental)"):(i=await this.getKeyFrame(),this.log("dispatch (full)")),e.dispatch({changes:i,annotations:[mc.of(this)]}),this.view.tracking=!0}},this.observer=(n,a)=>{var s,i;try{(s=this._observer)==null||s.call(this,n,a)}catch(f){f instanceof RangeError&&pa(this.view)&&(this.view.tracking=!1,(i=this._observer)==null||i.call(this,n,a))}},this._ytext=this.view.document.ytext,this._ytext.observe(this.observer)))}getBufferChange(e){return{from:0,to:this.editor.state.doc.length,insert:e}}async getKeyFrame(){if(!pa(this.view))return[];let e=this.editor.state.doc.toString();return this.view.document.text===e?(this.view.tracking=!0,[]):(this.log("ytext and editor buffer need syncing"),!this.view.document.hasLocalDB()&&this.view.document.text===""?(this.log("local db missing, not setting buffer"),[]):(this.view.tracking||await this.view.checkStale(),pa(this.view)?[this.getBufferChange(this.view.document.text)]:[]))}update(e){var n,a,s,i;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(mc)===this)return;let t=e.view;this.view=(n=this.connectionManager)==null?void 0:n.findView(t);let r=(s=(a=this.view)==null?void 0:a.document)==null?void 0:s.ytext;r&&((i=r.doc)==null||i.transact(()=>{let f=0;e.changes.iterChanges((c,d,p,h,y)=>{let g=y.sliceString(0,y.length,`
`);c!==d&&r.delete(c+f,d-c),g.length>0&&r.insert(c+f,g),f+=g.length-(d-c)})},this))}destroy(){var e;this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Cg=kg.ViewPlugin.fromClass(hc);var zi=require("@codemirror/state"),Ht=require("@codemirror/view");var Ag=Ht.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),lI=zi.Annotation.define(),gc=class extends Ht.WidgetType{constructor(t,r){super();this.color=t,this.name=r}toDOM(t){return Wa("span",[Tt("class","cm-ySelectionCaret"),Tt("style",`background-color: ${this.color}; border-color: ${this.color}`)],[Bn("\u2060"),Wa("div",[Tt("class","cm-ySelectionCaretDot")]),Bn("\u2060"),Wa("div",[Tt("class","cm-ySelectionInfo")],[Bn(this.name)]),Bn("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},xc=class{constructor(e){var r,n;this.editor=e,this.decorations=zi.RangeSet.of([]),this.connectionManager=this.editor.state.field(Fo);let t=(r=this.connectionManager)==null?void 0:r.findView(e);if(t&&t instanceof Ro){this.view=t;let a=(n=this.view.document)==null?void 0:n._provider;this._listener=({added:s,updated:i,removed:f},c,d)=>{s.concat(i).concat(f).findIndex(h=>{var y;return h!==((y=this._awareness)==null?void 0:y.doc.clientID)})>=0&&e.dispatch({annotations:[lI.of([])]})},a&&(this._awareness=a.awareness,this._awareness.on("change",this._listener))}}destroy(){var e;this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var c,d,p,h;let t=e.view;this.view=(c=this.connectionManager)==null?void 0:c.findView(t);let r=(p=(d=this.view)==null?void 0:d.document)==null?void 0:p.ytext;if(!(this.view&&r&&r.doc))return;let n=(h=this.view.document)==null?void 0:h._provider;if(!n)return;this._awareness=n.awareness;let a=this._awareness,s=r.doc,i=[],f=this._awareness.getLocalState();if(f!=null){let y=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),g=y?e.state.selection.main:null,v=f.cursor==null?null:lu(f.cursor.anchor),b=f.cursor==null?null:lu(f.cursor.head);if(g!=null){let _=fu(r,g.anchor),D=fu(r,g.head);(f.cursor==null||!cu(v,_)||!cu(b,D))&&a.setLocalStateField("cursor",{anchor:_,head:D})}else f.cursor!=null&&y&&a.setLocalStateField("cursor",null)}a.getStates().forEach((y,g)=>{if(g===a.doc.clientID)return;let v=y.cursor;if(v==null||v.anchor==null||v.head==null)return;let b=uu(v.anchor,s),_=uu(v.head,s);if(b==null||_==null||b.type!==r||_.type!==r)return;if(b.index>e.state.doc.length||_.index>e.state.doc.length){ae("[RemoteSelections]","warn")(`cursor positions (${b.index}, ${_.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=Ht.Decoration.none;return}let{color:D="#30bced",name:F="Anonymous"}=y.user||{},S=y.user&&y.user.colorLight||D+"33",P=An(b.index,_.index),H=gr(b.index,_.index),R=e.view.state.doc.lineAt(P),V=e.view.state.doc.lineAt(H);if(R.number===V.number)i.push({from:P,to:H,value:Ht.Decoration.mark({attributes:{style:`background-color: ${S}`},class:"cm-ySelection"})});else{i.push({from:P,to:R.from+R.length,value:Ht.Decoration.mark({attributes:{style:`background-color: ${S}`},class:"cm-ySelection"})}),i.push({from:V.from,to:H,value:Ht.Decoration.mark({attributes:{style:`background-color: ${S}`},class:"cm-ySelection"})});for(let O=R.number+1;O<V.number;O++){let te=e.view.state.doc.line(O).from;i.push({from:te,to:te,value:Ht.Decoration.line({attributes:{style:`background-color: ${S}`,class:"cm-yLineSelection"}})})}}i.push({from:_.index,to:_.index,value:Ht.Decoration.widget({side:_.index-b.index>0?-1:1,block:!1,widget:new gc(D,F)})})}),this.decorations=Ht.Decoration.set(i,!0)}},Tg=Ht.ViewPlugin.fromClass(xc,{decorations:o=>o.decorations});var Gi=require("@codemirror/state"),lo=require("@codemirror/view"),Dg=require("@codemirror/view");var cF=Gi.Annotation.define(),wc=class extends Dg.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},yc=Gi.StateEffect.define(),bc=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(Fo),this.decorations=lo.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,n)=>{this.updateFromMetadata(n),this.editor.dispatch({effects:yc.of(null)})},!this.connectionManager){ae("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.view=this.connectionManager.findView(e),this.view&&(this.log=ae(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var r,n;if(this.connectionManager&&((n=(r=this.view)==null?void 0:r.document)!=null&&n.tfile)){this.connectionManager.onMeta(this.view.document.tfile,this.cb);let a=app.metadataCache.getFileCache(this.view.document.tfile);a&&(this.updateFromMetadata(a),this.editor.dispatch({effects:yc.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet(lo.EditorView.decorations).forEach(n=>{(typeof n=="function"?n(e):n).between(0,e.state.doc.length,(s,i,f)=>{var p;(((p=f.spec)==null?void 0:p.class)||"").contains("cm-formatting-link-end")&&t.push({from:s,to:i})})}),t}updateFromMetadata(e){var r,n,a,s;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!((n=(r=this.view)==null?void 0:r.document)!=null&&n.sharedFolder)||!((s=(a=this.view)==null?void 0:a.document)!=null&&s.tfile))return;let t=new Map;for(let i of(e==null?void 0:e.links)||[]){let f=app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);f&&!this.view.document.sharedFolder.checkPath(f.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}for(let i of(e==null?void 0:e.embeds)||[]){let f=app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);f&&!this.view.document.sharedFolder.checkPath(f.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(n){this.metadata.delete(t)}}updateFromEditor(e){var a,s,i,f;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!((s=(a=this.view)==null?void 0:a.document)!=null&&s.sharedFolder)||!((f=(i=this.view)==null?void 0:i.document)!=null&&f.tfile))return;let t=[],r=new Map(this.metadata),n=this.findInternalLinks(this.editor);for(let c of n){let d=null;for(let[y,g]of r)if(c.from<=g.to&&c.to>=g.from){d=g,r.delete(y);break}if(!d)continue;let p=app.metadataCache.getFirstLinkpathDest(d.link,this.view.document.path);p&&!this.view.document.sharedFolder.checkPath(p.path)&&t.push(c.from)}t.filter(c=>c<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>lo.Decoration.widget({widget:new wc,side:1}).range(t));e.length>0?this.decorations=lo.Decoration.set(e,!0):this.decorations=lo.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(n=>n.is(yc))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},Eg=lo.ViewPlugin.fromClass(bc,{decorations:o=>o.decorations});function fo(){}fo.prototype={diff:function(e,t){var r,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=n.callback;typeof n=="function"&&(a=n,n={}),this.options=n;var s=this;function i(S){return a?(setTimeout(function(){a(void 0,S)},0),!0):S}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var f=t.length,c=e.length,d=1,p=f+c;n.maxEditLength&&(p=Math.min(p,n.maxEditLength));var h=(r=n.timeout)!==null&&r!==void 0?r:1/0,y=Date.now()+h,g=[{oldPos:-1,lastComponent:void 0}],v=this.extractCommon(g[0],t,e,0);if(g[0].oldPos+1>=c&&v+1>=f)return i([{value:this.join(t),count:t.length}]);var b=-1/0,_=1/0;function D(){for(var S=Math.max(b,-d);S<=Math.min(_,d);S+=2){var P=void 0,H=g[S-1],R=g[S+1];H&&(g[S-1]=void 0);var V=!1;if(R){var O=R.oldPos-S;V=R&&0<=O&&O<f}var te=H&&H.oldPos+1<c;if(!V&&!te){g[S]=void 0;continue}if(!te||V&&H.oldPos+1<R.oldPos?P=s.addToPath(R,!0,void 0,0):P=s.addToPath(H,void 0,!0,1),v=s.extractCommon(P,t,e,S),P.oldPos+1>=c&&v+1>=f)return i(fI(s,P.lastComponent,t,e,s.useLongestToken));g[S]=P,P.oldPos+1>=c&&(_=Math.min(_,S-1)),v+1>=f&&(b=Math.max(b,S+1))}d++}if(a)(function S(){setTimeout(function(){if(d>p||Date.now()>y)return a();D()||S()},0)})();else for(;d<=p&&Date.now()<=y;){var F=D();if(F)return F}},addToPath:function(e,t,r,n){var a=e.lastComponent;return a&&a.added===t&&a.removed===r?{oldPos:e.oldPos+n,lastComponent:{count:a.count+1,added:t,removed:r,previousComponent:a.previousComponent}}:{oldPos:e.oldPos+n,lastComponent:{count:1,added:t,removed:r,previousComponent:a}}},extractCommon:function(e,t,r,n){for(var a=t.length,s=r.length,i=e.oldPos,f=i-n,c=0;f+1<a&&i+1<s&&this.equals(t[f+1],r[i+1]);)f++,i++,c++;return c&&(e.lastComponent={count:c,previousComponent:e.lastComponent}),e.oldPos=i,f},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function fI(o,e,t,r,n){for(var a=[],s;e;)a.push(e),s=e.previousComponent,delete e.previousComponent,e=s;a.reverse();for(var i=0,f=a.length,c=0,d=0;i<f;i++){var p=a[i];if(p.removed){if(p.value=o.join(r.slice(d,d+p.count)),d+=p.count,i&&a[i-1].added){var y=a[i-1];a[i-1]=a[i],a[i]=y}}else{if(!p.added&&n){var h=t.slice(c,c+p.count);h=h.map(function(v,b){var _=r[d+b];return _.length>v.length?_:v}),p.value=o.join(h)}else p.value=o.join(t.slice(c,c+p.count));c+=p.count,p.added||(d+=p.count)}}var g=a[f-1];return f>1&&typeof g.value=="string"&&(g.added||g.removed)&&o.equals("",g.value)&&(a[f-2].value+=g.value,a.pop()),a}var pF=new fo;function uI(o,e){if(typeof o=="function")e.callback=o;else if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e}var Pg=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Mg=/\S/,Ic=new fo;Ic.equals=function(o,e){return this.options.ignoreCase&&(o=o.toLowerCase(),e=e.toLowerCase()),o===e||this.options.ignoreWhitespace&&!Mg.test(o)&&!Mg.test(e)};Ic.tokenize=function(o){for(var e=o.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&Pg.test(e[t])&&Pg.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function Fg(o,e,t){return t=uI(t,{ignoreWhitespace:!0}),Ic.diff(o,e,t)}var kc=new fo;kc.tokenize=function(o){this.options.stripTrailingCr&&(o=o.replace(/\r\n/g,`
`));var e=[],t=o.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var n=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=n:(this.options.ignoreWhitespace&&(n=n.trim()),e.push(n))}return e};function cI(o,e,t){return kc.diff(o,e,t)}var dI=new fo;dI.tokenize=function(o){return o.split(/(\S.+?[.!?])(?=\s+|$)/)};var pI=new fo;pI.tokenize=function(o){return o.split(/([{}:;,]|\s+)/)};function Yi(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Yi=function(e){return typeof e}:Yi=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yi(o)}function _c(o){return mI(o)||hI(o)||gI(o)||xI()}function mI(o){if(Array.isArray(o))return vc(o)}function hI(o){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(o))return Array.from(o)}function gI(o,e){if(o){if(typeof o=="string")return vc(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return vc(o,e)}}function vc(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function xI(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var yI=Object.prototype.toString,fs=new fo;fs.useLongestToken=!0;fs.tokenize=kc.tokenize;fs.castInput=function(o){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,n=r===void 0?function(a,s){return typeof s=="undefined"?t:s}:r;return typeof o=="string"?o:JSON.stringify(Sc(o,null,null,n),n,"  ")};fs.equals=function(o,e){return fo.prototype.equals.call(fs,o.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function Sc(o,e,t,r,n){e=e||[],t=t||[],r&&(o=r(n,o));var a;for(a=0;a<e.length;a+=1)if(e[a]===o)return t[a];var s;if(yI.call(o)==="[object Array]"){for(e.push(o),s=new Array(o.length),t.push(s),a=0;a<o.length;a+=1)s[a]=Sc(o[a],e,t,r,n);return e.pop(),t.pop(),s}if(o&&o.toJSON&&(o=o.toJSON()),Yi(o)==="object"&&o!==null){e.push(o),s={},t.push(s);var i=[],f;for(f in o)o.hasOwnProperty(f)&&i.push(f);for(i.sort(),a=0;a<i.length;a+=1)f=i[a],s[f]=Sc(o[f],e,t,r,f);e.pop(),t.pop()}else s=o;return s}var Lc=new fo;Lc.tokenize=function(o){return o.slice()};Lc.join=Lc.removeEmpty=function(o){return o};function Rg(o,e,t,r,n,a,s){s||(s={}),typeof s.context=="undefined"&&(s.context=4);var i=cI(t,r,s);if(!i)return;i.push({value:"",lines:[]});function f(_){return _.map(function(D){return" "+D})}for(var c=[],d=0,p=0,h=[],y=1,g=1,v=function(D){var F=i[D],S=F.lines||F.value.replace(/\n$/,"").split(`
`);if(F.lines=S,F.added||F.removed){var P;if(!d){var H=i[D-1];d=y,p=g,H&&(h=s.context>0?f(H.lines.slice(-s.context)):[],d-=h.length,p-=h.length)}(P=h).push.apply(P,_c(S.map(function(q){return(F.added?"+":"-")+q}))),F.added?g+=S.length:y+=S.length}else{if(d)if(S.length<=s.context*2&&D<i.length-2){var R;(R=h).push.apply(R,_c(f(S)))}else{var V,O=Math.min(S.length,s.context);(V=h).push.apply(V,_c(f(S.slice(0,O))));var te={oldStart:d,oldLines:y-d+O,newStart:p,newLines:g-p+O,lines:h};if(D>=i.length-2&&S.length<=s.context){var ve=/\n$/.test(t),ne=/\n$/.test(r),fe=S.length==0&&h.length>te.oldLines;!ve&&fe&&t.length>0&&h.splice(te.oldLines,0,"\\ No newline at end of file"),(!ve&&!fe||!ne)&&h.push("\\ No newline at end of file")}c.push(te),d=0,p=0,h=[]}y+=S.length,g+=S.length}},b=0;b<i.length;b++)v(b);return{oldFileName:o,newFileName:e,oldHeader:n,newHeader:a,hunks:c}}var $g=require("obsidian");var Ji=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var ji=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let n=0,a=0;for(let s=0;s<r.lines.length;s+=1){let i=r.lines[s];if(i.startsWith("+")||i.startsWith("-")){let f=s,c=f;for(;c<r.lines.length-1&&(r.lines[c+1].startsWith("+")||r.lines[c+1].startsWith("-"));)c+=1;let d=r.lines.slice(f,c+1).filter(h=>h.startsWith("-")).map(h=>h.slice(1)),p=r.lines.slice(f,c+1).filter(h=>h.startsWith("+")).map(h=>h.slice(1));t.push(new Ji({file1Start:r.oldStart+f-a-1,file2Start:r.newStart+f-n-1,file1Lines:d,file2Lines:p})),n+=d.length,a+=p.length,s+=c-f}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function Cc(o){let e=o.fullText.split(`
`);return e.splice(o.position,0,o.newLine),e.join(`
`)}function us(o){let e=o.fullText.split(`
`);return o.newLine===""?e.splice(o.position,o.linesToReplace):e.splice(o.position,o.linesToReplace,o.newLine),e.join(`
`)}function cs(o){let e=o.fullText.split(`
`);return e.splice(o.position,o.count),e.join(`
`)}function ma(o){return o!==""?o:"\u200E"}var Ir=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var Oo=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var Ac=require("obsidian");var Ug=Fa(Og());function Zi(o,e){let t=o.getText("contents"),r=t.toString(),n=new Ug.diff_match_patch,a=n.diff_main(r,e);n.diff_cleanupSemantic(a);let s=0,i=ae("[updateYDocFromDiskBuffer]","debug");i("Updating YDoc:"),i("Current content length:",r.length),i("Disk buffer length:",e.length),a.length!=0&&(o.transact(()=>{for(let[f,c]of a)switch(f){case 1:i(`Inserting "${c}" at position ${s}`),t.insert(s,c),s+=c.length;break;case 0:i(`Keeping "${c}" (length: ${c.length})`),s+=c.length;break;case-1:i(`Deleting "${c}" at position ${s}`),t.delete(s,c.length);break}}),i("Update complete. New content length:",t.toString().length))}var Xi=class{constructor(e,t,r){this.loginManager=e;this.timeProvider=t;this.sharedFolders=r;this.subscriptions=[];this.downloadQueue=[];this.log=ae("[BackgroundSync]","log");this.debug=ae("[BackgroundSync]","debug");this.error=ae("[BackgroundSync]","error");Nt.set(this,"BackgroundSync")}enqueueDownload(e){this.downloadQueue.push(e)}async downloadItem(e){var s;let t=e.s3rn;this.log("[downloadItem]",`${Br.encode(t)}`);let r;if(t instanceof vr)r=t.documentId;else if(t instanceof ar)r=t.folderId;else throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let n={Authorization:`Bearer ${(s=this.loginManager.user)==null?void 0:s.token}`},a=await(0,Ac.requestUrl)({url:`https://api.system3.md/relay/${t.relayId}/doc/${r}/as-update`,method:"GET",headers:n});return a.status===200?this.debug("[downloadItem]",r,a.status):this.error("[downloadItem]",r,a.status,a.text),a}async uploadItem(e){var i;let t=e.s3rn;this.log("[uploadItem]",`${Br.encode(t)}`);let r;if(t instanceof vr)r=t.documentId;else if(t instanceof ar)r=t.folderId;else throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let n={Authorization:`Bearer ${(i=this.loginManager.user)==null?void 0:i.token}`,"Content-Type":"application/octet-stream"},a=nn(e.ydoc),s=await(0,Ac.requestUrl)({url:`https://api.system3.md/relay/${t.relayId}/doc/${r}/update`,method:"POST",headers:n,body:a.buffer,throw:!1});return s.status===200?this.debug("[uploadItem]",r,s.status,s.text):this.error("[uploadItem]",r,s.status,s.text),s}async getDocument(e){try{let t=e.text,r="";try{r=await e.sharedFolder.read(e)}catch(d){}let n=t.trim()===r.trim(),a=r!=="",i=(await this.downloadItem(e)).arrayBuffer,f=new Uint8Array(i),c=new tr;if(To(c,f),!c.getText("contents").toString()&&a){this.log("[getDocument] server contents empty document, not overwriting local file.");return}if(this.log("[getDocument] got content from server"),To(e.ydoc,f),a&&!n){this.log("Skipping flush - file requires merge conflict resolution.");return}e.sharedFolder.flush(e,e.text)}catch(t){console.error(t);return}}async putDocument(e){try{let t=await this.uploadItem(e);if(t.status!==200)throw new Error(`Failed to upload document: ${t.status} ${t.text}`)}catch(t){console.error(t);return}}async putFolderFiles(e){await e.whenReady(),this.log("[putFolderFiles]",`Uploading ${e.docset.size} items`);let t=1;for(let r of e.docset.items())await r.whenReady(),r.text&&await this.uploadItem(r),this.log("[putFolderFiles]",`${t}/${e.docset.size}`),t++}async getFolder(e){let r=(await this.downloadItem(e)).arrayBuffer,n=new Uint8Array(r);To(e.ydoc,n)}async getFolderFiles(e){await e.whenReady(),this.log("[getFolderFiles]",`Downloading ${e.docset.size} files`);let t=1;for(let r of e.docset.items())await this.getDocument(r),this.log("[getFolderFiles]",`${t}/${e.docset.size}`),t++}destroy(){this.loginManager=null,this.sharedFolders=null,this.subscriptions.forEach(e=>e()),this.downloadQueue=[]}};var Qi=class{constructor(e){this.difference=e.difference,this.file1=e.file1,this.file2=e.file2,this.file1Content=e.file1Content,this.file2Content=e.file2Content,this.triggerRebuild=e.triggerRebuild}async modify(e,t){if(e instanceof Po){Zi(e.ydoc,t);return}else if(e instanceof Eo){e.contents=t;return}await app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,n=this.difference.file2Lines.length>0;n&&r?(new Ir({text:"Accept Top",onClick:a=>this.acceptTopClick(a,this.difference)}).build(t),Oo.build(t),new Ir({text:"Accept Bottom",onClick:a=>this.acceptBottomClick(a,this.difference)}).build(t),Oo.build(t),new Ir({text:"Accept All",onClick:a=>this.acceptAllClick(a,this.difference)}).build(t),Oo.build(t),new Ir({text:"Accept None",onClick:a=>this.acceptNoneClick(a,this.difference)}).build(t)):r?(new Ir({text:`Accept from ${this.file1.name}`,onClick:a=>this.insertFile1Difference(a,this.difference)}).build(t),Oo.build(t),new Ir({text:"Discard",onClick:a=>this.discardFile1Difference(a,this.difference)}).build(t)):n&&(new Ir({text:`Accept from ${this.file2.name}`,onClick:a=>this.insertFile2Difference(a,this.difference)}).build(t),Oo.build(t),new Ir({text:"Discard",onClick:a=>this.discardFile2Difference(a,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=us({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=us({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),n=us({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n);let a=us({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,a),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=cs({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let n=cs({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=Cc({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=Cc({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,n),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=cs({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=cs({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var ga="system3-differences-view";async function Bg(o,e){o.detachLeavesOfType(ga);let t=o.getLeaf(!0);t.setViewState({type:ga,active:!0,state:e}),o.revealLeaf(t)}var el=class extends $g.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[];this.registerEvent(this.app.vault.on("modify",async r=>{var n,a;r!==((n=this.state)==null?void 0:n.file1)&&r!==((a=this.state)==null?void 0:a.file2)||(await this.updateState(),this.build())}))}async getContent(t){return t instanceof Po?t.text:t instanceof Eo?t.contents:await this.app.vault.cachedRead(t)}getViewType(){return ga}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}async updateState(){var r,n;if(((r=this.state)==null?void 0:r.file1)==null||((n=this.state)==null?void 0:n.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(a=>a.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(a=>a.trimEnd());let t=Rg(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));this.fileDifferences=ji.fromParsedDiff(t),this.fileDifferences.differences.length===0&&this.leaf.detach()}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildLines(t),this.scrollToFirstDifference()}buildLines(t){var s,i,f;let r=0,n=0,a=Math.max(((s=this.file1Lines)==null?void 0:s.length)||0,((i=this.file2Lines)==null?void 0:i.length)||0);for(;r<=a||n<=a;){let c=(f=this.fileDifferences)==null?void 0:f.differences.find(d=>d.file1Start===r&&d.file2Start===n);if(c!=null){let d=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(d,c),r+=c.file1Lines.length,n+=c.file2Lines.length}else{let d=r<=n?this.file1Lines[r]:this.file2Lines[n];t.createDiv({text:ma(d),cls:"file-diff__line"}),r+=1,n+=1}}}buildDifferenceVisualizer(t,r){var n;(n=this.state)!=null&&n.showMergeOption&&new Qi({difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.build()}}).build(t);for(let a=0;a<r.file1Lines.length;a+=1){let s=r.file1Lines[a],i=r.file2Lines[a],f=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),c=this.buildDiffLine(s,i,"file-diff_top-line__character");(a<r.file1Lines.length-1||r.file2Lines.length!==0)&&f.classList.add("file-diff__no-bottom-border"),a!==0&&f.classList.add("file-diff__no-top-border"),f.appendChild(c)}for(let a=0;a<r.file2Lines.length;a+=1){let s=r.file1Lines[a],i=r.file2Lines[a],f=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),c=this.buildDiffLine(i,s,"file-diff_bottom-line__character");(a==0&&r.file1Lines.length>0||a>0)&&f.classList.add("file-diff__no-top-border"),a<r.file2Lines.length-1&&f.classList.add("file-diff__no-bottom-border"),f.appendChild(c)}}buildDiffLine(t,r,n){let a=document.createElement("div");if(t!=null&&t.length===0)a.textContent=ma(t);else if(t!=null&&r!=null){let s=Fg(r,t);for(let i of s){if(i.removed)continue;let f=document.createElement("span");f.textContent=ma(i.value),i.added&&f.classList.add(n),a.appendChild(f)}}else if(t!=null&&r==null){let s=document.createElement("span");s.textContent=ma(t),s.classList.add(n),a.appendChild(s)}else a.textContent=ma(t);return a}scrollToFirstDifference(){var n;if(((n=this.fileDifferences)==null?void 0:n.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var _I=3;function Tc(o,e){o.iterateAllLeaves(t=>{t.view instanceof Uo.MarkdownView&&e(t.view)})}function vI(o,e){var t,r,n,a;if(o.length!==e.length)return!1;for(let s=0;s<o.length;s++)if(((t=o[s].view.file)==null?void 0:t.path)!==((r=e[s].view.file)==null?void 0:r.path)||((n=o[s].document)==null?void 0:n.path)!==((a=e[s].document)==null?void 0:a.path))return!1;return!0}var Dc=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new da(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){this.release(),this.banner=void 0,this.view=null}};function pa(o){return o instanceof Ro&&o.document!==void 0&&o.document.text!==void 0}var Ro=class{constructor(e,t,r,n=!0,a=!0){this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=n,this.canConnect=a,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}mergeBanner(){return this._banner=new da(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer(),this.view.requestSave()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new da(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Ig({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)&&this.document.text?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){return this.setConnectionDot(),new Promise(e=>this.document.whenReady().then(t=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t;(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.document.disconnect()}destroy(){this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.document=null}},tl=class{constructor(e,t,r,n){this.app=e;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=n,this.refreshQueue=[],this._compartment=new rl.Compartment,this.log=ae("[LiveViews]","log"),this.warn=ae("[LiveViews]","warn"),this.metadataListeners=new Map;let a=(f,c,d)=>{let p=this.metadataListeners.get(f);p==null||p(c,d)},s=this.app.metadataCache.on("changed",a);this.offListeners.push(()=>{this.app.metadataCache.offref(s)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let i=f=>(f.ready||(async()=>f.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(c=>{this.views.forEach(d=>{var p;((p=d.document)==null?void 0:p.sharedFolder)===f&&d.offlineBanner()})}))(),f.docset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.subscribe(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((f,c)=>{this.sharedFolders.has(c)||(f(),this.folderListeners.delete(c))}),this.sharedFolders.forEach(f=>{this.folderListeners.has(f)||this.folderListeners.set(f,i(f))})})),Nt.set(this,"LiveViewManager")}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([Fo.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){Bg(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return Tc(this.workspace,t=>{var a;let r=(a=t.file)==null?void 0:a.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if(Tc(this.workspace,r=>{var s;let n=(s=r.file)==null?void 0:s.path;if(!n)return;let a=this.sharedFolders.lookup(n);a&&e.add(a)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}getViews(){let e=[];return Tc(this.workspace,t=>{var a;let r=(a=t.file)==null?void 0:a.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let s=n.getFile(r,!0,!0,!0),i=new Ro(this,t,s);e.push(i)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let s=new Dc(this,t,()=>this.loginManager.openLoginPage());e.push(s)}}),e}findView(e){return this.views.find(t=>t.view.editor.cm===e)}async viewsReady(e){return await Promise.all(e.filter(t=>t instanceof Ro).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=_I){let r=this.workspace.getActiveViewOfType(Uo.MarkdownView),n=0,a=e.sort((i,f)=>f.view.leaf.activeTime-i.view.leaf.activeTime),s=new Set;for(let i of a)i instanceof Ro&&(i.view===r||s.has(i.document)?(i.canConnect=!0,s.add(i.document)):n<t?(i.canConnect=!0,s.add(i.document),n++):i.canConnect=!1);return n>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${n-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(n=>{let a=e.find(s=>{if(n.document==s.document&&n.view==s.view)return!0});a?(r.push(n),e.remove(a)):t.push(n)}),e.forEach(n=>{r.push(n)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,n=ae(r,"debug"),a=(p,h)=>{n(p,h.map(y=>{var g;return{type:y.constructor.name,file:(g=y.document)==null?void 0:g.path,canConnect:y.canConnect}}))};n("Refresh"),await this.foldersReady();let s=[];try{s=this.getViews()}catch(p){return this.warn("[System 3][Relay][Live Views] error getting views",p),!1}let i=this.findFolders();if(i.length===0&&s.length===0)return this.extensions.length!==0&&(n("Unexpected plugins loaded."),this.wipe()),a("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?i.forEach(p=>{p.connect()}):this.sharedFolders.forEach(p=>{p.disconnect()});let[f,c]=this.deduplicate(s);if(a("Releasing Views",c),this.releaseViews(c),c.length===0&&vI(f,this.views)){let p=await this.viewsAttachedWithConnectionPool(this.views);a("Attached Views",p)}else{let p=await this.viewsReady(f);a("Ready Views",p);let h=await this.viewsAttachedWithConnectionPool(p);a("Attached Views",h),this.views=f}n("loading plugins"),this.load();let d=Uo.moment.utc();return n(`refresh completed in ${d.diff(t)}ms`,r),!0}async refresh(e,t=3e3){let r=ae(e,"warn"),n=Uo.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,n)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;)this.refreshQueue.length>2&&(r("refreshQueue size:",this.refreshQueue.length),this.refreshQueue.slice(-2)),Uo.Platform.isIosApp?(this._activePromise=this.refreshQueue.pop()().finally(()=>{this._activePromise=null}),await this._activePromise):(this._activePromise=Fi("Refresh Views",this.refreshQueue.pop()(),t).catch(a=>{if(a instanceof ln)return this.warn(`[System 3][Relay][Live Views] refresh views timed out... timeout=${t}`,a),this._activePromise=null,!1;throw console.error(a),a}).finally(()=>{this._activePromise=null}),await this._activePromise);return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(Fo.init(()=>this)),Cg,Ag,Tg,Eg]),this.workspace.updateOptions())}destroy(){this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null,this.loginManager=null,this.app=null,this.workspace=null}},Fo=rl.StateField.define({create(o){},update(o,e){return o}});var xa=require("obsidian");function SI(o){Ie(o,"svelte-3npei9",".folder-icons.svelte-3npei9{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05)}.icon.svelte-3npei9{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-3npei9{color:var(--color-accent)}span.system3-disconnected.svelte-3npei9{color:var(--color-base-40)}span.notebook.svelte-3npei9{color:var(--color-accent)}span.hidden.svelte-3npei9{display:none}")}function LI(o){let e,t,r;return t=new io({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=E("span"),N(t.$$.fragment),L(e,"class","notebook icon svelte-3npei9"),L(e,"aria-label","Tracking Changes")},m(n,a){C(n,e,a),U(t,e,null),r=!0},p:Y,i(n){r||(I(t.$$.fragment,n),r=!0)},o(n){T(t.$$.fragment,n),r=!1},d(n){n&&k(e),$(t)}}}function II(o){let e,t,r,n,a,s,i,f;return t=new io({props:{class:"inline-icon",style:"width: 0.8em"}}),a=new dn({props:{class:"inline-icon"}}),{c(){e=E("span"),N(t.$$.fragment),r=W(),n=E("span"),N(a.$$.fragment),L(e,"class","notebook icon hidden svelte-3npei9"),L(e,"aria-label","Tracking Changes"),L(n,"class",s="satellite icon system3-"+o[0]+" svelte-3npei9"),L(n,"aria-label",i=`${o[1].relay.name} (${o[0]})`)},m(c,d){C(c,e,d),U(t,e,null),C(c,r,d),C(c,n,d),U(a,n,null),f=!0},p(c,d){(!f||d&1&&s!==(s="satellite icon system3-"+c[0]+" svelte-3npei9"))&&L(n,"class",s),(!f||d&3&&i!==(i=`${c[1].relay.name} (${c[0]})`))&&L(n,"aria-label",i)},i(c){f||(I(t.$$.fragment,c),I(a.$$.fragment,c),f=!0)},o(c){T(t.$$.fragment,c),T(a.$$.fragment,c),f=!1},d(c){c&&(k(e),k(r),k(n)),$(t),$(a)}}}function kI(o){let e,t,r,n,a=[II,LI],s=[];function i(f,c){return f[1]?0:1}return t=i(o,-1),r=s[t]=a[t](o),{c(){e=E("div"),r.c(),L(e,"class","folder-icons svelte-3npei9")},m(f,c){C(f,e,c),s[t].m(e,null),n=!0},p(f,[c]){let d=t;t=i(f,c),t===d?s[t].p(f,c):(Se(),T(s[d],1,1,()=>{s[d]=null}),Le(),r=s[t],r?r.p(f,c):(r=s[t]=a[t](f),r.c()),I(r,1),r.m(e,null))},i(f){n||(I(r),n=!0)},o(f){T(r),n=!1},d(f){f&&k(e),s[t].d()}}}function CI(o,e,t){let{status:r="disconnected"}=e,{remote:n}=e;return o.$$set=a=>{"status"in a&&t(0,r=a.status),"remote"in a&&t(1,n=a.remote)},[r,n]}var Ec=class extends j{constructor(e){super(),X(this,e,CI,kI,J,{status:0,remote:1},SI)}},Ng=Ec;function AI(o){let e,t,r;return{c(){e=E("div"),t=E("span"),r=ee(o[0]),L(e,"class","nav-file-tag system3-filepill")},m(n,a){C(n,e,a),M(e,t),M(t,r)},p(n,[a]){a&1&&ie(r,n[0])},i:Y,o:Y,d(n){n&&k(e)}}}function TI(o,e,t){let{text:r}=e;return o.$$set=n=>{"text"in n&&t(0,r=n.text)},[r]}var Pc=class extends j{constructor(e){super(),X(this,e,TI,AI,J,{text:0})}},Hg=Pc;var Mc=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,n)=>{for(let a of r)a.type==="childList"&&e.nextSibling&&(t(e),n.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},ya=class{visitFolder(e,t,r,n){return null}visitFile(e,t,r,n){return null}},Fc=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new Mc(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},Rc=class extends ya{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new Fc(t.selfEl,n):(r&&r.destroy(),null)}},Oc=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.el.addClass("system3-pill"),this.pill=new Ng({target:this.el,props:{status:this.sharedFolder.state.status,remote:this.sharedFolder.remote}}),this.unsubscribe=this.sharedFolder.subscribe(this.el,r=>{this.pill.$set({status:r.status,remote:this.sharedFolder.remote})})}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},Uc=class extends ya{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new Oc(t.selfEl,n):(r&&r.destroy(),null)}},$c=class{constructor(e,t){this.el=e;this.doc=t;this.el.querySelectorAll(".system3-filepill").forEach(n=>{n.remove()}),this.pill=new Hg({target:this.el,props:{text:`${t.guid.slice(0,3)} ${t.dbsize}`}});let r=()=>{this.pill.$set({text:`${t.guid.slice(0,3)} ${t.dbsize} ${t._hasKnownPeers?"!":""}`})};t.ydoc.on("update",r),t.hasKnownPeers().then(n=>{r()}),this.unsubscribe=()=>{t.ydoc.off("update",r)}}destroy(){var e;this.pill.$destroy(),(e=this.unsubscribe)==null||e.call(this),this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()})}},Bc=class extends ya{visitFile(e,t,r,n){if(n&&n.ready){let a=n.getFile(e.path,!1,!1);return a?r||new $c(t.selfEl,a):null}return r&&r.destroy(),null}},Nc=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,n=>{this.docStatus(n)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},Hc=class extends ya{visitFile(e,t,r,n){if(n)try{let a=n.ids.get(n.getVirtualPath(e.path));if(!a)return null;let s=n.docs.get(a);return s?r||new Nc(t.el,s,e):null}catch(a){return null}return r&&r.destroy(),null}},ol=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let n of this.visitors)this.storage.set(n,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(a=>a.path===e.path)||t,n=this.getFileExplorerItem(this.fileExplorer,e);n&&this.storage.forEach((a,s)=>{let i=a.get(n),f=s.visitFolder(e,n,i,r);i&&!f?a.delete(n):f&&a.set(n,f)}),e.children.forEach(a=>{if(a instanceof xa.TFolder)this.walk(a,r);else if(a instanceof xa.TFile){let s=this.getFileExplorerItem(this.fileExplorer,a);this.storage.forEach((i,f)=>{let c=i.get(s),d=f.visitFile(a,s,c,r);c&&!d?i.delete(s):d&&i.set(s,d)})}})}destory(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},nl=class{constructor(e,t,r){this.layoutReady=!1;this.vault=e,this.workspace=t,this.sharedFolders=r,this.treeState=new Map,this.workspace.onLayoutReady(()=>{this.layoutReady=!0,this.refresh()}),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(n=>{lg([ir.enableDocumentStatus,ir.enableDebugFileTag],()=>{this.offDocumentListeners.get(n)||this.offDocumentListeners.set(n,n.docset.on(()=>{this.refresh()}))})}),this.refresh()}),this.offLayoutChange=(()=>{let n=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(n)}})()}makeVisitors(){let e=[];return e.push(new Rc),e.push(new Uc),Nr(ir.enableDocumentStatus,()=>{e.push(new Hc)}),Nr(ir.enableDebugFileTag,()=>{e.push(new Bc)}),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let n=this.treeState.get(r)||new ol(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,n);for(let a of t){let s=this.vault.getAbstractFileByPath(a);s instanceof xa.TFolder&&n.walk(s)}}}refresh(){if(!this.layoutReady)return;let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new ol(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let n=this.vault.getAbstractFileByPath("/");n instanceof xa.TFolder&&r.walk(n)}}destroy(){this.offFolderListener(),this.offDocumentListeners.forEach(e=>e()),this.offDocumentListeners.clear(),this.treeState.forEach(e=>{e.destory()}),this.treeState.clear(),this.offLayoutChange(),this.vault=null,this.workspace=null,this.sharedFolders=null}};var ty=require("obsidian");function lt(o,e,t,r){function n(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function i(d){try{c(r.next(d))}catch(p){s(p)}}function f(d){try{c(r.throw(d))}catch(p){s(p)}}function c(d){d.done?a(d.value):n(d.value).then(i,f)}c((r=r.apply(o,e||[])).next())})}var $o=require("obsidian");function DI(o){let e,t,r;return{c(){e=Hr("svg"),t=Hr("g"),r=Hr("path"),L(r,"d","M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"),L(r,"fill","#5865F2"),L(r,"fill-rule","nonzero"),L(e,"width",o[0]),L(e,"height",o[0]),L(e,"viewBox","0 -28.5 256 256"),L(e,"version","1.1"),L(e,"xmlns","http://www.w3.org/2000/svg"),L(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),L(e,"preserveAspectRatio","xMidYMid")},m(n,a){C(n,e,a),M(e,t),M(t,r)},p(n,[a]){a&1&&L(e,"width",n[0]),a&1&&L(e,"height",n[0])},i:Y,o:Y,d(n){n&&k(e)}}}function EI(o,e,t){let{size:r="1em"}=e;return o.$$set=n=>{"size"in n&&t(0,r=n.size)},[r]}var Vc=class extends j{constructor(e){super(),X(this,e,EI,DI,J,{size:0})}},al=Vc;function PI(o){Ie(o,"svelte-4t8k3t",`.menu-container.svelte-4t8k3t{display:inline-block;position:relative}.menu-button.svelte-4t8k3t{box-shadow:none;padding:8px;border:none;background:transparent;color:var(--text-muted)}.menu-button.svelte-4t8k3t:hover{color:var(--icon-color-hover)}.menu-button.svelte-4t8k3t:focus{color:var(--icon-color-focus)}.menu-dropdown.svelte-4t8k3t{position:absolute;right:0;margin-top:8px;width:224px;background:var(--color-base-10);border-radius:6px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);border:1px solid rgba(0, 0, 0, 0.1)}.arrow.svelte-4t8k3t{position:absolute;top:-5px;right:12px;width:10px;height:10px;background:var(--color-base-10);border-left:1px solid rgba(0, 0, 0, 0.1);border-top:1px solid rgba(0, 0, 0, 0.1);transform:rotate(45deg)}.menu-content.svelte-4t8k3t{display:flex;flex-direction:column;gap:8px;padding:8px}.menu-item.svelte-4t8k3t{display:flex;width:100%;align-items:center;gap:12px;padding:8px;border-radius:4px;text-decoration:none;color:var(--text-muted);transition:background-color 0.2s;font-size:14px}.menu-item.svelte-4t8k3t:hover{background-color:var(--background-modifier-hover)}.menu-item.svelte-4t8k3t:focus{background-color:var(--background-modifier-hover)}`)}function Vg(o){let e,t,r,n,a,s,i,f,c,d,p,h,y;return i=new al({props:{size:20}}),{c(){e=E("div"),t=E("div"),r=W(),n=E("div"),a=E("span"),s=E("a"),N(i.$$.fragment),f=W(),c=E("span"),c.textContent="Join the community",L(t,"class","arrow svelte-4t8k3t"),L(s,"href","https://discord.system3.md"),L(s,"target","_blank"),L(s,"rel","noopener noreferrer"),L(s,"class","menu-item svelte-4t8k3t"),le(a,"text-align","center"),le(a,"display","flex"),L(n,"class","menu-content svelte-4t8k3t"),L(e,"class","menu-dropdown svelte-4t8k3t")},m(g,v){C(g,e,v),M(e,t),M(e,r),M(e,n),M(n,a),M(a,s),U(i,s,null),M(s,f),M(s,c),p=!0,h||(y=cg(d=o[1].call(null,e)),h=!0)},i(g){p||(I(i.$$.fragment,g),p=!0)},o(g){T(i.$$.fragment,g),p=!1},d(g){g&&k(e),$(i),h=!1,y()}}}function MI(o){let e,t,r,n,a,s,i;r=new fc({props:{size:"20px"}});let f=o[0]&&Vg(o);return{c(){e=E("div"),t=E("button"),N(r.$$.fragment),n=W(),f&&f.c(),L(t,"class","menu-button svelte-4t8k3t"),L(e,"class","menu-container svelte-4t8k3t")},m(c,d){C(c,e,d),M(e,t),U(r,t,null),M(e,n),f&&f.m(e,null),a=!0,s||(i=Q(t,"click",gg(o[2])),s=!0)},p(c,[d]){c[0]?f?d&1&&I(f,1):(f=Vg(c),f.c(),I(f,1),f.m(e,null)):f&&(Se(),T(f,1,1,()=>{f=null}),Le())},i(c){a||(I(r.$$.fragment,c),I(f),a=!0)},o(c){T(r.$$.fragment,c),T(f),a=!1},d(c){c&&k(e),$(r),f&&f.d(),s=!1,i()}}}function FI(o,e,t){let r=!1;function n(s){let i=f=>{let c=document.querySelector(".menu-button");!s.contains(f.target)&&f.target!==c&&!(c!=null&&c.contains(f.target))&&t(0,r=!1)};return setTimeout(()=>{document.addEventListener("click",i)},0),{destroy(){document.removeEventListener("click",i)}}}function a(s){s.stopPropagation(),t(0,r=!r)}return[r,n,a]}var Wc=class extends j{constructor(e){super(),X(this,e,FI,MI,J,{},PI)}},Wg=Wc;function RI(o){Ie(o,"svelte-ycfe1d",".relay-text.svelte-ycfe1d{fill:var(--text-normal)}")}function OI(o){let e,t;return{c(){e=Hr("svg"),t=Hr("path"),L(t,"d","m112.88679 65.94517c-1.8219-.6498-2.8316-1.9996-2.8205-3.7707.019-2.9692 4.2679-9.1564 8.5532-12.4538.8896-.6846 3.2865-2.0796 5.3264-3.1002l3.7089-1.8555 1.1034-2.1157c.6069-1.1636 1.0788-2.1403 1.0487-2.1704-.03-.03-.7517.2969-1.6037.7266-1.7893.9026-3.4923 1.0179-5.6348.3816-1.2664-.376-2.6971-1.5724-3.0511-2.5512-.1036-.2865-.2262-.2926-.6259-.031-1.6133 1.0551-3.9805 2.2931-5.3124 2.7783-3.2045 1.1672-7.1579.5507-8.5509-1.3335l-.5903-.7983-1.2238.7491c-3.1246 1.9126-7.5052 2.5576-9.6905 1.4268-1.3209-.6835-2.1336-1.8529-2.3663-3.405-.099-.6587-.2706-1.1976-.3819-1.1976-.1112 0-.4909.3082-.8437.685-1.1393 1.2168-4.3891 3.211-6.2437 3.8314-4.3168 1.4441-8.0424.1949-8.8532-2.9684-.1823-.7114-.3977-1.2593-.4786-1.2177-8.2088 4.2188-13.1666 5.5617-17.3451 4.6983-7.2318-1.4943-8.5363-7.633-3.2721-15.3969 3.43-5.0586 8.1226-8.1393 12.5368-8.2303 4.2661-.088 6.1851 2.8612 4.6067 7.0798-1.4639 3.9129-6.6553 7.7738-11.3995 8.4781l-1.2322.183-.173.9219c-.2449 1.3054.055 2.3726.8414 2.9909 1.4773 1.162 5.3481.4499 9.169-1.6869 4.0877-2.286 9.2494-6.7459 10.2254-8.8353 2.1729-4.6512 10.3391-19.4528 12.6199-22.8741 1.9649-2.9472 2.9544-3.913 4.6877-4.575 2.2454-.8575 3.8556.1204 3.8556 2.3418 0 1.0627-.8749 2.8756-5.2398 10.8581-4.5459 8.3134-10.5554 20.346-10.9601 21.9446-.372 1.4696-.093 1.8547 1.0954 1.5137 3.1691-.9088 8.5727-5.615 10.728-9.3431 3.192-5.5215 7.5241-8.5901 12.516-8.8657 1.3396-.074 2.6532.01 3.3914.2166 1.585.4437 3.5318 2.2009 3.7762 3.4083.1003.4954.3584.9822.5736 1.0817 1.6112.7453 1.9862 1.0047 2.0682 1.4307.051.2665-.9529 2.6236-2.2318 5.238-1.8799 3.8432-2.328 4.9899-2.3404 5.9886l-.015 1.2352.9261.077c1.132.094 3.2883-1.1349 5.6894-3.243 2.3304-2.0459 3.4794-3.659 6.2257-8.7403 1.3371-2.4739 2.6529-4.8096 2.924-5.1906.7068-.9931 1.8337-1.3742 3.6712-1.2413 1.7839.1291 2.6563.7039 2.6563 1.7502 0 .3631-1.6536 3.8273-3.6747 7.698-3.6147 6.9231-4.2241 8.2285-3.8408 8.2285.3864 0 2.6593-1.4351 4.2082-2.6571 2.9724-2.3449 4.1289-3.8334 6.7129-8.64 3.2167-5.9836 4.0513-6.6961 7.4599-6.3685 1.5037.1444 2.3637.7781 2.3637 1.7416 0 .6971-3.7642 8.1283-7.3844 14.5783-1.1774 2.0975-2.1406 3.9288-2.1406 4.0695 0 1.0032 6.4569-2.0079 10.373-4.8373 1.75083-1.265 2.80833-1.8553 3.32363-1.8553.8396 0 1.9138.8456 1.9138 1.5065 0 1.6136-6.83683 5.3607-15.31743 8.3952l-3.0144 1.0785-3.1147 4.959c-6.6125 10.5277-11.2414 15.4863-16.0267 17.1682-1.6492.5797-2.5036.6042-3.8855.1114zm3.4676-4.0874c2.3533-1.2035 5.0029-4.3759 7.0335-8.4211 1.4729-2.9341 1.2858-3.2801-1.0497-1.9405-2.6054 1.4944-6.0792 5.1835-7.6115 8.0833-1.3391 2.5343-.6792 3.458 1.6277 2.2783zm-13.7433-25.7067c2.0798-1.3888 2.707-2.2251 5.1929-6.9235 1.1337-2.1427 2.4702-4.3736 2.9701-4.9576.4999-.5839.8343-1.1823.7432-1.3297-.3028-.49-1.5733-.2724-2.9201.5001-3.9 2.237-10.6318 12.1845-9.2087 13.6076.4489.4489 1.7491.087 3.2226-.8969zm-39.6413-6.7383c1.4951-.7532 3.4914-2.3885 4.373-3.5822.8778-1.1886.8303-2.7169-.089-2.8472-.9504-.1348-2.84 1.147-4.3353 2.9408-1.4368 1.7237-2.8652 3.8321-2.8652 4.2293 0 .3431 1.5421-.048 2.916-.7407zm-15.7519 34.9397c-7.7618-1.6901-14.6809-7.6649-17.3519-14.9834-1.0082-2.7626-2.5946-8.8926-3.6898-14.2584-.7621-3.7334-1.4567-5.8195-2.0623-6.1938-.1258-.078-.173.4384-.1049 1.147l.1238 1.2883-2.6916 5.648c-3.9954 8.3841-5.3958 10.566-7.4555 11.6168-1.4222.7256-3.7417.6896-5.2712-.082-1.0729-.541-1.1779-.6797-1.1514-1.5213.017-.5465.8143-2.6067 1.945-5.0271 3.1568-6.7568 12.4018-25.1754 13.3068-26.5105 1.1089-1.6358 2.3136-2.186 4.3772-1.9989 1.8988.1722 3.7575 1.0556 3.7575 1.7858 0 .685-.9801 3.23-2.4839 6.4499-.6712 1.437-1.2203 2.6574-1.2203 2.712 0 .2508 2.423.059 3.8048-.3005 2.1083-.5492 3.5885-1.4764 5.2895-3.3138 2.9831-3.2221 3.5133-7.5609 1.1835-9.6842-3.8351-3.4952-12.7275-2.9971-21.5226 1.2055-6.4797 3.0962-10.7971 8.141-11.8606 13.8587-.5183 2.7868-1.354 3.618-2.8384 2.8236-2.234-1.1956-1.5337-5.997 1.651-11.3196 5.1483-8.6044 15.656-14.9768 26.6996-16.192 9.3582-1.0298 17.2345 3.5198 17.8697 10.322.3469 3.7147-1.5827 8.0493-5.1855 11.6487-2.6104 2.6078-4.969 3.9861-7.9877 4.6679l-1.94.4381.8512.2875c1.5709.5307 1.8619 1.0923 3.1019 5.988 2.5245 9.9665 4.9471 14.9264 9.4592 19.3659 6.055 5.9576 14.0611 6.1192 19.4354.3922.7131-.7598 2.2084-2.7055 3.323-4.3238 1.1145-1.6182 2.2218-3.0172 2.4606-3.1088 2.1176-.8126 2.9615 1.5236 1.6137 4.4675-2.2327 4.877-6.6161 9.1629-11.4944 11.2387-4.1481 1.7652-9.8251 2.3621-13.9414 1.4657z"),L(e,"class","relay-text svelte-ycfe1d"),L(e,"width",o[0]),L(e,"height",o[1]),L(e,"viewBox","0 0 154.24573 66.293579"),L(e,"xmlns","http://www.w3.org/2000/svg")},m(r,n){C(r,e,n),M(e,t)},p:Y,i:Y,o:Y,d(r){r&&k(e)}}}function UI(o,e,t){let{size:r=64}=e,n=r,a=r/2;return o.$$set=s=>{"size"in s&&t(2,r=s.size)},[n,a,r]}var qc=class extends j{constructor(e){super(),X(this,e,UI,OI,J,{size:2},RI)}},sl=qc;function $I(o){Ie(o,"svelte-120r7kg",".subtitle.svelte-120r7kg{color:var(--text-muted);font-size:1.25rem;margin:0}.description.svelte-120r7kg{color:var(--text-muted);font-size:1rem;max-width:480px;margin:0}")}function BI(o){let e,t,r,n,a,s;return e=new sl({props:{size:140}}),{c(){N(e.$$.fragment),t=W(),r=E("p"),r.textContent="Real-time collaboration in Obsidian",n=W(),a=E("p"),a.textContent=`Share folders with your team, edit together in real time, and keep your
	knowledge library exactly how you want it.`,L(r,"class","subtitle svelte-120r7kg"),L(a,"class","description svelte-120r7kg")},m(i,f){U(e,i,f),C(i,t,f),C(i,r,f),C(i,n,f),C(i,a,f),s=!0},p:Y,i(i){s||(I(e.$$.fragment,i),s=!0)},o(i){T(e.$$.fragment,i),s=!1},d(i){i&&(k(t),k(r),k(n),k(a)),$(e,i)}}}var Kc=class extends j{constructor(e){super(),X(this,e,null,BI,J,{},$I)}},qg=Kc;var il=require("obsidian");function NI(o){Ie(o,"svelte-1kvxms3",`.help-section.svelte-1kvxms3{width:100%;padding:0 2rem;margin-bottom:2rem}.footer.svelte-1kvxms3{padding:0 2rem;margin-bottom:2rem;text-align:center}.help-container.svelte-1kvxms3{position:relative;max-width:640px;margin:0 auto}.why-google.svelte-1kvxms3:hover{background-color:transparent !important;box-shadow:none;color:var(--text-modifier-hover)}.why-google.svelte-1kvxms3{outline:0;color:var(--text-muted);font-size:0.875rem;margin:0;background-color:transparent !important;box-shadow:none;text-decoration-line:var(--link-decoration);padding:0;border:none;cursor:pointer;width:100%;text-align:left}.why-google.svelte-1kvxms3:hover{color:var(--text-normal)}.help-content.svelte-1kvxms3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1);text-align:left}.popover.svelte-1kvxms3{position:absolute;z-index:50;width:256px;padding-left:1em;padding-right:1em;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:calc(100% + 8px);text-align:left;left:50%;transform:translateX(-50%);opacity:0;visibility:hidden;transition:opacity 0.3s ease,
			visibility 0.3s ease;transition-delay:0.1s}.popover.visible.svelte-1kvxms3{opacity:1;visibility:visible}.popover.svelte-1kvxms3:not(.visible){transition-delay:0s}.arrow.svelte-1kvxms3{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px;right:40px}.discord-link.svelte-1kvxms3{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;color:var(--text-muted);font-size:0.875rem;margin:0}`)}function HI(o){let e,t,r,n;return{c(){e=E("div"),t=E("div"),r=W(),n=E("p"),n.textContent=`${zg}`,L(t,"class","arrow svelte-1kvxms3"),L(e,"class","popover svelte-1kvxms3"),it(e,"visible",o[0])},m(a,s){C(a,e,s),M(e,t),M(e,r),M(e,n),o[9](e)},p(a,s){s&1&&it(e,"visible",a[0])},d(a){a&&k(e),o[9](null)}}}function VI(o){let e,t=o[0]&&Kg(o);return{c(){t&&t.c(),e=Pe()},m(r,n){t&&t.m(r,n),C(r,e,n)},p(r,n){r[0]?t?t.p(r,n):(t=Kg(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&k(e),t&&t.d(r)}}}function Kg(o){let e,t;return{c(){e=E("div"),t=E("p"),t.textContent=`${zg}`,L(e,"class","help-content svelte-1kvxms3")},m(r,n){C(r,e,n),M(e,t)},p:Y,d(r){r&&k(e)}}}function WI(o){let e,t,r,n,a,s,i,f,c,d,p,h;function y(b,_){return b[1]?VI:HI}let g=y(o,-1),v=g(o);return f=new al({}),{c(){e=E("div"),t=E("div"),r=E("button"),r.textContent="Why sign in with Google?",n=W(),v.c(),a=W(),s=E("div"),i=E("a"),N(f.$$.fragment),c=ee(`
		Join the project on Discord`),L(r,"class","why-google svelte-1kvxms3"),it(r,"mobile",o[1]),L(t,"class","help-container svelte-1kvxms3"),L(e,"class","help-section svelte-1kvxms3"),L(i,"href","https://discord.system3.md"),L(i,"class","discord-link svelte-1kvxms3"),L(s,"class","footer svelte-1kvxms3")},m(b,_){C(b,e,_),M(e,t),M(t,r),o[8](r),M(t,n),v.m(t,null),C(b,a,_),C(b,s,_),M(s,i),U(f,i,null),M(i,c),d=!0,p||(h=[Q(r,"mouseenter",o[4]),Q(r,"mouseleave",o[5]),Q(r,"click",o[6])],p=!0)},p(b,[_]){(!d||_&2)&&it(r,"mobile",b[1]),g===(g=y(b,_))&&v?v.p(b,_):(v.d(1),v=g(b),v&&(v.c(),v.m(t,null)))},i(b){d||(I(f.$$.fragment,b),d=!0)},o(b){T(f.$$.fragment,b),d=!1},d(b){b&&(k(e),k(a),k(s)),o[8](null),v.d(),$(f),p=!1,Ce(h)}}}var zg="We require sign-in because your vault needs to communicate securely with Relay servers for syncing. An identity provider like Google helps to prevent spam accounts. We may add more sign-in options based on user feedback \u2014 let us know in Discord.";function qI(o,e,t){var r;let n=!1,a=!1,s,i;function f(){a||t(0,n=!0)}function c(){a||t(0,n=!1)}function d(){a&&t(0,n=!n)}function p(y){cr[y?"unshift":"push"](()=>{s=y,t(2,s)})}function h(y){cr[y?"unshift":"push"](()=>{i=y,t(3,i)})}return o.$$.update=()=>{if(o.$$.dirty&128){e:t(1,a=t(7,r=il.Platform===null||il.Platform===void 0?void 0:il.Platform.isMobile)!==null&&r!==void 0?r:!1)}},[n,a,s,i,f,c,d,r,p,h]}var zc=class extends j{constructor(e){super(),X(this,e,qI,WI,J,{},NI)}},Gg=zc;var Yg=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],ll=class{constructor(e,t,r,n,a){this.id=e;this.name=t;this.email=r;this.picture=n;this.token=a;this.color=Yg[Ba()%Yg.length]}};function KI(o){Ie(o,"svelte-1ym1y1w",".avatar.svelte-1ym1y1w{position:relative;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:var(--color-base-30)}.initial.svelte-1ym1y1w{color:var(--text-on-accent)}img.svelte-1ym1y1w{width:100%;height:100%;object-fit:cover}")}function zI(o){let e,t;return{c(){e=E("span"),t=ee(o[5]),L(e,"class","initial svelte-1ym1y1w"),le(e,"font-size",o[4])},m(r,n){C(r,e,n),M(e,t)},p(r,n){n&32&&ie(t,r[5]),n&16&&le(e,"font-size",r[4])},d(r){r&&k(e)}}}function GI(o){let e,t,r,n;return{c(){e=E("img"),Hu(e.src,t=o[0].picture)||L(e,"src",t),L(e,"alt",o[1]),L(e,"class","svelte-1ym1y1w")},m(a,s){C(a,e,s),r||(n=Q(e,"error",o[6]),r=!0)},p(a,s){s&1&&!Hu(e.src,t=a[0].picture)&&L(e,"src",t),s&2&&L(e,"alt",a[1])},d(a){a&&k(e),r=!1,n()}}}function YI(o){let e;function t(a,s){return!a[3]&&a[0].picture?GI:zI}let r=t(o,-1),n=r(o);return{c(){e=E("div"),n.c(),L(e,"class","avatar svelte-1ym1y1w"),le(e,"width",o[2]),le(e,"height",o[2])},m(a,s){C(a,e,s),n.m(e,null)},p(a,[s]){r===(r=t(a,s))&&n?n.p(a,s):(n.d(1),n=r(a),n&&(n.c(),n.m(e,null))),s&4&&le(e,"width",a[2]),s&4&&le(e,"height",a[2])},i:Y,o:Y,d(a){a&&k(e),n.d()}}}function JI(o){var e;return((e=o.match(/[a-z]+$/i))===null||e===void 0?void 0:e[0])||"px"}function jI(o,e,t){let r,n,a,{user:s}=e,{alt:i="Profile picture"}=e,{size:f="40px"}=e,c=!1;function d(){t(3,c=!0)}return o.$$set=p=>{"user"in p&&t(0,s=p.user),"alt"in p&&t(1,i=p.alt),"size"in p&&t(2,f=p.size)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(5,r=s.name?s.name.charAt(0).toUpperCase():"?")}if(o.$$.dirty&4){e:t(7,n=JI(f))}if(o.$$.dirty&132){e:t(4,a=`${parseFloat(f)/2}${n}`)}},[s,i,f,c,a,r,d,n]}var Gc=class extends j{constructor(e){super(),X(this,e,jI,YI,J,{user:0,alt:1,size:2},KI)}},Jg=Gc;function XI(o){let e,t,r,n,a,s=(o[0].name||"")+"",i,f,c,d,p=(o[0].email||"")+"",h,y,g,v;t=new Jg({props:{size:"2.5em",user:o[0]}});let b=o[2].default,_=me(b,o,o[1],null);return{c(){e=E("div"),N(t.$$.fragment),r=W(),n=E("div"),a=E("div"),i=ee(s),f=W(),c=E("br"),d=W(),h=ee(p),y=W(),g=E("div"),_&&_.c(),L(a,"class","setting-item-description"),L(n,"class","setting-item-info"),le(n,"display","grid"),L(g,"class","setting-item-control"),L(e,"class","setting-item")},m(D,F){C(D,e,F),U(t,e,null),M(e,r),M(e,n),M(n,a),M(a,i),M(a,f),M(a,c),M(a,d),M(a,h),M(e,y),M(e,g),_&&_.m(g,null),v=!0},p(D,[F]){let S={};F&1&&(S.user=D[0]),t.$set(S),(!v||F&1)&&s!==(s=(D[0].name||"")+"")&&ie(i,s),(!v||F&1)&&p!==(p=(D[0].email||"")+"")&&ie(h,p),_&&_.p&&(!v||F&2)&&ge(_,b,D,D[1],v?he(b,D[1],F,null):xe(D[1]),null)},i(D){v||(I(t.$$.fragment,D),I(_,D),v=!0)},o(D){T(t.$$.fragment,D),T(_,D),v=!1},d(D){D&&k(e),$(t),_&&_.d(D)}}}function ZI(o,e,t){let{$$slots:r={},$$scope:n}=e,{user:a}=e;return o.$$set=s=>{"user"in s&&t(0,a=s.user),"$$scope"in s&&t(1,n=s.$$scope)},[a,n,r]}var Yc=class extends j{constructor(e){super(),X(this,e,ZI,XI,J,{user:0})}},jg=Yc;var fl=require("obsidian");function QI(o){Ie(o,"svelte-5zjjwa",".help-container.svelte-5zjjwa{position:relative;display:inline-block}button.svelte-5zjjwa{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px;margin:0;background:transparent;border:none;color:var(--text-muted);box-shadow:none;border-radius:50%}button.svelte-5zjjwa:hover{box-shadow:none;color:var(--icon-color-hover);opacity:var(--icon-opacity-hover);background-color:transparent;border-radius:0}button.svelte-5zjjwa:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.popover.svelte-5zjjwa{position:absolute;z-index:50;width:256px;padding:8px;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:32px;transition-delay:0.1s}.popover.left.svelte-5zjjwa{right:100%;margin-right:8px}.popover.right.svelte-5zjjwa{left:0}.arrow.svelte-5zjjwa{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px}.arrow.left.svelte-5zjjwa{right:8px}.arrow.right.svelte-5zjjwa{left:8px}p.svelte-5zjjwa{margin:0;color:var(--text-normal)}")}function Xg(o){let e,t,r,n,a;return{c(){e=E("div"),t=E("div"),r=W(),n=E("p"),a=ee(o[0]),L(t,"class","arrow svelte-5zjjwa"),it(t,"left",o[4]==="left"),it(t,"right",o[4]==="right"),L(n,"class","svelte-5zjjwa"),L(e,"class","popover svelte-5zjjwa"),it(e,"left",o[4]==="left"),it(e,"right",o[4]==="right")},m(s,i){C(s,e,i),M(e,t),M(e,r),M(e,n),M(n,a),o[9](e)},p(s,i){i&16&&it(t,"left",s[4]==="left"),i&16&&it(t,"right",s[4]==="right"),i&1&&ie(a,s[0]),i&16&&it(e,"left",s[4]==="left"),i&16&&it(e,"right",s[4]==="right")},d(s){s&&k(e),o[9](null)}}}function ek(o){let e,t,r,n,a,s,i;r=new ls({props:{size:16}});let f=o[1]&&Xg(o);return{c(){e=E("div"),t=E("button"),N(r.$$.fragment),n=W(),f&&f.c(),L(t,"type","button"),L(t,"class","svelte-5zjjwa"),L(e,"class","help-container svelte-5zjjwa")},m(c,d){C(c,e,d),M(e,t),U(r,t,null),o[8](t),M(e,n),f&&f.m(e,null),a=!0,s||(i=[Q(t,"mouseenter",o[5]),Q(t,"mouseleave",o[6]),Q(t,"click",o[7])],s=!0)},p(c,[d]){c[1]?f?f.p(c,d):(f=Xg(c),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i(c){a||(I(r.$$.fragment,c),a=!0)},o(c){T(r.$$.fragment,c),a=!1},d(c){c&&k(e),$(r),o[8](null),f&&f.d(),s=!1,Ce(i)}}}function tk(o,e,t){let{helpText:r}=e,n=!1,a="right",s,i;function f(){t(1,n=!0)}function c(){t(1,n=!1)}function d(){t(1,n=!n)}function p(y){cr[y?"unshift":"push"](()=>{s=y,t(2,s)})}function h(y){cr[y?"unshift":"push"](()=>{i=y,t(3,i)})}return o.$$set=y=>{"helpText"in y&&t(0,r=y.helpText)},o.$$.update=()=>{if(o.$$.dirty&14){e:if(n&&s&&i){let y=s.getBoundingClientRect(),g=i.getBoundingClientRect(),v=window.innerWidth;t(4,a=y.right+g.width>v-20?"left":"right")}}},[r,n,s,i,a,f,c,d,p,h]}var Jc=class extends j{constructor(e){super(),X(this,e,tk,ek,J,{helpText:0},QI)}},Zg=Jc;function rk(o){Ie(o,"svelte-1v3t6m3",".setting-item-name.svelte-1v3t6m3{display:flex;align-items:center;gap:8px}.help-button.svelte-1v3t6m3{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px !important;margin:0;background:transparent;border:none;color:var(--text-muted);border-radius:50%;-webkit-tap-highlight-color:transparent}@media(hover: hover){.help-button.svelte-1v3t6m3:hover{box-shadow:none;color:var(--text-normal);background:transparent;border-radius:0}}.help-button.svelte-1v3t6m3:active{color:var(--text-normal)}.help-content.svelte-1v3t6m3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1)}p.svelte-1v3t6m3{margin:0}")}var ok=o=>({}),Qg=o=>({}),nk=o=>({}),ex=o=>({}),ak=o=>({}),tx=o=>({});function sk(o){let e;return{c(){e=ee(o[0])},m(t,r){C(t,e,r)},p(t,r){r&1&&ie(e,t[0])},d(t){t&&k(e)}}}function rx(o){let e,t,r,n,a=[lk,ik],s=[];function i(f,c){return f[3]?0:1}return e=i(o,-1),t=s[e]=a[e](o),{c(){t.c(),r=Pe()},m(f,c){s[e].m(f,c),C(f,r,c),n=!0},p(f,c){let d=e;e=i(f,c),e===d?s[e].p(f,c):(Se(),T(s[d],1,1,()=>{s[d]=null}),Le(),t=s[e],t?t.p(f,c):(t=s[e]=a[e](f),t.c()),I(t,1),t.m(r.parentNode,r))},i(f){n||(I(t),n=!0)},o(f){T(t),n=!1},d(f){f&&k(r),s[e].d(f)}}}function ik(o){let e,t;return e=new Zg({props:{helpText:o[1]}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n&2&&(a.helpText=r[1]),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function lk(o){let e,t,r,n,a;return t=new ls({props:{size:16}}),{c(){e=E("button"),N(t.$$.fragment),L(e,"class","help-button svelte-1v3t6m3"),L(e,"aria-expanded",o[2])},m(s,i){C(s,e,i),U(t,e,null),r=!0,n||(a=Q(e,"click",o[4]),n=!0)},p(s,i){(!r||i&4)&&L(e,"aria-expanded",s[2])},i(s){r||(I(t.$$.fragment,s),r=!0)},o(s){T(t.$$.fragment,s),r=!1},d(s){s&&k(e),$(t),n=!1,a()}}}function fk(o){let e,t,r=o[7].description,n=me(r,o,o[6],Qg);return{c(){e=E("div"),n&&n.c(),L(e,"class","setting-item-description")},m(a,s){C(a,e,s),n&&n.m(e,null),t=!0},p(a,s){n&&n.p&&(!t||s&64)&&ge(n,r,a,a[6],t?he(r,a[6],s,ok):xe(a[6]),Qg)},i(a){t||(I(n,a),t=!0)},o(a){T(n,a),t=!1},d(a){a&&k(e),n&&n.d(a)}}}function ox(o){let e,t,r;return{c(){e=E("div"),t=E("p"),r=ee(o[1]),L(t,"class","svelte-1v3t6m3"),L(e,"class","help-content svelte-1v3t6m3"),it(e,"expanded",o[2])},m(n,a){C(n,e,a),M(e,t),M(t,r)},p(n,a){a&2&&ie(r,n[1]),a&4&&it(e,"expanded",n[2])},d(n){n&&k(e)}}}function uk(o){let e,t,r,n,a,s,i,f,c,d=o[7].name,p=me(d,o,o[6],tx),h=p||sk(o),y=o[1]&&rx(o),g=o[7].description,v=me(g,o,o[6],ex),b=v||fk(o),_=o[1]&&o[2]&&o[3]&&ox(o),D=o[7].default,F=me(D,o,o[6],null);return{c(){e=E("div"),t=E("div"),r=E("div"),h&&h.c(),n=W(),y&&y.c(),a=W(),b&&b.c(),s=W(),_&&_.c(),i=W(),f=E("div"),F&&F.c(),L(r,"class","setting-item-name svelte-1v3t6m3"),L(t,"class","setting-item-info"),L(f,"class","setting-item-control"),L(e,"class","setting-item setting-item-heading")},m(S,P){C(S,e,P),M(e,t),M(t,r),h&&h.m(r,null),M(r,n),y&&y.m(r,null),M(t,a),b&&b.m(t,null),M(t,s),_&&_.m(t,null),M(e,i),M(e,f),F&&F.m(f,null),c=!0},p(S,[P]){p?p.p&&(!c||P&64)&&ge(p,d,S,S[6],c?he(d,S[6],P,ak):xe(S[6]),tx):h&&h.p&&(!c||P&1)&&h.p(S,c?P:-1),S[1]?y?(y.p(S,P),P&2&&I(y,1)):(y=rx(S),y.c(),I(y,1),y.m(r,null)):y&&(Se(),T(y,1,1,()=>{y=null}),Le()),v?v.p&&(!c||P&64)&&ge(v,g,S,S[6],c?he(g,S[6],P,nk):xe(S[6]),ex):b&&b.p&&(!c||P&64)&&b.p(S,c?P:-1),S[1]&&S[2]&&S[3]?_?_.p(S,P):(_=ox(S),_.c(),_.m(t,null)):_&&(_.d(1),_=null),F&&F.p&&(!c||P&64)&&ge(F,D,S,S[6],c?he(D,S[6],P,null):xe(S[6]),null)},i(S){c||(I(h,S),I(y),I(b,S),I(F,S),c=!0)},o(S){T(h,S),T(y),T(b,S),T(F,S),c=!1},d(S){S&&k(e),h&&h.d(S),y&&y.d(),b&&b.d(S),_&&_.d(),F&&F.d(S)}}}function ck(o,e,t){let{$$slots:r={},$$scope:n}=e;var a;let{name:s=""}=e,{helpText:i=void 0}=e,f=!1,c=!1;function d(){c&&t(2,f=!f)}return o.$$set=p=>{"name"in p&&t(0,s=p.name),"helpText"in p&&t(1,i=p.helpText),"$$scope"in p&&t(6,n=p.$$scope)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(3,c=t(5,a=fl.Platform===null||fl.Platform===void 0?void 0:fl.Platform.isMobile)!==null&&a!==void 0?a:!1)}},[s,i,f,c,d,a,n,r]}var jc=class extends j{constructor(e){super(),X(this,e,ck,uk,J,{name:0,helpText:1},rk)}},ft=jc;var wa=[];function dk(o,e){return{subscribe:He(o,e).subscribe}}function He(o,e=Y){let t,r=new Set;function n(i){if(J(o,i)&&(o=i,t)){let f=!wa.length;for(let c of r)c[1](),wa.push(c,o);if(f){for(let c=0;c<wa.length;c+=2)wa[c][0](wa[c+1]);wa.length=0}}}function a(i){n(i(o))}function s(i,f=Y){let c=[i,f];return r.add(c),r.size===1&&(t=e(n,a)||Y),i(o),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:n,update:a,subscribe:s}}function ds(o,e,t){let r=!Array.isArray(o),n=r?[o]:o;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let a=e.length<2;return dk(t,(s,i)=>{let f=!1,c=[],d=0,p=Y,h=()=>{if(d)return;p();let g=e(r?c[0]:c,s,i);a?s(g):p=rt(g)?g:Y},y=n.map((g,v)=>Et(g,b=>{c[v]=b,d&=~(1<<v),f&&h()},()=>{d|=1<<v}));return f=!0,h(),function(){Ce(y),p(),f=!1}})}var ux=require("obsidian"),cx=require("obsidian");if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkFetch;let o=["fetch","Response","FormData","Request","Headers"];for(let e of o)globalThis[e]=globalThis[`blink${e}`]}}catch(o){console.error(o)}globalThis.EventSource===void 0&&(cx.Platform.isMobile?console.warn("[Relay] Polyfilling EventSource API required, but unable to polyfill on Mobile"):(console.warn("[Relay] Polyfilling EventSource API"),globalThis.EventSource=fx()));var pn=async(o,e)=>{let t=o instanceof URL?o.toString():o,r=(e==null?void 0:e.method)||"GET",n=Object.assign({},e==null?void 0:e.headers,{"Relay-Version":"0.4.1"}),a={url:t,method:r,body:e==null?void 0:e.body,headers:n,throw:!1},s;if(s=await(0,ux.requestUrl)(a),!s.arrayBuffer.byteLength)return new Response(null,{status:s.status,statusText:s.status.toString(),headers:new Headers(s.headers)});let i=new Response(s.arrayBuffer,{status:s.status,statusText:s.status.toString(),headers:new Headers(s.headers)});Object.defineProperty(i,"json",{value:async()=>JSON.parse(s.text)});let c=s.status>=500?"error":s.status>=400?"warn":"debug",d=s.text;if(ae("[CustomFetch]",c)(s.status.toString(),r,t,d),s.status>=500)throw new Error(d);return i};function Ik(o){Ie(o,"svelte-16zgfvu",`.continue.svelte-16zgfvu{font-weight:600;font-size:larger;margin-top:0;margin-bottom:0px}.link.svelte-16zgfvu{color:var(--text-muted)}.link.svelte-16zgfvu:hover{color:var(--text-normal)}.not-working.svelte-16zgfvu{margin-top:0px;margin-bottom:0px;color:var(--text-faint);font-size:0.75em}.link-button.svelte-16zgfvu{box-shadow:none;background:none;border:none;padding:0;font:inherit;text-decoration:underline}button.link-button.svelte-16zgfvu:hover{box-shadow:none;color:var(--text-normal)}button.link.link-button.svelte-16zgfvu{height:auto;padding:0;color:var(--text-faint)}.welcome.svelte-16zgfvu{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:7rem 2rem 1rem 2rem;max-width:640px;margin:0 auto;gap:2rem}.google-sign-in-button.svelte-16zgfvu{height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
			Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.google-sign-in-button.svelte-16zgfvu:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.google-sign-in-button.svelte-16zgfvu:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}`)}function kk(o){let e,t,r,n,a,s,i;t=new qg({});function f(g,v){return g[3]?Tk:Ak}let c=f(o,[-1,-1]),d=c(o);function p(g,v){if(g[5])return Ek;if(g[4])return Dk}let h=p(o,[-1,-1]),y=h&&h(o);return s=new Gg({}),{c(){e=E("div"),N(t.$$.fragment),r=W(),d.c(),n=W(),y&&y.c(),a=W(),N(s.$$.fragment),L(e,"class","welcome svelte-16zgfvu")},m(g,v){C(g,e,v),U(t,e,null),M(e,r),d.m(e,null),M(e,n),y&&y.m(e,null),C(g,a,v),U(s,g,v),i=!0},p(g,v){c===(c=f(g,v))&&d?d.p(g,v):(d.d(1),d=c(g),d&&(d.c(),d.m(e,n))),h===(h=p(g,v))&&y?y.p(g,v):(y&&y.d(1),y=h&&h(g),y&&(y.c(),y.m(e,null)))},i(g){i||(I(t.$$.fragment,g),I(s.$$.fragment,g),i=!0)},o(g){T(t.$$.fragment,g),T(s.$$.fragment,g),i=!1},d(g){g&&(k(e),k(a)),$(t),d.d(),y&&y.d(),$(s,g)}}}function Ck(o){let e,t,r,n,a,s,i;e=new ft({props:{$$slots:{name:[Mk],default:[Pk]},$$scope:{ctx:o}}}),r=new ft({props:{name:"Account"}}),a=new jg({props:{user:o[2].user,$$slots:{default:[Fk]},$$scope:{ctx:o}}});let f=o[17].default,c=me(f,o,o[23],null);return{c(){N(e.$$.fragment),t=W(),N(r.$$.fragment),n=W(),N(a.$$.fragment),s=W(),c&&c.c()},m(d,p){U(e,d,p),C(d,t,p),U(r,d,p),C(d,n,p),U(a,d,p),C(d,s,p),c&&c.m(d,p),i=!0},p(d,p){let h={};p[0]&8388608&&(h.$$scope={dirty:p,ctx:d}),e.$set(h);let y={};p[0]&4&&(y.user=d[2].user),p[0]&8388608&&(y.$$scope={dirty:p,ctx:d}),a.$set(y),c&&c.p&&(!i||p[0]&8388608)&&ge(c,f,d,d[23],i?he(f,d[23],p,null):xe(d[23]),null)},i(d){i||(I(e.$$.fragment,d),I(r.$$.fragment,d),I(a.$$.fragment,d),I(c,d),i=!0)},o(d){T(e.$$.fragment,d),T(r.$$.fragment,d),T(a.$$.fragment,d),T(c,d),i=!1},d(d){d&&(k(t),k(n),k(s)),$(e,d),$(r,d),$(a,d),c&&c.d(d)}}}function Ak(o){let e,t,r,n,a;return{c(){e=E("a"),t=E("button"),r=ee("Sign in with Google"),L(t,"class","google-sign-in-button svelte-16zgfvu"),t.disabled=o[4],L(e,"href",o[1]),L(e,"target","_blank")},m(s,i){C(s,e,i),M(e,t),M(t,r),n||(a=Q(t,"click",o[20]),n=!0)},p(s,i){i[0]&16&&(t.disabled=s[4]),i[0]&2&&L(e,"href",s[1])},d(s){s&&k(e),n=!1,a()}}}function Tk(o){let e,t,r,n;return{c(){e=E("button"),t=ee("Sign in with Google"),L(e,"class","google-sign-in-button svelte-16zgfvu"),e.disabled=o[4]},m(a,s){C(a,e,s),M(e,t),r||(n=Q(e,"click",(0,$o.debounce)(o[19])),r=!0)},p(a,s){s[0]&16&&(e.disabled=a[4])},d(a){a&&k(e),r=!1,n()}}}function Dk(o){let e,t,r,n,a,s,i,f;return{c(){e=E("div"),t=E("p"),t.textContent="Continue in your browser...",r=W(),n=E("p"),a=ee(`Not working?
					`),s=E("button"),s.textContent="(try again)",L(t,"class","continue svelte-16zgfvu"),L(s,"class","link link-button svelte-16zgfvu"),L(n,"class","not-working svelte-16zgfvu")},m(c,d){C(c,e,d),M(e,t),M(e,r),M(e,n),M(n,a),M(n,s),i||(f=Q(s,"click",o[22]),i=!0)},p:Y,d(c){c&&k(e),i=!1,f()}}}function Ek(o){let e,t,r,n,a,s=o[6]&&dx(o);return{c(){e=E("p"),t=ee(o[5]),r=ee("."),n=E("br"),a=W(),s&&s.c()},m(i,f){C(i,e,f),M(e,t),M(e,r),M(e,n),M(e,a),s&&s.m(e,null)},p(i,f){f[0]&32&&ie(t,i[5]),i[6]?s?s.p(i,f):(s=dx(i),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(i){i&&k(e),s&&s.d()}}}function dx(o){let e,t,r,n;return{c(){e=ee("Already logged in? "),t=E("button"),t.textContent="(click here)",L(t,"class","link link-button svelte-16zgfvu")},m(a,s){C(a,e,s),C(a,t,s),r||(n=Q(t,"click",(0,$o.debounce)(o[21])),r=!0)},p:Y,d(a){a&&(k(e),k(t)),r=!1,n()}}}function Pk(o){let e,t;return e=new Wg({}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function Mk(o){let e,t;return e=new sl({props:{slot:"name"}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p:Y,i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function Fk(o){let e,t,r;return{c(){e=E("button"),e.textContent="Logout"},m(n,a){C(n,e,a),t||(r=Q(e,"click",(0,$o.debounce)(o[18])),t=!0)},p:Y,d(n){n&&k(e),t=!1,r()}}}function Rk(o){let e,t,r,n,a=[Ck,kk],s=[];function i(f,c){return f[2].hasUser&&f[2].user?0:1}return e=i(o,[-1,-1]),t=s[e]=a[e](o),{c(){t.c(),r=Pe()},m(f,c){s[e].m(f,c),C(f,r,c),n=!0},p(f,c){let d=e;e=i(f,c),e===d?s[e].p(f,c):(Se(),T(s[d],1,1,()=>{s[d]=null}),Le(),t=s[e],t?t.p(f,c):(t=s[e]=a[e](f),t.c()),I(t,1),t.m(r.parentNode,r))},i(f){n||(I(t),n=!0)},o(f){T(t),n=!1},d(f){f&&k(r),s[e].d(f)}}}function Xc(){try{return Response.toString()}catch(o){return"undefined"}}function px(){try{return fetch.toString()}catch(o){return"undefined"}}function mx(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function Ok(o,e,t){let r,n,a,s=Y,i=()=>(s(),s=Et(v,ke=>t(2,a=ke)),v),f,c,d,p;o.$$.on_destroy.push(()=>s());let{$$slots:h={},$$scope:y}=e,{plugin:g}=e,v,b=He(!$o.Platform.isIosApp);Oe(o,b,ke=>t(3,f=ke));let _=He(!1);Oe(o,_,ke=>t(4,c=ke)),i(v=g.loginManager);let D=He(!1);Oe(o,D,ke=>t(6,p=ke));let F=He(!1),S=He(!0);Oe(o,S,ke=>t(26,r=ke));let P=He("please wait...");Oe(o,P,ke=>t(1,n=ke));let H,R,V=He("");Oe(o,V,ke=>t(5,d=ke));let O=He(g.settings.debugging);function te(){O.set(g.toggleDebugging(!0))}function ve(){return lt(this,void 0,void 0,function*(){g.loginManager.logout(),F.set(!1),D.set(!1)})}function ne(){return lt(this,void 0,void 0,function*(){try{yield g.loginManager.login()}catch(ke){b.set(!1),F.set(!1),n&&n!=="please wait..."&&(window.open(n,"_blank"),Xe())}})}let fe=He(Xc()),q=He(px()),Z=He(mx()),Je=He(g.loginManager.pb);function Vt(){fe.set(Xc()),q.set(px()),Z.set(mx()),Je.set(g.loginManager.pb)}function Ue(){try{let ke=r?pn:fetch;H=void 0,P.set("please wait..."),v.initiateManualOAuth2CodeFlow(ke).then(([Rt,Tr,yn])=>{H=Tr,R=yn,P.set(Rt)}).catch(Rt=>{let Tr=Rt.message;throw Tr=Tr+`
`+Xc(),V.set(Tr),Rt})}catch(ke){V.set(ke.message)}}Sr(()=>{F.set(!1),Ue()});function Xe(){return lt(this,void 0,void 0,function*(){if(!(!H||!R))return yield g.loginManager.poll(H,R).then(ke=>{F.set(!0),_.set(!1),V.set("")}).catch(ke=>{D.set(!0),_.set(!1),F.set(!1),V.set(ke.message)})})}function qe(ke){let Rt=ke.target;Rt.focus(),Rt.select(),navigator.clipboard.writeText(Rt.value).then(()=>new $o.Notice("Invite link copied")).catch(Tr=>{}),Xe()}let ue=()=>{ve()},je=async()=>{_.set(!0),await ne()},oe=()=>{_.set(!0),Xe()},Ar=()=>{Xe()},Xt=()=>{_.set(!1)};return o.$$set=ke=>{"plugin"in ke&&t(16,g=ke.plugin),"$$scope"in ke&&t(23,y=ke.$$scope)},[v,n,a,f,c,d,p,b,_,D,S,P,V,ve,ne,Xe,g,h,ue,je,oe,Ar,Xt,y]}var Zc=class extends j{constructor(e){super(),X(this,e,Ok,Rk,J,{plugin:16},Ik,[-1,-1])}},hx=Zc;function gx(o,e,t){let r=o.slice();return r[5]=e[t],r}var Uk=o=>({}),xx=o=>({}),$k=o=>({}),yx=o=>({});function Bk(o){let e;return{c(){e=ee(o[0])},m(t,r){C(t,e,r)},p(t,r){r&1&&ie(e,t[0])},d(t){t&&k(e)}}}function Nk(o){let e,t=ot(o[1]),r=[];for(let n=0;n<t.length;n+=1)r[n]=wx(gx(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=Pe()},m(n,a){for(let s=0;s<r.length;s+=1)r[s]&&r[s].m(n,a);C(n,e,a)},p(n,a){if(a&2){t=ot(n[1]);let s;for(s=0;s<t.length;s+=1){let i=gx(n,t,s);r[s]?r[s].p(i,a):(r[s]=wx(i),r[s].c(),r[s].m(e.parentNode,e))}for(;s<r.length;s+=1)r[s].d(1);r.length=t.length}},d(n){n&&k(e),fr(r,n)}}}function wx(o){let e;return{c(){e=E("div"),e.textContent=`${o[5]} `},m(t,r){C(t,e,r)},p:Y,d(t){t&&k(e)}}}function Hk(o){let e,t=o[1].length>0&&Nk(o);return{c(){t&&t.c(),e=Pe()},m(r,n){t&&t.m(r,n),C(r,e,n)},p(r,n){r[1].length>0&&t.p(r,n)},d(r){r&&k(e),t&&t.d(r)}}}function Vk(o){let e,t,r,n,a,s,i,f,c=o[4].name,d=me(c,o,o[3],yx),p=d||Bk(o),h=o[4].description,y=me(h,o,o[3],xx),g=y||Hk(o),v=o[4].default,b=me(v,o,o[3],null);return{c(){e=E("div"),t=E("div"),r=E("div"),p&&p.c(),n=W(),a=E("div"),g&&g.c(),s=W(),i=E("div"),b&&b.c(),L(r,"class","setting-item-name"),le(r,"display","grid"),le(r,"align-items","center"),L(a,"class","setting-item-description"),L(t,"class","setting-item-info"),le(t,"display","grid"),L(i,"class","setting-item-control"),L(e,"class","setting-item")},m(_,D){C(_,e,D),M(e,t),M(t,r),p&&p.m(r,null),M(t,n),M(t,a),g&&g.m(a,null),M(e,s),M(e,i),b&&b.m(i,null),f=!0},p(_,[D]){d?d.p&&(!f||D&8)&&ge(d,c,_,_[3],f?he(c,_[3],D,$k):xe(_[3]),yx):p&&p.p&&(!f||D&1)&&p.p(_,f?D:-1),y&&y.p&&(!f||D&8)&&ge(y,h,_,_[3],f?he(h,_[3],D,Uk):xe(_[3]),xx),b&&b.p&&(!f||D&8)&&ge(b,v,_,_[3],f?he(v,_[3],D,null):xe(_[3]),null)},i(_){f||(I(p,_),I(g,_),I(b,_),f=!0)},o(_){T(p,_),T(g,_),T(b,_),f=!1},d(_){_&&k(e),p&&p.d(_),g&&g.d(_),b&&b.d(_)}}}function Wk(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:a=""}=e,{description:s}=e,i=s!==void 0?s.split(`
`):[];return o.$$set=f=>{"name"in f&&t(0,a=f.name),"description"in f&&t(2,s=f.description),"$$scope"in f&&t(3,n=f.$$scope)},[a,i,s,n,r]}var Qc=class extends j{constructor(e){super(),X(this,e,Wk,Vk,J,{name:0,description:2})}},Be=Qc;function qk(o){Ie(o,"svelte-tyruzk",".setting-item-control.svelte-tyruzk{width:unset !important;margin-top:unset !important}.setting-item.svelte-tyruzk{flex-direction:unset !important;align-items:flex-start}.setting-item-info.svelte-tyruzk{min-width:0;margin-top:auto;margin-bottom:auto}.setting-item-name.svelte-tyruzk{min-width:0}.truncate.svelte-tyruzk *{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")}var Kk=o=>({}),bx=o=>({}),zk=o=>({}),_x=o=>({});function Gk(o){let e;return{c(){e=ee(o[0])},m(t,r){C(t,e,r)},p(t,r){r&1&&ie(e,t[0])},d(t){t&&k(e)}}}function Yk(o){let e,t,r,n,a,s,i,f=o[2].name,c=me(f,o,o[1],_x),d=c||Gk(o),p=o[2].description,h=me(p,o,o[1],bx),y=o[2].default,g=me(y,o,o[1],null);return{c(){e=E("div"),t=E("div"),r=E("div"),d&&d.c(),n=W(),h&&h.c(),a=W(),s=E("div"),g&&g.c(),L(r,"class","setting-item-name truncate svelte-tyruzk"),L(t,"class","setting-item-info svelte-tyruzk"),L(s,"class","setting-item-control svelte-tyruzk"),L(e,"class","setting-item svelte-tyruzk")},m(v,b){C(v,e,b),M(e,t),M(t,r),d&&d.m(r,null),M(e,n),h&&h.m(e,null),M(e,a),M(e,s),g&&g.m(s,null),i=!0},p(v,[b]){c?c.p&&(!i||b&2)&&ge(c,f,v,v[1],i?he(f,v[1],b,zk):xe(v[1]),_x):d&&d.p&&(!i||b&1)&&d.p(v,i?b:-1),h&&h.p&&(!i||b&2)&&ge(h,p,v,v[1],i?he(p,v[1],b,Kk):xe(v[1]),bx),g&&g.p&&(!i||b&2)&&ge(g,y,v,v[1],i?he(y,v[1],b,null):xe(v[1]),null)},i(v){i||(I(d,v),I(h,v),I(g,v),i=!0)},o(v){T(d,v),T(h,v),T(g,v),i=!1},d(v){v&&k(e),d&&d.d(v),h&&h.d(v),g&&g.d(v)}}}function Jk(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:a=""}=e;return o.$$set=s=>{"name"in s&&t(0,a=s.name),"$$scope"in s&&t(1,n=s.$$scope)},[a,n,r]}var ed=class extends j{constructor(e){super(),X(this,e,Jk,Yk,J,{name:0},qk)}},Bo=ed;function jk(o){Ie(o,"svelte-y529x8",".extra-setting-button.svelte-y529x8:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.extra-setting-button.svelte-y529x8:hover{box-shadow:none;opacity:var(--icon-opacity-hover);color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}")}function Xk(o){let e,t,r,n,a;return t=new dc({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){e=E("div"),N(t.$$.fragment),L(e,"class","clickable-icon extra-setting-button svelte-y529x8"),L(e,"aria-label","Options"),L(e,"role","button"),L(e,"tabindex","0")},m(s,i){C(s,e,i),U(t,e,null),r=!0,n||(a=[Q(e,"click",o[0]),Q(e,"keydown",o[0])],n=!0)},p:Y,i(s){r||(I(t.$$.fragment,s),r=!0)},o(s){T(t.$$.fragment,s),r=!1},d(s){s&&k(e),$(t),n=!1,Ce(a)}}}function Zk(o){let e=Lt();function t(r){(r instanceof MouseEvent||r instanceof KeyboardEvent&&(r.key==="Enter"||r.key===" "))&&e("settings")}return[t]}var td=class extends j{constructor(e){super(),X(this,e,Zk,Xk,J,{},jk)}},mn=td;function Qk(o){let e,t,r,n,a,s;t=new dn({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0;"}});let i=o[3].default,f=me(i,o,o[2],null);return{c(){e=E("span"),N(t.$$.fragment),r=W(),f&&f.c(),L(e,"role","button"),L(e,"tabindex","0"),le(e,"display","flex"),le(e,"align-items","center"),le(e,"width","100%")},m(c,d){C(c,e,d),U(t,e,null),M(e,r),f&&f.m(e,null),n=!0,a||(s=[Q(e,"keypress",o[0]),Q(e,"click",o[0])],a=!0)},p(c,[d]){f&&f.p&&(!n||d&4)&&ge(f,i,c,c[2],n?he(i,c[2],d,null):xe(c[2]),null)},i(c){n||(I(t.$$.fragment,c),I(f,c),n=!0)},o(c){T(t.$$.fragment,c),T(f,c),n=!1},d(c){c&&k(e),$(t),f&&f.d(c),a=!1,Ce(s)}}}function eC(o,e,t){let{$$slots:r={},$$scope:n}=e,{relay:a=void 0}=e,s=Lt();function i(){a&&s("manageRelay",{relay:a})}return o.$$set=f=>{"relay"in f&&t(1,a=f.relay),"$$scope"in f&&t(2,n=f.$$scope)},[i,a,n,r]}var rd=class extends j{constructor(e){super(),X(this,e,eC,Qk,J,{relay:1})}},No=rd;function tC(o){let e,t,r,n,a,s;t=new sc({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}});let i=o[3].default,f=me(i,o,o[2],null);return{c(){e=E("span"),N(t.$$.fragment),r=W(),f&&f.c(),L(e,"role","button"),L(e,"tabindex","0"),le(e,"display","inline-flex"),le(e,"align-items","center"),le(e,"width","100%")},m(c,d){C(c,e,d),U(t,e,null),M(e,r),f&&f.m(e,null),n=!0,a||(s=[Q(e,"keypress",o[0]),Q(e,"click",o[0])],a=!0)},p(c,[d]){f&&f.p&&(!n||d&4)&&ge(f,i,c,c[2],n?he(i,c[2],d,null):xe(c[2]),null)},i(c){n||(I(t.$$.fragment,c),I(f,c),n=!0)},o(c){T(t.$$.fragment,c),T(f,c),n=!1},d(c){c&&k(e),$(t),f&&f.d(c),a=!1,Ce(s)}}}function rC(o,e,t){let{$$slots:r={},$$scope:n}=e,{folder:a=void 0}=e,s=Lt();function i(){var f;a&&s("manageSharedFolder",{folder:a,relay:(f=a.remote)===null||f===void 0?void 0:f.relay})}return o.$$set=f=>{"folder"in f&&t(1,a=f.folder),"$$scope"in f&&t(2,n=f.$$scope)},[i,a,n,r]}var od=class extends j{constructor(e){super(),X(this,e,rC,tC,J,{folder:1})}},hn=od;function oC(o){let e,t=o[0].name+"",r;return{c(){e=E("span"),r=ee(t),le(e,"overflow","hidden"),le(e,"text-overflow","ellipsis"),le(e,"white-space","nowrap")},m(n,a){C(n,e,a),M(e,r)},p(n,a){a&1&&t!==(t=n[0].name+"")&&ie(r,t)},d(n){n&&k(e)}}}function vx(o){let e,t,r,n,a;return t=new Qu({props:{size:16,class:"svg-icon"}}),n=new No({props:{relay:o[1],$$slots:{default:[nC]},$$scope:{ctx:o}}}),n.$on("manageRelay",o[3]),{c(){e=E("span"),N(t.$$.fragment),r=W(),N(n.$$.fragment),le(e,"width","16px"),le(e,"flex-shrink","0"),le(e,"display","flex"),le(e,"justify-content","center")},m(s,i){C(s,e,i),U(t,e,null),C(s,r,i),U(n,s,i),a=!0},p(s,i){let f={};i&2&&(f.relay=s[1]),i&17&&(f.$$scope={dirty:i,ctx:s}),n.$set(f)},i(s){a||(I(t.$$.fragment,s),I(n.$$.fragment,s),a=!0)},o(s){T(t.$$.fragment,s),T(n.$$.fragment,s),a=!1},d(s){s&&(k(e),k(r)),$(t),$(n,s)}}}function nC(o){let e,t=o[0].remote.relay.name+"",r;return{c(){e=E("span"),r=ee(t),le(e,"flex","1"),le(e,"min-width","0"),le(e,"text-overflow","ellipsis"),le(e,"white-space","nowrap")},m(n,a){C(n,e,a),M(e,r)},p(n,a){a&1&&t!==(t=n[0].remote.relay.name+"")&&ie(r,t)},d(n){n&&k(e)}}}function aC(o){let e,t,r,n,a;r=new hn({props:{folder:o[0],$$slots:{default:[oC]},$$scope:{ctx:o}}}),r.$on("manageSharedFolder",o[2]);let s=o[0].remote&&vx(o);return{c(){e=E("span"),t=E("span"),N(r.$$.fragment),n=W(),s&&s.c(),le(t,"display","inline-flex"),le(t,"align-items","center"),le(t,"width","200px"),le(t,"min-width","200px"),le(t,"flex-shrink","0"),le(e,"display","inline-flex"),le(e,"align-items","center"),le(e,"width","100%"),le(e,"gap","8px")},m(i,f){C(i,e,f),M(e,t),U(r,t,null),M(e,n),s&&s.m(e,null),a=!0},p(i,[f]){let c={};f&1&&(c.folder=i[0]),f&17&&(c.$$scope={dirty:f,ctx:i}),r.$set(c),i[0].remote?s?(s.p(i,f),f&1&&I(s,1)):(s=vx(i),s.c(),I(s,1),s.m(e,null)):s&&(Se(),T(s,1,1,()=>{s=null}),Le())},i(i){a||(I(r.$$.fragment,i),I(s),a=!0)},o(i){T(r.$$.fragment,i),T(s),a=!1},d(i){i&&k(e),$(r),s&&s.d()}}}function sC(o,e,t){let{folder:r}=e,{relay:n}=e;function a(i){Lr.call(this,o,i)}function s(i){Lr.call(this,o,i)}return o.$$set=i=>{"folder"in i&&t(0,r=i.folder),"relay"in i&&t(1,n=i.relay)},[r,n,a,s]}var nd=class extends j{constructor(e){super(),X(this,e,sC,aC,J,{folder:0,relay:1})}},Sx=nd;var ba=require("obsidian");function iC(o){Ie(o,"svelte-yg42fv","input.system3-input-invalid.svelte-yg42fv{border:1px solid var(--color-red) !important}span.faint.svelte-yg42fv{color:var(--text-faint)}")}function Lx(o,e,t){let r=o.slice();return r[21]=e[t],r}function Ix(o,e,t){let r=o.slice();return r[24]=e[t],r}function lC(o){let e,t,r,n,a,s;return{c(){e=E("input"),r=W(),n=E("button"),n.textContent="Join",L(e,"type","text"),L(e,"placeholder","Enter share key"),L(e,"class",t=la(o[2]?"system3-input-invalid":"")+" svelte-yg42fv"),L(n,"class","mod-cta")},m(i,f){C(i,e,f),ur(e,o[1]),C(i,r,f),C(i,n,f),a||(s=[Q(e,"input",o[12]),Q(e,"input",o[8]),Q(n,"click",function(){rt((0,ba.debounce)(o[13]))&&(0,ba.debounce)(o[13]).apply(this,arguments)})],a=!0)},p(i,f){o=i,f&4&&t!==(t=la(o[2]?"system3-input-invalid":"")+" svelte-yg42fv")&&L(e,"class",t),f&2&&e.value!==o[1]&&ur(e,o[1])},d(i){i&&(k(e),k(r),k(n)),a=!1,Ce(s)}}}function fC(o){let e;return{c(){e=E("span"),e.textContent="Relay Servers",L(e,"slot","name"),le(e,"display","inline-flex"),le(e,"align-items","center")},m(t,r){C(t,e,r)},p:Y,d(t){t&&k(e)}}}function uC(o){let e,t;function r(){return o[15](o[24])}return e=new mn({}),e.$on("settings",r),{c(){N(e.$$.fragment)},m(n,a){U(e,n,a),t=!0},p(n,a){o=n},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){$(e,n)}}}function cC(o){let e;return{c(){e=E("span"),e.textContent="(Untitled Relay Server)",L(e,"class","faint svelte-yg42fv")},m(t,r){C(t,e,r)},p:Y,d(t){t&&k(e)}}}function dC(o){let e=o[24].name+"",t;return{c(){t=ee(e)},m(r,n){C(r,t,n)},p(r,n){n&8&&e!==(e=r[24].name+"")&&ie(t,e)},d(r){r&&k(t)}}}function pC(o){let e;function t(a,s){return a[24].name?dC:cC}let r=t(o,-1),n=r(o);return{c(){n.c(),e=Pe()},m(a,s){n.m(a,s),C(a,e,s)},p(a,s){r===(r=t(a,s))&&n?n.p(a,s):(n.d(1),n=r(a),n&&(n.c(),n.m(e.parentNode,e)))},d(a){a&&k(e),n.d(a)}}}function mC(o){let e,t;return e=new No({props:{slot:"name",relay:o[24],t:"name",$$slots:{default:[pC]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[14]),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n&8&&(a.relay=r[24]),n&134217736&&(a.$$scope={dirty:n,ctx:r}),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function kx(o){let e,t;return e=new Bo({props:{$$slots:{name:[mC],default:[uC]},$$scope:{ctx:o}}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n&134217736&&(a.$$scope={dirty:n,ctx:r}),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function hC(o){let e,t,r;return{c(){e=E("button"),e.textContent="Create",L(e,"class","mod-cta")},m(n,a){C(n,e,a),t||(r=Q(e,"click",(0,ba.debounce)(o[16])),t=!0)},p:Y,d(n){n&&k(e),t=!1,r()}}}function Cx(o){let e,t;return e=new Be({props:{description:"Go to a Relay Server's settings page above to share existing folders, or add Shared Folders to your vault."}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function gC(o){let e,t,r;function n(){return o[19](o[21])}return e=new mn({}),e.$on("settings",function(){rt((0,ba.debounce)(n))&&(0,ba.debounce)(n).apply(this,arguments)}),{c(){N(e.$$.fragment),t=W()},m(a,s){U(e,a,s),C(a,t,s),r=!0},p(a,s){o=a},i(a){r||(I(e.$$.fragment,a),r=!0)},o(a){T(e.$$.fragment,a),r=!1},d(a){a&&k(t),$(e,a)}}}function xC(o){var r;let e,t;return e=new Sx({props:{folder:o[21],relay:(r=o[21].remote)==null?void 0:r.relay,slot:"name"}}),e.$on("manageRelay",o[17]),e.$on("manageSharedFolder",o[18]),{c(){N(e.$$.fragment)},m(n,a){U(e,n,a),t=!0},p(n,a){var i;let s={};a&16&&(s.folder=n[21]),a&16&&(s.relay=(i=n[21].remote)==null?void 0:i.relay),e.$set(s)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){$(e,n)}}}function Ax(o){let e,t;return e=new Bo({props:{$$slots:{name:[xC],default:[gC]},$$scope:{ctx:o}}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n&134217752&&(a.$$scope={dirty:n,ctx:r}),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function yC(o){let e,t,r,n,a,s,i,f,c,d,p,h=o[4].items().length===0,y,g,v;e=new ft({props:{name:"Join a Relay Server"}}),r=new Be({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[lC]},$$scope:{ctx:o}}}),a=new ft({props:{helpText:"A Relay Server coordinates real-time updates between collaborators. You can add collaborators and share folders on the Relay Server's settings page.",$$slots:{name:[fC]},$$scope:{ctx:o}}});let b=ot(o[3].values().sort(Tx)),_=[];for(let R=0;R<b.length;R+=1)_[R]=kx(Ix(o,b,R));let D=R=>T(_[R],1,1,()=>{_[R]=null});f=new Be({props:{name:"",description:"",$$slots:{default:[hC]},$$scope:{ctx:o}}}),d=new ft({props:{name:"Shared Folders",helpText:"Shared Folders enhance local folders by tracking edits. You can see what Relay Server a Shared Folder is connected to below."}});let F=h&&Cx(o),S=ot(o[4].items()),P=[];for(let R=0;R<S.length;R+=1)P[R]=Ax(Lx(o,S,R));let H=R=>T(P[R],1,1,()=>{P[R]=null});return{c(){N(e.$$.fragment),t=W(),N(r.$$.fragment),n=W(),N(a.$$.fragment),s=W();for(let R=0;R<_.length;R+=1)_[R].c();i=W(),N(f.$$.fragment),c=W(),N(d.$$.fragment),p=W(),F&&F.c(),y=W();for(let R=0;R<P.length;R+=1)P[R].c();g=Pe()},m(R,V){U(e,R,V),C(R,t,V),U(r,R,V),C(R,n,V),U(a,R,V),C(R,s,V);for(let O=0;O<_.length;O+=1)_[O]&&_[O].m(R,V);C(R,i,V),U(f,R,V),C(R,c,V),U(d,R,V),C(R,p,V),F&&F.m(R,V),C(R,y,V);for(let O=0;O<P.length;O+=1)P[O]&&P[O].m(R,V);C(R,g,V),v=!0},p(R,[V]){let O={};V&134217734&&(O.$$scope={dirty:V,ctx:R}),r.$set(O);let te={};if(V&134217728&&(te.$$scope={dirty:V,ctx:R}),a.$set(te),V&72){b=ot(R[3].values().sort(Tx));let ne;for(ne=0;ne<b.length;ne+=1){let fe=Ix(R,b,ne);_[ne]?(_[ne].p(fe,V),I(_[ne],1)):(_[ne]=kx(fe),_[ne].c(),I(_[ne],1),_[ne].m(i.parentNode,i))}for(Se(),ne=b.length;ne<_.length;ne+=1)D(ne);Le()}let ve={};if(V&134217728&&(ve.$$scope={dirty:V,ctx:R}),f.$set(ve),V&16&&(h=R[4].items().length===0),h?F?V&16&&I(F,1):(F=Cx(R),F.c(),I(F,1),F.m(y.parentNode,y)):F&&(Se(),T(F,1,1,()=>{F=null}),Le()),V&152){S=ot(R[4].items());let ne;for(ne=0;ne<S.length;ne+=1){let fe=Lx(R,S,ne);P[ne]?(P[ne].p(fe,V),I(P[ne],1)):(P[ne]=Ax(fe),P[ne].c(),I(P[ne],1),P[ne].m(g.parentNode,g))}for(Se(),ne=S.length;ne<P.length;ne+=1)H(ne);Le()}},i(R){if(!v){I(e.$$.fragment,R),I(r.$$.fragment,R),I(a.$$.fragment,R);for(let V=0;V<b.length;V+=1)I(_[V]);I(f.$$.fragment,R),I(d.$$.fragment,R),I(F);for(let V=0;V<S.length;V+=1)I(P[V]);v=!0}},o(R){T(e.$$.fragment,R),T(r.$$.fragment,R),T(a.$$.fragment,R),_=_.filter(Boolean);for(let V=0;V<_.length;V+=1)T(_[V]);T(f.$$.fragment,R),T(d.$$.fragment,R),T(F),P=P.filter(Boolean);for(let V=0;V<P.length;V+=1)T(P[V]);v=!1},d(R){R&&(k(t),k(n),k(s),k(i),k(c),k(p),k(y),k(g)),$(e,R),$(r,R),$(a,R),fr(_,R),$(f,R),$(d,R),F&&F.d(R),fr(P,R)}}}function Tx(o,e){return o.owner&&!e.owner?-1:e.owner&&!o.owner||o.name>e.name?1:-1}function wC(o,e,t){let r,n=Y,a=()=>(n(),n=Et(f,te=>t(3,r=te)),f),s;o.$$.on_destroy.push(()=>n());let{plugin:i}=e,{relays:f}=e;a();let c=i.sharedFolders;Oe(o,c,te=>t(4,s=te));let d="",p=!1,h=Lt();function y(te){te&&h("manageRelay",{relay:te})}function g(te,ve){te&&h("manageSharedFolder",{folder:te,relay:ve})}function v(){t(2,p=!1)}function b(te){return lt(this,void 0,void 0,function*(){try{let ve=yield i.relayManager.acceptInvitation(te);h("joinRelay",{relay:ve})}catch(ve){t(2,p=!0)}})}function _(){h("createRelay")}function D(){d=this.value,t(1,d)}let F=()=>b(d);function S(te){Lr.call(this,o,te)}let P=te=>{y(te)},H=()=>_();function R(te){Lr.call(this,o,te)}function V(te){Lr.call(this,o,te)}let O=te=>{let ve=r.values().find(ne=>{var fe;return((fe=te.remote)==null?void 0:fe.relay.guid)===ne.guid});g(te,ve)};return o.$$set=te=>{"plugin"in te&&t(11,i=te.plugin),"relays"in te&&a(t(0,f=te.relays))},[f,d,p,r,s,c,y,g,v,b,_,i,D,F,S,P,H,R,V,O]}var ad=class extends j{constructor(e){super(),X(this,e,wC,yC,J,{plugin:11,relays:0},iC)}},Ho=ad;var Ye=require("obsidian");var Yx=Fa(qs());function bC(o){let e,t,r,n,a,s,i,f,c;n=new oc({props:{size:16}});let d=o[3].default,p=me(d,o,o[4],null);return{c(){e=E("span"),t=ee(o[1]),r=W(),N(n.$$.fragment),a=W(),s=E("span"),p&&p.c(),L(e,"tabindex","0"),L(e,"role","button"),le(s,"flex","1"),le(s,"min-width","0"),le(s,"text-overflow","ellipsis"),le(s,"white-space","nowrap"),le(s,"overflow","hidden")},m(h,y){C(h,e,y),M(e,t),C(h,r,y),U(n,h,y),C(h,a,y),C(h,s,y),p&&p.m(s,null),i=!0,f||(c=[Q(e,"click",o[2]),Q(e,"keypress",o[2])],f=!0)},p(h,y){(!i||y&2)&&ie(t,h[1]),p&&p.p&&(!i||y&16)&&ge(p,d,h,h[4],i?he(d,h[4],y,null):xe(h[4]),null)},i(h){i||(I(n.$$.fragment,h),I(p,h),i=!0)},o(h){T(n.$$.fragment,h),T(p,h),i=!1},d(h){h&&(k(e),k(r),k(a),k(s)),$(n,h),p&&p.d(h),f=!1,Ce(c)}}}function _C(o){let e,t,r;var n=o[0];function a(s,i){return{props:{$$slots:{default:[bC]},$$scope:{ctx:s}}}}return n&&(t=qu(n,a(o))),{c(){e=E("h4"),t&&N(t.$$.fragment)},m(s,i){C(s,e,i),t&&U(t,e,null),r=!0},p(s,[i]){if(i&1&&n!==(n=s[0])){if(t){Se();let f=t;T(f.$$.fragment,1,0,()=>{$(f,1)}),Le()}n?(t=qu(n,a(s,i)),N(t.$$.fragment),I(t.$$.fragment,1),U(t,e,null)):t=null}else if(n){let f={};i&18&&(f.$$scope={dirty:i,ctx:s}),t.$set(f)}},i(s){r||(t&&I(t.$$.fragment,s),r=!0)},o(s){t&&T(t.$$.fragment,s),r=!1},d(s){s&&k(e),t&&$(t)}}}function vC(o,e,t){let{$$slots:r={},$$scope:n}=e,{category:a}=e,{categoryText:s}=e,i=Lt();function f(){i("goBack")}return o.$$set=c=>{"category"in c&&t(0,a=c.category),"categoryText"in c&&t(1,s=c.categoryText),"$$scope"in c&&t(4,n=c.$$scope)},[a,s,f,r,n]}var sd=class extends j{constructor(e){super(),X(this,e,vC,_C,J,{category:0,categoryText:1})}},ul=sd;var dl=require("obsidian");function SC(o){let e,t,r=o[0].shared&&Dx(o);return{c(){e=E("div"),r&&r.c(),L(e,"class","suggestion-icon")},m(n,a){C(n,e,a),r&&r.m(e,null),t=!0},p(n,a){n[0].shared?r?a&1&&I(r,1):(r=Dx(n),r.c(),I(r,1),r.m(e,null)):r&&(Se(),T(r,1,1,()=>{r=null}),Le())},i(n){t||(I(r),t=!0)},o(n){T(r),t=!1},d(n){n&&k(e),r&&r.d()}}}function LC(o){let e;return{c(){e=E("span"),e.textContent="Enter to create",L(e,"class","suggestion-action")},m(t,r){C(t,e,r)},p:Y,i:Y,o:Y,d(t){t&&k(e)}}}function Dx(o){let e,t;return e=new io({props:{class:"svg-icon"}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function IC(o){let e,t,r=o[0].folder+"",n,a,s,i,f,c,d=[LC,SC],p=[];function h(y,g){return y[0].exists?1:0}return i=h(o,-1),f=p[i]=d[i](o),{c(){e=E("div"),t=E("div"),n=ee(r),a=W(),s=E("div"),f.c(),L(t,"class","suggestion-title"),L(e,"class","suggestion-content"),L(s,"class","suggestion-aux")},m(y,g){C(y,e,g),M(e,t),M(t,n),C(y,a,g),C(y,s,g),p[i].m(s,null),c=!0},p(y,[g]){(!c||g&1)&&r!==(r=y[0].folder+"")&&ie(n,r);let v=i;i=h(y,g),i===v?p[i].p(y,g):(Se(),T(p[v],1,1,()=>{p[v]=null}),Le(),f=p[i],f?f.p(y,g):(f=p[i]=d[i](y),f.c()),I(f,1),f.m(s,null))},i(y){c||(I(f),c=!0)},o(y){T(f),c=!1},d(y){y&&(k(e),k(a),k(s)),p[i].d()}}}function kC(o,e,t){let{suggestion:r}=e;return o.$$set=n=>{"suggestion"in n&&t(0,r=n.suggestion)},[r]}var id=class extends j{constructor(e){super(),X(this,e,kC,IC,J,{suggestion:0})}},Ex=id;var cl=class extends dl.SuggestModal{constructor(t,r,n){super(t);this.sharedFolders=r;this.onChoose=n;this.components=[];this.sharedPaths=new Set(this.sharedFolders.map(a=>a.path)),this.hasRemotes=new Set(this.sharedFolders.filter(a=>a.remote!==void 0).map(a=>a.path)),this.setInstructions([{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}])}sortFn(t,r){return t.exists&&!r.exists?1:!t.exists&&r.exists||t.shared&&!r.shared?-1:r.shared&&!t.shared?1:t.folder.localeCompare(r.folder)}onClose(){super.onClose(),this.components.forEach(t=>{t.$destroy()})}getSuggestions(t){this.components.forEach(i=>{i.$destroy()});let r=t.toLowerCase(),n=[],a=this.app.vault.getAbstractFileByPath(t)!==null;t.length>0&&!a&&n.push({folder:t,exists:!1,shared:!1});let s=i=>{let f=this.sharedPaths.has(i.path),c=this.hasRemotes.has(i.path);if(i.path.toLowerCase().contains(r)&&i.path.length>1&&!c&&n.push({folder:i.path,exists:!0,shared:f}),!f)for(let d of i.children)d instanceof dl.TFolder&&s(d)};return s(this.app.vault.getRoot()),n.sort(this.sortFn)}renderSuggestion(t,r){r.addClass("mod-complex");let n=new Ex({target:r,props:{suggestion:t}});this.components.push(n)}onChooseSuggestion(t,r){this.onChoose(t.folder)}};var Ux=require("obsidian");var fd=require("obsidian");var Px=require("obsidian"),Mx=require("obsidian"),pl=class extends Mx.AbstractInputSuggest{constructor(t,r,n){super(t,n);this.app=t;this.sharedFolders=r;this.inputEl=n;this.sharedPaths=new Set(this.sharedFolders.map(a=>a.path))}getSuggestions(t){let r=t.toLowerCase(),n=[],a=s=>{if(!this.sharedPaths.has(s.path)){s.path.toLowerCase().contains(r)&&n.push(s.path);for(let f of s.children)f instanceof Px.TFolder&&a(f)}};return a(this.app.vault.getRoot()),n}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}};function CC(o){let e,t,r,n;return{c(){e=E("div"),t=E("input"),L(t,"type","text"),L(t,"placeholder","/"),L(e,"class","folder-suggest-container")},m(a,s){C(a,e,s),M(e,t),o[5](t),ur(t,o[2]),r||(n=[Q(t,"input",AC),Q(t,"input",o[6])],r=!0)},p(a,[s]){s&4&&t.value!==a[2]&&ur(t,a[2])},i:Y,o:Y,d(a){a&&k(e),o[5](null),r=!1,Ce(n)}}}function AC(){}function TC(o,e,t){let r,n=Y,a=()=>(n(),n=Et(d,y=>t(2,r=y)),d);o.$$.on_destroy.push(()=>n());let{app:s}=e,i,f,{sharedFolders:c}=e,{selectedFolder:d=He()}=e;a(),Sr(()=>{f=new pl(s,c,i);let y=g=>{a(t(0,d=g.detail.folder.path))};return i.addEventListener("folder-selected",y),()=>{i.removeEventListener("folder-selected",y)}}),Ku(()=>{f&&f.close()});function p(y){cr[y?"unshift":"push"](()=>{i=y,t(1,i)})}function h(){r=this.value,d.set(r)}return o.$$set=y=>{"app"in y&&t(3,s=y.app),"sharedFolders"in y&&t(4,c=y.sharedFolders),"selectedFolder"in y&&a(t(0,d=y.selectedFolder))},[d,i,r,s,c,p,h]}var ld=class extends j{constructor(e){super(),X(this,e,TC,CC,J,{app:3,sharedFolders:4,selectedFolder:0})}},Fx=ld;function DC(o){Ie(o,"svelte-hgd3zf","span.error.svelte-hgd3zf{flex:auto;align-content:center}")}function EC(o){let e,t,r;return{c(){e=E("input"),L(e,"type","text")},m(n,a){C(n,e,a),ur(e,o[4]),t||(r=Q(e,"input",o[8]),t=!0)},p(n,a){a&16&&e.value!==n[4]&&ur(e,n[4])},d(n){n&&k(e),t=!1,r()}}}function PC(o){let e,t;return e=new Fx({props:{app:o[0],sharedFolders:o[2],selectedFolder:o[7]}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n&1&&(a.app=r[0]),n&4&&(a.sharedFolders=r[2]),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function Rx(o){let e,t;return{c(){e=E("span"),t=ee(o[5]),L(e,"class","mod-warning error svelte-hgd3zf")},m(r,n){C(r,e,n),M(e,t)},p(r,n){n&32&&ie(t,r[5])},d(r){r&&k(e)}}}function MC(o){let e,t,r,n,a,s,i,f,c,d,p,h,y;n=new Be({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[EC]},$$scope:{ctx:o}}}),s=new Be({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[PC]},$$scope:{ctx:o}}});let g=o[5]&&Rx(o);return{c(){e=E("div"),e.textContent="Add to vault",t=W(),r=E("div"),N(n.$$.fragment),a=W(),N(s.$$.fragment),i=W(),f=E("div"),g&&g.c(),c=W(),d=E("button"),d.textContent="Confirm",L(e,"class","modal-title"),L(d,"class","mod-cta"),L(f,"class","modal-button-container"),L(r,"class","modal-content")},m(v,b){C(v,e,b),C(v,t,b),C(v,r,b),U(n,r,null),M(r,a),U(s,r,null),M(r,i),M(r,f),g&&g.m(f,null),M(f,c),M(f,d),p=!0,h||(y=Q(d,"click",function(){rt((0,fd.debounce)(o[9]))&&(0,fd.debounce)(o[9]).apply(this,arguments)}),h=!0)},p(v,[b]){o=v;let _={};b&1040&&(_.$$scope={dirty:b,ctx:o}),n.$set(_);let D={};b&1029&&(D.$$scope={dirty:b,ctx:o}),s.$set(D),o[5]?g?g.p(o,b):(g=Rx(o),g.c(),g.m(f,c)):g&&(g.d(1),g=null)},i(v){p||(I(n.$$.fragment,v),I(s.$$.fragment,v),p=!0)},o(v){T(n.$$.fragment,v),T(s.$$.fragment,v),p=!1},d(v){v&&(k(e),k(t),k(r)),$(n),$(s),g&&g.d(),h=!1,y()}}}function FC(o,e,t){let r,{app:n}=e,{remoteFolder:a}=e,{sharedFolders:s}=e,{onConfirm:i}=e,f=a.name,c=He();Oe(o,c,y=>t(6,r=y));let d="";function p(){f=this.value,t(4,f)}let h=async()=>{i(a,f,r||"").catch(y=>{t(5,d=y.message)})};return o.$$set=y=>{"app"in y&&t(0,n=y.app),"remoteFolder"in y&&t(1,a=y.remoteFolder),"sharedFolders"in y&&t(2,s=y.sharedFolders),"onConfirm"in y&&t(3,i=y.onConfirm)},[n,a,s,i,f,d,r,c,p,h]}var ud=class extends j{constructor(e){super(),X(this,e,FC,MC,J,{app:0,remoteFolder:1,sharedFolders:2,onConfirm:3},DC)}},Ox=ud;var ml=class extends Ux.Modal{constructor(t,r,n,a){super(t);this.sharedFolders=r;this.remoteFolder=n;this.onConfirm=a;this.onConfirm=a}onOpen(){let{contentEl:t}=this;this.component=new Ox({target:t,props:{remoteFolder:this.remoteFolder,sharedFolders:this.sharedFolders,onConfirm:async(r,n,a)=>{await this.onConfirm(r,n,a),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var dd=Fa($x());function RC(o){Ie(o,"svelte-xzg7gq",".system3-settings-danger-zone.svelte-xzg7gq{margin-top:6em}input.system3-updating.svelte-xzg7gq{border:1px solid var(--color-accent) !important}input.system3-input-invalid.svelte-xzg7gq{border:1px solid var(--color-red) !important}.faint.svelte-xzg7gq{color:var(--text-faint)}")}function Bx(o,e,t){let r=o.slice();return r[50]=e[t],r}function Nx(o,e,t){let r=o.slice();return r[53]=e[t],r}function OC(o){let e;return{c(){e=E("span"),e.textContent="(Untitled Relay Server)",L(e,"class","faint svelte-xzg7gq")},m(t,r){C(t,e,r)},p:Y,d(t){t&&k(e)}}}function UC(o){let e=o[0].name+"",t;return{c(){t=ee(e)},m(r,n){C(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].name+"")&&ie(t,e)},d(r){r&&k(t)}}}function $C(o){let e;function t(a,s){return a[0].name?UC:OC}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=Pe()},m(a,s){n.m(a,s),C(a,e,s)},p(a,s){r===(r=t(a,s))&&n?n.p(a,s):(n.d(1),n=r(a),n&&(n.c(),n.m(e.parentNode,e)))},d(a){a&&k(e),n.d(a)}}}function Hx(o){let e,t;return e=new Be({props:{name:"Name",description:"Set the Relay Server's name.",$$slots:{default:[BC]},$$scope:{ctx:o}}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n[0]&297|n[1]&33554432&&(a.$$scope={dirty:n,ctx:r}),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function BC(o){let e,t,r,n;return{c(){e=E("input"),L(e,"type","text"),L(e,"spellcheck","false"),L(e,"placeholder","Example: Shared Notes"),L(e,"class",t=la((o[8]?"system3-updating":"")+(o[5]?"":" system3-input-invalid"))+" svelte-xzg7gq")},m(a,s){C(a,e,s),ur(e,o[0].name),o[35](e),r||(n=[Q(e,"input",o[34]),Q(e,"input",o[26])],r=!0)},p(a,s){s[0]&288&&t!==(t=la((a[8]?"system3-updating":"")+(a[5]?"":" system3-input-invalid"))+" svelte-xzg7gq")&&L(e,"class",t),s[0]&1&&e.value!==a[0].name&&ur(e,a[0].name)},d(a){a&&k(e),o[35](null),r=!1,Ce(n)}}}function NC(o){let e,t;return e=new Bo({props:{$$slots:{name:[qC],default:[VC]},$$scope:{ctx:o}}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n[0]&512|n[1]&33554432&&(a.$$scope={dirty:n,ctx:r}),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function HC(o){let e,t;return e=new Bo({props:{$$slots:{name:[GC],default:[KC]},$$scope:{ctx:o}}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n[0]&1536|n[1]&33554432&&(a.$$scope={dirty:n,ctx:r}),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function VC(o){let e,t,r;function n(){return o[39](o[53])}return{c(){e=E("button"),e.textContent="Add to Vault",L(e,"class","mod-cta"),L(e,"aria-label","Add shared folder to vault")},m(a,s){C(a,e,s),t||(r=Q(e,"click",function(){rt((0,Ye.debounce)(n))&&(0,Ye.debounce)(n).apply(this,arguments)}),t=!0)},p(a,s){o=a},d(a){a&&k(e),t=!1,r()}}}function WC(o){let e=o[53].name+"",t;return{c(){t=ee(e)},m(r,n){C(r,t,n)},p(r,n){n[0]&512&&e!==(e=r[53].name+"")&&ie(t,e)},d(r){r&&k(t)}}}function qC(o){let e,t;return e=new hn({props:{slot:"name",$$slots:{default:[WC]},$$scope:{ctx:o}}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n[0]&512|n[1]&33554432&&(a.$$scope={dirty:n,ctx:r}),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function KC(o){let e,t;function r(){return o[38](o[53])}return e=new mn({}),e.$on("settings",function(){rt((0,Ye.debounce)(r))&&(0,Ye.debounce)(r).apply(this,arguments)}),{c(){N(e.$$.fragment)},m(n,a){U(e,n,a),t=!0},p(n,a){o=n},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){$(e,n)}}}function zC(o){let e=o[53].name+"",t;return{c(){t=ee(e)},m(r,n){C(r,t,n)},p(r,n){n[0]&512&&e!==(e=r[53].name+"")&&ie(t,e)},d(r){r&&k(t)}}}function GC(o){let e,t;function r(...n){return o[36](o[53],...n)}return e=new hn({props:{folder:o[10].find(r),slot:"name",$$slots:{default:[zC]},$$scope:{ctx:o}}}),e.$on("manageSharedFolder",o[37]),{c(){N(e.$$.fragment)},m(n,a){U(e,n,a),t=!0},p(n,a){o=n;let s={};a[0]&1536&&(s.folder=o[10].find(r)),a[0]&512|a[1]&33554432&&(s.$$scope={dirty:a,ctx:o}),e.$set(s)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){$(e,n)}}}function Vx(o){let e,t,r,n,a;function s(...d){return o[33](o[53],...d)}let i=[HC,NC],f=[];function c(d,p){return p[0]&1536&&(e=null),e==null&&(e=!!d[10].find(s)),e?0:1}return t=c(o,[-1,-1]),r=f[t]=i[t](o),{c(){r.c(),n=Pe()},m(d,p){f[t].m(d,p),C(d,n,p),a=!0},p(d,p){o=d;let h=t;t=c(o,p),t===h?f[t].p(o,p):(Se(),T(f[h],1,1,()=>{f[h]=null}),Le(),r=f[t],r?r.p(o,p):(r=f[t]=i[t](o),r.c()),I(r,1),r.m(n.parentNode,n))},i(d){a||(I(r),a=!0)},o(d){T(r),a=!1},d(d){d&&k(n),f[t].d(d)}}}function YC(o){let e,t,r;return{c(){e=E("button"),e.textContent="Share a folder",L(e,"class","mod-cta"),L(e,"aria-label","Select a folder to share it with this Relay Server")},m(n,a){C(n,e,a),t||(r=Q(e,"click",(0,Ye.debounce)(o[40])),t=!0)},p:Y,d(n){n&&k(e),t=!1,r()}}}function JC(o){let e=o[11].values().length+"",t,r,n=o[7].userLimit+"",a;return{c(){t=ee(e),r=ee(" / "),a=ee(n)},m(s,i){C(s,t,i),C(s,r,i),C(s,a,i)},p(s,i){i[0]&2048&&e!==(e=s[11].values().length+"")&&ie(t,e),i[0]&128&&n!==(n=s[7].userLimit+"")&&ie(a,n)},d(s){s&&(k(t),k(r),k(a))}}}function Wx(o){let e,t,r;function n(){return o[41](o[50])}return{c(){e=E("button"),e.textContent="Kick",L(e,"class","mod-destructive")},m(a,s){C(a,e,s),t||(r=Q(e,"click",function(){rt((0,Ye.debounce)(n))&&(0,Ye.debounce)(n).apply(this,arguments)}),t=!0)},p(a,s){o=a},d(a){a&&k(e),t=!1,r()}}}function jC(o){let e,t=o[50].role==="Member"&&o[7].owner&&Wx(o);return{c(){t&&t.c(),e=W()},m(r,n){t&&t.m(r,n),C(r,e,n)},p(r,n){r[50].role==="Member"&&r[7].owner?t?t.p(r,n):(t=Wx(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&k(e),t&&t.d(r)}}}function qx(o){let e,t;return e=new Be({props:{name:o[50].user.name,description:o[50].role,$$slots:{default:[jC]},$$scope:{ctx:o}}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n[0]&2048&&(a.name=r[50].user.name),n[0]&2048&&(a.description=r[50].role),n[0]&2176|n[1]&33554432&&(a.$$scope={dirty:n,ctx:r}),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function XC(o){let e,t,r;return{c(){e=E("input"),e.value=o[4],L(e,"type","text"),e.readOnly=!0,L(e,"id","system3InviteLink")},m(n,a){C(n,e,a),t||(r=Q(e,"click",(0,Ye.debounce)(o[30])),t=!0)},p(n,a){a[0]&16&&e.value!==n[4]&&(e.value=n[4])},d(n){n&&k(e),t=!1,r()}}}function ZC(o){let e,t,r,n;return e=new ft({props:{name:"Membership"}}),r=new Be({props:{name:"Leave Relay Server",description:"Leave the Relay Server. Local data is preserved.",$$slots:{default:[e2]},$$scope:{ctx:o}}}),{c(){N(e.$$.fragment),t=W(),N(r.$$.fragment)},m(a,s){U(e,a,s),C(a,t,s),U(r,a,s),n=!0},p(a,s){let i={};s[1]&33554432&&(i.$$scope={dirty:s,ctx:a}),r.$set(i)},i(a){n||(I(e.$$.fragment,a),I(r.$$.fragment,a),n=!0)},o(a){T(e.$$.fragment,a),T(r.$$.fragment,a),n=!1},d(a){a&&k(t),$(e,a),$(r,a)}}}function QC(o){let e,t,r,n,a,s,i,f=[r2,t2],c=[];function d(p,h){return p[12]?0:1}return e=d(o,[-1,-1]),t=c[e]=f[e](o),n=new ft({props:{name:"Storage"}}),s=new Be({props:{name:"Destroy Relay Server",description:"This will destroy the Relay Server (deleting all data on the server). Local data is preserved.",$$slots:{default:[c2]},$$scope:{ctx:o}}}),{c(){t.c(),r=W(),N(n.$$.fragment),a=W(),N(s.$$.fragment)},m(p,h){c[e].m(p,h),C(p,r,h),U(n,p,h),C(p,a,h),U(s,p,h),i=!0},p(p,h){let y=e;e=d(p,h),e===y?c[e].p(p,h):(Se(),T(c[y],1,1,()=>{c[y]=null}),Le(),t=c[e],t?t.p(p,h):(t=c[e]=f[e](p),t.c()),I(t,1),t.m(r.parentNode,r));let g={};h[0]&64|h[1]&33554432&&(g.$$scope={dirty:h,ctx:p}),s.$set(g)},i(p){i||(I(t),I(n.$$.fragment,p),I(s.$$.fragment,p),i=!0)},o(p){T(t),T(n.$$.fragment,p),T(s.$$.fragment,p),i=!1},d(p){p&&(k(r),k(a)),c[e].d(p),$(n,p),$(s,p)}}}function e2(o){let e,t,r;return{c(){e=E("button"),e.textContent="Leave",L(e,"class","mod-warning")},m(n,a){C(n,e,a),t||(r=Q(e,"click",(0,Ye.debounce)(o[45])),t=!0)},p:Y,d(n){n&&k(e),t=!1,r()}}}function t2(o){let e,t;return e=new Be({props:{name:`Plan: ${o[7].plan}`,description:"",$$slots:{description:[n2],default:[o2]},$$scope:{ctx:o}}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n[0]&128&&(a.name=`Plan: ${r[7].plan}`),n[0]&128|n[1]&33554432&&(a.$$scope={dirty:n,ctx:r}),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function r2(o){let e,t,r=!o[6].values()[0].active||o[6].values()[0].cancelAt,n,a;e=new Be({props:{name:`Plan: ${o[7].plan}`,description:"",$$slots:{description:[s2],default:[a2]},$$scope:{ctx:o}}});let s=r&&zx(o);return{c(){N(e.$$.fragment),t=W(),s&&s.c(),n=Pe()},m(i,f){U(e,i,f),C(i,t,f),s&&s.m(i,f),C(i,n,f),a=!0},p(i,f){let c={};f[0]&128&&(c.name=`Plan: ${i[7].plan}`),f[0]&4288|f[1]&33554432&&(c.$$scope={dirty:f,ctx:i}),e.$set(c),f[0]&64&&(r=!i[6].values()[0].active||i[6].values()[0].cancelAt),r?s?(s.p(i,f),f[0]&64&&I(s,1)):(s=zx(i),s.c(),I(s,1),s.m(n.parentNode,n)):s&&(Se(),T(s,1,1,()=>{s=null}),Le())},i(i){a||(I(e.$$.fragment,i),I(s),a=!0)},o(i){T(e.$$.fragment,i),T(s),a=!1},d(i){i&&(k(t),k(n)),$(e,i),s&&s.d(i)}}}function o2(o){let e,t,r;return{c(){e=E("button"),e.textContent="Upgrade",L(e,"class","mod-cta")},m(n,a){C(n,e,a),t||(r=Q(e,"click",function(){rt((0,Ye.debounce)(o[44]))&&(0,Ye.debounce)(o[44]).apply(this,arguments)}),t=!0)},p(n,a){o=n},d(n){n&&k(e),t=!1,r()}}}function n2(o){let e,t=(o[7].cta||"Thanks for supporting Relay development <3")+"",r;return{c(){e=E("fragment"),r=ee(t),L(e,"slot","description")},m(n,a){C(n,e,a),M(e,r)},p(n,a){a[0]&128&&t!==(t=(n[7].cta||"Thanks for supporting Relay development <3")+"")&&ie(r,t)},d(n){n&&k(e)}}}function Kx(o){let e,t,r;return{c(){e=E("button"),e.textContent="Cancel",L(e,"class","mod-destructive")},m(n,a){C(n,e,a),t||(r=Q(e,"click",function(){rt((0,Ye.debounce)(o[43]))&&(0,Ye.debounce)(o[43]).apply(this,arguments)}),t=!0)},p(n,a){o=n},d(n){n&&k(e),t=!1,r()}}}function a2(o){let e,t,r=o[6].values()[0].active&&!o[6].values()[0].cancelAt,n,a,s,i=r&&Kx(o);return{c(){e=E("button"),e.textContent="Manage",t=W(),i&&i.c(),n=Pe()},m(f,c){C(f,e,c),C(f,t,c),i&&i.m(f,c),C(f,n,c),a||(s=Q(e,"click",function(){rt((0,Ye.debounce)(o[42]))&&(0,Ye.debounce)(o[42]).apply(this,arguments)}),a=!0)},p(f,c){o=f,c[0]&64&&(r=o[6].values()[0].active&&!o[6].values()[0].cancelAt),r?i?i.p(o,c):(i=Kx(o),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(f){f&&(k(e),k(t),k(n)),i&&i.d(f),a=!1,s()}}}function s2(o){let e,t=o[7].cta+"",r;return{c(){e=E("fragment"),r=ee(t),L(e,"slot","description")},m(n,a){C(n,e,a),M(e,r)},p(n,a){a[0]&128&&t!==(t=n[7].cta+"")&&ie(r,t)},d(n){n&&k(e)}}}function zx(o){let e,t;return e=new Be({props:{description:"",$$slots:{name:[l2],default:[i2]},$$scope:{ctx:o}}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n[0]&64|n[1]&33554432&&(a.$$scope={dirty:n,ctx:r}),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function i2(o){let e=o[14](o[6].values()[0].cancelAt)+"",t;return{c(){t=ee(e)},m(r,n){C(r,t,n)},p(r,n){n[0]&64&&e!==(e=r[14](r[6].values()[0].cancelAt)+"")&&ie(t,e)},d(r){r&&k(t)}}}function l2(o){let e;return{c(){e=E("span"),e.textContent="Status: Cancelled",L(e,"slot","name"),L(e,"class","mod-warning")},m(t,r){C(t,e,r)},p:Y,d(t){t&&k(e)}}}function f2(o){let e,t,r;return{c(){e=E("button"),e.textContent="Destroy",L(e,"class","mod-warning")},m(n,a){C(n,e,a),t||(r=Q(e,"click",(0,Ye.debounce)(o[27])),t=!0)},p:Y,d(n){n&&k(e),t=!1,r()}}}function u2(o){let e,t;return{c(){e=E("button"),e.textContent="Destroy",e.disabled=t=!0,L(e,"class","mod-warning"),L(e,"aria-label","Cancel subscription to destroy Relay Server.")},m(r,n){C(r,e,n)},p:Y,d(r){r&&k(e)}}}function c2(o){let e,t;function r(s,i){return i[0]&64&&(e=null),e==null&&(e=s[6].values().length>0&&!s[6].values()[0].cancelAt),e?u2:f2}let n=r(o,[-1,-1]),a=n(o);return{c(){a.c(),t=Pe()},m(s,i){a.m(s,i),C(s,t,i)},p(s,i){n===(n=r(s,i))&&a?a.p(s,i):(a.d(1),a=n(s),a&&(a.c(),a.m(t.parentNode,t)))},d(s){s&&k(t),a.d(s)}}}function d2(o){let e,t,r,n,a,s,i,f,c,d,p,h,y,g,v,b,_,D,F;e=new ul({props:{category:No,categoryText:"Relay Servers",$$slots:{default:[$C]},$$scope:{ctx:o}}}),e.$on("goBack",o[23]);let S=o[0].owner&&Hx(o);n=new ft({props:{name:"Folders on this Relay Server"}});let P=ot(o[9].values()),H=[];for(let q=0;q<P.length;q+=1)H[q]=Vx(Nx(o,P,q));let R=q=>T(H[q],1,1,()=>{H[q]=null});i=new Be({props:{description:"",name:"",$$slots:{default:[YC]},$$scope:{ctx:o}}}),c=new ft({props:{name:"Users",$$slots:{default:[JC]},$$scope:{ctx:o}}});let V=ot(o[11].values().sort(Gx)),O=[];for(let q=0;q<V.length;q+=1)O[q]=qx(Bx(o,V,q));let te=q=>T(O[q],1,1,()=>{O[q]=null});h=new ft({props:{name:"Sharing"}}),g=new Be({props:{name:"Share Key",description:"Share this key with your collaborators.",$$slots:{default:[XC]},$$scope:{ctx:o}}});let ve=[QC,ZC],ne=[];function fe(q,Z){return q[7].owner?0:1}return b=fe(o,[-1,-1]),_=ne[b]=ve[b](o),{c(){N(e.$$.fragment),t=W(),S&&S.c(),r=W(),N(n.$$.fragment),a=W();for(let q=0;q<H.length;q+=1)H[q].c();s=W(),N(i.$$.fragment),f=W(),N(c.$$.fragment),d=W();for(let q=0;q<O.length;q+=1)O[q].c();p=W(),N(h.$$.fragment),y=W(),N(g.$$.fragment),v=W(),_.c(),D=Pe()},m(q,Z){U(e,q,Z),C(q,t,Z),S&&S.m(q,Z),C(q,r,Z),U(n,q,Z),C(q,a,Z);for(let Je=0;Je<H.length;Je+=1)H[Je]&&H[Je].m(q,Z);C(q,s,Z),U(i,q,Z),C(q,f,Z),U(c,q,Z),C(q,d,Z);for(let Je=0;Je<O.length;Je+=1)O[Je]&&O[Je].m(q,Z);C(q,p,Z),U(h,q,Z),C(q,y,Z),U(g,q,Z),C(q,v,Z),ne[b].m(q,Z),C(q,D,Z),F=!0},p(q,Z){let Je={};if(Z[0]&1|Z[1]&33554432&&(Je.$$scope={dirty:Z,ctx:q}),e.$set(Je),q[0].owner?S?(S.p(q,Z),Z[0]&1&&I(S,1)):(S=Hx(q),S.c(),I(S,1),S.m(r.parentNode,r)):S&&(Se(),T(S,1,1,()=>{S=null}),Le()),Z[0]&570426880){P=ot(q[9].values());let ue;for(ue=0;ue<P.length;ue+=1){let je=Nx(q,P,ue);H[ue]?(H[ue].p(je,Z),I(H[ue],1)):(H[ue]=Vx(je),H[ue].c(),I(H[ue],1),H[ue].m(s.parentNode,s))}for(Se(),ue=P.length;ue<H.length;ue+=1)R(ue);Le()}let Vt={};Z[1]&33554432&&(Vt.$$scope={dirty:Z,ctx:q}),i.$set(Vt);let Ue={};if(Z[0]&2176|Z[1]&33554432&&(Ue.$$scope={dirty:Z,ctx:q}),c.$set(Ue),Z[0]&268437632){V=ot(q[11].values().sort(Gx));let ue;for(ue=0;ue<V.length;ue+=1){let je=Bx(q,V,ue);O[ue]?(O[ue].p(je,Z),I(O[ue],1)):(O[ue]=qx(je),O[ue].c(),I(O[ue],1),O[ue].m(p.parentNode,p))}for(Se(),ue=V.length;ue<O.length;ue+=1)te(ue);Le()}let Xe={};Z[0]&16|Z[1]&33554432&&(Xe.$$scope={dirty:Z,ctx:q}),g.$set(Xe);let qe=b;b=fe(q,Z),b===qe?ne[b].p(q,Z):(Se(),T(ne[qe],1,1,()=>{ne[qe]=null}),Le(),_=ne[b],_?_.p(q,Z):(_=ne[b]=ve[b](q),_.c()),I(_,1),_.m(D.parentNode,D))},i(q){if(!F){I(e.$$.fragment,q),I(S),I(n.$$.fragment,q);for(let Z=0;Z<P.length;Z+=1)I(H[Z]);I(i.$$.fragment,q),I(c.$$.fragment,q);for(let Z=0;Z<V.length;Z+=1)I(O[Z]);I(h.$$.fragment,q),I(g.$$.fragment,q),I(_),F=!0}},o(q){T(e.$$.fragment,q),T(S),T(n.$$.fragment,q),H=H.filter(Boolean);for(let Z=0;Z<H.length;Z+=1)T(H[Z]);T(i.$$.fragment,q),T(c.$$.fragment,q),O=O.filter(Boolean);for(let Z=0;Z<O.length;Z+=1)T(O[Z]);T(h.$$.fragment,q),T(g.$$.fragment,q),T(_),F=!1},d(q){q&&(k(t),k(r),k(a),k(s),k(f),k(d),k(p),k(y),k(v),k(D)),$(e,q),S&&S.d(q),$(n,q),fr(H,q),$(i,q),$(c,q),fr(O,q),$(h,q),$(g,q),ne[b].d(q)}}}function Gx(o,e){return o.role==="Owner"&&e.role!=="Owner"?-1:o.role!=="Owner"&&e.role==="Owner"||o.user.name>e.user.name?1:-1}function p2(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function m2(o,e,t){let r,n,a=Y,s=()=>(a(),a=Et(H,K=>t(46,n=K)),H),i,f,c=Y,d=()=>(c(),c=Et(D,K=>t(7,f=K)),D),p,h,y,g=Y,v=()=>(g(),g=Et(P,K=>t(10,y=K)),P),b,_;o.$$.on_destroy.push(()=>a()),o.$$.on_destroy.push(()=>c()),o.$$.on_destroy.push(()=>g());let{relay:D}=e;d();let F=D.folders;Oe(o,F,K=>t(9,h=K));let{plugin:S}=e,{sharedFolders:P}=e;v();let{relayRoles:H}=e;s();function R(K){if(!K)return"Active";let Te=(0,dd.default)(),Ke=(0,dd.default)(K).diff(Te,"days");return Ke<=0?"Subscription has ended":Ke===1?"Active for 1 more day":`Active for ${Ke} more days`}let V=f.subscriptions;Oe(o,V,K=>t(6,i=K));let O=ds(i,K=>{if(K.values().length!==0)return K.values()[0]});Oe(o,O,K=>t(12,_=K));let te=n.filter(K=>{var Te;return((Te=K.relay)===null||Te===void 0?void 0:Te.id)===D.id});Oe(o,te,K=>t(11,b=K));let ve=He(!0);Oe(o,ve,K=>t(5,r=K));let ne;Sr(()=>{ne&&ne.value===""&&ne.focus()});let fe=Lt();function q(K){return lt(this,void 0,void 0,function*(){var Te;if(!(!((Te=S.loginManager)===null||Te===void 0)&&Te.user))return;let Qe={relay:K.id,quantity:10,user_email:S.loginManager.user.email},Ke=btoa(JSON.stringify(Qe)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(S.buildApiUrl(`/subscribe/${Ke}`),"_blank")})}function Z(K){return lt(this,void 0,void 0,function*(){let Te=K.token,Qe=K.id;window.open(S.buildApiUrl(`/subscriptions/${Qe}/manage?token=${Te}`),"_blank")})}function Je(K){return lt(this,void 0,void 0,function*(){let Te=K.token,Qe=K.id;window.open(S.buildApiUrl(`/subscriptions/${Qe}/cancel?token=${Te}`),"_blank")})}function Vt(){return lt(this,void 0,void 0,function*(){S.relayManager.leaveRelay(D),fe("goBack",{clear:!0})})}function Ue(){return lt(this,void 0,void 0,function*(){fe("goBack",{clear:!0})})}let Xe;S.relayManager.getRelayInvitationKey(D).then(K=>{t(4,Xe=K)});function qe(K,Te,Qe){return lt(this,void 0,void 0,function*(){let Ke=(0,Ye.normalizePath)((0,Yx.join)(Qe,Te));return S.vault.getFolderByPath(Ke)===null&&(yield S.vault.createFolder(Ke)),S.sharedFolders.new(Ke,K.guid,D.guid,!0).then(de=>(de.remote=K,S.sharedFolders.notifyListeners(),Nr(ir.enableDownloadOnAddToVault,()=>{S.backgroundSync.getFolderFiles(de)}),de))})}let ue=He(!1);Oe(o,ue,K=>t(8,p=K));let je=(0,Ye.debounce)(()=>{S.relayManager.updateRelay(D),ue.set(!1)},500,!0),oe=K=>{new ml(S.app,P,K,qe).open()};function Ar(){ve.set(p2(ne.value)),r&&ne.value!==""&&(ue.set(!0),je())}function Xt(){S.relayManager.destroyRelay(D),fe("goBack",{})}function ke(K){S.relayManager.kick(K)}function Rt(K,Te){K&&fe("manageSharedFolder",{folder:K,relay:Te,mount:!1})}function Tr(K){let Te=K.target;Te.focus(),Te.select(),navigator.clipboard.writeText(Te.value).then(()=>new Ye.Notice("Invite link copied")).catch(Qe=>{})}let yn=new cl(S.app,P,K=>lt(void 0,void 0,void 0,function*(){let Te=(0,Ye.normalizePath)(K),Qe=P.find(go=>go.path==K);if(Qe){let go=yield S.relayManager.createRemoteFolder(Qe,D);Qe.remote=go,Qe.connect(),S.sharedFolders.notifyListeners();return}S.vault.getFolderByPath(Te)===null&&(yield S.vault.createFolder(Te));let Ke=ti(),de=yield S.sharedFolders.new((0,Ye.normalizePath)(K),Ke,D.guid,!1),ho=yield S.relayManager.createRemoteFolder(de,D);de.remote=ho,S.sharedFolders.notifyListeners()})),Hl=(K,Te)=>Te.remote===K;function Vl(){D.name=this.value,d(t(0,D))}function Wl(K){cr[K?"unshift":"push"](()=>{ne=K,t(3,ne)})}let ql=(K,Te)=>Te.remote===K;function Kl(K){Lr.call(this,o,K)}let zl=K=>{let Te=y.find(Qe=>Qe.remote===K);Te&&Rt(Te,K.relay)},Gl=K=>{oe(K)},Yl=()=>{yn.open()},Wo=K=>{ke(K)},dt=()=>{Z(_)},Ot=()=>{Je(_)},La=()=>{q(f)},Ls=()=>{Vt()};return o.$$set=K=>{"relay"in K&&d(t(0,D=K.relay)),"plugin"in K&&t(32,S=K.plugin),"sharedFolders"in K&&v(t(1,P=K.sharedFolders)),"relayRoles"in K&&s(t(2,H=K.relayRoles))},[D,P,H,ne,Xe,r,i,f,p,h,y,b,_,F,R,V,O,te,ve,q,Z,Je,Vt,Ue,ue,oe,Ar,Xt,ke,Rt,Tr,yn,S,Hl,Vl,Wl,ql,Kl,zl,Gl,Yl,Wo,dt,Ot,La,Ls]}var pd=class extends j{constructor(e){super(),X(this,e,m2,d2,J,{relay:0,plugin:32,sharedFolders:1,relayRoles:2},RC,[-1,-1])}},ms=pd;function h2(o){let e,t,r,n,a,s;return r=new tc({}),{c(){e=E("div"),t=E("div"),N(r.$$.fragment),L(t,"class","clickable-icon"),L(t,"aria-label","Back"),L(t,"tabindex","0"),L(t,"role","button"),L(e,"class","modal-setting-nav-bar")},m(i,f){C(i,e,f),M(e,t),U(r,t,null),n=!0,a||(s=[Q(t,"click",o[0]),Q(t,"keypress",o[1])],a=!0)},p:Y,i(i){n||(I(r.$$.fragment,i),n=!0)},o(i){T(r.$$.fragment,i),n=!1},d(i){i&&k(e),$(r),a=!1,Ce(s)}}}function g2(o){let e=Lt();function t(){e("goBack",{})}function r(n){n.key==="Escape"&&(e("goBack",{}),n.stopPropagation())}return[t,r]}var md=class extends j{constructor(e){super(),X(this,e,g2,h2,J,{})}},Jx=md;var va=require("obsidian");function x2(o){let e=o[1].name+"",t;return{c(){t=ee(e)},m(r,n){C(r,t,n)},p(r,n){n&2&&e!==(e=r[1].name+"")&&ie(t,e)},d(r){r&&k(t)}}}function y2(o){let e,t,r;return{c(){e=E("button"),e.textContent="Delete local",L(e,"class","mod-warning")},m(n,a){C(n,e,a),t||(r=Q(e,"click",(0,va.debounce)(o[13])),t=!0)},p:Y,d(n){n&&k(e),t=!1,r()}}}function w2(o){let e,t,r,n,a,s,i;return{c(){e=E("button"),t=ee("Delete metadata"),L(e,"class",r=o[4]?"mod-disabled":"mod-warning"),e.disabled=n=!!o[4],L(e,"aria-label",a=o[4]?"Metadata is required for sharing.":"")},m(f,c){C(f,e,c),M(e,t),s||(i=Q(e,"click",(0,va.debounce)(o[14])),s=!0)},p(f,c){c&16&&r!==(r=f[4]?"mod-disabled":"mod-warning")&&L(e,"class",r),c&16&&n!==(n=!!f[4])&&(e.disabled=n),c&16&&a!==(a=f[4]?"Metadata is required for sharing.":"")&&L(e,"aria-label",a)},d(f){f&&k(e),s=!1,i()}}}function jx(o){var n,a,s,i,f;let e,t,r=(((n=o[4])==null?void 0:n.owner)||((i=(s=(a=o[3])==null?void 0:a.remote)==null?void 0:s.creator)==null?void 0:i.id)===((f=o[0].relayManager.user)==null?void 0:f.id))&&Xx(o);return{c(){r&&r.c(),e=Pe()},m(c,d){r&&r.m(c,d),C(c,e,d),t=!0},p(c,d){var p,h,y,g,v;(p=c[4])!=null&&p.owner||((g=(y=(h=c[3])==null?void 0:h.remote)==null?void 0:y.creator)==null?void 0:g.id)===((v=c[0].relayManager.user)==null?void 0:v.id)?r?(r.p(c,d),d&25&&I(r,1)):(r=Xx(c),r.c(),I(r,1),r.m(e.parentNode,e)):r&&(Se(),T(r,1,1,()=>{r=null}),Le())},i(c){t||(I(r),t=!0)},o(c){T(r),t=!1},d(c){c&&k(e),r&&r.d(c)}}}function Xx(o){let e,t,r,n;return e=new ft({props:{name:"Remote Folder"}}),r=new Be({props:{name:"Remove from relay",description:"Deletes the remote folder from the relay. Local files will be preserved.",$$slots:{default:[b2]},$$scope:{ctx:o}}}),{c(){N(e.$$.fragment),t=W(),N(r.$$.fragment)},m(a,s){U(e,a,s),C(a,t,s),U(r,a,s),n=!0},p(a,s){let i={};s&1048576&&(i.$$scope={dirty:s,ctx:a}),r.$set(i)},i(a){n||(I(e.$$.fragment,a),I(r.$$.fragment,a),n=!0)},o(a){T(e.$$.fragment,a),T(r.$$.fragment,a),n=!1},d(a){a&&k(t),$(e,a),$(r,a)}}}function b2(o){let e,t,r;return{c(){e=E("button"),e.textContent="Delete remote",L(e,"class","mod-destructive")},m(n,a){C(n,e,a),t||(r=Q(e,"click",(0,va.debounce)(o[9])),t=!0)},p:Y,d(n){n&&k(e),t=!1,r()}}}function _2(o){let e,t;return e=new Be({props:{description:"This folder is tracking edits, but is not connected to a Relay Server."}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p:Y,i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function v2(o){let e,t;return e=new Bo({props:{$$slots:{name:[I2],default:[S2]},$$scope:{ctx:o}}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n&1048592&&(a.$$scope={dirty:n,ctx:r}),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function S2(o){let e,t;return e=new mn({}),e.$on("settings",function(){rt((0,va.debounce)(o[16]))&&(0,va.debounce)(o[16]).apply(this,arguments)}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){o=r},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function L2(o){let e=o[4].name+"",t;return{c(){t=ee(e)},m(r,n){C(r,t,n)},p(r,n){n&16&&e!==(e=r[4].name+"")&&ie(t,e)},d(r){r&&k(t)}}}function I2(o){let e,t;return e=new No({props:{slot:"name",relay:o[4],$$slots:{default:[L2]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[15]),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n&16&&(a.relay=r[4]),n&1048592&&(a.$$scope={dirty:n,ctx:r}),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function k2(o){let e,t,r,n,a,s,i,f,c,d,p,h,y,g,v;e=new ul({props:{category:hn,categoryText:"Shared Folders",$$slots:{default:[x2]},$$scope:{ctx:o}}}),e.$on("goBack",o[7]),r=new ft({props:{name:"Local folder"}}),a=new Be({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[y2]},$$scope:{ctx:o}}}),i=new Be({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[w2]},$$scope:{ctx:o}}});let b=o[4]&&jx(o);d=new ft({props:{name:"Relay Server"}});let _=[v2,_2],D=[];function F(S,P){return S[4]?0:1}return h=F(o,-1),y=D[h]=_[h](o),{c(){N(e.$$.fragment),t=W(),N(r.$$.fragment),n=W(),N(a.$$.fragment),s=W(),N(i.$$.fragment),f=W(),b&&b.c(),c=W(),N(d.$$.fragment),p=W(),y.c(),g=Pe()},m(S,P){U(e,S,P),C(S,t,P),U(r,S,P),C(S,n,P),U(a,S,P),C(S,s,P),U(i,S,P),C(S,f,P),b&&b.m(S,P),C(S,c,P),U(d,S,P),C(S,p,P),D[h].m(S,P),C(S,g,P),v=!0},p(S,[P]){let H={};P&1048578&&(H.$$scope={dirty:P,ctx:S}),e.$set(H);let R={};P&1048576&&(R.$$scope={dirty:P,ctx:S}),a.$set(R);let V={};P&1048592&&(V.$$scope={dirty:P,ctx:S}),i.$set(V),S[4]?b?(b.p(S,P),P&16&&I(b,1)):(b=jx(S),b.c(),I(b,1),b.m(c.parentNode,c)):b&&(Se(),T(b,1,1,()=>{b=null}),Le());let O=h;h=F(S,P),h===O?D[h].p(S,P):(Se(),T(D[O],1,1,()=>{D[O]=null}),Le(),y=D[h],y?y.p(S,P):(y=D[h]=_[h](S),y.c()),I(y,1),y.m(g.parentNode,g))},i(S){v||(I(e.$$.fragment,S),I(r.$$.fragment,S),I(a.$$.fragment,S),I(i.$$.fragment,S),I(b),I(d.$$.fragment,S),I(y),v=!0)},o(S){T(e.$$.fragment,S),T(r.$$.fragment,S),T(a.$$.fragment,S),T(i.$$.fragment,S),T(b),T(d.$$.fragment,S),T(y),v=!1},d(S){S&&(k(t),k(n),k(s),k(f),k(c),k(p),k(g)),$(e,S),$(r,S),$(a,S),$(i,S),b&&b.d(S),$(d,S),D[h].d(S)}}}function C2(o,e,t){let r,n,a=Y,s=()=>(a(),a=Et(d,O=>t(17,n=O)),d),i;o.$$.on_destroy.push(()=>a());let{plugin:f}=e,{sharedFolder:c}=e,{sharedFolders:d}=e;s();let{relayRoles:p}=e,h=ds(n,O=>O.find(te=>te===c));Oe(o,h,O=>t(3,r=O));let y=ds([h,p],([O,te])=>{var ve;return(ve=te.find(ne=>{var fe;return ne.relay===((fe=O==null?void 0:O.remote)===null||fe===void 0?void 0:fe.relay)}))===null||ve===void 0?void 0:ve.relay});Oe(o,y,O=>t(4,i=O));let g;Sr(()=>{!c&&g&&g.value===""&&g.focus()});let v=Lt();function b(){return lt(this,void 0,void 0,function*(){v("goBack",{clear:!0})})}function _(O){O&&v("manageRelay",{relay:O})}function D(){return lt(this,void 0,void 0,function*(){yield f.relayManager.deleteRemote(c),f.sharedFolders.notifyListeners()})}function F(){return lt(this,void 0,void 0,function*(){r&&f.sharedFolders.delete(r),v("goBack",{clear:!0})})}function S(){let O=f.vault.getFolderByPath(c.path);O&&f.app.vault.trash(O,!1),v("goBack",{})}let P=()=>{S()},H=()=>{F()};function R(O){Lr.call(this,o,O)}let V=()=>{_(i)};return o.$$set=O=>{"plugin"in O&&t(0,f=O.plugin),"sharedFolder"in O&&t(1,c=O.sharedFolder),"sharedFolders"in O&&s(t(2,d=O.sharedFolders)),"relayRoles"in O&&t(12,p=O.relayRoles)},[f,c,d,r,i,h,y,b,_,D,F,S,p,P,H,R,V]}var hd=class extends j{constructor(e){super(),X(this,e,C2,k2,J,{plugin:0,sharedFolder:1,sharedFolders:2,relayRoles:12})}},Zx=hd;function A2(o){Ie(o,"svelte-iv3x1u",".relay-version.svelte-iv3x1u{user-select:auto;background:var(--color-base-10);color:var(--text-faint);position:absolute;bottom:0;right:0;font-size:xx-small;padding-right:1em;padding-top:0.3em;padding-left:1em;border-top-left-radius:1em}.vertical-tab-content.svelte-iv3x1u{max-height:var(--modal-max-height);position:relative}.system3-announcement-banner.svelte-iv3x1u{padding-left:48px !important;background-color:var(--color-red) !important}.system3-announcement.svelte-iv3x1u{color:var(--text-on-accent)}")}function T2(o){let e,t,r=o[0].networkStatus.status+"",n;return{c(){e=E("div"),t=E("span"),n=ee(r),L(t,"class","system3-announcement svelte-iv3x1u"),L(e,"class","modal-setting-nav-bar system3-announcement-banner svelte-iv3x1u")},m(a,s){C(a,e,s),M(e,t),M(t,n)},p(a,s){s&1&&r!==(r=a[0].networkStatus.status+"")&&ie(n,r)},i:Y,o:Y,d(a){a&&k(e)}}}function D2(o){let e,t;return e=new Jx({}),e.$on("goBack",o[9]),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p:Y,i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function E2(o){let e,t;return e=new hx({props:{plugin:o[0],$$slots:{default:[F2]},$$scope:{ctx:o}}}),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n&1&&(a.plugin=r[0]),n&262145&&(a.$$scope={dirty:n,ctx:r}),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function P2(o){let e,t;return e=new ms({props:{plugin:o[0],relayRoles:o[3],relay:o[2],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageSharedFolder",o[7]),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n&1&&(a.plugin=r[0]),n&4&&(a.relay=r[2]),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function M2(o){let e,t;return e=new Zx({props:{plugin:o[0],relayRoles:o[3],sharedFolder:o[1],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageRelay",o[6]),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n&1&&(a.plugin=r[0]),n&2&&(a.sharedFolder=r[1]),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function F2(o){let e,t;return e=new Ho({props:{relays:o[4],plugin:o[0]}}),e.$on("manageRelay",o[6]),e.$on("manageSharedFolder",o[7]),e.$on("createRelay",o[8]),e.$on("joinRelay",o[11]),{c(){N(e.$$.fragment)},m(r,n){U(e,r,n),t=!0},p(r,n){let a={};n&1&&(a.plugin=r[0]),e.$set(a)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){$(e,r)}}}function Qx(o){let e,t=o[0].version+"",r;return{c(){e=E("span"),r=ee(t),L(e,"class","relay-version svelte-iv3x1u")},m(n,a){C(n,e,a),M(e,r)},p(n,a){a&1&&t!==(t=n[0].version+"")&&ie(r,t)},d(n){n&&k(e)}}}function R2(o){let e,t,r,n,a,s,i,f,c,d=[D2,T2],p=[];function h(_,D){return _[2]||_[1]?0:_[0].networkStatus.status?1:-1}~(e=h(o,-1))&&(t=p[e]=d[e](o));let y=[M2,P2,E2],g=[];function v(_,D){return _[1]?0:_[2]?1:2}a=v(o,-1),s=g[a]=y[a](o);let b=o[0].manifest.version!==o[0].version&&Qx(o);return{c(){t&&t.c(),r=W(),n=E("div"),s.c(),i=W(),b&&b.c(),f=Pe(),L(n,"class","vertical-tab-content svelte-iv3x1u")},m(_,D){~e&&p[e].m(_,D),C(_,r,D),C(_,n,D),g[a].m(n,null),C(_,i,D),b&&b.m(_,D),C(_,f,D),c=!0},p(_,[D]){let F=e;e=h(_,D),e===F?~e&&p[e].p(_,D):(t&&(Se(),T(p[F],1,1,()=>{p[F]=null}),Le()),~e?(t=p[e],t?t.p(_,D):(t=p[e]=d[e](_),t.c()),I(t,1),t.m(r.parentNode,r)):t=null);let S=a;a=v(_,D),a===S?g[a].p(_,D):(Se(),T(g[S],1,1,()=>{g[S]=null}),Le(),s=g[a],s?s.p(_,D):(s=g[a]=y[a](_),s.c()),I(s,1),s.m(n,null)),_[0].manifest.version!==_[0].version?b?b.p(_,D):(b=Qx(_),b.c(),b.m(f.parentNode,f)):b&&(b.d(1),b=null)},i(_){c||(I(t),I(s),c=!0)},o(_){T(t),T(s),c=!1},d(_){_&&(k(r),k(n),k(i),k(f)),~e&&p[e].d(_),g[a].d(),b&&b.d(_)}}}function O2(o,e,t){let r,{plugin:n}=e,a=n.app,s=n.relayManager,i=s.relayRoles,f=s.relays;Oe(o,f,P=>t(14,r=P));let c=n.sharedFolders,d,p=Ho,h,y=[{component:Ho}],{close:g}=e;function v(P){y.push({currentRelay:h,sharedFolder:d,component:p}),t(2,h=P.detail.relay),t(1,d=void 0),t(13,p=ms)}function b(P){y.push({currentRelay:h,sharedFolder:d,component:p}),t(1,d=P.detail.folder),t(2,h=P.detail.relay)}function _(P){return lt(this,void 0,void 0,function*(){y.push({currentRelay:h,sharedFolder:d,component:p}),t(2,h=yield n.relayManager.createRelay("")),t(13,p=ms)})}function D(P){if(P.detail.clear){y.length=0,t(2,h=void 0),t(1,d=void 0),t(13,p=Ho);return}let H=y.pop();if(H)for(;H;){if(!H.currentRelay&&!H.sharedFolder)t(2,h=H.currentRelay),t(1,d=H.sharedFolder),t(13,p=H.component);else if(H.sharedFolder&&c.has(H.sharedFolder)){t(2,h=H.currentRelay),t(1,d=H.sharedFolder),t(13,p=H.component);break}else if(H.currentRelay&&s.relays.get(H.currentRelay.id)){t(2,h=H.currentRelay),t(1,d=H.sharedFolder),t(13,p=H.component);break}H=y.pop()}else t(2,h=void 0),t(1,d=void 0),t(13,p=Ho)}function F(P){y.length=0,g()}function S(P){t(2,h=P.detail.relay),t(13,p=ms)}return o.$$set=P=>{"plugin"in P&&t(0,n=P.plugin),"close"in P&&t(12,g=P.close)},o.$$.update=()=>{if(o.$$.dirty&16388){e:h&&!r.has(h.id)&&(t(2,h=void 0),t(13,p=Ho))}if(o.$$.dirty&2){e:d&&!c.has(d)&&(t(1,d=void 0),t(13,p=Ho))}if(o.$$.dirty&8198){e:(p||h||d)&&setTimeout(()=>{let P=document.querySelector(".vertical-tab-content");P&&(P.scrollTop=0)},0)}},[n,d,h,i,f,c,v,b,_,D,F,S,g,p,r]}var gd=class extends j{constructor(e){super(),X(this,e,O2,R2,J,{plugin:0,close:12},A2)}},ey=gd;var hl=class extends ty.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;this.targetEl=t.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new ey({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}hide(){var t;try{(t=this.component)==null||t.$destroy()}catch(r){console.warn(r)}}destroy(){this.hide(),this.plugin=null}};var ly=require("obsidian");var Pt=class extends Error{constructor(e){var t,r,n,a;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,Pt.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof Pt||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(a=(n=(r=this.originalError)==null?void 0:r.cause)==null?void 0:n.message)!=null&&a.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},gl=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function U2(o,e){let t={};if(typeof o!="string")return t;let r=Object.assign({},e||{}).decode||$2,n=0;for(;n<o.length;){let a=o.indexOf("=",n);if(a===-1)break;let s=o.indexOf(";",n);if(s===-1)s=o.length;else if(s<a){n=o.lastIndexOf(";",a-1)+1;continue}let i=o.slice(n,a).trim();if(t[i]===void 0){let f=o.slice(a+1,s).trim();f.charCodeAt(0)===34&&(f=f.slice(1,-1));try{t[i]=r(f)}catch(c){t[i]=f}}n=s+1}return t}function ry(o,e,t){let r=Object.assign({},t||{}),n=r.encode||B2;if(!gl.test(o))throw new TypeError("argument name is invalid");let a=n(e);if(a&&!gl.test(a))throw new TypeError("argument val is invalid");let s=o+"="+a;if(r.maxAge!=null){let i=r.maxAge-0;if(isNaN(i)||!isFinite(i))throw new TypeError("option maxAge is invalid");s+="; Max-Age="+Math.floor(i)}if(r.domain){if(!gl.test(r.domain))throw new TypeError("option domain is invalid");s+="; Domain="+r.domain}if(r.path){if(!gl.test(r.path))throw new TypeError("option path is invalid");s+="; Path="+r.path}if(r.expires){if(!function(f){return Object.prototype.toString.call(f)==="[object Date]"||f instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");s+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(s+="; HttpOnly"),r.secure&&(s+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":s+="; Priority=Low";break;case"medium":s+="; Priority=Medium";break;case"high":s+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return s}function $2(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function B2(o){return encodeURIComponent(o)}var ay;function xl(o){if(o)try{let e=decodeURIComponent(ay(o.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function sy(o,e=0){let t=xl(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}ay=typeof atob=="function"?atob:o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,n=0,a=0,s="";r=e.charAt(a++);~r&&(t=n%4?64*t+r:r,n++%4)?s+=String.fromCharCode(255&t>>(-2*n&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return s};var oy="pb_auth",hs=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!sy(this.token)}get isAdmin(){return xl(this.token).type==="admin"}get isAuthRecord(){return xl(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=oy){let r=U2(e||"")[t]||"",n={};try{n=JSON.parse(r),(typeof n===null||typeof n!="object"||Array.isArray(n))&&(n={})}catch(a){}this.save(n.token||"",n.model||null)}exportToCookie(e,t=oy){var f,c;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},n=xl(this.token);r.expires=n!=null&&n.exp?new Date(1e3*n.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let a={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},s=ry(t,JSON.stringify(a),e),i=typeof Blob!="undefined"?new Blob([s]).size:s.length;if(a.model&&i>4096){a.model={id:(f=a==null?void 0:a.model)==null?void 0:f.id,email:(c=a==null?void 0:a.model)==null?void 0:c.email};let d=["collectionId","username","verified"];for(let p in this.model)d.includes(p)&&(a.model[p]=this.model[p]);s=ry(t,JSON.stringify(a),e)}return s}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},yd=class extends hs{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}},uo=class{constructor(e){this.client=e}},wd=class extends uo{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then(()=>!0)}async generateAppleClientSecret(e,t,r,n,a,s){return s=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:n,duration:a}},s),this.client.send("/api/settings/apple/generate-client-secret",s)}},gs=class extends uo{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then(n=>{var a;return n.items=((a=n.items)==null?void 0:a.map(s=>this.decode(s)))||[],n})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(r=>{var n;if(!((n=r==null?void 0:r.items)!=null&&n.length))throw new Pt({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]})}async getOne(e,t){if(!e)throw new Pt({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(r=>this.decode(r))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(r=>this.decode(r))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then(n=>this.decode(n))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],n=async a=>this.getList(a,e||500,t).then(s=>{let i=s.items;return r=r.concat(i),i.length==s.perPage?n(a+1):r});return n(1)}};function Gt(o,e,t,r){let n=r!==void 0;return n||t!==void 0?n?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function xd(o){var e;(e=o._resetAutoRefresh)==null||e.call(o)}var bd=class extends gs{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then(n=>{var a,s;return((a=this.client.authStore.model)==null?void 0:a.id)===n.id&&((s=this.client.authStore.model)==null?void 0:s.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,a;return r&&((n=this.client.authStore.model)==null?void 0:n.id)===e&&((a=this.client.authStore.model)==null?void 0:a.collectionId)===void 0&&this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,n){let a={method:"POST",body:{identity:e,password:t}};a=Gt("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",a,r,n);let s=a.autoRefreshThreshold;delete a.autoRefreshThreshold,a.autoRefresh||xd(this.client);let i=await this.client.send(this.baseCrudPath+"/auth-with-password",a);return i=this.authResponse(i),s&&function(c,d,p,h){xd(c);let y=c.beforeSend,g=c.authStore.model,v=c.authStore.onChange((b,_)=>{(!b||(_==null?void 0:_.id)!=(g==null?void 0:g.id)||(_!=null&&_.collectionId||g!=null&&g.collectionId)&&(_==null?void 0:_.collectionId)!=(g==null?void 0:g.collectionId))&&xd(c)});c._resetAutoRefresh=function(){v(),c.beforeSend=y,delete c._resetAutoRefresh},c.beforeSend=async(b,_)=>{var P;let D=c.authStore.token;if((P=_.query)!=null&&P.autoRefresh)return y?y(b,_):{url:b,sendOptions:_};let F=c.authStore.isValid;if(F&&sy(c.authStore.token,d))try{await p()}catch(H){F=!1}F||await h();let S=_.headers||{};for(let H in S)if(H.toLowerCase()=="authorization"&&D==S[H]&&c.authStore.token){S[H]=c.authStore.token;break}return _.headers=S,y?y(b,_):{url:b,sendOptions:_}}}(this.client,s,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},a))),i}async authRefresh(e,t){let r={method:"POST"};return r=Gt("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=Gt("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,a){let s={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return s=Gt("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",s,n,a),this.client.send(this.baseCrudPath+"/confirm-password-reset",s).then(()=>!0)}},N2=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function iy(o){if(o){o.query=o.query||{};for(let e in o)N2.includes(e)||(o.query[e]=o[e],delete o[e])}}var yl=class extends uo{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var s;if(!e)throw new Error("topic must be set.");let n=e;if(r){iy(r);let i="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));n+=(n.includes("?")?"&":"?")+i}let a=function(i){let f=i,c;try{c=JSON.parse(f==null?void 0:f.data)}catch(d){}t(c||{})};return this.subscriptions[n]||(this.subscriptions[n]=[]),this.subscriptions[n].push(a),this.isConnected?this.subscriptions[n].length===1?await this.submitSubscriptions():(s=this.eventSource)==null||s.addEventListener(n,a):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,a)}async unsubscribe(e){var r;let t=!1;if(e){let n=this.getSubscriptionsByTopic(e);for(let a in n)if(this.hasSubscriptionListeners(a)){for(let s of this.subscriptions[a])(r=this.eventSource)==null||r.removeEventListener(a,s);delete this.subscriptions[a],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let n in this.subscriptions)if((n+"?").startsWith(e)){t=!0;for(let a of this.subscriptions[n])(r=this.eventSource)==null||r.removeEventListener(n,a);delete this.subscriptions[n]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var a;let r=!1,n=this.getSubscriptionsByTopic(e);for(let s in n){if(!Array.isArray(this.subscriptions[s])||!this.subscriptions[s].length)continue;let i=!1;for(let f=this.subscriptions[s].length-1;f>=0;f--)this.subscriptions[s][f]===t&&(i=!0,delete this.subscriptions[s][f],this.subscriptions[s].splice(f,1),(a=this.eventSource)==null||a.removeEventListener(s,t));i&&(this.subscriptions[s].length||delete this.subscriptions[s],r||this.hasSubscriptionListeners(s)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let n in this.subscriptions)if((r=this.subscriptions[n])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()}).then(()=>{for(let n of this.pendingConnects)n.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let n in r)for(let a of r[n])a(e)}).catch(r=>{this.clientId="",this.connectErrorHandler(r)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new Pt(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},_d=class extends gs{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then(n=>{var a,s,i;return((a=this.client.authStore.model)==null?void 0:a.id)!==(n==null?void 0:n.id)||((s=this.client.authStore.model)==null?void 0:s.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,a,s;return!r||((n=this.client.authStore.model)==null?void 0:n.id)!==e||((a=this.client.authStore.model)==null?void 0:a.collectionId)!==this.collectionIdOrName&&((s=this.client.authStore.model)==null?void 0:s.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,r,n){let a={method:"POST",body:{identity:e,password:t}};return a=Gt("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",a,r,n),this.client.send(this.baseCollectionPath+"/auth-with-password",a).then(s=>this.authResponse(s))}async authWithOAuth2Code(e,t,r,n,a,s,i){let f={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:n,createData:a}};return f=Gt("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",f,s,i),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",f).then(c=>this.authResponse(c))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find(f=>f.name===t.provider);if(!r)throw new Pt(new Error(`Missing or invalid provider "${t.provider}".`));let n=this.client.buildUrl("/api/oauth2-redirect"),a=new yl(this.client),s=null;function i(){s==null||s.close(),a.unsubscribe()}return t.urlCallback||(s=ny(void 0)),new Promise(async(f,c)=>{var d;try{await a.subscribe("@oauth2",async g=>{let v=a.clientId;try{if(!g.state||v!==g.state)throw new Error("State parameters don't match.");let b=Object.assign({},t);delete b.provider,delete b.scopes,delete b.createData,delete b.urlCallback;let _=await this.authWithOAuth2Code(r.name,g.code,r.codeVerifier,n,t.createData,b);f(_)}catch(b){c(new Pt(b))}i()});let p={state:a.clientId};(d=t.scopes)!=null&&d.length&&(p.scope=t.scopes.join(" "));let h=this._replaceQueryParams(r.authUrl+n,p);await(t.urlCallback||function(g){s?s.location.href=g:s=ny(g)})(h)}catch(p){i(),c(new Pt(p))}})}async authRefresh(e,t){let r={method:"POST"};return r=Gt("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then(n=>this.authResponse(n))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=Gt("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,a){let s={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return s=Gt("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",s,n,a),this.client.send(this.baseCollectionPath+"/confirm-password-reset",s).then(()=>!0)}async requestVerification(e,t,r){let n={method:"POST",body:{email:e}};return n=Gt("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-verification",n).then(()=>!0)}async confirmVerification(e,t,r){let n={method:"POST",body:{token:e}};return n=Gt("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",n).then(()=>!0)}async requestEmailChange(e,t,r){let n={method:"POST",body:{newEmail:e}};return n=Gt("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",n).then(()=>!0)}async confirmEmailChange(e,t,r,n){let a={method:"POST",body:{token:e,password:t}};return a=Gt("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",a,r,n),this.client.send(this.baseCollectionPath+"/confirm-email-change",a).then(()=>!0)}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then(()=>!0)}_replaceQueryParams(e,t={}){let r=e,n="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),n=e.substring(e.indexOf("?")+1));let a={},s=n.split("&");for(let i of s){if(i=="")continue;let f=i.split("=");a[decodeURIComponent(f[0].replace(/\+/g," "))]=decodeURIComponent((f[1]||"").replace(/\+/g," "))}for(let i in t)t.hasOwnProperty(i)&&(t[i]==null?delete a[i]:a[i]=t[i]);n="";for(let i in a)a.hasOwnProperty(i)&&(n!=""&&(n+="&"),n+=encodeURIComponent(i.replace(/%20/g,"+"))+"="+encodeURIComponent(a[i].replace(/%20/g,"+")));return n!=""?r+"?"+n:r}};function ny(o){if(typeof window=="undefined"||!(window!=null&&window.open))throw new Pt(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,n=window.innerHeight;e=e>r?r:e,t=t>n?n:t;let a=r/2-e/2,s=n/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+s+",left="+a+",resizable,menubar=no")}var vd=class extends gs{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then(()=>!0)}},Sd=class extends uo{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new Pt({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},Ld=class extends uo{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},Id=class extends uo{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let n=[];n.push("api"),n.push("files"),n.push(encodeURIComponent(e.collectionId||e.collectionName)),n.push(encodeURIComponent(e.id)),n.push(encodeURIComponent(t));let a=this.client.buildUrl(n.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let s=new URLSearchParams(r);a+=(a.includes("?")?"&":"?")+s}return a}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}},kd=class extends uo{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},wl=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new yd,this.admins=new bd(this),this.collections=new vd(this),this.files=new Id(this),this.logs=new Sd(this),this.settings=new wd(this),this.realtime=new yl(this),this.health=new Ld(this),this.backups=new kd(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new _d(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let n=t[r];switch(typeof n){case"boolean":case"number":n=""+n;break;case"string":n="'"+n.replace(/'/g,"\\'")+"'";break;default:n=n===null?"null":n instanceof Date?"'"+n.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(n).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",n)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let n=Object.assign({},await this.beforeSend(r,t));n.url!==void 0||n.options!==void 0?(r=n.url||r,t=n.options||t):Object.keys(n).length&&(t=n,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let n=this.serializeQueryParams(t.query);n&&(r+=(r.includes("?")?"&":"?")+n),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then(async n=>{let a={};try{a=await n.json()}catch(s){}if(this.afterSend&&(a=await this.afterSend(n,a)),n.status>=400)throw new Pt({url:n.url,status:n.status,data:a});return a}).catch(n=>{throw new Pt(n)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),iy(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let n=new AbortController;this.cancelControllers[r]=n,t.signal=n.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let n=this.normalizeFormDataValue(e[r]),a=Array.isArray(n)?n:[n];if(a.length)for(let s of a)t.append(r,s);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter(t=>typeof t!="string").length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let n of r)if(typeof Blob!="undefined"&&n instanceof Blob||typeof File!="undefined"&&n instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let n=e[r],a=encodeURIComponent(r);if(Array.isArray(n))for(let s of n)t.push(a+"="+encodeURIComponent(s));else n instanceof Date?t.push(a+"="+encodeURIComponent(n.toISOString())):typeof n!==null&&typeof n=="object"?t.push(a+"="+encodeURIComponent(JSON.stringify(n))):t.push(a+"="+encodeURIComponent(n))}return t.join("&")}};var bl=class extends hs{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(n){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let n=r;typeof r!="string"&&(n=JSON.stringify(r)),window.localStorage.setItem(t,n)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};var _l=class extends zt{constructor(t,r,n){super();this._log=ae("[LoginManager]");let a=ae("[Pocketbase]","debug");this.authStore=new bl(`pocketbase_auth_${t}`),this.pb=new wl("https://auth.system3.md",this.authStore),this.pb.beforeSend=(s,i)=>(a(s,i),i.fetch=pn,i.headers=Object.assign({},i.headers,{"Relay-Version":"0.4.1"}),{url:s,options:i}),this.refreshToken(),n.setInterval(()=>this.refreshToken(),864e5),this.openSettings=r,Nt.set(this,"loginManager")}log(t,...r){this._log(t,...r)}refreshToken(){this.pb.authStore.isValid&&(this.user=this.makeUser(this.pb.authStore),this.pb.collection("users").authRefresh().then(t=>{let r=t.token,[,n]=r.split("."),a=JSON.parse(atob(n)),s=new Date(a.exp*1e3),i=new Date,f=Math.ceil((s.getTime()-i.getTime())/(1e3*60*60*24));this._log("Token Refreshed"),this._log("JWT Info:",{expiresAt:s.toLocaleString(),expiresIn:`${f} days`,userId:a.id,email:a.email})}))}setup(t){var r,n;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore,(r=t==null?void 0:t.meta)==null?void 0:r.rawUser),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(n=t.meta)==null?void 0:n.rawUser}).then(()=>{this.notifyListeners()}).catch(a=>{this.log(a)}),!0):(this.notifyListeners(),!1)}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,ly.requestUrl)({url:"https://api.system3.md/whoami",method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}get hasUser(){return this.user!==void 0}makeUser(t,r){var n,a,s,i;return new ll((n=t.model)==null?void 0:n.id,((a=t.model)==null?void 0:a.name)||(r==null?void 0:r.name),(s=t.model)==null?void 0:s.email,((i=t.model)==null?void 0:i.picture)||(r==null?void 0:r.picture),t.token)}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}async initiateManualOAuth2CodeFlow(t){let n=(await this.pb.collection("users").listAuthMethods({fetch:t}).catch(s=>{throw s.originalError})).authProviders[0],a=this.pb.buildUrl("/api/oauth2-redirect");return[n.authUrl+a,n,async s=>this.pb.collection("users").authWithOAuth2Code(n.name,s,n.codeVerifier,a,{fetch:t}).then(i=>(this.setup(i),i))]}async poll(t,r){let n=0,a=1e3;return new Promise((s,i)=>{let f=setInterval(()=>{if(n+=1,n>30)return clearInterval(f),i(new Error(`Auth timeout: Timed out after ${n*a/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.state.slice(0,15)).then(c=>{if(c)return clearInterval(f),s(r(c.code))}).catch(c=>{})},a)})}async login(){let t=await this.pb.collection("users").authWithOAuth2({provider:"google"});return this.setup(t)}async openLoginPage(){return await this.openSettings(),await new Promise((r,n)=>{let a=()=>{this.loggedIn&&(this.off(a),r(!0)),r(!1)};this.on(a)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};function Cd(o,e){let t=Object.keys(e).map(r=>H2(o,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function H2(o,e,t){let r=o[e],n=o.hasOwnProperty(e),a=n?r:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},s=t(a);return r&&Object.setPrototypeOf(s,r),Object.setPrototypeOf(i,s),o[e]=i,f;function i(...c){return s===a&&o[e]===i&&f(),s.apply(this,c)}function f(){o[e]===i&&(n?o[e]=a:delete o[e]),s!==a&&(s=a,Object.setPrototypeOf(i,r||Function))}}var It=crypto;var Vr=new TextEncoder,Yt=new TextDecoder,y4=2**32;var fy=o=>{let e=o;typeof e=="string"&&(e=Vr.encode(e));let t=32768,r=[];for(let n=0;n<e.length;n+=t)r.push(String.fromCharCode.apply(null,e.subarray(n,n+t)));return btoa(r.join(""))},kr=o=>fy(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),uy=o=>{let e=atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},gn=o=>{let e=o;e instanceof Uint8Array&&(e=Yt.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return uy(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var Ad={};gf(Ad,{JOSEAlgNotAllowed:()=>ys,JOSEError:()=>bt,JOSENotSupported:()=>at,JWEDecryptionFailed:()=>ws,JWEInvalid:()=>Jt,JWKInvalid:()=>Sl,JWKSInvalid:()=>Ll,JWKSMultipleMatchingKeys:()=>Il,JWKSNoMatchingKey:()=>bs,JWKSTimeout:()=>kl,JWSInvalid:()=>co,JWSSignatureVerificationFailed:()=>_s,JWTClaimValidationFailed:()=>xs,JWTExpired:()=>vl,JWTInvalid:()=>Mt});var bt=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},xs=class extends bt{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},vl=class extends bt{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},ys=class extends bt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},at=class extends bt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},ws=class extends bt{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},Jt=class extends bt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},co=class extends bt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},Mt=class extends bt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},Sl=class extends bt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},Ll=class extends bt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},bs=class extends bt{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},Il=class extends bt{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},kl=class extends bt{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},_s=class extends bt{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var Cl=It.getRandomValues.bind(It);function z2(o){return typeof o=="object"&&o!==null}function Ft(o){if(!z2(o)||Object.prototype.toString.call(o)!=="[object Object]")return!1;if(Object.getPrototypeOf(o)===null)return!0;let e=o;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(o)===e}var nA=Symbol();var mA,Dl,_y;(typeof navigator=="undefined"||!((_y=(Dl=navigator.userAgent)==null?void 0:Dl.startsWith)!=null&&_y.call(Dl,"Mozilla/5.0 ")))&&(mA="jose/v5.3.0");var Ed={};gf(Ed,{decode:()=>El,encode:()=>hA});var hA=kr,El=gn;function Pd(o){if(typeof o!="string")throw new Mt("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=o.split(".");if(t===5)throw new Mt("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new Mt("Invalid JWT");if(!e)throw new Mt("JWTs must contain a payload");let r;try{r=El(e)}catch(a){throw new Mt("Failed to base64url decode the payload")}let n;try{n=JSON.parse(Yt.decode(r))}catch(a){throw new Mt("Failed to parse the decoded payload as JSON")}if(!Ft(n))throw new Mt("Invalid JWT Claims Set");return n}var xn=class extends Error{constructor(e){super(e),this.name="[System3] Relay Error"}};function vy(o){return o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3)}s`:o<36e5?`${Math.round(o/6e4)}m`:`${Math.round(o/36e5)}h`}function gA(o){let e=Pd(o.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var Pl=class{constructor(e,t=5){this.expiryMargin=5*60*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=gA,this.maxConnections=t,this.refreshInterval=null}onRefresh(e){return new Promise((r,n)=>{let a=i=>{r(i)},s=i=>{n(i)};this.refresh(e,a,s)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=n=>{this.onTokenRefreshed(e,n),this.activeConnections--;let a=this.dequeue();a&&this.addToRefreshQueue(a)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let n=this.dequeue();n&&this.addToRefreshQueue(n)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let n=this.tokenMap.get(e),a=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...n,token:t,expiryTime:r}),a(t),this.log(`Token refreshed for ${n.friendlyName} (${e})`)}}onRefreshFailure(e){let t=this.tokenMap.get(e),r=(t==null?void 0:t.attempts)||0+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){let n=this._activePromises.get(e);if(n)return n;this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:0}),this.callbacks.set(e,r);let a=this.onRefresh(e).then(s=>(this.onTokenRefreshed(e,s),this._activePromises.delete(e),s)).catch(s=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),s});return this._activePromises.set(e,a),a}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new xn("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let n=this.tokenMap.get(e);if(n.token&&this.isTokenValid(n))return this.callbacks.set(e,r),n.friendlyName=t,r(n.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(n.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),n=Array.from(this.tokenMap.entries()).sort((a,s)=>a[1].expiryTime-s[1].expiryTime);for(let[a,{friendlyName:s,expiryTime:i,attempts:f}]of n){if(!e(a))continue;let c=i-r,d="";c>0?d=`expires in ${vy(c-this.expiryMargin)}`:d="expired",t.push(`${a} (${s}): ${f} attempts, (${d})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${vy(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(){this.tokenMap.clear(),this.refreshQueue.clear()}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};var Sy=require("obsidian");var Ml=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let n=r.split(`${this.namespace}${this.seperator}`)[1],a=this.get(n);e.call(t,a,n,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};function xA(o){return o.expiryTime||0}function yA(o,e){return(...t)=>e(o,...t)}async function wA(o,e,t,r){var c;let n=ae("[TokenStore][Refresh]","debug"),a=ae("[TokenStore][Refresh]","error");n(`${e}`);let s=Br.decode(e),i;if(s instanceof vr)i=JSON.stringify({docId:s.documentId,relay:s.relayId});else if(s instanceof ar)i=JSON.stringify({docId:s.folderId,relay:s.relayId});else{r(new Error("No remote to connect to"));return}if(!o.loggedIn){r(Error("Not logged in"));return}let f={Authorization:`Bearer ${(c=o.user)==null?void 0:c.token}`,"Relay-Version":"0.4.1"};(0,Sy.requestUrl)({url:"https://api.system3.md/token",method:"POST",headers:f,body:i}).then(d=>{d.status!==200&&(n(d.status,d.text),r(Error(`Received status code ${d.status} from an API.`)));let p=d.json;t(p)}).catch(d=>{a(d,i),r(d)})}var Fl=class extends Pl{constructor(e,t,r,n=5){super({log:ae("[LiveTokenStore]","debug"),refresh:yA(e,wA),getJwtExpiry:xA,getStorage:function(){return new Ml("TokenStore/"+r)},getTimeProvider:()=>t},n)}};var Ly=require("obsidian");var Md=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=ae("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,Ly.requestUrl)({url:this.url,method:"HEAD",headers:{"Relay-Version":"0.4.1"}}).then(e=>{if(e.text&&(this.status=e.text),e.status===200&&!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t(this.status)),this._onceOnline.forEach(t=>t(this.status)),this._onceOnline.clear();return}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,this.onOffline.forEach(t=>t(this.status))})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},Iy=Md;var Cr=class extends zt{constructor(t){super();this.observableName=t;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,n]of this._map)if(t(n,r))return n}some(t){for(let[r,n]of this._map)if(t(n,r))return!0;return!1}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let n=new Fd(this,t);return this._derivedMaps.set(t,n),n}},Fd=class extends Cr{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.sub(),this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(()=>{let t=new Map;this.parentMap.forEach((r,n)=>{this.predicate(r,n)&&t.set(n,r)}),this._map=t,this.notifyListeners()}))}subscribe(t){return this.sub(),super.subscribe(t),()=>{this.unsubscribe(t)}}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){this.unsub&&this.unsub()}};function Rd(o){return typeof o.id=="string"}function bA(o){return typeof o.name=="string"}var Od=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function ky(o){return typeof o.aggregate_root=="object"}function Cy(o){return typeof o.acl=="object"}var Ss=class{get aggregate_root(){}get acl(){}},Rl=class extends Ss{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}update(t){return this.user=t,this}},Ud=class extends Ss{constructor(t,r,n){super();this.remoteFolder=t;this.relays=r;this.users=n}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get aggregate_root(){return["relays",this.remoteFolder.relay]}get acl(){return["relays",this.remoteFolder.relay]}},$d=class{constructor(e,t,r){this.remoteFolders=e;this.relays=t;this.users=r;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new Ud(e,this.relays,this.users);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},Bd=class{constructor(e,t,r,n,a,s,i){this.relays=e;this.roles=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=a;this.subscriptions=s;this.user=i;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new Ol(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},Nd=class{constructor(e,t,r,n){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=n}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new Kd(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},Hd=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new zd(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},Vd=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new Rl(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},Wd=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new Gd(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},qd=class{constructor(e){this.collections=new Map,this.relationships=new Map;for(let t of e)this.collections.set(t.collectionName,t);this.error=ae("[Store]","error"),this.warn=ae("[Store]","warn"),Nt.set(this,"Store")}getCollection(e){let t=this.collections.get(e);if(!t)throw this.error("No collection found for",e),new Error("No collection found for "+e);return t}clear(){let e=sr.getInstance();e.beginTransaction(),this.collections.forEach(t=>{t.clear()}),this.collections.clear(),this.relationships.clear(),e.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(e){return this.ingestBatch(e==null?void 0:e.items)}ingestBatch(e){if(e)return e.map(t=>this.ingest(t))}ingest(e){let t=sr.getInstance();t.beginTransaction();let r=this._ingest(e);return t.commitTransaction(),r}_ingest(e){if(!e)return;let t,r=this.collections.get(e.collectionName);if(r?t=r.ingest(e):this.error("No collection found for record",e),ky(t)){let n=t.aggregate_root;if(n){let a=e.id,s=this.relationships.get(n.join(":"))||new Set;s.add([e.collectionName,a].join(":")),this.relationships.set(n.join(":"),s)}}if(Cy(t)){let n=t.acl;if(n){let a=e.id,s=this.relationships.get(n.join(":"))||new Set;s.add([e.collectionName,a].join(":")),this.relationships.set(n.join(":"),s)}}if(e.expand)for(let[,n]of Object.entries(e.expand))Array.isArray(n)?this.ingestBatch(n):this.ingest(n);return t}delete(e){this.cascade(e.collectionName,e.id)}graphviz(){let e=`digraph G {
`;for(let[t,r]of this.collections)for(let n of r.items()){if(!Rd(n)){this.warn("record has no id",n);continue}let a=t+"_"+n.id;if(bA(n)&&(a=t+"_"+n.name),e+=`  ${t}_${n.id} [label="${a}"];
`,Rd(n)&&ky(n)&&n.aggregate_root){let[s,i]=n.aggregate_root;e+=`  ${t}_${n.id} -> ${s}_${i};
`}if(Rd(n)&&Cy(n)&&n.acl){let[s,i]=n.acl;e+=`  ${t}_${n.id} -> ${s}_${i} [style=dotted];
`}}return e+="}",e}cascade(e,t){let r=this.collections.get(e),n=this.relationships.get([e,t].join(":")),a=sr.getInstance();a.beginTransaction(),r&&(this.warn("cascade delete parent",e,t),r.delete(t)),this.relationships.delete([e,t].join(":"));for(let s of n||[]){let[i,f]=s.split(":");this.warn("cascade delete child",i,f),this.getCollection(i)&&this.cascade(i,f)}a.commitTransaction()}},Kd=class extends Ss{constructor(t,r,n,a){super();this.users=n,this.roles=a,this.relays=r,this.relayRole=t}update(t){return this.relayRole=t,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let t=this.users.get(this.relayRole.user);if(!t)throw new Error(`Unable to find user: ${this.relayRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.relayRole.role))==null?void 0:t.name}get relayId(){return this.relayRole.relay}get relay(){let t=this.relays.get(this.relayRole.relay);if(!t)throw new Error("invalid role");return t}get aggregate_root(){return["relays",this.relayRole.relay]}get acl(){return["users",this.relayRole.user]}},zd=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get aggregate_root(){return["relays",this.relayInvitation.relay]}},Gd=class extends zt{constructor(t,r,n){super();this.subscription=t;this.relays=r;this.users=n}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get acl(){return["users",this.subscription.user]}},Ol=class extends zt{constructor(t,r,n,a,s,i){super();this.relay=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=a;this._subscriptions=s;this.user=i;this.log=ae("[RelayAuto]","log"),this.warn=ae("[RelayAuto]","warn")}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get userLimit(){return this.relay.user_limit}get role(){var n;let t=this.relay.creator===this.user.id,r=(n=this.relayRoles.find(a=>{var s;return((s=a.relay)==null?void 0:s.id)===this.relay.id&&a.user.id===this.user.id}))==null?void 0:n.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get folders(){return this.remoteFolders.filter(t=>t.relay.id===this.id)}get subscriptions(){return this._subscriptions.filter(t=>t.relay.id===this.id)}get acl(){var r;let t=(r=this.relayRoles.find(n=>n.relay.id===this.id&&n.user.id===this.user.id))==null?void 0:r.id;if(t)return["relay_roles",t]}},Ul=class{constructor(e){this.loginManager=e;this.log=ae("[RelayManager]","log"),this.debug=ae("[RelayManager]","debug"),this.warn=ae("[RelayManager]","warn"),this.pb=this.loginManager.pb,this.users=new Cr("users"),this.relays=new Cr("relays"),this.remoteFolders=new Cr("remote folders"),this.relayInvitations=new Cr("relay invitations"),this.relayRoles=new Cr("relay roles"),this.roles=new Cr("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new Cr("subscriptions"),this._offLoginManager=this.loginManager.subscribe(()=>{this.login()}),this.setUser(),this.user&&(Nt.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user||this.store)return;let e=new Od(this.roles),t=new Vd(this.users),r=new Bd(this.relays,this.roles,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user),n=new Nd(this.relayRoles,this.relays,this.users,this.roles),a=new Hd(this.relayInvitations,this.relays,this.roles),s=new $d(this.remoteFolders,this.relays,this.users),i=new Wd(this.subscriptions,this.relays,this.users);this.store=new qd([e,t,r,n,a,s,i])}setUser(){var e;this.authUser=(e=this.pb)==null?void 0:e.authStore.model,this.authUser&&(this.user=new Rl(this.authUser),this.users.set(this.user.id,this.user))}login(){this.setUser(),this.buildGraph(),this.subscribe(),this.update()}logout(){var e;(e=this.store)==null||e.clear(),this.user=void 0,this.store=void 0}async getRelayInvitationKey(e){if(!this.pb)return"";let t=this.relayInvitations.find(r=>r.relay.id===e.id);return t!=null&&t.key?t.key:this.pb.collection("relay_invitations").getList(0,200).then(r=>{r.items.forEach(a=>{var s;(s=this.store)==null||s.ingest(a)});let n=this.relayInvitations.find(a=>a.relay.id===e.id);return n?n.key:""})}async subscribe(){var r;if(!this.pb||!this.pb.authStore.isValid||((r=this.pb.authStore.model)==null?void 0:r.id)===void 0)return;let e=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"subscriptions",expand:["user","relay"]}],t=(n,a)=>{var s,i;this.debug(`[Event]: ${n}`,a.action,a.record),a.action==="delete"?(s=this.store)==null||s.delete(a.record):(i=this.store)==null||i.ingest(a.record)};for(let n of e)this.pb.collection(n.name).subscribe("*",a=>t(n.name,a),{expand:n.expand.join(","),fetch:pn})}collection(e){this.pb}async update(){var e;if(!(!this.pb||!this.pb.authStore.isValid||((e=this.pb.authStore.model)==null?void 0:e.id)===void 0))try{await this.pb.collection("users").getOne(this.pb.authStore.model.id,{expand:"relay_roles_via_user,relay_roles_via_user.relay,relay_roles_via_user.role,subscriptions_via_user,subscriptions_via_user.relay"}).then(t=>{var r;(r=this.store)==null||r.ingest(t)}).catch(t=>{t.status===404&&this.loginManager.logout()}),await this.pb.collection("relay_roles").getFullList({expand:"user"}).then(t=>{t.forEach(r=>{var n;(n=this.store)==null||n.ingest(r)})}),await this.pb.collection("relay_invitations").getFullList().then(t=>{t.forEach(r=>{var n;(n=this.store)==null||n.ingest(r)})}),await this.pb.collection("shared_folders").getFullList({expand:"relay,creator"}).then(t=>{t.forEach(r=>{var n;(n=this.store)==null||n.ingest(r)})}),await this.pb.collection("subscriptions").getFullList({expand:"relay,user",fetch:pn}).then(t=>{t.forEach(r=>{var n;(n=this.store)==null||n.ingest(r)})})}catch(t){this.warn("error during update()",t)}}async acceptInvitation(e){var n;if(!this.pb)throw new Error("Failed to accept invitation");let t=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e})});this.debug("[InviteAccept]",t);let r=(n=this.store)==null?void 0:n.ingest(t);if(!r)throw new Error("Failed to accept invitation");return r}async createRelay(e){var a;let t=Qn(),r=await((a=this.pb)==null?void 0:a.collection("relays").create({guid:t,name:e,path:null}));if(!r)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let n=new Ol(r,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user);return this.relays.set(n.id,n),n}async updateRelay(e){var n;if(!this.pb)throw new Error("Failed to update relay");let t=await this.pb.collection("relays").update(e.id,{name:e.name.trim()}),r=(n=this.store)==null?void 0:n.ingest(t);if(!r)throw new Error("Failed to update relay");return r}async deleteRemote(e){var r;e.remote=void 0;let t=this.remoteFolders.find(n=>n.guid===e.guid);return t?(await((r=this.pb)==null?void 0:r.collection("shared_folders").delete(t.id)),e.remote=void 0,!0):!1}async createRemoteFolder(e,t){var a,s;if(!this.pb)throw new Error("Failed to create folder");let r=await this.pb.collection("shared_folders").create({name:e.name,guid:e.guid,relay:t.id,creator:(a=this.user)==null?void 0:a.id,private:!1},{expand:"relay"}),n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to create folder");return n}async destroyRelay(e){var t,r;return await((t=this.pb)==null?void 0:t.collection("relays").delete(e.id)),(r=this.store)==null||r.cascade("relays",e.id),!0}async leaveRelay(e){var r,n;let t=this.relayRoles.find(a=>{var s,i;return a.user.id===((s=this.user)==null?void 0:s.id)&&((i=a.relay)==null?void 0:i.id)===e.id});t?await((r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)):this.warn("No role found to leave relay"),(n=this.store)==null||n.cascade("relay",e.id)}async kick(e){var t;return(t=this.pb)==null?void 0:t.collection("relay_roles").delete(e.id)}destroy(){var e,t;this._offLoginManager&&this._offLoginManager(),(e=this.pb)==null||e.cancelAllRequests(),this.loginManager=null,this.pb=null,(t=this.store)==null||t.destroy(),this.authUser=null,this.store=null}};var Vy=require("obsidian");var Py=require("obsidian");var Dy=require("obsidian");function _A(o){Ie(o,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function Ay(o,e,t){let r=o.slice();return r[5]=e[t][0],r[6]=e[t][1],r}function Ty(o){let e,t,r,n=o[5]+"",a,s,i,f,c=o[5]+"",d,p,h,y,g,v,b,_,D,F,S,P,H;function R(){return o[2](o[5])}function V(){return o[3](o[5])}return{c(){e=E("div"),t=E("div"),r=E("div"),a=ee(n),s=W(),i=E("div"),f=ee("Toggle "),d=ee(c),p=ee(" on or off"),h=W(),y=E("div"),g=E("div"),v=E("input"),_=W(),D=E("div"),S=W(),L(r,"class","setting-item-name"),L(i,"class","setting-item-description"),L(t,"class","setting-item-info"),L(v,"type","checkbox"),v.checked=b=o[6],L(D,"class","checkbox-toggle"),L(g,"role","checkbox"),L(g,"aria-checked",F=o[6]),L(g,"tabindex","0"),L(g,"class","checkbox-container svelte-4kkvmr"),it(g,"is-enabled",o[6]),L(y,"class","setting-item-control"),L(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(O,te){C(O,e,te),M(e,t),M(t,r),M(r,a),M(t,s),M(t,i),M(i,f),M(i,d),M(i,p),M(e,h),M(e,y),M(y,g),M(g,v),M(g,_),M(g,D),M(e,S),P||(H=[Q(g,"keypress",R),Q(g,"click",V)],P=!0)},p(O,te){o=O,te&1&&n!==(n=o[5]+"")&&ie(a,n),te&1&&c!==(c=o[5]+"")&&ie(d,c),te&1&&b!==(b=o[6])&&(v.checked=b),te&1&&F!==(F=o[6])&&L(g,"aria-checked",F),te&1&&it(g,"is-enabled",o[6])},d(O){O&&k(e),P=!1,Ce(H)}}}function vA(o){let e,t,r,n,a,s=ot(Object.entries(o[0])),i=[];for(let f=0;f<s.length;f+=1)i[f]=Ty(Ay(o,s,f));return{c(){e=E("div"),t=E("h2"),t.textContent="Feature Flags",r=W(),n=E("p"),n.textContent="Make sure you reload obsidian after changing the flags below.",a=W();for(let f=0;f<i.length;f+=1)i[f].c();L(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(f,c){C(f,e,c),M(e,t),M(e,r),M(e,n),M(e,a);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(e,null)},p(f,[c]){if(c&3){s=ot(Object.entries(f[0]));let d;for(d=0;d<s.length;d+=1){let p=Ay(f,s,d);i[d]?i[d].p(p,c):(i[d]=Ty(p),i[d].c(),i[d].m(e,null))}for(;d<i.length;d+=1)i[d].d(1);i.length=s.length}},i:Y,o:Y,d(f){f&&k(e),fr(i,f)}}}function SA(o,e,t){let r=Ct.getInstance(),n=Object.assign({},r.flags);function a(f){t(0,n[f]=!n[f],n),r.setFlag(f,n[f],!0)}return Sr(()=>{Object.keys(n).forEach(f=>{let c=document.getElementById(`toggle-${f}`);c&&(0,Dy.setIcon)(c,"check")})}),[n,a,f=>{a(f)},f=>a(f)]}var Yd=class extends j{constructor(e){super(),X(this,e,SA,vA,J,{},_A)}},Ey=Yd;var $l=class extends Py.Modal{constructor(t){super(t)}onOpen(){let{contentEl:t}=this;this.component=new Ey({target:t})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var By=require("obsidian");function LA(o){Ie(o,"svelte-1h8zaiy",".object-state-display.svelte-1h8zaiy{padding:10px;margin-top:10px;font-family:monospace}pre.svelte-1h8zaiy{white-space:pre-wrap;word-wrap:break-word}")}function IA(o){let e,t,r=Object.keys(o[0]).join(`
`)+"",n,a;return{c(){e=E("div"),t=E("pre"),n=ee(r),a=ee(`
        `),L(t,"class","svelte-1h8zaiy"),L(e,"class","object-state-display svelte-1h8zaiy")},m(s,i){C(s,e,i),M(e,t),M(t,n),M(t,a)},p(s,[i]){i&1&&r!==(r=Object.keys(s[0]).join(`
`)+"")&&ie(n,r)},i:Y,o:Y,d(s){s&&k(e)}}}function kA(o,e,t){let{object:r}=e;return o.$$set=n=>{"object"in n&&t(0,r=n.object)},[r]}var Jd=class extends j{constructor(e){super(),X(this,e,kA,IA,J,{object:0},LA)}},My=Jd;var Uy=require("obsidian");function CA(o){let e,t,r;return{c(){e=E("button"),e.textContent="Refresh"},m(n,a){C(n,e,a),t||(r=Q(e,"click",(0,Uy.debounce)(o[10])),t=!0)},p:Y,d(n){n&&k(e),t=!1,r()}}}function AA(o){let e=navigator.userAgent+"",t;return{c(){t=ee(e)},m(r,n){C(r,t,n)},p:Y,d(r){r&&k(t)}}}function TA(o){let e;return{c(){e=ee(o[0])},m(t,r){C(t,e,r)},p(t,r){r&1&&ie(e,t[0])},d(t){t&&k(e)}}}function DA(o){let e;return{c(){e=ee(o[1])},m(t,r){C(t,e,r)},p(t,r){r&2&&ie(e,t[1])},d(t){t&&k(e)}}}function EA(o){let e;return{c(){e=ee(o[2])},m(t,r){C(t,e,r)},p(t,r){r&4&&ie(e,t[2])},d(t){t&&k(e)}}}function PA(o){let e,t,r,n,a,s,i,f,c,d,p,h,y,g,v,b,_;return n=new ft({props:{name:"Environment",$$slots:{default:[CA]},$$scope:{ctx:o}}}),s=new Be({props:{name:"User Agent",description:"",$$slots:{default:[AA]},$$scope:{ctx:o}}}),f=new Be({props:{name:"Fetch",description:"",$$slots:{default:[TA]},$$scope:{ctx:o}}}),d=new Be({props:{name:"Response",description:"",$$slots:{default:[DA]},$$scope:{ctx:o}}}),h=new Be({props:{name:"Blink Fetch",description:"",$$slots:{default:[EA]},$$scope:{ctx:o}}}),g=new ft({props:{name:"Connections"}}),b=new My({props:{object:o[3].cancelControllers}}),{c(){e=E("div"),e.textContent="Debug Information",t=W(),r=E("div"),N(n.$$.fragment),a=W(),N(s.$$.fragment),i=W(),N(f.$$.fragment),c=W(),N(d.$$.fragment),p=W(),N(h.$$.fragment),y=W(),N(g.$$.fragment),v=W(),N(b.$$.fragment),L(e,"class","modal-title"),L(r,"class","modal-content")},m(D,F){C(D,e,F),C(D,t,F),C(D,r,F),U(n,r,null),M(r,a),U(s,r,null),M(r,i),U(f,r,null),M(r,c),U(d,r,null),M(r,p),U(h,r,null),M(r,y),U(g,r,null),M(r,v),U(b,r,null),_=!0},p(D,[F]){let S={};F&2048&&(S.$$scope={dirty:F,ctx:D}),n.$set(S);let P={};F&2048&&(P.$$scope={dirty:F,ctx:D}),s.$set(P);let H={};F&2049&&(H.$$scope={dirty:F,ctx:D}),f.$set(H);let R={};F&2050&&(R.$$scope={dirty:F,ctx:D}),d.$set(R);let V={};F&2052&&(V.$$scope={dirty:F,ctx:D}),h.$set(V);let O={};F&8&&(O.object=D[3].cancelControllers),b.$set(O)},i(D){_||(I(n.$$.fragment,D),I(s.$$.fragment,D),I(f.$$.fragment,D),I(d.$$.fragment,D),I(h.$$.fragment,D),I(g.$$.fragment,D),I(b.$$.fragment,D),_=!0)},o(D){T(n.$$.fragment,D),T(s.$$.fragment,D),T(f.$$.fragment,D),T(d.$$.fragment,D),T(h.$$.fragment,D),T(g.$$.fragment,D),T(b.$$.fragment,D),_=!1},d(D){D&&(k(e),k(t),k(r)),$(n),$(s),$(f),$(d),$(h),$(g),$(b)}}}function Fy(){try{return Response.toString()}catch(o){return"undefined"}}function Ry(){try{return fetch.toString()}catch(o){return"undefined"}}function Oy(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function MA(o,e,t){let r,n,a,s,{plugin:i}=e,f=He(Fy());Oe(o,f,g=>t(1,n=g));let c=He(Ry());Oe(o,c,g=>t(0,r=g));let d=He(Oy());Oe(o,d,g=>t(2,a=g));let p=He(i.loginManager.pb);Oe(o,p,g=>t(3,s=g));function h(){f.set(Fy()),c.set(Ry()),d.set(Oy()),p.set(i.loginManager.pb)}let y=()=>{h()};return o.$$set=g=>{"plugin"in g&&t(9,i=g.plugin)},[r,n,a,s,f,c,d,p,h,i,y]}var jd=class extends j{constructor(e){super(),X(this,e,MA,PA,J,{plugin:9})}},$y=jd;var Bl=class extends By.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new $y({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var FA={sharedFolders:[],debugging:!1,...Oi},Nl=class extends Vy.Plugin{constructor(){super(...arguments);this.settingsFileLocked=!0;this.fileDiffMergeWarningKey="file-diff-merge-warning";this.version="0.4.1"}enableDebugging(t){Pi(!0),console.warn("RelayInstances",Nt),t&&(this.settings.debugging=!1,this.saveSettings())}disableDebugging(t){Pi(!1),t&&(this.settings.debugging=!1,this.saveSettings())}toggleDebugging(t){let r=!this.settings.debugging;return Pi(r),t&&(this.settings.debugging=r,this.saveSettings()),r}buildApiUrl(t){return"https://api.system3.md"+t}async onload(){Nt.set(this,"plugin"),this.timeProvider=new ia,this.register(()=>{this.timeProvider.destroy()}),rg(this.app.vault,this.timeProvider,".obsidian/plugins/system3-relay/relay.log",{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.log=ae("[System 3][Relay]","log"),this.warn=ae("[System 3][Relay]","warn"),await this.loadSettings();let t=Ct.getInstance();t.setFlags(this.settings),this._offFlagUpdates=t.subscribe(n=>{this.settings={...this.settings,...n.flags},this.saveSettings()}),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.settings.debugging&&(this.enableDebugging(),this.addCommand({id:"toggle-feature-flags",name:"Feature Flags",callback:()=>{new $l(this.app).open()}}),this.addCommand({id:"show-debug-info",name:"Show Debug Information",callback:()=>{new Bl(this.app,this).open()}})),this.vault=this.app.vault;let r=this.vault.getName();this.fileManager=this.app.fileManager,this.loginManager=new _l(this.vault.getName(),this.openSettings.bind(this),this.timeProvider),this.relayManager=new Ul(this.loginManager),this.sharedFolders=new $i(this.relayManager,this._createSharedFolder.bind(this)),this.tokenStore=new Fl(this.loginManager,this.timeProvider,r,3),this.networkStatus=new Iy(this.timeProvider,"https://api.system3.md/health?version=0.4.1"),this.backgroundSync=new Xi(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new jt.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.loadSharedFolders(this.settings.sharedFolders),this._liveViews=new tl(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),Ny.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(n=>n.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(ga,n=>new el(n)),this.registerEvent(this.app.workspace.on("file-menu",(n,a)=>{if(a instanceof jt.TFolder){let s=this.sharedFolders.find(i=>i.path===a.path);if(!s)return;n.addItem(i=>{i.setTitle(s.connected?"Disconnect":"Connect").setIcon("satellite").onClick(()=>{s.toggleConnection(),this._liveViews.refresh("folder connection toggle")})})}})),this.setup(),this.settingsFileLocked=!1,this._liveViews.refresh("init")})}loadSharedFolders(t){this.log("Loading shared folders");let r=this.settingsFileLocked;this.settingsFileLocked=!0;let n=!1;t.forEach(a=>{if(!this.vault.getFolderByPath(a.path)){this.warn(`[System 3][Relay][Shared Folder]: Invalid settings, ${a.path} does not exist`);return}this.sharedFolders._new(a.path,a.guid,a==null?void 0:a.relay),n=!0}),this._offSaveSettings||(this._offSaveSettings=this.sharedFolders.subscribe(()=>{this.saveSettings()})),this.settingsFileLocked=r,n&&this.sharedFolders.notifyListeners()}async _createSharedFolder(t,r,n,a){return new Ui(r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.backgroundSync,n,a)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.loadSharedFolders(this.settings.sharedFolders),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(){let t=this.app.setting;await t.open(),t.openTabById("system3-relay")}setup(){this.folderNavDecorations=new nl(this.vault,this.app.workspace,this.sharedFolders),this.folderNavDecorations.refresh(),this.settingsTab=new hl(this.app,this),this.addSettingTab(this.settingsTab);let t=ae("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",c=>{t("file-open"),i._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=ae("[System 3][Relay][Vault]","log"),n=c=>{let d=c.error;d&&d instanceof xn&&Fu(d)};window.addEventListener("error",n,!0),this.register(()=>window.removeEventListener("error",n,!0));let a=c=>{c.reason instanceof xn&&Fu(c.reason)},s=c=>a(c);window.addEventListener("unhandledrejection",s,!0),this.register(()=>window.removeEventListener("unhandledrejection",s,!0)),this.registerEvent(this.app.vault.on("create",c=>{if(c instanceof jt.TFolder)return;let d=this.sharedFolders.lookup(c.path);d&&d.whenReady().then(p=>{p.getFile(c.path,!0,!0)})})),this.registerEvent(this.app.vault.on("delete",c=>{if(c instanceof jt.TFolder){let p=this.sharedFolders.find(h=>h.path===c.path);p&&this.sharedFolders.delete(p);return}let d=this.sharedFolders.lookup(c.path);d&&(r("Delete",c.path),d.whenReady().then(p=>{p.deleteFile(c.path)}))})),this.registerEvent(this.app.vault.on("rename",(c,d)=>{if(c instanceof jt.TFolder){let g=this.sharedFolders.find(v=>v.path==d);g&&(g.path=c.path,this.sharedFolders.update());return}let p=this.sharedFolders.lookup(d),h=this.sharedFolders.lookup(c.path),y=p||h;p&&h?(r("Rename",c,d),p.renameFile(c.path,d),h.renameFile(c.path,d),this._liveViews.refresh("rename")):y&&(r("Rename",c,d),y.renameFile(c.path,d),this._liveViews.refresh("rename"))})),this.registerEvent(this.app.vault.on("modify",c=>{let d=this.sharedFolders.lookup(c.path);d&&(r("Modify",c.path),Nr(ir.enableUpdateYDocFromDiskBuffer,()=>{try{let p=d.getFile(c.path,!1,!1);this._liveViews.docIsOpen(p)||d.read(p).then(h=>{h.length!==0&&Zi(p.ydoc,h)})}catch(p){}}),this.app.metadataCache.trigger("resolve",c))}));let i=this,f=Cd(jt.MarkdownView.prototype,{onUnloadFile(c){return function(d){return i._liveViews.wipe(),c.call(this,d)}}});this.register(f),Nr(ir.enableNewLinkFormat,()=>{let c=Cd(jt.MetadataCache.prototype,{fileToLinktext(d){return function(p,h,y){if(i.sharedFolders.lookup(p.path)){y===void 0&&(y=!0);let v=p.extension==="md"&&y?p.basename:p.name,b=(0,jt.normalizePath)(p.name),_=app.metadataCache.uniqueFileLookup.get(b.toLowerCase());if(_&&_.length===1&&_[0]===p)return v;{let D=p.extension==="md"&&y?p.path.slice(0,p.path.length-3):p.path,F=(0,Hy.relative)(h,D);return F==="../"+v?"./"+v:F}}return d.call(this,p,h,y)}}});this.register(c)})}onunload(){var t,r,n,a,s,i,f,c,d,p,h,y,g,v;this.settingsFileLocked=!0,(t=this._offFlagUpdates)==null||t.call(this),this._offFlagUpdates=null,(r=this._offSaveSettings)==null||r.call(this),this._offSaveSettings=null,(n=this.timeProvider)==null||n.destroy(),(a=this.folderNavDecorations)==null||a.destroy(),this.app.workspace.detachLeavesOfType(ga),(s=this.backgroundSync)==null||s.destroy(),this.backgroundSync=null,(i=this._liveViews)==null||i.destroy(),this._liveViews=null,(f=this.relayManager)==null||f.destroy(),this.relayManager=null,(c=this.tokenStore)==null||c.stop(),(d=this.tokenStore)==null||d.clearState(),(p=this.tokenStore)==null||p.destroy(),this.tokenStore=null,(h=this.networkStatus)==null||h.stop(),(y=this.networkStatus)==null||y.destroy(),this.networkStatus=null,this.sharedFolders.destroy(),this.sharedFolders=null,(g=this.settingsTab)==null||g.destroy(),this.settingsTab=null,(v=this.loginManager)==null||v.destroy(),this.loginManager=null,this.app.workspace.updateOptions(),this.app=null,this.fileManager=null,this.manifest=null,this.vault=null,Ct.destroy(),sr.destroy(),ig(),Mu()}async loadSettings(){this.settings=Object.assign({},FA,await this.loadData())}async saveSettings(){this.settingsFileLocked?this.log("Saving settings: settings file locked"):(this.settings.sharedFolders=this.sharedFolders.toSettings(),this.log("Saving settings",this.settings),await this.saveData(this.settings),Ct.getInstance().setFlags(this.settings))}};
/*! Bundled license information:

moment/moment.js:
  (*! moment.js *)
  (*! version : 2.29.4 *)
  (*! authors : Tim Wood, Iskren Chernev, Moment.js contributors *)
  (*! license : MIT *)
  (*! momentjs.com *)

lucide-svelte/dist/defaultAttributes.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-right.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-help.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/layers.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/message-square-heart.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/satellite.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/settings.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/index.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/aliases.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/

/* nosourcemap */